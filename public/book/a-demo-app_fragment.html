

<h1 class="title">Ruby on Rails チュートリアル </h1>


<h1 class="subtitle"> 実例を使ってRailsを学ぼう</h1>


<h2 class="author">Michael Hartl (マイケル・ハートル)</h2>




<h1 class="contents">目次</h1>


<div id="table_of_contents"><ol><li class="chapter"><a href="beginning#top"><span class="number">第1章</span> ゼロからデプロイまで</a></li><li><ol><li class="section"><a href="beginning#sec:introduction"><span class="number">1.1</span>　はじめに</a></li><li><ol><li class="subsection"><a href="beginning#sec:comments_for_various_readers"><span class="number">1.1.1</span> 読者の皆さまへのコメント</a></li><li class="subsection"><a href="beginning#sec:1.1.2"><span class="number">1.1.2</span> Railsとスケールについて</a></li><li class="subsection"><a href="beginning#sec:conventions"><span class="number">1.1.3</span> この本における取り決め</a></li></ol></li><li class="section"><a href="beginning#sec:up_and_running"><span class="number">1.2</span> さっそく動作させる</a></li><li><ol><li class="subsection"><a href="beginning#sec:development_tools"><span class="number">1.2.1</span> 開発環境</a></li><li><ol><li class="subsubsection"><a href="beginning#sec:1.2.1.1">IDEs</a></li><li class="subsubsection"><a href="beginning#sec:1.2.1.2">テキストエディタとコマンドライン</a></li><li class="subsubsection"><a href="beginning#sec:1.2.1.3">ブラウザ</a></li><li class="subsubsection"><a href="beginning#sec:1.2.1.4">使用するツールについて</a></li></ol></li><li class="subsection"><a href="beginning#sec:rubygems"><span class="number">1.2.2</span> Ruby, RubyGems, Rails, そして Git</a></li><li><ol><li class="subsubsection"><a href="beginning#sec:rails_installer_windows">Rails インストーラ (Windows)</a></li><li class="subsubsection"><a href="beginning#sec:install_git">Gitのインストール</a></li><li class="subsubsection"><a href="beginning#sec:install_ruby">Rubyのインストール</a></li><li class="subsubsection"><a href="beginning#sec:install_rubygems">RubyGemsのインストール</a></li><li class="subsubsection"><a href="beginning#sec:install_rails">Railsのインストール</a></li></ol></li><li class="subsection"><a href="beginning#sec:the_first_application"><span class="number">1.2.3</span> 最初のアプリケーション</a></li><li class="subsection"><a href="beginning#sec:bundler"><span class="number">1.2.4</span> Bundler</a></li><li class="subsection"><a href="beginning#sec:rails_server"><span class="number">1.2.5</span> <code>rails server</code></a></li><li class="subsection"><a href="beginning#sec:mvc"><span class="number">1.2.6</span> Model-view-controller (MVC)</a></li></ol></li><li class="section"><a href="beginning#sec:version_control"><span class="number">1.3</span> Gitによるバージョン管理</a></li><li><ol><li class="subsection"><a href="beginning#sec:git_setup"><span class="number">1.3.1</span> インストールとセットアップ</a></li><li><ol><li class="subsubsection"><a href="beginning#sec:1.3.1.1">最初のシステム・セットアップ</a></li><li class="subsubsection"><a href="beginning#sec:1.3.1.2">最初のリポジトリ・セットアップ</a></li></ol></li><li class="subsection"><a href="beginning#sec:adding_and_committing"><span class="number">1.3.2</span> 追加とコミット</a></li><li class="subsection"><a href="beginning#sec:1.3.3"><span class="number">1.3.3</span> Gitの利点とは？</a></li><li class="subsection"><a href="beginning#sec:github"><span class="number">1.3.4</span> GitHub</a></li><li class="subsection"><a href="beginning#sec:git_commands"><span class="number">1.3.5</span> ブランチ(branch)、変更(edit)、 コミット(commit)、 統合(merge)</a></li><li><ol><li class="subsubsection"><a href="beginning#sec:git_branch">ブランチ(branch)</a></li><li class="subsubsection"><a href="beginning#sec:git_edit">Edit</a></li><li class="subsubsection"><a href="beginning#sec:git_commit">Commit</a></li><li class="subsubsection"><a href="beginning#sec:git_merge">統合(merge)</a></li><li class="subsubsection"><a href="beginning#sec:git_push">Push</a></li></ol></li></ol></li><li class="section"><a href="beginning#sec:deploying"><span class="number">1.4</span> デプロイする</a></li><li><ol><li class="subsection"><a href="beginning#sec:1.4.1"><span class="number">1.4.1</span> Herokuのセットアップ</a></li><li class="subsection"><a href="beginning#sec:heroku_step_one"><span class="number">1.4.2</span> Herokuにデプロイする　(1)</a></li><li class="subsection"><a href="beginning#sec:1.4.3"><span class="number">1.4.3</span> Herokuにデプロイする (2)</a></li><li class="subsection"><a href="beginning#sec:heroku_commands"><span class="number">1.4.4</span> Heroku コマンド</a></li></ol></li><li class="section"><a href="beginning#sec:beginning_conclusion"><span class="number">1.5</span> 最後に</a></li></ol></li><li class="chapter"><a href="a-demo-app#top"><span class="number">第２章</span>　デモアプリケーション</a></li><li><ol><li class="section"><a href="a-demo-app#sec:planning_the_application"><span class="number">2.1</span> アプリの計画</a></li><li><ol><li class="subsection"><a href="a-demo-app#sec:modeling_users"><span class="number">2.1.1</span> ユーザーのモデル</a></li><li class="subsection"><a href="a-demo-app#sec:modeling_microposts"><span class="number">2.1.2</span> マイクロプロストのモデル</a></li></ol></li><li class="section"><a href="a-demo-app#sec:demo_users_resource"><span class="number">2.2</span> Usersリソース</a></li><li><ol><li class="subsection"><a href="a-demo-app#sec:a_user_tour"><span class="number">2.2.1</span> ユーザーページを見てみる</a></li><li class="subsection"><a href="a-demo-app#sec:mvc_in_action"><span class="number">2.2.2</span> 作動中のMVC </a></li><li class="subsection"><a href="a-demo-app#sec:weaknesses_of_this_users_resource"><span class="number">2.2.3</span> Usersリソースの欠点</a></li></ol></li><li class="section"><a href="a-demo-app#sec:microposts_resource"><span class="number">2.3</span> Microposts リソース</a></li><li><ol><li class="subsection"><a href="a-demo-app#sec:a_micropost_microtour"><span class="number">2.3.1</span> マイクロポストのページを見てみる</a></li><li class="subsection"><a href="a-demo-app#sec:putting_the_micro_in_microposts"><span class="number">2.3.2</span> マイクロポストを <em>マイクロ</em> にする</a></li><li class="subsection"><a href="a-demo-app#sec:demo_user_has_many_microposts"><span class="number">2.3.3</span> ユーザーとマイクロポストを <code>has_many</code> で関連づける</a></li><li class="subsection"><a href="a-demo-app#sec:inheritance_hierarchies"><span class="number">2.3.4</span> 継承階層</a></li><li class="subsection"><a href="a-demo-app#sec:deploying_the_demo_app"><span class="number">2.3.5</span>デモアプリケーションのデプロイ</a></li></ol></li><li class="section"><a href="a-demo-app#sec:2.4"><span class="number">2.4</span> 最後に</a></li></ol></li><li class="chapter"><a href="static-pages#top"><span class="number">第3章</span>主に静的ページの作成</a></li><li><ol><li class="section"><a href="static-pages#sec:static_pages"><span class="number">3.1</span> 静的ページ</a></li><li><ol><li class="subsection"><a href="static-pages#sec:truly_static_pages"><span class="number">3.1.1</span> 「本当に」静的なページ</a></li><li class="subsection"><a href="static-pages#sec:static_pages_with_rails"><span class="number">3.1.2</span> Railsでの静的なページ</a></li></ol></li><li class="section"><a href="static-pages#sec:first_tests"><span class="number">3.2</span> 最初のテスト</a></li><li><ol><li class="subsection"><a href="static-pages#sec:testing_tools"><span class="number">3.2.1</span> テストに使用するツール</a></li><li><ol><li class="subsubsection"><a href="static-pages#sec:autotest">Autotest</a></li></ol></li><li class="subsection"><a href="static-pages#sec:TDD"><span class="number">3.2.2</span> TDD: 赤(Red), 緑(Green), リファクタリング</a></li><li><ol><li class="subsubsection"><a href="static-pages#sec:spork">Spork</a></li><li class="subsubsection"><a href="static-pages#sec:red">赤(Red)</a></li><li class="subsubsection"><a href="static-pages#sec:green">緑(Green)</a></li><li class="subsubsection"><a href="static-pages#sec:refactor">リファクタリング</a></li></ol></li></ol></li><li class="section"><a href="static-pages#sec:slightly_dynamic_pages"><span class="number">3.3</span> ちょっとだけ動的なページ</a></li><li><ol><li class="subsection"><a href="static-pages#sec:testing_a_title_change"><span class="number">3.3.1</span> タイトル変更のテスト</a></li><li class="subsection"><a href="static-pages#sec:passing_title_tests"><span class="number">3.3.2</span> タイトルのテストをパスさせる</a></li><li class="subsection"><a href="static-pages#sec:instance_variables_embedded_ruby"><span class="number">3.3.3</span> インスタンス変数とEmbedded Ruby</a></li><li class="subsection"><a href="static-pages#sec:layouts"><span class="number">3.3.4</span> レイアウトを使って重複をなくす</a></li></ol></li><li class="section"><a href="static-pages#sec:static_pages_conclusion"><span class="number">3.4</span> 最後に</a></li><li class="section"><a href="static-pages#sec:static_pages_exercises"><span class="number">3.5</span> 練習</a></li></ol></li><li class="chapter"><a href="rails-flavored-ruby#top"><span class="number">第4章</span> Rails風味のRuby</a></li><li><ol><li class="section"><a href="rails-flavored-ruby#sec:motivation"><span class="number">4.1</span> 動機</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec:title_helper"><span class="number">4.1.1</span> <code>title</code> ヘルパー</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:cascading_style_sheets"><span class="number">4.1.2</span> スタイルシート(CSS)</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec:strings_and_methods"><span class="number">4.2</span> 文字列(string）とメソッド</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec:comments"><span class="number">4.2.1</span> コメント</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:strings"><span class="number">4.2.2</span> 文字列</a></li><li><ol><li class="subsubsection"><a href="rails-flavored-ruby#sec:printing">出力</a></li><li class="subsubsection"><a href="rails-flavored-ruby#sec:single_quoted_strings">シングルクォート内の文字列</a></li></ol></li><li class="subsection"><a href="rails-flavored-ruby#sec:objects_and_message_passing"><span class="number">4.2.3</span> オブジェクトとメッセージパッシング</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:method_definitions"><span class="number">4.2.4</span>メソッドの定義</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:back_to_the_title_helper"><span class="number">4.2.5</span> <code>title</code> ヘルパー、再び</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec:other_data_structures"><span class="number">4.3</span> 他のデータ構造</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec:arrays_and_ranges"><span class="number">4.3.1</span> 配列と範囲演算子</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:blocks"><span class="number">4.3.2</span>ブロック</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:hashes_and_symbols"><span class="number">4.3.3</span> ハッシュとシンボル</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:css_revisited"><span class="number">4.3.4</span> CSS 再び</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec:ruby_classes"><span class="number">4.4</span> Ruby におけるクラス</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec:constructors"><span class="number">4.4.1</span> コンストラクタ</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:a_class_of_our_own"><span class="number">4.4.2</span> クラス継承</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:modifying_built_in_classes"><span class="number">4.4.3</span> 組み込み関数の変更</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:a_controller_class"><span class="number">4.4.4</span> コントローラクラス</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:a_user_class"><span class="number">4.4.5</span> ユーザークラス</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec:exercises"><span class="number">4.5</span> 練習</a></li></ol></li><li class="chapter"><a href="filling-in-the-layout#top"><span class="number">第5章</span> レイアウトを埋める</a></li><li><ol><li class="section"><a href="filling-in-the-layout#sec:structure"><span class="number">5.1</span> 構造を少し追加する</a></li><li><ol><li class="subsection"><a href="filling-in-the-layout#sec:adding_to_the_layout"><span class="number">5.1.1</span> ナビゲーション</a></li><li class="subsection"><a href="filling-in-the-layout#sec:custom_css"><span class="number">5.1.2</span> カスタム・CSS/a></li><li class="subsection"><a href="filling-in-the-layout#sec:partials"><span class="number">5.1.3</span> パーシャル(partial)</a></li></ol></li><li class="section"><a href="filling-in-the-layout#sec:layout_links"><span class="number">5.2</span> レイアウトのリンク</a></li><li><ol><li class="subsection"><a href="filling-in-the-layout#sec:integration_tests"><span class="number">5.2.1</span> 統合テスト（インテグレーションテスト）</a></li><li class="subsection"><a href="filling-in-the-layout#sec:rails_routes"><span class="number">5.2.2</span> Rails ルート</a></li><li class="subsection"><a href="filling-in-the-layout#sec:named_routes"><span class="number">5.2.3</span> 名前付きルート</a></li></ol></li><li class="section"><a href="filling-in-the-layout#sec:user_signup"><span class="number">5.3</span> 第1歩:ユーザー登録</a></li><li><ol><li class="subsection"><a href="filling-in-the-layout#sec:users_controller"><span class="number">5.3.1</span> Users コントローラ</a></li><li class="subsection"><a href="filling-in-the-layout#sec:signup_url"><span class="number">5.3.2</span> ユーザー登録URL</a></li></ol></li><li class="section"><a href="filling-in-the-layout#sec:layout_conclusion"><span class="number">5.4</span> Conclusion</a></li><li class="section"><a href="filling-in-the-layout#sec:layout_exercises"><span class="number">5.5</span> 練習</a></li></ol></li><li class="chapter"><a href="modeling-and-viewing-users-one#top"><span class="number">第6章</span> ユーザーのモデルと表示(1)</a></li><li><ol><li class="section"><a href="modeling-and-viewing-users-one#sec:user_model"><span class="number">6.1</span> User モデル</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-one#sec:database_migrations"><span class="number">6.1.1</span> データベース・マイグレーション</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:the_model_file"><span class="number">6.1.2</span> モデルのファイル</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:model_annotation">モデルの注釈</a></li><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:accessible_attributes">accessibleな属性</a></li></ol></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:creating_user_objects"><span class="number">6.1.3</span> ユーザーオブジェクトの生成</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:finding_user_objects"><span class="number">6.1.4</span> ユーザーオブジェクトの検索</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:updating_user_objects"><span class="number">6.1.5</span> ユーザーオブジェクトの更新</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-one#sec:user_validations"><span class="number">6.2</span> ユーザーのバリデーション(確認)</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-one#sec:presence_validation"><span class="number">6.2.1</span> 存在のバリデーション</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:length_validation"><span class="number">6.2.2</span> 長さのバリデーション</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:format_validation"><span class="number">6.2.3</span> 形式のバリデーション</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:uniqueness_validation"><span class="number">6.2.4</span> 一意性(Uniqueness)のバリデーション</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:the_caveat">一意性(Uniqueness）の問題点</a></li></ol></li></ol></li><li class="section"><a href="modeling-and-viewing-users-one#sec:viewing_users"><span class="number">6.3</span> ユーザーを表示する</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-one#sec:rails_environments"><span class="number">6.3.1</span> Rails環境とデバッギング</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:users_show"><span class="number">6.3.2</span> ユーザーのモデル,ビュー,コントローラ(MVC)</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:a_users_resource"><span class="number">6.3.3</span> Users リソース</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:params_in_debug"><code>debug</code>での<code>params</code> </a></li></ol></li></ol></li><li class="section"><a href="modeling-and-viewing-users-one#sec:6.4"><span class="number">6.4</span> 最後に</a></li><li class="section"><a href="modeling-and-viewing-users-one#sec:6.5"><span class="number">6.5</span> 練習</a></li></ol></li><li class="chapter"><a href="modeling-and-viewing-users-two#top"><span class="number">第7章</span> ユーザーのモデルと表示(2)</a></li><li><ol><li class="section"><a href="modeling-and-viewing-users-two#sec:insecure_passwords"><span class="number">7.1</span> 危険なパスワード</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_validations"><span class="number">7.1.1</span>パスワードのバリデーション</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_migration"><span class="number">7.1.2</span> パスワードのマイグレーション</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_active_record_callback"><span class="number">7.1.3</span> Active Record コールバック</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec:secure_passwords"><span class="number">7.2</span> 安全なパスワード</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_secure_password_test"><span class="number">7.2.1</span> 安全なパスワードのテスト</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:secure_password_theory"><span class="number">7.2.2</span> パスワードの安全性について</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:implementing_has_password"><span class="number">7.2.3</span> <code>has_password?</code>の実装</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_authenticate_method"><span class="number">7.2.4</span> 認証メソッド</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec:better_user_views"><span class="number">7.3</span> ユーザービューを改良する</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec:tests_with_factories"><span class="number">7.3.1</span> factoryを使ったユーザー表示ページのテスト</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_name_and_a_gravatar"><span class="number">7.3.2</span> 名前とGravatar</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-two#sec:a_gravatar_helper">Gravatar用ヘルパー</a></li></ol></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_user_sidebar"><span class="number">7.3.3</span> ユーザーサイドバー</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec:7.4"><span class="number">7.4</span> 最後に</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec:7.4.1"><span class="number">7.4.1</span> Git コミット</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:heroku_deploy"><span class="number">7.4.2</span> Heroku デプロイ</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec:more_modeling_users_exercises"><span class="number">7.5</span>練習</a></li></ol></li><li class="chapter"><a href="sign-up#top"><span class="number">第8章</span> ユーザー登録</a></li><li><ol><li class="section"><a href="sign-up#sec:signup_form"><span class="number">8.1</span> ユーザー登録用フォーム</a></li><li><ol><li class="subsection"><a href="sign-up#sec:using_form_for"><span class="number">8.1.1</span> <code>form_for</code>を使用する</a></li><li class="subsection"><a href="sign-up#sec:the_form_html"><span class="number">8.1.2</span> フォームのHTML</a></li></ol></li><li class="section"><a href="sign-up#sec:signup_failure"><span class="number">8.2</span> ユーザー登録失敗</a></li><li><ol><li class="subsection"><a href="sign-up#sec:testing_failure"><span class="number">8.2.1</span> 登録失敗のテスト</a></li><li class="subsection"><a href="sign-up#sec:a_working_form"><span class="number">8.2.2</span> 正常に動くフォーム</a></li><li class="subsection"><a href="sign-up#sec:signup_error_messages"><span class="number">8.2.3</span> ユーザー登録失敗時のエラーメッセージ</a></li><li class="subsection"><a href="sign-up#sec:filtering_parameter_logging"><span class="number">8.2.4</span> パラメータ・ログをフィルターする</a></li></ol></li><li class="section"><a href="sign-up#sec:signup_success"><span class="number">8.3</span> ユーザー登録成功</a></li><li><ol><li class="subsection"><a href="sign-up#sec:testing_success"><span class="number">8.3.1</span> ユーザー登録成功のテスト</a></li><li class="subsection"><a href="sign-up#sec:the_finished_signup_form"><span class="number">8.3.2</span> ユーザー登録用フォームの完成</a></li><li class="subsection"><a href="sign-up#sec:the_flash"><span class="number">8.3.3</span> flash</a></li><li class="subsection"><a href="sign-up#sec:the_first_signup"><span class="number">8.3.4</span> 実際にユーザーを登録させてみる</a></li></ol></li><li class="section"><a href="sign-up#sec:rspec_integration_tests"><span class="number">8.4</span> RSpec インテグレーションテスト</a></li><li><ol><li class="subsection"><a href="sign-up#sec:integration_tests_with_style"><span class="number">8.4.1</span> 華やかなインテグレーションテスト</a></li><li class="subsection"><a href="sign-up#sec:failed_signup"><span class="number">8.4.2</span> ユーザー登録失敗時に、新しいユーザーが作成されない事をテスト</a></li><li class="subsection"><a href="sign-up#sec:successful_signup"><span class="number">8.4.3</span> ユーザー登録成功時に、新しいユーザーが正しく作成される事をテスト認</a></li></ol></li><li class="section"><a href="sign-up#sec:8.5"><span class="number">8.5</span> 最後に</a></li><li class="section"><a href="sign-up#sec:signup_exercises"><span class="number">8.6</span> 練習</a></li></ol></li><li class="chapter"><a href="sign-in-sign-out#top"><span class="number">第9章</span> サインイン、サインアウト</a></li><li><ol><li class="section"><a href="sign-in-sign-out#sec:sessions"><span class="number">9.1</span> Session</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec:sessions_controller"><span class="number">9.1.1</span> Sessionコントローラ</a></li><li class="subsection"><a href="sign-in-sign-out#sec:signin_form"><span class="number">9.1.2</span> サインイン用フォーム</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec:signin_failure"><span class="number">9.2</span> サインイン失敗</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec:reviewing_form_submission"><span class="number">9.2.1</span>フォーム送信について</a></li><li class="subsection"><a href="sign-in-sign-out#sec:failed_signin"><span class="number">9.2.2</span> サインイン失敗(テストと実装)</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec:signin_success"><span class="number">9.3</span> サインイン成功</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec:the_completed_create_action"><span class="number">9.3.1</span>　<code>create</code>アクションの完成</a></li><li class="subsection"><a href="sign-in-sign-out#sec:remember_me"><span class="number">9.3.2</span> ユーザー情報の保存</a></li><li class="subsection"><a href="sign-in-sign-out#sec:current_user"><span class="number">9.3.3</span> 現在のユーザー</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec:signing_out"><span class="number">9.4</span> サインアウト</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec:destroying_sessions"><span class="number">9.4.1</span> セッションの破棄</a></li><li class="subsection"><a href="sign-in-sign-out#sec:signin_upon_signup"><span class="number">9.4.2</span> ユーザー登録時にサインインさせる</a></li><li class="subsection"><a href="sign-in-sign-out#sec:changing_the_layout_links"><span class="number">9.4.3</span> レイアウトのリンクを変更する</a></li><li class="subsection"><a href="sign-in-sign-out#sec:signin_out_integration_tests"><span class="number">9.4.4</span> サインイン・サインアウトのインテグレーションテスト</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec:9.5"><span class="number">9.5</span> 最後に</a></li><li class="section"><a href="sign-in-sign-out#sec:sign_in_out_exercises"><span class="number">9.6</span> 練習</a></li></ol></li><li class="chapter"><a href="updating-showing-and-deleting-users#top"><span class="number">Chapter 10</span> ユーザーの更新・表示・削除</a></li><li><ol><li class="section"><a href="updating-showing-and-deleting-users#sec:updating_users"><span class="number">10.1</span> ユーザーの更新</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec:edit_form"><span class="number">10.1.1</span> ユーザー編集用のフォーム</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:enabling_edits"><span class="number">10.1.2</span> ユーザー編集機能の実装</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec:protecting_pages"><span class="number">10.2</span> ページの保護</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_signed_in_users"><span class="number">10.2.1</span> ユーザーがサインインしている事を確認する</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_the_right_user"><span class="number">10.2.2</span> 正しいユーザーである事を確認する</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:friendly_forwarding"><span class="number">10.2.3</span> 転送機能の改良</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec:showing_users"><span class="number">10.3</span> ユーザーを表示する</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec:user_index"><span class="number">10.3.1</span> ユーザーのインデックス</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:sample_users"><span class="number">10.3.2</span> サンプル用ユーザー</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:pagination"><span class="number">10.3.3</span> ページ送り</a></li><li><ol><li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:testing_pagination">ページ送りのテスト</a></li></ol></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:partial_refactoring"><span class="number">10.3.4</span> パーシャル(partial)のリファクタリング</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec:destroying_users"><span class="number">10.4</span> ユーザーの削除</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec:administrative_users"><span class="number">10.4.1</span> 管理権限を持ったユーザー</a></li><li><ol><li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:revisiting_attr_accessible"><code>attr_accessible</code>再び</a></li></ol></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:the_destroy_action"><span class="number">10.4.2</span> The <code>destroy</code> アクション</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec:10.5"><span class="number">10.5</span> 最後に</a></li><li class="section"><a href="updating-showing-and-deleting-users#sec:updating_deleting_exercises"><span class="number">10.6</span> 練習</a></li></ol></li><li class="chapter"><a href="user-microposts#top"><span class="number">Chapter 11</span> ユーザーのマイクロポスト</a></li><li><ol><li class="section"><a href="user-microposts#sec:a_micropost_model"><span class="number">11.1</span> マイクロポストのモデル</a></li><li><ol><li class="subsection"><a href="user-microposts#sec:the_basic_model"><span class="number">11.1.1</span>基本的なモデル</a></li><li><ol><li class="subsubsection"><a href="user-microposts#sec:accessible_attribute">Accessible 属性</a></li></ol></li><li class="subsection"><a href="user-microposts#sec:user_micropost_associations"><span class="number">11.1.2</span> User/Micropost の関連づけ</a></li><li class="subsection"><a href="user-microposts#sec:ordering_and_dependency"><span class="number">11.1.3</span> Micropost を改良する</a></li><li><ol><li class="subsubsection"><a href="user-microposts#sec:default_scope">デフォルトのスコープ</a></li><li class="subsubsection"><a href="user-microposts#sec:dependent_destroy">Dependent: destroy</a></li></ol></li><li class="subsection"><a href="user-microposts#sec:micropost_validations"><span class="number">11.1.4</span> マイクロポストのバリデーション</a></li></ol></li><li class="section"><a href="user-microposts#sec:showing_microposts"><span class="number">11.2</span> マイクロポストの表示</a></li><li><ol><li class="subsection"><a href="user-microposts#sec:augmenting_the_user_show_page"><span class="number">11.2.1</span> ユーザー表次ページの機能拡張</a></li><li class="subsection"><a href="user-microposts#sec:sample_microposts"><span class="number">11.2.2</span> サンプル用マイクロポスト</a></li></ol></li><li class="section"><a href="user-microposts#sec:manipulating_microposts"><span class="number">11.3</span> マイクロポストを扱う</a></li><li><ol><li class="subsection"><a href="user-microposts#sec:access_control"><span class="number">11.3.1</span> アクセス管理</a></li><li class="subsection"><a href="user-microposts#sec:creating_microposts"><span class="number">11.3.2</span> マイクロポストの作成</a></li><li class="subsection"><a href="user-microposts#sec:a_proto_feed"><span class="number">11.3.3</span> フィードの原型</a></li><li class="subsection"><a href="user-microposts#sec:destroying_microposts"><span class="number">11.3.4</span> マイクロポストの削除</a></li><li class="subsection"><a href="user-microposts#sec:testing_the_new_home_page"><span class="number">11.3.5</span> 新しいhomeページのテスト</a></li></ol></li><li class="section"><a href="user-microposts#sec:11.4"><span class="number">11.4</span> 最後に</a></li><li class="section"><a href="user-microposts#sec:micropost_exercises"><span class="number">11.5</span> 練習</a></li></ol></li><li class="chapter"><a href="following-users#top"><span class="number">Chapter 12</span> ユーザーをフォローする</a></li><li><ol><li class="section"><a href="following-users#sec:the_relationship_model"><span class="number">12.1</span> Relationshipのモデル</a></li><li><ol><li class="subsection"><a href="following-users#sec:a_problem_with_the_data_model"><span class="number">12.1.1</span> データモデルの問題点(と解決法)</a></li><li class="subsection"><a href="following-users#sec:relationship_user_associations"><span class="number">12.1.2</span> UsersとRelationshipsの関連</a></li><li class="subsection"><a href="following-users#sec:relationship_validations"><span class="number">12.1.3</span>バリデーション</a></li><li class="subsection"><a href="following-users#sec:following"><span class="number">12.1.4</span> 「フォローしている」ユーザー</a></li><li class="subsection"><a href="following-users#sec:followers"><span class="number">12.1.5</span> 「フォローされている」ユーザー</a></li></ol></li><li class="section"><a href="following-users#sec:a_web_interface_for_following_and_followers"><span class="number">12.2</span> 「フォローしている・されている」用のウェブ・インターフェース</a></li><li><ol><li class="subsection"><a href="following-users#sec:sample_following_data"><span class="number">12.2.1</span> 「フォローしている」用のサンプルデータ</a></li><li class="subsection"><a href="following-users#sec:stats_and_a_follow_form"><span class="number">12.2.2</span> 統計とフォロー用のフォーム</a></li><li class="subsection"><a href="following-users#sec:following_and_followers_pages"><span class="number">12.2.3</span> 「フォローしている」と「フォローされている」のページ</a></li><li class="subsection"><a href="following-users#sec:a_working_follow_button_the_standard_way"><span class="number">12.2.4</span> 「フォローする」ボタン(Ajaxなし)</a></li><li class="subsection"><a href="following-users#sec:a_working_follow_button_with_ajax"><span class="number">12.2.5</span> 「フォローする」ボタン(Ajaxあり)</a></li></ol></li><li class="section"><a href="following-users#sec:the_status_feed"><span class="number">12.3</span> ステータスフィード</a></li><li><ol><li class="subsection"><a href="following-users#sec:motivation_and_strategy"><span class="number">12.3.1</span> 動機と計画</a></li><li class="subsection"><a href="following-users#sec:a_first_feed_implementation"><span class="number">12.3.2</span> ステータスフィードの実装</a></li><li class="subsection"><a href="following-users#sec:scopes_subselects_and_a_lambda"><span class="number">12.3.3</span> スコープ, サブセレクト, そしてlambda</a></li><li class="subsection"><a href="following-users#sec:the_new_status_feed"><span class="number">12.3.4</span> 新しいステータスフィード</a></li></ol></li><li class="section"><a href="following-users#sec:following_conclusion"><span class="number">12.4</span> 最後に</a></li><li><ol><li class="subsection"><a href="following-users#sec:extensions_to_the_sample_application"><span class="number">12.4.1</span> サンプルアプリケーションの機能拡大</a></li><li><ol><li class="subsubsection"><a href="following-users#sec:replies">返信機能</a></li><li class="subsubsection"><a href="following-users#sec:messaging">メッセージ機能</a></li><li class="subsubsection"><a href="following-users#sec:follower_notifications">フォロワーの通知</a></li><li class="subsubsection"><a href="following-users#sec:password_reminders">パスワードリマインダー</a></li><li class="subsubsection"><a href="following-users#sec:signup_confirmation">ユーザーの登録確認</a></li><li class="subsubsection"><a href="following-users#sec:rss_feed">RSSフィード</a></li><li class="subsubsection"><a href="following-users#sec:rest_api">REST API</a></li><li class="subsubsection"><a href="following-users#sec:search">検索機能</a></li></ol></li><li class="subsection"><a href="following-users#sec:guide_to_further_resources"><span class="number">12.4.2</span>読み物ガイド</a></li></ol></li><li class="section"><a href="following-users#sec:following_exercises"><span class="number">12.5</span> 練習</a></li></ol></li></ol></div>

<div id="main_content"></div>


<p> <span class="preamble">
 <span id="foreword">
<strong> 前書き
</strong> <br />
 </span>
 </span></p>

<p>私が前にいた会社(CD Baby)は、かなり早い段階でRuby on Railsに乗り換え、そしてまたPHPに戻っていった会社でした。(詳細は私の名前をGoogleで検索してみて下さい)　Michael Hartl氏によるこの本を強く進められて、これはやってみなければ、と試してみたところ、私が再びRailsに乗り換えるのに使用したのがこの<em>Ruby on Railsチュートリアル</em>でした。</p>

<p>私は多数のRails本を参考にしてきましたが、決定的だったのはこれです。本書では全ての手順が&ldquo;Rails way&rdquo;(「Rails方式」)で行われており、始めは慣れない方式でしたが、この本を終えた今、やっと自然な方式だと感じる事が出来るようになりました。また、本書はRails本の中で唯一、全編を通して強く推奨されているTDD(Test Driven Development-テスト駆動開発)を行っており、非常に分かりやすく解説されています。最後に、Git、GitHub、そしてHerokuを実例に含む事で、チュートリアルのコード例も含め実際のプロジェクトの開発プロセスを体験出来るようになっています。</p>

<p>この物語風の直線的な形式は、非常に良い物だと思います。私は3日間かけて章の終わりにある練習問題もやりながら<em>Rails　チュートリアル</em>を一気に読破しました。最初から最後まで、途中で飛ばさずにやるのが一番効果的で有益な読み方ですのでぜひやってみて下さい。</p>

<p>では、お楽しみあれ!</p>

<p><a href="http://sivers.org/">デレック・シバーズ(Derek Sivers)</a> (<a href="http://sivers.org/">sivers.org</a>) <br />
<em>元:</em> <a href="http://www.cdbaby.com/"><em>CD Baby </em></a><em>(創始者)</em><br />
<em>現在:</em> <a href="http://thoughts.pro/"><em>Thoughts Ltd.</em></a><em>(創始者)</em> <br /></p>

<p> <span class="preamble">
<strong> 謝辞</strong> <br />
 </span></p>

<p><em>Ruby on Rails チュートリアル</em>は、私の以前の著書<em>RailsSpace</em>と、その時の共著者の<a href="http://aure.com/">Aurelius Prochazka</a>に負うところが多くあります。Aureには、RailsSpaceでの協力と本書への支援も含め、感謝したいと思います。また、<em>RailsSpace</em>と<em>Rails チュートリアル</em>両方の編集を担当して頂いたDebra Williams Cauley氏にも謝意を表したく思います。彼女に野球の試合に連れて行ってもらえる限り、私は本を書き続けます。</p>

<p>私にインスピレーションと知識を与えてくれたRubyistの方々にも感謝したいと思います:David Heinemeier Hansson, Yehuda Katz, Carl Lerche, Jeremy Kemper, Xavier Noria, Ryan Bates, Geoffrey Grosenbach, Peter Cooper, Matt Aimonetti, Gregg Pollack, Wayne&nbsp;E. Seguin, Amy Hoy, Dave Chelimsky, Pat Maddox, Tom Preston-Werner, Chris Wanstrath, Chad Fowler, Josh Susser, Obie Fernandez, Ian McFarland, Steven Bristol, Giles Bowkett, Evan Dorn, Long Nguyen, James Lindenbaum, Adam Wiggins, Tikhon Bernstam, Ron Evans, Wyatt Greene, Miles Forrest, Pivotal Labsの方々, Herokuの方々, thoughtbotの方々, そしてGitHubチーム。
最後に、リストにするには多すぎるほどにたくさんの読者の方々から執筆中にバグ報告や提案を頂き、本書を出来る限り良いものにするのに大変役立ちました。
<br /></p>

<p> <span class="preamble">
 <span id="author">
<strong> 著者</strong> <br />
 </span>
 </span></p>

<p><a href="http://michaelhartl.com/">マイケル・ハートル(Michael Hartl)</a> はプログラマー・教育者・起業家です. 氏は2007年に出版されたRails本のベスt−セラー<em>RailsSpace</em>の共著者の一人で、Railsで書かれた<a href="http://github.com/popular/forked">人気の</em>ソーシャルネットワーキング<a href="http://insoshi.com/">Insoshi</a>を設立しリード開発者を担当していました。以前は、<a href="http://www.caltech.edu/">カリフォルニア工科大学</a>(Caltech)で理論物理学と計算物理学の講師を務め、優秀な教育者に贈られるLifetime Achievement Awardを受賞しています。マイケルは<a href="http://college.harvard.edu/">ハーバード大学</a>出身で、Caltechにて<a href="http://resolver.caltech.edu/CaltechETD:etd-05222003-161626">物理学の博士号</a>を取得し、<a href="http://ycombinator.com/">Y&nbsp;Combinator</a>の卒業生でもあります。<br /></p>

<p> <span id="license" class="preamble">
<strong> 著作権とライセンス</strong> <br />
 </span></p>

<p><em>Ruby on Rails チュートリアル: 実例を使ってRailsを学ぼう</em>. Copyright &copy; 2010 by Michael Hartl. <em>Ruby on Rails チュートリアル</em>内の全てのソースコードは<a href="http://www.opensource.org/licenses/mit-license.php">MIT ライセンス</a> と<a href="http://en.wikipedia.org/wiki/Beerware">Beerware ライセンス</a>の元で提供されています。</p>

<pre class="verbatim">   Copyright (c) 2010 Michael Hartl
   以下に定める条件に従い、本ソフトウェアおよび関連文書のファイル（以下「ソフトウェア」）
   の複製を取得するすべての人に対し、ソフトウェアを無制限に扱うことを無償で許可します。
   これには、ソフトウェアの複製を使用、複写、変更、結合、掲載、頒布、サブライセンス、
   および/または販売する権利、およびソフトウェアを提供する相手に同じことを許可する権利も
   無制限に含まれます。

   上記の著作権表示および本許諾表示を、ソフトウェアのすべての複製または重要な部分に記載
   するものとします。
   
   ソフトウェアは「現状のまま」で、明示であるか暗黙であるかを問わず、何らの保証もなく提供されます。
   ここでいう保証とは、商品性、特定の目的への適合性、および権利非侵害についての保証も含みますが、
   それに限定されるものではありません。 作者または著作権者は、契約行為、不法行為、
   またはそれ以外であろうと、ソフトウェアに起因または関連し、あるいはソフトウェアの使用
   またはその他の扱いによって生じる一切の請求、損害、その他の義務について何らの責任も
   負わないものとします。 
</pre>




<pre class="verbatim">/*
 * ------------------------------------------------------------
 * &quot;BEERWARE ライセンス&quot; (リビジョン 42):
 * このソースコードはMichael Hartlによる物です。このライセンスを含む限り、
 * ソースコードで何をしても構いません。いつか会う事があって、あなたがこの
 * チュートリアルが有用だったと思うなら、僕にビールを奢ってくれれば嬉しいです。
 * ------------------------------------------------------------
 */</pre>



 
<div id="top"></div>

<h1 class="chapter"><a id="sec:2" href="a-demo-app#top" class="heading"><span class="number">Chapter 2</span> A demo app</a></h1>

<p>この章では、Railsの強力な機能をいくつか紹介するためのデモアプリケーションを作成します。<em>scaffold</em><sup class="footnote" id="fnref:2.1"><a href="#fn:2.1"> 1 </a></sup > ジェネレータというスクリプトを使ってアプリケーションをすばやく生成する事により、 Railsプログラミング・Webプログラミングのハイレベルな概要を覚えていきます。<a class="ref" href="beginning#sidebar:scaffolding">囲み1.1</a>で述べたように、本書の残りの章ではこの逆のアプローチを取り、徐々にアプリケーションを作りながら各段階・概念を説明して行きますが、<em>scaffold</em>は手早くRailsアプリをいじるのには最適なのでこの章では使用することにします。結果として生成させることになるでもアプリはURLを通して動かすことが出来るので、これによりRailsアプリの構造、そしてRailsに推奨されている<em>REST</em>アーキテクチャを洞察します。</p>

<p>後に作成するサンプルアプリと同じく、デモアプリは<em>ユーザー</em>と関連している<em>マイクロポスト</em>から成り立っています。機能は実装されているとはいえ限定的なもので、しかも手順の多くが「魔法」のように思えるかもしれませんが、<a class="ref" href="static-pages#top">第3章</a>から作成するサンプルアプリでは同じような機能を全て手動で書いていくのでご心配なく。</p>

<div class="label" id="sec:planning_the_application"></div>

<h2><a id="sec:2.1" href="a-demo-app#sec:planning_the_application" class="heading"><span class="number">2.1</span> アプリの計画</a></h2>

<p>はじめに、デモアプリケーションをどのようなものにするのか、計画を立てていきます。節<a class="ref" href="beginning#sec:the_first_application">1.2.3</a>と同じく、<code>rails</code>コマンドでアプリケーションの骨格(フォルダ構造、デフォルトで作成されるファイル類)を生成します。

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects
<span class="gp">$</span> rails new demo_app
<span class="gp">$</span> <span class="nb">cd </span>demo_app
</pre></div>
</div>

<p>次に、テキストエディタでBundler用の<code>Gemfile</code>を編集します。<a class="ref" href="a-demo-app#code:demo_gemfile_sqlite_version_redux">リスト&nbsp;2.1</a>の内容に書き換えてください。</p>

<div class="label" id="code:demo_gemfile_sqlite_version_redux"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.1.</span> <span class="description">デモアプリケーション用の<code>Gemfile</code></span>       
</div>

<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.7&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3-ruby&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.2&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s1">&#39;sqlite3&#39;</span>
</pre></div>
</div></div>

<p> <a class="ref" href="beginning#sec:bundler">節1.2.4</a>で述べたように、OS X Leopardを使用している場合は<tt>ｓqlite3-ruby</tt>ジェムの1.2.5バージョンが必要な可能性があります。

では、<code>bundle</code>コマンドでジェムのインストールとインクルードを行います。
</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>

<p>最後に、Gitリポジトリを初期化して最初のコミットをしておきます。<sup class="footnote" id="fnref:2.2"><a href="#fn:2.2">2</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git init
<span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Initial commit&quot;</span>
</pre></div>
</div>


<div class="label" id="fig:create_demo_repo"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/create_demo_repo.png" alt="create_demo_repo" /></span></div><div class="caption"><span class="header">図 2.1: </span><span class="description">GitHubでのデモアプリ用リポジトリの作成<a href="http://railstutorial.org/images/figures/create_demo_repo-full.png">(フルサイズ)</a></span></div></div>

<p>これは任意ですが、新しいリポジトリを作成し (<a class="ref" href="a-demo-app#fig:create_demo_repo">図&nbsp;2.1</a>)、それをGitHubにpushする事も出来ます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin git@github.com:&lt;username&gt;/demo_app.git
<span class="gp">$</span> git push origin master
</pre></div>
</div>

<p>これで、アプリ自体を作るための下準備が整いました。ウェブアプリケーションを作る際、まずはアプリケーションで使用される構造体を表すための<em>データモデル</em>を作成します。わがデモアプリはユーザーとマイクロポストといった限定的な機能をもったマイクロブログですので、まずは<em>ユーザー</em> (<a class="ref" href="a-demo-app#sec:modeling_users">節2.1.1</a>)のデータモデルを作り、それから<em>マイクロポスト</em> (<a class="ref" href="a-demo-app#sec:modeling_microposts">節2.1.2</a>)のデータモデル作成に着手していこうと思います。</p>

<div class="label" id="sec:modeling_users"></div>


<h3><a id="sec:2.1.1" href="a-demo-app#sec:modeling_users" class="heading"><span class="number">2.1.1</span> ユーザーのモデル</a></h3>

<p>ユーザーという概念をデータモデルで表す方法はたくさんありますが、ここではあえて最小限の構造に抑えておきます。各ユーザーには、ユニークキーとなる<code>integer</code>型のID番号(<code>id</code>と呼びます)が割り当てられ、このIDに加えて一般公開される<code>string</code>型の名前(<code>name</code>)、そして同じく<code>string</code>型のメールアドレス(<code>email</code>)を持たせます。ユーザーのデータモデルの概要は<a class="ref" href="a-demo-app#fig:demo_user_model">図&nbsp;2.2</a>に載せています。</p>

<div class="label" id="fig:demo_user_model"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_user_model.png" alt="demo_user_model" /></span></div><div class="caption"><span class="header">図 2.2: </span><span class="description">ユーザー用のデータモデル.</span></div></div>

<p><a class="ref" href="modeling-and-viewing-users-one#sec:database_migrations">節&nbsp;6.1.1</a>から明らかになってきますが、<a class="ref" href="a-demo-app#fig:demo_user_model">図&nbsp;2.2</a>の<code>users</code>というのはデータベース内の<em>テーブル</em>（表）に相当し、<code>id</code>、<code>name</code>、<code>email</code>といった属性はテーブルの<em>カラム</em>（列）に値します。</p>

<div class="label" id="sec:modeling_microposts"></div>

<h3><a id="sec:2.1.2" href="a-demo-app#sec:modeling_microposts" class="heading"><span class="number">2.1.2</span>マイクロポストのモデル</a></h3>

<p>マイクロポストのデータモデルはユーザーよりもさらにシンプルで、<code>id</code>とマイクロポストのテキスト内容を格納する<code>string</code>型の<code>content</code>だけで構成されています。<sup class="footnote" id="fnref:2.3"><a href="#fn:2.3">3</a></sup>しかし、これではどのユーザーがどのブログポストを作成したかがわからないので、<code>user_id</code>でユーザーIDを記録してユーザーとマイクロポストを関連付けさせます。結果は<a class="ref" href="a-demo-app#fig:demo_micropost_model">図&nbsp;2.3</a>を参照。</p>

<div class="label" id="fig:demo_micropost_model"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_micropost_model.png" alt="demo_micropost_model" /></span></div><div class="caption"><span class="header">図 2.3: </span><span class="description">マイクロポストのデータモデル</span></div></div>

<p>この<code>user_id</code>を使う事により「一人のユーザーに対し、マイクロポストは複数存在する」という概念を簡単に表現することができます。詳細は、<a class="ref" href="a-demo-app#sec:demo_user_has_many_microposts">節&nbsp;2.3.3</a>と、<a class="ref" href="user-microposts#top">第11章</a>にて説明しています。</p>

<div class="label" id="sec:demo_users_resource"></div>


<h2><a id="sec:2.2" href="a-demo-app#sec:demo_users_resource" class="heading"><span class="number">2.2</span> Usersリソース</a></h2>

<p>ここでは、<a class="ref" href="a-demo-app#sec:modeling_users">節2.1.1</a>の、ユーザー用のデータモデルとウェブ上でモデルを扱うためのインターフェースを実装します。この組み合わせは<em>Usersリソース</em>となり、これによりユーザーを<a href="http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTPプロトコル</a>で「作成、読み取り、更新、削除」(CRUD)」できるオブジェクトとして扱えるようになります。</p>

<p>冒頭で述べたように、このUsersリソースは全てのRailsプロジェクトに標準装備でついてくるscaffoldジェネレータで生成します。<code>scaffold</code>コマンドの引数はリソース名(Users)の英語での単数形(<code>User</code>)と、データモデルの属性用のパラメータ<sup class="footnote" id="fnref:2.4"><a href="#fn:2.4">4</a></sup>です。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate scaffold User name:string email:string
<span class="go">      invoke  active_record</span>
<span class="go">      create    db/migrate/20100615004000_create_users.rb</span>
<span class="go">      create    app/models/user.rb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/unit/user_test.rb</span>
<span class="go">      create      test/fixtures/users.yml</span>
<span class="go">       route  resources :users</span>
<span class="go">      invoke  scaffold_controller</span>
<span class="go">      create    app/controllers/users_controller.rb</span>
<span class="go">      invoke    erb</span>
<span class="go">      create      app/views/users</span>
<span class="go">      create      app/views/users/index.html.erb</span>
<span class="go">      create      app/views/users/edit.html.erb</span>
<span class="go">      create      app/views/users/show.html.erb</span>
<span class="go">      create      app/views/users/new.html.erb</span>
<span class="go">      create      app/views/users/_form.html.erb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/functional/users_controller_test.rb</span>
<span class="go">      invoke    helper</span>
<span class="go">      create      app/helpers/users_helper.rb</span>
<span class="go">      invoke      test_unit</span>
<span class="go">      create        test/unit/helpers/users_helper_test.rb</span>
<span class="go">      invoke  stylesheets</span>
<span class="go">      create    public/stylesheets/scaffold.css</span>
</pre></div>
</div>

<p><code>name:string</code>と<code>email:string</code>を含めることにより、Userモデルを<a class="ref" href="a-demo-app#fig:demo_user_model">図&nbsp;2.2</a>の形式で作成します。(<code>id</code>はRailsが自動的に生成してくれるので、含まなくても大丈夫です<sup class="footnote" id="fnref:2.5"><a href="#fn:2.5">5</a></sup>)</p>

<p>デモアプリケーションの開発を進めるには、<em>Rake</em>でデータベースを<em>migrate</em>(マイグレート)する必要があります。　(<a class="ref" href="a-demo-app#sidebar:rake">囲み2.1</a>):</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rake db:migrate
<span class="go">==  CreateUsers: migrating ====================================================</span>
<span class="go">-- create_table(:users)</span>
<span class="go">   -&gt; 0.0017s</span>
<span class="go">==  CreateUsers: migrated (0.0018s) ===========================================</span>
</pre></div>
</div>

<p>これは単に、データベースを更新し<code>users</code>データモデルを作成させるためのものです。このマイグレーションについての詳細は<a class="ref" href="modeling-and-viewing-users-one#sec:database_migrations">節6.1.1</a>.</p>で解説しています。

<p>マイグレーションが終わったら、<code>rails s</code>コマンド(<code>rails server</code>と同じです)でローカル上でWebサーバを立ち上げます:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails s
</pre></div>
</div>

<p>これで<a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a>にてデモアプリケーションを観覧する事が出来るはずです。</p>

<div class="label" id="sidebar:rake"></div>


<div class="sidebar"><span class="title"><span class="header">囲み 2.1.</span><span class="description">Rake</span></span>
<p>Unixでは、ソースコードから実行用プログラムをビルドするために主に<a href="http://en.wikipedia.org/wiki/Make_(software)"><em>make</em></a>というツールが使われてきました。多くのプログラマーが、LinuxやMac OS Xでコードをコンパイルするのによく使われる</p>

<pre class="verbatim">  $ ./configure &amp;&amp; make &amp;&amp; sudo make install</pre>

<p>を記憶しているかと思います。</p>

<p>Rakeは<em>Ruby make</em>というRubyで書かれたmakeのようなツールです。RailsではRakeをデータベース管理上のタスクなどに頻繁に使っています。このうち<code>rake db:migrate</code>がもっともよく使われる物かもしれませんが、<code>-T db</cdoe>でわかるように他にも色々なコマンドがあります:</p>

<pre class="verbatim">  $ rake -T db</pre>


<p>Rakeで利用可能な全てのタスクを見るには、</p>

<pre class="verbatim">  $ rake -T</pre>


<p>を実行します。コマンドの多さに圧倒されがちですが、全てのコマンドを今覚える必要は全くないのでご安心を。<em>Railsチュートリアル</em>を最後まで読んだ方なら、重要なコマンドは一通り覚えているかと思います。</p></div>

<div class="label" id="sec:a_user_tour"></div>


<h3><a id="sec:2.2.1" href="a-demo-app#sec:a_user_tour" class="heading"><span class="number">2.2.1</span> A user tour</a></h3>

<p><a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a>をブラウザで見てみると、 <a class="ref" href="beginning#fig:riding_rails_3">図1.3</a>と同じくRailsのデフォルトページが表示されますが、実はUsersリソースを作ったときに他に色々な「ユーザーを扱うためのページ」が作成されています。例え、ば<a href="http://localhost:3000/users">/users</a>に行けば全ユーザのリストが見られます。また、<a href="http://localhost:3000/">/users/new</a>.<sup class="footnote" id="fnref:2.6"><a href="#fn:2.6">6</a></sup>はユーザー作成用のページです。この章の残り半分では、このユーザー関連のページを次々と見ていくことにします。この際、<a class="ref" href="a-demo-app#table:user_urls">表2.1</a>に載せてあるページとURLの関係を参照すると覚えやすいかも知れません。</p>

<div class="label" id="table:user_urls"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>アクション</strong></th><th class="align_left"><strong>用途</strong></th></tr><tr class="top_bar"><td class="align_left"><a href="http://localhost:3000/users"><tt>/users</tt></a></td><td class="align_left"><code>index</code></td><td class="align_left">全ユーザーの一覧</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/1"><tt>/users/1</tt></a></td><td class="align_left"><code>show</code></td><td class="align_left">idが<code>1</code>のユーザーを表示するページ</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/new"><tt>/users/new</tt></a></td><td class="align_left"><code>new</code></td><td class="align_left">新規ユーザー作成ページ</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/1/edit"><tt>/users/1/edit</tt></a></td><td class="align_left"><code>edit</code></td><td class="align_left">idが<code>1</code>のユーザー編集用のページ</td></tr></table></div><div class="caption"><span class="header">Table 2.1: </span><span class="description">Usersリソースにおける、ページとURLの関係</span></div></div>

<p>まずは<a href="http://localhost:3000/users"><tt>index</tt></a>と呼ばれる、ユーザー一覧のページから見てみます。もちろん、まだユーザーはいません(<a class="ref" href="a-demo-app#fig:demo_blank_user_index_rails_3">図2.4</a>)。</p>

<div class="label" id="fig:demo_blank_user_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_blank_user_index_rails_3.png" alt="demo_blank_user_index_rails_3" /></span></div><div class="caption"><span class="header">図 2.4: </span><span class="description">Usersリソースの初期indexページ (<a href="http://localhost:3000/users"><tt>/users</tt></a>).&nbsp;<a href="/images/figures/demo_blank_user_index_rails_3-full.png">(フルサイズ)</a></span></div></div>

<p>新規ユーザーの作成は、<a class="ref" href="a-demo-app#fig:demo_new_user_rails_3">図2.5</a>の<a href="http://localhost:3000/users/new"><tt>new</tt></a>(new=新規)ページにて行います。(<a class="ref" href="sign-up#top">第8章</a>では、これがユーザー登録ページになります)

<div class="label" id="fig:demo_new_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_new_user_rails_3.png" alt="demo_new_user_rails_3" /></span></div><div class="caption"><span class="header">図2.5: </span><span class="description">新規ユーザー作成ページ (<a href="http://localhost:3000/users/new"><tt>/users/new</tt></a>).&nbsp;<a href="/images/figures/demo_new_user_rails_3-full.png">(フルサイズ)</a></span></div></div>

<p>テキストフィールドに名前とEメールアドレスを入力して作成ボタンを押せば、ユーザーが作成されて<a href=<a class="ref" href="a-demo-app#fig:demo_show_user_rails_3">図2.6</a>の<a href="http://localhost:3000/users/1"><tt>show</tt></a>ページが表示されます。(緑色のメッセージは、 <a class="ref" href="sign-up#sec:the_flash">節8.3.3</a>に出てくる<em>flash</em>という機能によるものです。)　URLが<a href="http://localhost:3000/users/1"><tt>/users/1</tt></a>だという事に注目してください。この<code>1</code>というのは<a class="ref" href="a-demo-app#fig:demo_user_model">図2.2</a>にあるユーザーの<code>id</code>属性なのです。<a class="ref" href="modeling-and-viewing-users-two#sec:better_user_views">節7.3</a>では、このURLがユーザーのプロフィールページに変わります。</p>

<div class="label" id="fig:demo_show_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_show_user_rails_3.png" alt="demo_show_user_rails_3" /></span></div><div class="caption"><span class="header">図2.6: </span><span class="description">ユーザー表示用のページ (<a href="http://localhost:3000/users/1"><tt>/users/1</tt></a>).&nbsp;<a href="/images/figures/demo_show_user_rails_3-full.png">(フルサイズ)</a></span></div></div>

<p>ユーザー情報の編集は、<a class="ref" href="a-demo-app#fig:demo_edit_user_rails_3">図2.7</a>の<a href="http://localhost:3000/users/1/edit"><tt>edit</tt></a>(edit=編集)ページにて行います。この編集ページ上でユーザーに関する情報を変更し、更新ボタンを押せば、デモアプリケーション内のユーザー情報が変更されます。(<a class="ref" href="a-demo-app#fig:demo_update_user_rails_3">図2.8</a>)　詳細は<a class="ref" href="modeling-and-viewing-users-one#top">第6章</a>で説明しますが、このユーザー情報というのはRailsのバックエンドで稼動しているデータベース内に格納されています。サンプルアプリケーションでも、<a class="ref" href="updating-showing-and-deleting-users#sec:updating_users">節10.1</a>でユーザー情報を編集・更新する機能を実装します。</p>

<div class="label" id="fig:demo_edit_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_edit_user_rails_3.png" alt="demo_edit_user_rails_3" /></span></div><div class="caption"><span class="header">図2.7: </span><span class="description">ユーザー編集用のページ (<a href="http://localhost:3000/users/1/edit"><tt>/users/1/edit</tt></a>).&nbsp;<a href="/images/figures/demo_edit_user_rails_3-full.png">(フルサイズ)</a></span></div></div>




<div class="label" id="fig:demo_update_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_update_user_rails_3.png" alt="demo_update_user_rails_3" /></span></div><div class="caption"><span class="header">図 2.8: </span><span class="description">情報が更新されたユーザー<a href="/images/figures/demo_update_user_rails_3-full.png">(フルサイズ)</a></span></div></div>

<p>ここで<a href="http://localhost:3000/users/new"><tt>new</tt></a>(新規ユーザー作成ページ)に戻り、二人目のユーザーを作成してみましょう。すると、<a href="http://localhost:3000/users"><tt>index</tt></a>ページ(<a class="ref" href="a-demo-app#fig:demo_user_index_two_rails_3">図2.9</a>)にあるユーザーの一覧には2人のユーザーが表示されます。<a class="ref" href="updating-showing-and-deleting-users#sec:showing_users">節10.3</a>ではより充実したユーザー一覧ページを実装します。</p>

<div class="label" id="fig:demo_user_index_two_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_user_index_two_rails_3.png" alt="demo_user_index_two_rails_3" /></span></div><div class="caption"><span class="header">図 2.9: </span><span class="description">二人のユーザーが表示されている 一覧ページ (<a href="http://localhost:3000/users"><tt>/users</tt></a>)<a href="/images/figures/demo_user_index_two_rails_3-full.png">(フルサイズ)</a></span></div></div>

<p>これまでユーザーの「作成」・「表示」・「編集」を行ってきましたが、今度は「削除」です。(<a class="ref" href="a-demo-app#fig:demo_destroy_user_rails_3">図2.10</a>). <a class="ref" href="a-demo-app#fig:demo_destroy_user_rails_3">図2.10</a>のリンクをクリックし、二人目のユーザーが削除された事を確認してください。(もし動かなかった場合は、JavaScriptが有効になっているかどうかを確認してください。Railsはユーザーを削除するためのリクエストを送信するのにJavaScriptを用いています）<a class="ref" href="updating-showing-and-deleting-users#sec:destroying_users">節10.4</a>ではサンプルアプリケーションにユーザーを削除する機能を実装し、「管理権限」(admin)を持ったユーザーのみこれが出来るように制限します。</p>

<div class="label" id="fig:demo_destroy_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_destroy_user_rails_3.png" alt="demo_destroy_user_rails_3" /></span></div><div class="caption"><span class="header">図 2.10: </span><span class="description">ユーザーの削除<a href="/images/figures/demo_destroy_user_rails_3-full.png">(フルサイズ)</a></span></div></div>




<div class="label" id="sec:mvc_in_action"></div>


<h3><a id="sec:2.2.2" href="a-demo-app#sec:mvc_in_action" class="heading"><span class="number">2.2.2</span> MVC in action</a></h3>

<p>これでUsersリソースの全貌が見えてきましたが、ここで<a class="ref" href="beginning#sec:mvc">節1.2.6</a>で紹介したMVC(Model-View-Controller = モデル・ビュー・コントローラ)パターンの観点からこのリソースを考察してみましょう。具体的には、ブラウザで<a href="http://localhost:3000/users">/users</a>のURLを観覧した時に何が起こっているかをMVC(<a class="ref" href="a-demo-app#fig:mvc_detailed">図2.11</a>)を使って説明します。</p>

<div class="label" id="fig:mvc_detailed"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/mvc_detailed.png" alt="mvc_detailed" /></span></div><div class="caption"><span class="header">図 2.11: </span><span class="description">RailsにおけるMVC<a href="/images/figures/mvc_detailed-full.png">(フルサイズ)</a></span></div></div>




<ol>
<li>ブラウザが、<tt>/users</tt>URLをリクエスト</li>
<li>Railsが、<tt>/users</tt>をUsersコントローラの<code>index</code>アクションにルーティングする</li>
<li><code>index</code>アクションが、Userモデルに「全てのユーザを引き出してくれ」と要請(<code>User.all</code)</li>
<li>Userモデルが、データベースから全てのユーザーを読み取る</li>
<li>Userモデルが、上で読み取ったユーザーのリストをコントローラに返す</li>
<li>コントローラが、ユーザーのリストを<code>@users</code>変数に格納し、これが<code>index</code>ビューに渡される</li>
<li>ビューは、Embedded RubyでHTMLとしてページを出力</li>
<li>コントローラが、HTMLをブラウザに渡す<sup class="footnote" id="fnref:2.7"><a href="#fn:2.7">7</a></sup></li>
</ol>


<p>We start with a request issued from the browser&mdash;i.e., the result of typing a URL in the address bar or clicking on a link (Step&nbsp;1 in <a class="ref" href="a-demo-app#fig:mvc_detailed">図2.11</a>). This request hits the <em>Rails router</em> (Step&nbsp;2), which dispatches to the proper <em>controller action</em> based on the URL (and, as we&rsquo;ll see in <a class="ref" href="static-pages#sidebar:get_etc">囲み3.1</a>, the type of request). The code to create the mapping of user URLs to controller actions for the Users resource appears in <a class="ref" href="a-demo-app#code:rails_routes">リスト2.2</a>;<sup class="footnote" id="fnref:2.8"><a href="#fn:2.8">8</a></sup> this code effectively sets up the table of URL/action pairs seen in <a class="ref" href="a-demo-app#table:user_urls">表2.1</a>.</p>

<div class="label" id="code:rails_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.2.</span> <span class="description">The Rails routes, with a rule for the Users resource. <br /> <code>config/routes.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="no">DemoApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>The pages from the tour in <a class="ref" href="a-demo-app#sec:a_user_tour">節2.2.1</a> correspond to <em>actions</em> in the Users <em>controller</em>, which is a collection of related actions; the controller generated by the scaffolding is shown schematically in <a class="ref" href="a-demo-app#code:demo_users_controller">リスト2.3</a>. Note the notation <code>class UsersController &lt; ApplicationController</code>; this is an example of a Ruby <em>class</em> with <em>inheritance</em>. (We&rsquo;ll discuss inheritance briefly in <a class="ref" href="a-demo-app#sec:inheritance_hierarchies">節2.3.4</a> and cover both subjects in more detail in <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">節4.4</a>.)</p>

<div class="label" id="code:demo_users_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.3.</span> <span class="description">The Users controller in schematic form. <br /> <code>app/controllers/users_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>You may notice that there are more actions than there are pages; the <code>index</code>, <code>show</code>, <code>new</code>, and <code>edit</code> actions all correspond to pages from <a class="ref" href="a-demo-app#sec:a_user_tour">節2.2.1</a>, but there are additional <code>create</code>, <code>update</code>, and <code>destroy</code> actions as well. These actions don&rsquo;t typically render pages (although they sometimes do); instead, their main purpose is to modify information about users in the database. This full suite of controller actions, summarized in <a class="ref" href="a-demo-app#table:demo_RESTful_users">表2.2</a>, represents the implementation of the REST architecture in Rails (<a class="ref" href="a-demo-app#sidebar:REST">囲み2.2</a>). Note from <a class="ref" href="a-demo-app#table:demo_RESTful_users">表2.2</a> that there is some overlap in the URLs; for example, both the user <code>show</code> action and the <code>update</code> action correspond to the URL <tt>/users/1</tt>. The difference between them is the <a href="http://en.wikipedia.org/wiki/HTTP_request#Request_methods">HTTP request method</a> they respond to. We&rsquo;ll learn more about HTTP request methods starting in <a class="ref" href="static-pages#sec:TDD">節3.2.2</a>.</p>

<div class="label" id="table:demo_RESTful_users"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_left"><strong>HTTP request</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Action</strong></th><th class="align_left"><strong>Purpose</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users</tt></td><td class="align_left"><code>index</code></td><td class="align_left">page to list all users</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users/1</tt></td><td class="align_left"><code>show</code></td><td class="align_left">page to show user with id <code>1</code></td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users/new</tt></td><td class="align_left"><code>new</code></td><td class="align_left">page to make a new user</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left"><tt>/users</tt></td><td class="align_left"><code>create</code></td><td class="align_left">create a new user</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users/1/edit</tt></td><td class="align_left"><code>edit</code></td><td class="align_left">page to edit user with id <code>1</code></td></tr><tr><td class="align_left"><tt>PUT</tt></td><td class="align_left"><tt>/users/1</tt></td><td class="align_left"><code>update</code></td><td class="align_left">update user with id <code>1</code></td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left"><tt>/users/1</tt></td><td class="align_left"><code>destroy</code></td><td class="align_left">delete user with id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Table 2.2: </span><span class="description">RESTful routes provided by the Users resource in <a class="ref" href="a-demo-app#code:rails_routes">リスト2.2</a>.</span></div></div>




<div class="label" id="sidebar:REST"></div>


<div class="sidebar"><span class="title"><span class="header">囲み 2.2.</span><span class="description">REpresentational State Transfer (REST)</span></span>
<p>If you read much about Ruby on Rails web development, you&rsquo;ll see a lot of references to &ldquo;REST&rdquo;, which is an acronym for REpresentational State Transfer. REST is an architectural style for developing distributed, networked systems and software applications such as the World Wide Web and web applications. Although REST theory is rather abstract, in the context of Rails applications REST means that most application components (such as users and microposts) are modeled as <em>resources</em> that can be created, read, updated, and deleted&mdash;operations that correspond both to the <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD operations of relational databases</a> and the four fundamental <a href="http://en.wikipedia.org/wiki/HTTP_request#Request_methods">HTTP request methods</a>: <tt>POST</tt>, <tt>GET</tt>, <tt>PUT</tt>, and <tt>DELETE</tt>. (We&rsquo;ll learn more about HTTP requests in <a class="ref" href="static-pages#sec:TDD">節3.2.2</a> and especially <a class="ref" href="static-pages#sidebar:get_etc">囲み3.1</a>.)</p>

<p>As a Rails application developer, the RESTful style of development helps you make choices about which controllers and actions to write: you simply structure the application using resources that get created, read, updated, and deleted. In the case of users and microposts, this process is straightforward, since they are naturally resources in their own right. In <a class="ref" href="following-users#top">Chapter&nbsp;12</a>, we&rsquo;ll see an example where REST principles allow us to model a subtler problem, &ldquo;following users&rdquo;, in a natural and convenient way.</p>
</div>


<p>To examine the relationship between the Users controller and the User model, let&rsquo;s focus on a simplified version of the <code>index</code> action, shown in <a class="ref" href="a-demo-app#code:demo_index_action">リスト2.4</a>.<sup class="footnote" id="fnref:2.9"><a href="#fn:2.9">9</a></sup></p>

<div class="label" id="code:demo_index_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.4.</span> <span class="description">The simplified user <code>index</code> action for the demo application. <br /> <code>app/controllers/users_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@users</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>This <code>index</code> action has the line <code>@users = User.all</code> (Step&nbsp;3), which asks the User model to retrieve a list of all the users from the database (Step&nbsp;4), and then places them in the  variable <code>@users</code> (pronounced &ldquo;at-users&rdquo;) (Step&nbsp;5). The User model itself appears in <a class="ref" href="a-demo-app#code:demo_user_model">リスト2.5</a>; although it is rather plain, it comes equipped with a large amount of functionality because of inheritance (<a class="ref" href="a-demo-app#sec:inheritance_hierarchies">節2.3.4</a> and <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">節4.4</a>). In particular, by using the Rails library called <em>Active Record</em>, the code in <a class="ref" href="a-demo-app#code:demo_user_model">リスト2.5</a> arranges for <code>User.all</code> to return all the users.</p>

<div class="label" id="code:demo_user_model"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.5.</span> <span class="description">The User model for the demo application. <br /> <code>app/models/user.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Once the <code>@users</code> variable is defined, the controller calls the <em>view</em> (Step&nbsp;6), shown in <a class="ref" href="a-demo-app#code:demo_index_view">リスト2.6</a>. Variables that start with the <code>@</code>&nbsp;sign, called <em>instance variables</em>, are automatically available in the view; in this case, the <code>index.html.erb</code> view in <a class="ref" href="a-demo-app#code:demo_index_view">リスト2.6</a> iterates through the <code>@users</code> list and outputs a line of HTML for each one.<sup class="footnote" id="fnref:2.10"><a href="#fn:2.10">10</a></sup></p>

<div class="label" id="code:demo_index_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.6.</span> <span class="description">The view for the user index. (You are not expected to understand it now.) <br /> <code>app/views/users/index.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Listing users<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Email<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

<span class="cp">&lt;%</span> <span class="vi">@users</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Show&#39;</span><span class="p">,</span> <span class="n">user</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">edit_user_path</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Destroy&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="ss">:confirm</span> <span class="o">=&gt;</span> <span class="s1">&#39;Are you sure?&#39;</span><span class="p">,</span>
<span class="ss">:method</span> <span class="o">=&gt;</span> <span class="ss">:delete</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;New User&#39;</span><span class="p">,</span> <span class="n">new_user_path</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p>The view converts its contents to HTML (Step&nbsp;7), which is then returned by the controller to the browser for display (Step&nbsp;8).</p>

<div class="label" id="sec:weaknesses_of_this_users_resource"></div>


<h3><a id="sec:2.2.3" href="a-demo-app#sec:weaknesses_of_this_users_resource" class="heading"><span class="number">2.2.3</span> Weaknesses of this Users resource</a></h3>


<p>Though good for getting a general overview of Rails, the scaffold Users resource suffers from a number of severe weaknesses.</p>

<ul>
<li><strong>No data validations.</strong> Our User model accepts data such as blank names and invalid email addresses without complaint.</li>
<li><strong>No authentication.</strong> We have no notion signing in or out, and no way to prevent any user from performing any operation.</li>
<li><strong>No tests.</strong> This isn&rsquo;t technically true&mdash;the scaffolding includes rudimentary tests&mdash;but the generated tests are ugly and inflexible, and they don&rsquo;t test for data validation, authentication, or any other custom requirements.</li>
<li><strong>No layout.</strong> There is no consistent site styling or navigation.</li>
<li><strong>No real understanding.</strong> If you understand the scaffold code, you probably shouldn&rsquo;t be reading this book.</li>
</ul>




<div class="label" id="sec:microposts_resource"></div>


<h2><a id="sec:2.3" href="a-demo-app#sec:microposts_resource" class="heading"><span class="number">2.3</span> The Microposts resource</a></h2>


<p>Having generated and explored the Users resource, we turn now to the associated Microposts resource. Throughout this section, I recommend comparing the elements of the Microposts resource with the analogous user elements from <a class="ref" href="a-demo-app#sec:demo_users_resource">節2.2</a>; you should see that the two resources parallel each other in many ways. The RESTful structure of Rails applications is best absorbed by this sort of repetition of form; indeed, seeing the parallel structure of Users and Microposts even at this early stage is one of the prime motivations for this chapter. (As we&rsquo;ll see, writing applications more robust than the toy example in this chapter takes considerable effort&mdash;we won&rsquo;t see the Microposts resource again until <a class="ref" href="user-microposts#top">Chapter&nbsp;11</a>&mdash;and I didn&rsquo;t want to defer its first appearance quite that far.)</p>

<div class="label" id="sec:a_micropost_microtour"></div>


<h3><a id="sec:2.3.1" href="a-demo-app#sec:a_micropost_microtour" class="heading"><span class="number">2.3.1</span> A micropost microtour</a></h3>


<p>As with the Users resource, we&rsquo;ll generate scaffold code for the Microposts resource using <code>rails generate scaffold</code>, in this case implementing the data model from <a class="ref" href="a-demo-app#fig:demo_micropost_model">図2.3</a>:<sup class="footnote" id="fnref:2.11"><a href="#fn:2.11">11</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate scaffold Micropost content:string user_id:integer
<span class="go">      invoke  active_record</span>
<span class="go">      create    db/migrate/20100615004429_create_microposts.rb</span>
<span class="go">      create    app/models/micropost.rb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/unit/micropost_test.rb</span>
<span class="go">      create      test/fixtures/microposts.yml</span>
<span class="go">       route  resources :microposts</span>
<span class="go">      invoke  scaffold_controller</span>
<span class="go">      create    app/controllers/microposts_controller.rb</span>
<span class="go">      invoke    erb</span>
<span class="go">      create      app/views/microposts</span>
<span class="go">      create      app/views/microposts/index.html.erb</span>
<span class="go">      create      app/views/microposts/edit.html.erb</span>
<span class="go">      create      app/views/microposts/show.html.erb</span>
<span class="go">      create      app/views/microposts/new.html.erb</span>
<span class="go">      create      app/views/microposts/_form.html.erb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/functional/microposts_controller_test.rb</span>
<span class="go">      invoke    helper</span>
<span class="go">      create      app/helpers/microposts_helper.rb</span>
<span class="go">      invoke      test_unit</span>
<span class="go">      create        test/unit/helpers/microposts_helper_test.rb</span>
<span class="go">      invoke  stylesheets</span>
<span class="go">   identical    public/stylesheets/scaffold.css</span>
</pre></div>
</div>


<p>To update our database with the new data model, we need to run a migration as in <a class="ref" href="a-demo-app#sec:demo_users_resource">節2.2</a>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rake db:migrate
<span class="go">==  CreateMicroposts: migrating ===============================================</span>
<span class="go">-- create_table(:microposts)</span>
<span class="go">   -&gt; 0.0023s</span>
<span class="go">==  CreateMicroposts: migrated (0.0026s) ======================================</span>
</pre></div>
</div>


<p>Now we are in a position to create microposts in the same way we created users in <a class="ref" href="a-demo-app#sec:a_user_tour">節2.2.1</a>. As you might guess, the scaffold generator has updated the Rails routes file with a rule for Microposts resource, as seen in <a class="ref" href="a-demo-app#code:demo_microposts_resource">リスト2.7</a>.<sup class="footnote" id="fnref:2.12"><a href="#fn:2.12">12</a></sup> As with users, the <code>resources :microposts</code> routing rule maps a micropost URLs to actions in the Microposts controller, as seen in <a class="ref" href="a-demo-app#table:demo_RESTful_microposts">表2.3</a>.</p>

<div class="label" id="code:demo_microposts_resource"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.7.</span> <span class="description">The Rails routes, with a new rule for Microposts resources. <br /> <code>config/routes.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="no">DemoApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:microposts</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="table:demo_RESTful_microposts"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_left"><strong>HTTP request</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Action</strong></th><th class="align_left"><strong>Purpose</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts</tt></td><td class="align_left"><code>index</code></td><td class="align_left">page to list all microposts</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts/1</tt></td><td class="align_left"><code>show</code></td><td class="align_left">page to show micropost with id <code>1</code></td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts/new</tt></td><td class="align_left"><code>new</code></td><td class="align_left">page to make a new micropost</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left"><tt>/microposts</tt></td><td class="align_left"><code>create</code></td><td class="align_left">create a new micropost</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts/1/edit</tt></td><td class="align_left"><code>edit</code></td><td class="align_left">page to edit micropost with id <code>1</code></td></tr><tr><td class="align_left"><tt>PUT</tt></td><td class="align_left"><tt>/microposts/1</tt></td><td class="align_left"><code>update</code></td><td class="align_left">update micropost with id <code>1</code></td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left"><tt>/microposts/1</tt></td><td class="align_left"><code>destroy</code></td><td class="align_left">delete micropost with id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Table 2.3: </span><span class="description">RESTful routes provided by the Microposts resource in <a class="ref" href="a-demo-app#code:demo_microposts_resource">リスト2.7</a>.</span></div></div>


<p>The Microposts controller itself appears in schematic form <a class="ref" href="a-demo-app#code:demo_microposts_controller">リスト2.8</a>. Note that, apart from having <code>MicropostsController</code> in place of <code>UsersController</code>, <a class="ref" href="a-demo-app#code:demo_microposts_controller">リスト2.8</a> is <em>identical</em> to the code in <a class="ref" href="a-demo-app#code:demo_users_controller">リスト2.3</a>. This is a reflection of the REST architecture common to both resources.</p>

<div class="label" id="code:demo_microposts_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.8.</span> <span class="description">The Microposts controller in schematic form. <br /> <code>app/controllers/microposts_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>To make some actual microposts, we enter information at the new microposts page, <a href="http://localhost:3000/microposts/new">/microposts/new</a>, as seen in <a class="ref" href="a-demo-app#fig:demo_new_micropost_rails_3">図2.12</a>.</p>

<div class="label" id="fig:demo_new_micropost_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_new_micropost_rails_3.png" alt="demo_new_micropost_rails_3" /></span></div><div class="caption"><span class="header">図 2.12: </span><span class="description">The new micropost page (<a href="http://localhost:3000/microposts/new">/microposts/new</a>).&nbsp;<a href="http://railstutorial.org/images/figures/demo_new_micropost-full.png">(フルサイズ)</a></span></div></div>


<p>At this point, go ahead and create a micropost or two, taking care to make sure that at least one has a <code>user_id</code> of&nbsp;<code>1</code> to match the id of the first user created in <a class="ref" href="a-demo-app#sec:a_user_tour">節2.2.1</a>. The result should look something like <a class="ref" href="a-demo-app#fig:demo_micropost_index_rails_3">図2.13</a>.</p>

<div class="label" id="fig:demo_micropost_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_micropost_index_rails_3.png" alt="demo_micropost_index_rails_3" /></span></div><div class="caption"><span class="header">図 2.13: </span><span class="description">The micropost index page (<a href="http://localhost:3000/microposts">/microposts</a>).&nbsp;<a href="http://railstutorial.org/images/figures/demo_micropost_index_rails_3-full.png">(フルサイズ)</a></span></div></div>




<div class="label" id="sec:putting_the_micro_in_microposts"></div>


<h3><a id="sec:2.3.2" href="a-demo-app#sec:putting_the_micro_in_microposts" class="heading"><span class="number">2.3.2</span> Putting the <em>micro</em> in microposts</a></h3>


<p>Any <em>micro</em>post worthy of the name should have some means of enforcing the length of the post. Implementing this constraint in Rails is easy with <em>validations</em>; to accept microposts with at most 140 characters (&agrave; la Twitter), we use a <em>length</em> validation. At this point, you should open the file <code>app/models/micropost.rb</code> in your text editor or IDE and fill it with the contents of <a class="ref" href="a-demo-app#code:demo_length_validation">リスト2.9</a>. (The use of <code>validates</code> in <a class="ref" href="a-demo-app#code:demo_length_validation">リスト2.9</a> is characteristic of Rails&nbsp;3; if you&rsquo;ve previously worked with Rails&nbsp;2.3, you should compare this to the use of <code>validates_length_of</code>.)</p>

<div class="label" id="code:demo_length_validation"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.9.</span> <span class="description">Constraining microposts to at most 140 characters with a length validation. <br /> <code>app/models/micropost.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>The code in <a class="ref" href="a-demo-app#code:demo_length_validation">リスト2.9</a> may look rather mysterious&mdash;we&rsquo;ll cover validations more thoroughly starting in <a class="ref" href="modeling-and-viewing-users-one#sec:user_validations">節6.2</a>&mdash;but its effects are readily apparent if we go to the new micropost page and enter more than 140 characters for the content of the post. As seen in <a class="ref" href="a-demo-app#fig:micropost_length_error_rails_3">図2.14</a>, Rails renders <em>error messages</em> indicating that the micropost&rsquo;s content is too long. (We&rsquo;ll learn more about error messages in <a class="ref" href="sign-up#sec:signup_error_messages">節8.2.3</a>.)</p>

<div class="label" id="fig:micropost_length_error_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/micropost_length_error_rails_3.png" alt="micropost_length_error_rails_3" /></span></div><div class="caption"><span class="header">図 2.14: </span><span class="description">Error messages for a failed micropost creation.&nbsp;<a href="http://railstutorial.org/images/figures/micropost_length_error_rails_3-full.png">(フルサイズ)</a></span></div></div>




<div class="label" id="sec:demo_user_has_many_microposts"></div>


<h3><a id="sec:2.3.3" href="a-demo-app#sec:demo_user_has_many_microposts" class="heading"><span class="number">2.3.3</span> A user <code>has_many</code> microposts</a></h3>


<p>One of the most powerful features of Rails is the ability to form <em>associations</em> between different data models. In the case of our User model, each user potentially has many microposts. We can express this in code by updating the User and Micropost models as in <a class="ref" href="a-demo-app#code:demo_user_has_many_microposts">リスト2.10</a> and <a class="ref" href="a-demo-app#code:demo_micropost_belongs_to_user">リスト2.11</a>.</p>

<div class="label" id="code:demo_user_has_many_microposts"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.10.</span> <span class="description">A user has many microposts. <br /> <code>app/models/user.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:microposts</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_micropost_belongs_to_user"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.11.</span> <span class="description">A micropost belongs to a user. <br /> <code>app/models/micropost.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>

  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>We can visualize the result of this association in <a class="ref" href="a-demo-app#fig:micropost_user_association">図2.15</a>. Because of the <code>user_id</code> column in the <code>microposts</code> table, Rails (using Active Record) can infer the microposts associated with each user.</p>

<div class="label" id="fig:micropost_user_association"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/micropost_user_association.png" alt="micropost_user_association" /></span></div><div class="caption"><span class="header">図 2.15: </span><span class="description">The association between microposts and users.</span></div></div>


<p>In <a class="ref" href="user-microposts#top">Chapter&nbsp;11</a> and <a class="ref" href="following-users#top">Chapter&nbsp;12</a>, we will use the association of users and microposts both to display all a user&rsquo;s microposts and to construct a Twitter-like micropost feed. For now, we can examine the implications of the user-micropost association by using the <em>console</em>, which is a useful tool for interacting with Rails applications. We first invoke the console with <code>rails console</code> at the command line, and then retrieve the first user from the database using <code>User.first</code> (putting the results in the variable <code>first_user</code>):<sup class="footnote" id="fnref:2.13"><a href="#fn:2.13">13</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="n">first_user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span>
<span class="go">=&gt; #&lt;User id: 1, name: &quot;Michael Hartl&quot;, email: &quot;michael@example.org&quot;,</span>
<span class="go">created_at: &quot;2010-04-03 02:01:31&quot;, updated_at: &quot;2010-04-03 02:01:31&quot;&gt;</span>
<span class="gp">&gt;&gt; </span><span class="n">first_user</span><span class="o">.</span><span class="n">microposts</span>
<span class="go">=&gt; [#&lt;Micropost id: 1, content: &quot;First micropost!&quot;, user_id: 1, created_at:</span>
<span class="go">&quot;2010-04-03 02:37:37&quot;, updated_at: &quot;2010-04-03 02:37:37&quot;&gt;, #&lt;Micropost id: 2,</span>
<span class="go">content: &quot;Second micropost&quot;, user_id: 1, created_at: &quot;2010-04-03 02:38:54&quot;,</span>
<span class="go">updated_at: &quot;2010-04-03 02:38:54&quot;&gt;]</span>
<span class="gp">&gt;&gt; </span><span class="nb">exit</span>
</pre></div>
</div>


<p>(I include the last line just to demonstrate how to exit the console, and on most systems you can Ctrl-d for the same purpose.) Here we have accessed the user&rsquo;s microposts using the code <code>first_user.microposts</code>: with this code, Active Record automatically returns all the microposts with <code>user_id</code> equal to the id of <code>first_user</code> (in this case,&nbsp;<code>1</code>). We&rsquo;ll learn much more about the association facilities in Active Record in <a class="ref" href="user-microposts#top">Chapter&nbsp;11</a> and <a class="ref" href="following-users#top">Chapter&nbsp;12</a>.</p>

<div class="label" id="sec:inheritance_hierarchies"></div>


<h3><a id="sec:2.3.4" href="a-demo-app#sec:inheritance_hierarchies" class="heading"><span class="number">2.3.4</span> Inheritance hierarchies</a></h3>


<p>We end our discussion of the demo application with a brief description of the controller and model class hierarchies in Rails. This discussion will only make much sense if you have some experience with object-oriented programming (OOP); if you haven&rsquo;t studied OOP, feel free to skip this section. In particular, if you are unfamiliar with <em>classes</em> (discussed in <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">節4.4</a>), I suggest looping back to this section at a later time.</p>

<p>We start with the inheritance structure for models. Comparing  <a class="ref" href="a-demo-app#code:demo_user_class">リスト2.12</a> and <a class="ref" href="a-demo-app#code:demo_micropost_class">リスト2.13</a>, we see that both the User model and the Micropost model inherit (via the left angle bracket&nbsp;<code>&lt;</code>) from <code>ActiveRecord::Base</code>, which is the base class for models provided by ActiveRecord; a diagram summarizing this relationship appears in <a class="ref" href="a-demo-app#fig:demo_model_inheritance">図2.16</a>. It is by inheriting from <code>ActiveRecord::Base</code> that our model objects gain the ability to communicate with the database, treat the database columns as Ruby attributes, and so&nbsp;on.</p>

<div class="label" id="code:demo_user_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.12.</span> <span class="description">The <code>User</code> class, with inheritance. <br /> <code>app/models/user.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_micropost_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.13.</span> <span class="description">The <code>Micropost</code> class, with inheritance. <br /> <code>app/models/micropost.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="fig:demo_model_inheritance"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_model_inheritance.png" alt="demo_model_inheritance" /></span></div><div class="caption"><span class="header">図 2.16: </span><span class="description">The inheritance hierarchy for the User and Micropost models.</span></div></div>


<p>The inheritance structure for controllers is only slightly more complicated. Comparing <a class="ref" href="a-demo-app#code:demo_users_controller_class">リスト2.14</a> and <a class="ref" href="a-demo-app#code:demo_microposts_controller_class">リスト2.15</a>, we see that both the Users controller and the Microposts controller inherit from the Application controller. Examining <a class="ref" href="a-demo-app#code:demo_application_controller_class">リスト2.16</a>, we see that <code>ApplicationController</code> itself inherits from <code>ActionController::Base</code>; this is the base class for controllers provided by the Rails library Action Pack. The relationships between these classes is illustrated in <a class="ref" href="a-demo-app#fig:demo_controller_inheritance">図2.17</a>.</p>

<div class="label" id="code:demo_users_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.14.</span> <span class="description">The <code>UsersController</code> class, with inheritance. <br /> <code>app/controllers/users_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_microposts_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.15.</span> <span class="description">The <code>MicropostsController</code> class, with inheritance. <br /> <code>app/controllers/microposts_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_application_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 2.16.</span> <span class="description">The <code>ApplicationController</code> class, with inheritance. <br /> <code>app/controllers/application_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="fig:demo_controller_inheritance"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_controller_inheritance.png" alt="demo_controller_inheritance" /></span></div><div class="caption"><span class="header">図 2.17: </span><span class="description">The inheritance hierarchy for the Users and Microposts controllers.</span></div></div>


<p>As with model inheritance, by inheriting ultimately from <code>ActionController::Base</code> both the Users and Microposts controllers gain a large amount of functionality, such as the ability to manipulate model objects, filter inbound HTTP requests, and render views as HTML. Since all Rails controllers inherit from <code>ApplicationController</code>, rules defined in the Application controller automatically apply to every action in the application. For example, in <a class="ref" href="sign-up#sec:filtering_parameter_logging">節8.2.4</a> we&rsquo;ll see how defining a rule in the Application controller allows us to filter passwords from all the Rails log files, thereby avoiding a serious potential security breach.</p>

<div class="label" id="sec:deploying_the_demo_app"></div>


<h3><a id="sec:2.3.5" href="a-demo-app#sec:deploying_the_demo_app" class="heading"><span class="number">2.3.5</span> Deploying the demo app</a></h3>


<p>With the completion of the Microposts resource, now is a good time to push the repository up to GitHub:<sup class="footnote" id="fnref:2.14"><a href="#fn:2.14">14</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -a -m <span class="s2">&quot;Done with the demo app&quot;</span>
<span class="gp">$</span> git push
</pre></div>
</div>


<p>You can also deploy the demo app to Heroku:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku create
<span class="gp">$</span> git push heroku master
<span class="gp">$</span> heroku rake db:migrate
</pre></div>
</div>


<p>(If this doesn&rsquo;t work for you, see the note just above <a class="ref" href="beginning#code:gemfile_sqlite_heroku">リスト1.8</a> for a possible fix.) Note the final line here, which runs the database migrations on the Heroku server. This updates the database at Heroku with the necessary user/micropost data model. If you want to push the <em>data</em> up, too, you can do so using the <tt>taps</tt> gem and <code>db:push</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install taps
<span class="gp">$</span> heroku db:push
</pre></div>
</div>




<h2><a id="sec:2.4" href="a-demo-app#sec:2.4" class="heading"><span class="number">2.4</span> Conclusion</a></h2>


<p>We&rsquo;ve come now to the end of the 30,000-foot view of a Rails application. The demo app developed in this chapter has several strengths and a host of weaknesses. <br /></p>

<p><strong>Strengths</strong></p>

<ul>
<li>High-level overview of Rails</li>
<li>Introduction to MVC</li>
<li>First taste of the REST architecture</li>
<li>Beginning data modeling</li>
<li>A live, database-backed web application in production<sup class="footnote" id="fnref:2.15"><a href="#fn:2.15">15</a></sup></li>
</ul>


<p><strong>Weaknesses</strong></p>

<ul>
<li>No custom layout or styling</li>
<li>No static pages (like &ldquo;Home&rdquo; or &ldquo;About&rdquo;)</li>
<li>No user passwords</li>
<li>No user images</li>
<li>No signing in</li>
<li>No security</li>
<li>No automatic user/micropost association</li>
<li>No notion of &ldquo;following&rdquo; or &ldquo;followed&rdquo;</li>
<li>No micropost feed</li>
<li>No test-driven development</li>
<li><strong>No real understanding</strong></li>
</ul>


<p>The rest of this tutorial is dedicated to building on the strengths and eliminating the weaknesses.</p>

<div class="navigation">  <a class="prev_page" href="beginning#top">
    &laquo;&nbsp;<span class="number">Chapter 1</span> From zero to deploy
  </a>
  <a class="next_page" href="static-pages#top">
    <span class="number">Chapter 3</span> Mostly static pages&nbsp;&raquo;
  </a>
</div><div class="footnotes">
<ol>
<li id="fn:2.1">I urge you not to look too closely at the generated code; at this stage, it will only serve to confuse you.&nbsp;<a class="arrow" href="#fnref:2.1">&uarr;</a></li>
<li id="fn:2.2">Recall that the <code>rails</code> command generates a default <code>.gitignore</code> file, but depending on your system you may find the augmented file from <a class="ref" href="beginning#code:gitignore">リスト1.5</a> to be more convenient.&nbsp;<a class="arrow" href="#fnref:2.2">&uarr;</a></li>
<li id="fn:2.3">When modeling longer posts, such as those for a normal (non-micro) blog, you should use the <code>text</code> type in place of <code>string</code>.&nbsp;<a class="arrow" href="#fnref:2.3">&uarr;</a></li>
<li id="fn:2.4">The name of the scaffold follows the convention of <em>models</em>, which are singular, rather than resources and controllers, which are plural. Thus, we have <code>User</code> instead <code>Users</code>.&nbsp;<a class="arrow" href="#fnref:2.4">&uarr;</a></li>
<li id="fn:2.5">The user id is needed as the <em>primary key</em> in the database.&nbsp;<a class="arrow" href="#fnref:2.5">&uarr;</a></li>
<li id="fn:2.6">Since the <tt>http://localhost:3000</tt> part of the address is implicit whenever we are developing locally, I&rsquo;ll usually omit it from now on.&nbsp;<a class="arrow" href="#fnref:2.6">&uarr;</a></li>
<li id="fn:2.7">Some references indicate that the view returns the HTML directly to the browser (via a web server such as Apache or Nginx). Regardless of the implementation details, I prefer to think of the controller as a central hub through which all the application&rsquo;s information flows.&nbsp;<a class="arrow" href="#fnref:2.7">&uarr;</a></li>
<li id="fn:2.8">The strange notation <code>:users</code> is a <em>symbol</em>, which we&rsquo;ll learn about in <a class="ref" href="rails-flavored-ruby#sec:hashes_and_symbols">節4.3.3</a>.&nbsp;<a class="arrow" href="#fnref:2.8">&uarr;</a></li>
<li id="fn:2.9">The scaffold code is ugly and confusing, so I&rsquo;ve suppressed it.&nbsp;<a class="arrow" href="#fnref:2.9">&uarr;</a></li>
<li id="fn:2.10">Remember, you aren&rsquo;t supposed to understand this code right now. It is shown only for purposes of illustration.&nbsp;<a class="arrow" href="#fnref:2.10">&uarr;</a></li>
<li id="fn:2.11">As with the User scaffold, the scaffold generator for microposts follows the singular convention of Rails models; thus, we have <code>generate Micropost</code>.&nbsp;<a class="arrow" href="#fnref:2.11">&uarr;</a></li>
<li id="fn:2.12">The scaffold code may have extra newlines compared to <a class="ref" href="a-demo-app#code:demo_microposts_resource">リスト2.7</a>; this is not a cause for concern, as Ruby ignores extra newlines.&nbsp;<a class="arrow" href="#fnref:2.12">&uarr;</a></li>
<li id="fn:2.13">Your console prompt will probably be something like <code>ruby-1.9.2-head &gt;</code>, but I&rsquo;ll use&nbsp;<code>&gt;&gt;</code> so that the prompt isn&rsquo;t tied to a specific Ruby version.&nbsp;<a class="arrow" href="#fnref:2.13">&uarr;</a></li>
<li id="fn:2.14">Ordinarily, you should make smaller, more frequent commits, but for the purposes of this chapter a single big commit at the end is just fine.&nbsp;<a class="arrow" href="#fnref:2.14">&uarr;</a></li>
<li id="fn:2.15">If you deployed to Heroku in <a class="ref" href="a-demo-app#sec:deploying_the_demo_app">節2.3.5</a>.&nbsp;<a class="arrow" href="#fnref:2.15">&uarr;</a></li>
</ol>
</div>




