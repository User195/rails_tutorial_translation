

<h1 class="title">Ruby on Rails Tutorial </h1>


<h1 class="subtitle">  Learn Rails by Example</h1>


<h2 class="author">Michael Hartl</h2>




<h1 class="contents">Contents</h1>


<div id="table_of_contents"><ol><li class="chapter"><a href="beginning#top"><span class="number">Chapter 1</span> From zero to deploy</a></li><li><ol><li class="section"><a href="beginning#sec:introduction"><span class="number">1.1</span> Introduction</a></li><li><ol><li class="subsection"><a href="beginning#sec:comments_for_various_readers"><span class="number">1.1.1</span> Comments for various readers</a></li><li class="subsection"><a href="beginning#sec:1.1.2"><span class="number">1.1.2</span> &ldquo;Scaling&rdquo; Rails</a></li><li class="subsection"><a href="beginning#sec:conventions"><span class="number">1.1.3</span> Conventions in this book</a></li></ol></li><li class="section"><a href="beginning#sec:up_and_running"><span class="number">1.2</span> Up and running</a></li><li><ol><li class="subsection"><a href="beginning#sec:development_tools"><span class="number">1.2.1</span> Development environments</a></li><li><ol><li class="subsubsection"><a href="beginning#sec:1.2.1.1">IDEs</a></li><li class="subsubsection"><a href="beginning#sec:1.2.1.2">Text editors and command lines</a></li><li class="subsubsection"><a href="beginning#sec:1.2.1.3">Browsers</a></li><li class="subsubsection"><a href="beginning#sec:1.2.1.4">A note about tools</a></li></ol></li><li class="subsection"><a href="beginning#sec:rubygems"><span class="number">1.2.2</span> Ruby, RubyGems, Rails, and Git</a></li><li><ol><li class="subsubsection"><a href="beginning#sec:rails_installer_windows">Rails Installer (Windows)</a></li><li class="subsubsection"><a href="beginning#sec:install_git">Install Git</a></li><li class="subsubsection"><a href="beginning#sec:install_ruby">Install Ruby</a></li><li class="subsubsection"><a href="beginning#sec:install_rubygems">Install RubyGems</a></li><li class="subsubsection"><a href="beginning#sec:install_rails">Install Rails</a></li></ol></li><li class="subsection"><a href="beginning#sec:the_first_application"><span class="number">1.2.3</span> The first application</a></li><li class="subsection"><a href="beginning#sec:bundler"><span class="number">1.2.4</span> Bundler</a></li><li class="subsection"><a href="beginning#sec:rails_server"><span class="number">1.2.5</span> <code>rails server</code></a></li><li class="subsection"><a href="beginning#sec:mvc"><span class="number">1.2.6</span> Model-view-controller (MVC)</a></li></ol></li><li class="section"><a href="beginning#sec:version_control"><span class="number">1.3</span> Version control with Git</a></li><li><ol><li class="subsection"><a href="beginning#sec:git_setup"><span class="number">1.3.1</span> Installation and setup</a></li><li><ol><li class="subsubsection"><a href="beginning#sec:1.3.1.1">First-time system setup</a></li><li class="subsubsection"><a href="beginning#sec:1.3.1.2">First-time repository setup</a></li></ol></li><li class="subsection"><a href="beginning#sec:adding_and_committing"><span class="number">1.3.2</span> Adding and committing</a></li><li class="subsection"><a href="beginning#sec:1.3.3"><span class="number">1.3.3</span> What good does Git do you?</a></li><li class="subsection"><a href="beginning#sec:github"><span class="number">1.3.4</span> GitHub</a></li><li class="subsection"><a href="beginning#sec:git_commands"><span class="number">1.3.5</span> Branch, edit, commit, merge</a></li><li><ol><li class="subsubsection"><a href="beginning#sec:git_branch">Branch</a></li><li class="subsubsection"><a href="beginning#sec:git_edit">Edit</a></li><li class="subsubsection"><a href="beginning#sec:git_commit">Commit</a></li><li class="subsubsection"><a href="beginning#sec:git_merge">Merge</a></li><li class="subsubsection"><a href="beginning#sec:git_push">Push</a></li></ol></li></ol></li><li class="section"><a href="beginning#sec:deploying"><span class="number">1.4</span> Deploying</a></li><li><ol><li class="subsection"><a href="beginning#sec:1.4.1"><span class="number">1.4.1</span> Heroku setup</a></li><li class="subsection"><a href="beginning#sec:heroku_step_one"><span class="number">1.4.2</span> Heroku deployment, step one</a></li><li class="subsection"><a href="beginning#sec:1.4.3"><span class="number">1.4.3</span> Heroku deployment, step two</a></li><li class="subsection"><a href="beginning#sec:heroku_commands"><span class="number">1.4.4</span> Heroku commands</a></li></ol></li><li class="section"><a href="beginning#sec:beginning_conclusion"><span class="number">1.5</span> Conclusion</a></li></ol></li><li class="chapter"><a href="a-demo-app#top"><span class="number">Chapter 2</span> A demo app</a></li><li><ol><li class="section"><a href="a-demo-app#sec:planning_the_application"><span class="number">2.1</span> Planning the application</a></li><li><ol><li class="subsection"><a href="a-demo-app#sec:modeling_users"><span class="number">2.1.1</span> Modeling users</a></li><li class="subsection"><a href="a-demo-app#sec:modeling_microposts"><span class="number">2.1.2</span> Modeling microposts</a></li></ol></li><li class="section"><a href="a-demo-app#sec:demo_users_resource"><span class="number">2.2</span> The Users resource</a></li><li><ol><li class="subsection"><a href="a-demo-app#sec:a_user_tour"><span class="number">2.2.1</span> A user tour</a></li><li class="subsection"><a href="a-demo-app#sec:mvc_in_action"><span class="number">2.2.2</span> MVC in action</a></li><li class="subsection"><a href="a-demo-app#sec:weaknesses_of_this_users_resource"><span class="number">2.2.3</span> Weaknesses of this Users resource</a></li></ol></li><li class="section"><a href="a-demo-app#sec:microposts_resource"><span class="number">2.3</span> The Microposts resource</a></li><li><ol><li class="subsection"><a href="a-demo-app#sec:a_micropost_microtour"><span class="number">2.3.1</span> A micropost microtour</a></li><li class="subsection"><a href="a-demo-app#sec:putting_the_micro_in_microposts"><span class="number">2.3.2</span> Putting the <em>micro</em> in microposts</a></li><li class="subsection"><a href="a-demo-app#sec:demo_user_has_many_microposts"><span class="number">2.3.3</span> A user <code>has_many</code> microposts</a></li><li class="subsection"><a href="a-demo-app#sec:inheritance_hierarchies"><span class="number">2.3.4</span> Inheritance hierarchies</a></li><li class="subsection"><a href="a-demo-app#sec:deploying_the_demo_app"><span class="number">2.3.5</span> Deploying the demo app</a></li></ol></li><li class="section"><a href="a-demo-app#sec:2.4"><span class="number">2.4</span> Conclusion</a></li></ol></li><li class="chapter"><a href="static-pages#top"><span class="number">Chapter 3</span> Mostly static pages</a></li><li><ol><li class="section"><a href="static-pages#sec:static_pages"><span class="number">3.1</span> Static pages</a></li><li><ol><li class="subsection"><a href="static-pages#sec:truly_static_pages"><span class="number">3.1.1</span> Truly static pages</a></li><li class="subsection"><a href="static-pages#sec:static_pages_with_rails"><span class="number">3.1.2</span> Static pages with Rails</a></li></ol></li><li class="section"><a href="static-pages#sec:first_tests"><span class="number">3.2</span> Our first tests</a></li><li><ol><li class="subsection"><a href="static-pages#sec:testing_tools"><span class="number">3.2.1</span> Testing tools</a></li><li><ol><li class="subsubsection"><a href="static-pages#sec:autotest">Autotest</a></li></ol></li><li class="subsection"><a href="static-pages#sec:TDD"><span class="number">3.2.2</span> TDD: Red, Green, Refactor</a></li><li><ol><li class="subsubsection"><a href="static-pages#sec:spork">Spork</a></li><li class="subsubsection"><a href="static-pages#sec:red">Red</a></li><li class="subsubsection"><a href="static-pages#sec:green">Green</a></li><li class="subsubsection"><a href="static-pages#sec:refactor">Refactor</a></li></ol></li></ol></li><li class="section"><a href="static-pages#sec:slightly_dynamic_pages"><span class="number">3.3</span> Slightly dynamic pages</a></li><li><ol><li class="subsection"><a href="static-pages#sec:testing_a_title_change"><span class="number">3.3.1</span> Testing a title change</a></li><li class="subsection"><a href="static-pages#sec:passing_title_tests"><span class="number">3.3.2</span> Passing title tests</a></li><li class="subsection"><a href="static-pages#sec:instance_variables_embedded_ruby"><span class="number">3.3.3</span> Instance variables and Embedded Ruby</a></li><li class="subsection"><a href="static-pages#sec:layouts"><span class="number">3.3.4</span> Eliminating duplication with layouts</a></li></ol></li><li class="section"><a href="static-pages#sec:static_pages_conclusion"><span class="number">3.4</span> Conclusion</a></li><li class="section"><a href="static-pages#sec:static_pages_exercises"><span class="number">3.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="rails-flavored-ruby#top"><span class="number">Chapter 4</span> Rails-flavored Ruby</a></li><li><ol><li class="section"><a href="rails-flavored-ruby#sec:motivation"><span class="number">4.1</span> Motivation</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec:title_helper"><span class="number">4.1.1</span> A <code>title</code> helper</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:cascading_style_sheets"><span class="number">4.1.2</span> Cascading Style Sheets</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec:strings_and_methods"><span class="number">4.2</span> Strings and methods</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec:comments"><span class="number">4.2.1</span> Comments</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:strings"><span class="number">4.2.2</span> Strings</a></li><li><ol><li class="subsubsection"><a href="rails-flavored-ruby#sec:printing">Printing</a></li><li class="subsubsection"><a href="rails-flavored-ruby#sec:single_quoted_strings">Single-quoted strings</a></li></ol></li><li class="subsection"><a href="rails-flavored-ruby#sec:objects_and_message_passing"><span class="number">4.2.3</span> Objects and message passing</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:method_definitions"><span class="number">4.2.4</span> Method definitions</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:back_to_the_title_helper"><span class="number">4.2.5</span> Back to the <code>title</code> helper</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec:other_data_structures"><span class="number">4.3</span> Other data structures</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec:arrays_and_ranges"><span class="number">4.3.1</span> Arrays and ranges</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:blocks"><span class="number">4.3.2</span> Blocks</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:hashes_and_symbols"><span class="number">4.3.3</span> Hashes and symbols</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:css_revisited"><span class="number">4.3.4</span> CSS revisited</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec:ruby_classes"><span class="number">4.4</span> Ruby classes</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec:constructors"><span class="number">4.4.1</span> Constructors</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:a_class_of_our_own"><span class="number">4.4.2</span> Class inheritance</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:modifying_built_in_classes"><span class="number">4.4.3</span> Modifying built-in classes</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:a_controller_class"><span class="number">4.4.4</span> A controller class</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:a_user_class"><span class="number">4.4.5</span> A user class</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec:exercises"><span class="number">4.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="filling-in-the-layout#top"><span class="number">Chapter 5</span> Filling in the layout</a></li><li><ol><li class="section"><a href="filling-in-the-layout#sec:structure"><span class="number">5.1</span> Adding some structure</a></li><li><ol><li class="subsection"><a href="filling-in-the-layout#sec:adding_to_the_layout"><span class="number">5.1.1</span> Site navigation</a></li><li class="subsection"><a href="filling-in-the-layout#sec:custom_css"><span class="number">5.1.2</span> Custom CSS</a></li><li class="subsection"><a href="filling-in-the-layout#sec:partials"><span class="number">5.1.3</span> Partials</a></li></ol></li><li class="section"><a href="filling-in-the-layout#sec:layout_links"><span class="number">5.2</span> Layout links</a></li><li><ol><li class="subsection"><a href="filling-in-the-layout#sec:integration_tests"><span class="number">5.2.1</span> Integration tests</a></li><li class="subsection"><a href="filling-in-the-layout#sec:rails_routes"><span class="number">5.2.2</span> Rails routes</a></li><li class="subsection"><a href="filling-in-the-layout#sec:named_routes"><span class="number">5.2.3</span> Named routes</a></li></ol></li><li class="section"><a href="filling-in-the-layout#sec:user_signup"><span class="number">5.3</span> User signup: A first step</a></li><li><ol><li class="subsection"><a href="filling-in-the-layout#sec:users_controller"><span class="number">5.3.1</span> Users controller</a></li><li class="subsection"><a href="filling-in-the-layout#sec:signup_url"><span class="number">5.3.2</span> Signup URL</a></li></ol></li><li class="section"><a href="filling-in-the-layout#sec:layout_conclusion"><span class="number">5.4</span> Conclusion</a></li><li class="section"><a href="filling-in-the-layout#sec:layout_exercises"><span class="number">5.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="modeling-and-viewing-users-one#top"><span class="number">Chapter 6</span> Modeling and viewing users, part I</a></li><li><ol><li class="section"><a href="modeling-and-viewing-users-one#sec:user_model"><span class="number">6.1</span> User model</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-one#sec:database_migrations"><span class="number">6.1.1</span> Database migrations</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:the_model_file"><span class="number">6.1.2</span> The model file</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:model_annotation">Model annotation</a></li><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:accessible_attributes">Accessible attributes</a></li></ol></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:creating_user_objects"><span class="number">6.1.3</span> Creating user objects</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:finding_user_objects"><span class="number">6.1.4</span> Finding user objects</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:updating_user_objects"><span class="number">6.1.5</span> Updating user objects</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-one#sec:user_validations"><span class="number">6.2</span> User validations</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-one#sec:presence_validation"><span class="number">6.2.1</span> Validating presence</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:length_validation"><span class="number">6.2.2</span> Length validation</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:format_validation"><span class="number">6.2.3</span> Format validation</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:uniqueness_validation"><span class="number">6.2.4</span> Uniqueness validation</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:the_caveat">The uniqueness caveat</a></li></ol></li></ol></li><li class="section"><a href="modeling-and-viewing-users-one#sec:viewing_users"><span class="number">6.3</span> Viewing users</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-one#sec:rails_environments"><span class="number">6.3.1</span> Debug and Rails environments</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:users_show"><span class="number">6.3.2</span> User model, view, controller</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:a_users_resource"><span class="number">6.3.3</span> A Users resource</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:params_in_debug"><code>params</code> in <code>debug</code></a></li></ol></li></ol></li><li class="section"><a href="modeling-and-viewing-users-one#sec:6.4"><span class="number">6.4</span> Conclusion</a></li><li class="section"><a href="modeling-and-viewing-users-one#sec:6.5"><span class="number">6.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="modeling-and-viewing-users-two#top"><span class="number">Chapter 7</span> Modeling and viewing users, part II</a></li><li><ol><li class="section"><a href="modeling-and-viewing-users-two#sec:insecure_passwords"><span class="number">7.1</span> Insecure passwords</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_validations"><span class="number">7.1.1</span> Password validations</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_migration"><span class="number">7.1.2</span> A password migration</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_active_record_callback"><span class="number">7.1.3</span> An Active Record callback</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec:secure_passwords"><span class="number">7.2</span> Secure passwords</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_secure_password_test"><span class="number">7.2.1</span> A secure password test</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:secure_password_theory"><span class="number">7.2.2</span> Some secure password theory</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:implementing_has_password"><span class="number">7.2.3</span> Implementing <code>has_password?</code></a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_authenticate_method"><span class="number">7.2.4</span> An authenticate method</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec:better_user_views"><span class="number">7.3</span> Better user views</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec:tests_with_factories"><span class="number">7.3.1</span> Testing the user show page (with factories)</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_name_and_a_gravatar"><span class="number">7.3.2</span> A name and a Gravatar</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-two#sec:a_gravatar_helper">A Gravatar helper</a></li></ol></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_user_sidebar"><span class="number">7.3.3</span> A user sidebar</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec:7.4"><span class="number">7.4</span> Conclusion</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec:7.4.1"><span class="number">7.4.1</span> Git commit</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:heroku_deploy"><span class="number">7.4.2</span> Heroku deploy</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec:more_modeling_users_exercises"><span class="number">7.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="sign-up#top"><span class="number">Chapter 8</span> Sign up</a></li><li><ol><li class="section"><a href="sign-up#sec:signup_form"><span class="number">8.1</span> Signup form</a></li><li><ol><li class="subsection"><a href="sign-up#sec:using_form_for"><span class="number">8.1.1</span> Using <code>form_for</code></a></li><li class="subsection"><a href="sign-up#sec:the_form_html"><span class="number">8.1.2</span> The form HTML</a></li></ol></li><li class="section"><a href="sign-up#sec:signup_failure"><span class="number">8.2</span> Signup failure</a></li><li><ol><li class="subsection"><a href="sign-up#sec:testing_failure"><span class="number">8.2.1</span> Testing failure</a></li><li class="subsection"><a href="sign-up#sec:a_working_form"><span class="number">8.2.2</span> A working form</a></li><li class="subsection"><a href="sign-up#sec:signup_error_messages"><span class="number">8.2.3</span> Signup error messages</a></li><li class="subsection"><a href="sign-up#sec:filtering_parameter_logging"><span class="number">8.2.4</span> Filtering parameter logging</a></li></ol></li><li class="section"><a href="sign-up#sec:signup_success"><span class="number">8.3</span> Signup success</a></li><li><ol><li class="subsection"><a href="sign-up#sec:testing_success"><span class="number">8.3.1</span> Testing success</a></li><li class="subsection"><a href="sign-up#sec:the_finished_signup_form"><span class="number">8.3.2</span> The finished signup form</a></li><li class="subsection"><a href="sign-up#sec:the_flash"><span class="number">8.3.3</span> The flash</a></li><li class="subsection"><a href="sign-up#sec:the_first_signup"><span class="number">8.3.4</span> The first signup</a></li></ol></li><li class="section"><a href="sign-up#sec:rspec_integration_tests"><span class="number">8.4</span> RSpec integration tests</a></li><li><ol><li class="subsection"><a href="sign-up#sec:integration_tests_with_style"><span class="number">8.4.1</span> Integration tests with style</a></li><li class="subsection"><a href="sign-up#sec:failed_signup"><span class="number">8.4.2</span> Users signup failure should not make a new user</a></li><li class="subsection"><a href="sign-up#sec:successful_signup"><span class="number">8.4.3</span> Users signup success should make a new user</a></li></ol></li><li class="section"><a href="sign-up#sec:8.5"><span class="number">8.5</span> Conclusion</a></li><li class="section"><a href="sign-up#sec:signup_exercises"><span class="number">8.6</span> Exercises</a></li></ol></li><li class="chapter"><a href="sign-in-sign-out#top"><span class="number">Chapter 9</span> Sign in, sign out</a></li><li><ol><li class="section"><a href="sign-in-sign-out#sec:sessions"><span class="number">9.1</span> Sessions</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec:sessions_controller"><span class="number">9.1.1</span> Sessions controller</a></li><li class="subsection"><a href="sign-in-sign-out#sec:signin_form"><span class="number">9.1.2</span> Signin form</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec:signin_failure"><span class="number">9.2</span> Signin failure</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec:reviewing_form_submission"><span class="number">9.2.1</span> Reviewing form submission</a></li><li class="subsection"><a href="sign-in-sign-out#sec:failed_signin"><span class="number">9.2.2</span> Failed signin (test and code)</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec:signin_success"><span class="number">9.3</span> Signin success</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec:the_completed_create_action"><span class="number">9.3.1</span> The completed <code>create</code> action</a></li><li class="subsection"><a href="sign-in-sign-out#sec:remember_me"><span class="number">9.3.2</span> Remember me</a></li><li class="subsection"><a href="sign-in-sign-out#sec:current_user"><span class="number">9.3.3</span> Current user</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec:signing_out"><span class="number">9.4</span> Signing out</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec:destroying_sessions"><span class="number">9.4.1</span> Destroying sessions</a></li><li class="subsection"><a href="sign-in-sign-out#sec:signin_upon_signup"><span class="number">9.4.2</span> Signin upon signup</a></li><li class="subsection"><a href="sign-in-sign-out#sec:changing_the_layout_links"><span class="number">9.4.3</span> Changing the layout links</a></li><li class="subsection"><a href="sign-in-sign-out#sec:signin_out_integration_tests"><span class="number">9.4.4</span> Signin/out integration tests</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec:9.5"><span class="number">9.5</span> Conclusion</a></li><li class="section"><a href="sign-in-sign-out#sec:sign_in_out_exercises"><span class="number">9.6</span> Exercises</a></li></ol></li><li class="chapter"><a href="updating-showing-and-deleting-users#top"><span class="number">Chapter 10</span> Updating, showing, and deleting users</a></li><li><ol><li class="section"><a href="updating-showing-and-deleting-users#sec:updating_users"><span class="number">10.1</span> Updating users</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec:edit_form"><span class="number">10.1.1</span> Edit form</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:enabling_edits"><span class="number">10.1.2</span> Enabling edits</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec:protecting_pages"><span class="number">10.2</span> Protecting pages</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_signed_in_users"><span class="number">10.2.1</span> Requiring signed-in users</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_the_right_user"><span class="number">10.2.2</span> Requiring the right user</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:friendly_forwarding"><span class="number">10.2.3</span> Friendly forwarding</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec:showing_users"><span class="number">10.3</span> Showing users</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec:user_index"><span class="number">10.3.1</span> User index</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:sample_users"><span class="number">10.3.2</span> Sample users</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:pagination"><span class="number">10.3.3</span> Pagination</a></li><li><ol><li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:testing_pagination">Testing pagination</a></li></ol></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:partial_refactoring"><span class="number">10.3.4</span> Partial refactoring</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec:destroying_users"><span class="number">10.4</span> Destroying users</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec:administrative_users"><span class="number">10.4.1</span> Administrative users</a></li><li><ol><li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:revisiting_attr_accessible">Revisiting <code>attr_accessible</code></a></li></ol></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:the_destroy_action"><span class="number">10.4.2</span> The <code>destroy</code> action</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec:10.5"><span class="number">10.5</span> Conclusion</a></li><li class="section"><a href="updating-showing-and-deleting-users#sec:updating_deleting_exercises"><span class="number">10.6</span> Exercises</a></li></ol></li><li class="chapter"><a href="user-microposts#top"><span class="number">Chapter 11</span> User microposts</a></li><li><ol><li class="section"><a href="user-microposts#sec:a_micropost_model"><span class="number">11.1</span> A Micropost model</a></li><li><ol><li class="subsection"><a href="user-microposts#sec:the_basic_model"><span class="number">11.1.1</span> The basic model</a></li><li><ol><li class="subsubsection"><a href="user-microposts#sec:accessible_attribute">Accessible attribute</a></li></ol></li><li class="subsection"><a href="user-microposts#sec:user_micropost_associations"><span class="number">11.1.2</span> User/Micropost associations</a></li><li class="subsection"><a href="user-microposts#sec:ordering_and_dependency"><span class="number">11.1.3</span> Micropost refinements</a></li><li><ol><li class="subsubsection"><a href="user-microposts#sec:default_scope">Default scope</a></li><li class="subsubsection"><a href="user-microposts#sec:dependent_destroy">Dependent: destroy</a></li></ol></li><li class="subsection"><a href="user-microposts#sec:micropost_validations"><span class="number">11.1.4</span> Micropost validations</a></li></ol></li><li class="section"><a href="user-microposts#sec:showing_microposts"><span class="number">11.2</span> Showing microposts</a></li><li><ol><li class="subsection"><a href="user-microposts#sec:augmenting_the_user_show_page"><span class="number">11.2.1</span> Augmenting the user show page</a></li><li class="subsection"><a href="user-microposts#sec:sample_microposts"><span class="number">11.2.2</span> Sample microposts</a></li></ol></li><li class="section"><a href="user-microposts#sec:manipulating_microposts"><span class="number">11.3</span> Manipulating microposts</a></li><li><ol><li class="subsection"><a href="user-microposts#sec:access_control"><span class="number">11.3.1</span> Access control</a></li><li class="subsection"><a href="user-microposts#sec:creating_microposts"><span class="number">11.3.2</span> Creating microposts</a></li><li class="subsection"><a href="user-microposts#sec:a_proto_feed"><span class="number">11.3.3</span> A proto-feed</a></li><li class="subsection"><a href="user-microposts#sec:destroying_microposts"><span class="number">11.3.4</span> Destroying microposts</a></li><li class="subsection"><a href="user-microposts#sec:testing_the_new_home_page"><span class="number">11.3.5</span> Testing the new home page</a></li></ol></li><li class="section"><a href="user-microposts#sec:11.4"><span class="number">11.4</span> Conclusion</a></li><li class="section"><a href="user-microposts#sec:micropost_exercises"><span class="number">11.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="following-users#top"><span class="number">Chapter 12</span> Following users</a></li><li><ol><li class="section"><a href="following-users#sec:the_relationship_model"><span class="number">12.1</span> The Relationship model</a></li><li><ol><li class="subsection"><a href="following-users#sec:a_problem_with_the_data_model"><span class="number">12.1.1</span> A problem with the data model (and a solution)</a></li><li class="subsection"><a href="following-users#sec:relationship_user_associations"><span class="number">12.1.2</span> User/relationship associations</a></li><li class="subsection"><a href="following-users#sec:relationship_validations"><span class="number">12.1.3</span> Validations</a></li><li class="subsection"><a href="following-users#sec:following"><span class="number">12.1.4</span> Following</a></li><li class="subsection"><a href="following-users#sec:followers"><span class="number">12.1.5</span> Followers</a></li></ol></li><li class="section"><a href="following-users#sec:a_web_interface_for_following_and_followers"><span class="number">12.2</span> A web interface for following and followers</a></li><li><ol><li class="subsection"><a href="following-users#sec:sample_following_data"><span class="number">12.2.1</span> Sample following data</a></li><li class="subsection"><a href="following-users#sec:stats_and_a_follow_form"><span class="number">12.2.2</span> Stats and a follow form</a></li><li class="subsection"><a href="following-users#sec:following_and_followers_pages"><span class="number">12.2.3</span> Following and followers pages</a></li><li class="subsection"><a href="following-users#sec:a_working_follow_button_the_standard_way"><span class="number">12.2.4</span> A working follow button the standard way</a></li><li class="subsection"><a href="following-users#sec:a_working_follow_button_with_ajax"><span class="number">12.2.5</span> A working follow button with Ajax</a></li></ol></li><li class="section"><a href="following-users#sec:the_status_feed"><span class="number">12.3</span> The status feed</a></li><li><ol><li class="subsection"><a href="following-users#sec:motivation_and_strategy"><span class="number">12.3.1</span> Motivation and strategy</a></li><li class="subsection"><a href="following-users#sec:a_first_feed_implementation"><span class="number">12.3.2</span> A first feed implementation</a></li><li class="subsection"><a href="following-users#sec:scopes_subselects_and_a_lambda"><span class="number">12.3.3</span> Scopes, subselects, and a lambda</a></li><li class="subsection"><a href="following-users#sec:the_new_status_feed"><span class="number">12.3.4</span> The new status feed</a></li></ol></li><li class="section"><a href="following-users#sec:following_conclusion"><span class="number">12.4</span> Conclusion</a></li><li><ol><li class="subsection"><a href="following-users#sec:extensions_to_the_sample_application"><span class="number">12.4.1</span> Extensions to the sample application</a></li><li><ol><li class="subsubsection"><a href="following-users#sec:replies">Replies</a></li><li class="subsubsection"><a href="following-users#sec:messaging">Messaging</a></li><li class="subsubsection"><a href="following-users#sec:follower_notifications">Follower notifications</a></li><li class="subsubsection"><a href="following-users#sec:password_reminders">Password reminders</a></li><li class="subsubsection"><a href="following-users#sec:signup_confirmation">Signup confirmation</a></li><li class="subsubsection"><a href="following-users#sec:rss_feed">RSS feed</a></li><li class="subsubsection"><a href="following-users#sec:rest_api">REST API</a></li><li class="subsubsection"><a href="following-users#sec:search">Search</a></li></ol></li><li class="subsection"><a href="following-users#sec:guide_to_further_resources"><span class="number">12.4.2</span> Guide to further resources</a></li></ol></li><li class="section"><a href="following-users#sec:following_exercises"><span class="number">12.5</span> Exercises</a></li></ol></li></ol></div>


<div id="main_content"></div>


<p> <span class="preamble">
 <span id="foreword">
<strong> Foreword</strong> <br />
 </span>
 </span></p>

<p>My former company (CD Baby) was one of the first to loudly switch to Ruby on Rails, and then even more loudly switch back to PHP (Google me to read about the drama). This book by Michael Hartl came so highly recommended that I had to try it, and <em>Ruby on Rails Tutorial</em> is what I used to switch back to Rails again.</p>

<p>Though I&rsquo;ve worked my way through many Rails books, this is the one that finally made me &ldquo;get&rdquo; it. Everything is done very much &ldquo;the Rails way&rdquo;&mdash;a way that felt very unnatural to me before, but now after doing this book finally feels natural. This is also the only Rails book that does test-driven development the entire time, an approach highly recommended by the experts but which has never been so clearly demonstrated before. Finally, by including Git, GitHub, and Heroku in the demo examples, the author really gives you a feel for what it&rsquo;s like to do a real-world project. The tutorial&rsquo;s code examples are not in isolation.</p>

<p>The linear narrative is such a great format. Personally, I powered through <em>Rails Tutorial</em> in three long days, doing all the examples and challenges at the end of each chapter. Do it from start to finish, without jumping around, and you&rsquo;ll get the ultimate benefit.</p>

<p>Enjoy!</p>

<p><a href="http://sivers.org/">Derek Sivers</a> (<a href="http://sivers.org/">sivers.org</a>) <br />
<em>Formerly: Founder,</em> <a href="http://www.cdbaby.com/"><em>CD Baby</em></a> <br />
<em>Currently: Founder,</em> <a href="http://thoughts.pro/"><em>Thoughts Ltd.</em></a> <br /></p>

<p> <span class="preamble">
<strong> Acknowledgments</strong> <br />
 </span></p>

<p><em>Ruby on Rails Tutorial</em> owes a lot to my previous Rails book, <em>RailsSpace</em>, and hence to my coauthor <a href="http://aure.com/">Aurelius Prochazka</a>. I&rsquo;d like to thank Aure both for the work he did on that book and for his support of this one. I&rsquo;d also like to thank Debra Williams Cauley, my editor on both <em>RailsSpace</em> and <em>Rails Tutorial</em>; as long as she keeps taking me to baseball games, I&rsquo;ll keep writing books for her.</p>

<p>I&rsquo;d like to acknowledge a long list of Rubyists who have taught and inspired me over the years: David Heinemeier Hansson, Yehuda Katz, Carl Lerche, Jeremy Kemper, Xavier Noria, Ryan Bates, Geoffrey Grosenbach, Peter Cooper, Matt Aimonetti, Gregg Pollack, Wayne&nbsp;E. Seguin, Amy Hoy, Dave Chelimsky, Pat Maddox, Tom Preston-Werner, Chris Wanstrath, Chad Fowler, Josh Susser, Obie Fernandez, Ian McFarland, Steven Bristol, Giles Bowkett, Evan Dorn, Long Nguyen, James Lindenbaum, Adam Wiggins, Tikhon Bernstam, Ron Evans, Wyatt Greene, Miles Forrest, the good people at Pivotal Labs, the Heroku gang, the thoughtbot guys, and the GitHub crew. Finally, many, many readers&mdash;far too many to list&mdash;have contributed a huge number of bug reports and suggestions during the writing of this book, and I gratefully acknowledge their help in making it as good as it can&nbsp;be. <br /></p>

<p> <span class="preamble">
 <span id="author">
<strong> About the author</strong> <br />
 </span>
 </span></p>

<p><a href="http://michaelhartl.com/">Michael Hartl</a> is a programmer, educator, and entrepreneur. Michael was coauthor of <em>RailsSpace</em>, a best-selling Rails tutorial book published in 2007, and was cofounder and lead developer of <a href="http://insoshi.com/">Insoshi</a>, a <a href="http://github.com/popular/forked">popular</a> social networking platform in Ruby on Rails. Previously, he taught theoretical and computational physics at the <a href="http://www.caltech.edu/">California Institute of Technology</a> (Caltech), where he received the Lifetime Achievement Award for Excellence in Teaching. Michael is a graduate of <a href="http://college.harvard.edu/">Harvard College</a>, has a <a href="http://resolver.caltech.edu/CaltechETD:etd-05222003-161626">Ph.D. in Physics</a> from <a href="http://www.caltech.edu/">Caltech</a>, and is an alumnus of the <a href="http://ycombinator.com/">Y&nbsp;Combinator</a> entrepreneur program. <br /></p>

<p> <span id="license" class="preamble">
<strong> Copyright and license</strong> <br />
 </span></p>

<p><em>Ruby on Rails Tutorial: Learn Rails by Example</em>. Copyright &copy; 2010 by Michael Hartl. All source code in <em>Ruby on Rails Tutorial</em> is available under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> and the <a href="http://en.wikipedia.org/wiki/Beerware">Beerware License</a>.</p>

<pre class="verbatim">   Copyright (c) 2010 Michael Hartl

   Permission is hereby granted, free of charge, to any person
   obtaining a copy of this software and associated documentation
   files (the &quot;Software&quot;), to deal in the Software without
   restriction, including without limitation the rights to use,
   copy, modify, merge, publish, distribute, sublicense, and/or sell
   copies of the Software, and to permit persons to whom the
   Software is furnished to do so, subject to the following
   conditions:

   The above copyright notice and this permission notice shall be
   included in all copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
   OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
   NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
   HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
   WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
   OTHER DEALINGS IN THE SOFTWARE.</pre>




<pre class="verbatim">/*
 * ------------------------------------------------------------
 * &quot;THE BEERWARE LICENSE&quot; (Revision 42):
 * Michael Hartl wrote this code. As long as you retain this 
 * notice, you can do whatever you want with this stuff. If we
 * meet someday, and you think this stuff is worth it, you can
 * buy me a beer in return.
 * ------------------------------------------------------------
 */</pre>




<div id="top"></div>


<h1 class="chapter"><a id="sec:2" href="a-demo-app#top" class="heading"><span class="number">Глава 2</span> demo app</a></h1>


<p>В этой главе мы разработаем простое демонстрационное приложение, чтобы показать мощь Rails. Цель -  получить общее представление о программировании на Ruby on Rails (и веб-разработке в целом), быстро сгенерировав приложение, используя <em>scaffold generators</em>.<sup class="footnote" id="fnref:2.1"><a href="#fn:2.1">1</a></sup> Как обсуждалось в  <a class="ref" href="beginning#sidebar:scaffolding">Блоке&nbsp;1.1</a>, остальная часть книги будет применять противоположный подход, постепенно разрабатывая приложение с объяснением всех новых понятий по мере их появления,  но для быстрого обзора (и некоторого быстрорастворимого удовлетворения) нет ничего лучше scaffolding. Конечное  демонстрационное приложение позволит нам взаимодействовать с ним через свой URL, давая нам понимание строения приложений Rails, включая первый пример <em>REST архитектуры</em> излюбленной Rails.</p>

<p>Как и предстоящий пример приложения, демонстрационное приложение будет состоять из <em>пользователей</em> и связанных с ними <em>микросообщений</em> (образуя минималистское приложение в стиле Twitter). Функциональность будет совершенно слаборазвита, и многие из шагов будут походить на волшебство, но не переживайте: полный пример приложения разработает подобное же приложение с нуля, начиная с <a class="ref" href="static-pages#top">Глава&nbsp;3</a>,  и я дам многочисленные ссылки на более поздний материал. Тем временем, имейте терпение и немного веры - все таки основная цель данного учебика - удержать Вас <em>вне</em> этого поверхностного, управляемого scaffold подхода, для достижения более глубокого понимания Rails.</p>

<div class="label" id="sec:planning_the_application"></div>


<h2><a id="sec:2.1" href="a-demo-app#sec:planning_the_application" class="heading"><span class="number">2.1</span> Планирование приложения</a></h2>


<p>В этом Разделе мы обрисуем в общих чертах наши планы относительно демонстрационного приложения. Как и в <a class="ref" href="beginning#sec:the_first_application">Разделе&nbsp;1.2.3</a>, мы начнем с создания скелета приложения, используя команду <code>rails</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects
<span class="gp">$</span> rails new demo_app
<span class="gp">$</span> <span class="nb">cd </span>demo_app
</pre></div>
</div>


<p>Затем, мы используем текстовый редактор, чтобы обновить <code>Gemfile</code> необходимый Bundler, содержанием из <a class="ref" href="a-demo-app#code:demo_gemfile_sqlite_version_redux">Листинг&nbsp;2.1</a>.</p>

<div class="label" id="code:demo_gemfile_sqlite_version_redux"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.1.</span> <span class="description"><code>Gemfile</code> для демонстрационного приложения.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.7&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3-ruby&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.2&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s1">&#39;sqlite3&#39;</span>
</pre></div>
</div></div>


<p>(Напомним из <a class="ref" href="beginning#sec:bundler">Раздела&nbsp;1.2.4</a> что Вам, возможно, понадобится версия <tt>1.2.5 sqlite3-ruby</tt> gem если Вы используете OS&nbsp;X Leopard.) Затем мы устанавливаем и включаем гемы, используя <code>bundle</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Наконец, мы инициализируем репозитарий Git и сделаем первую фиксацию (commit):<sup class="footnote" id="fnref:2.2"><a href="#fn:2.2">2</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git init
<span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Initial commit&quot;</span>
</pre></div>
</div>


<div class="label" id="fig:create_demo_repo"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/create_demo_repo.png" alt="create_demo_repo" /></span></div><div class="caption"><span class="header">Рис. 2.1: </span><span class="description">Создание репозитария demo app в GitHub.&nbsp;<a href="http://railstutorial.org/images/figures/create_demo_repo-full.png">(полный размер)</a></span></div></div>


<p>Можно также дополнительно создать новый репозитарий (<a class="ref" href="a-demo-app#fig:create_demo_repo">Рис.&nbsp;2.1</a>) и отправить его в GitHub:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin git@github.com:&lt;username&gt;/demo_app.git
<span class="gp">$</span> git push origin master
</pre></div>
</div>


<p>Теперь мы готовы начать делать само приложение. Типичный первый шаг, при разработке приложений это создание  <em>модели данных</em>, которая является изображением структур, необходимых нашему приложению. В нашем случае demo app будет упрощенным микроблогом: только пользователи и короткие (микро) сообщения. Таким образом, мы начнем с модели для <em>пользователей</em> приложения (<a class="ref" href="a-demo-app#sec:modeling_users">Раздел&nbsp;2.1.1</a>), и затем мы добавим модель для <em>микросообщений</em> (<a class="ref" href="a-demo-app#sec:modeling_microposts">Раздел&nbsp;2.1.2</a>).</p>

<div class="label" id="sec:modeling_users"></div>


<h3><a id="sec:2.1.1" href="a-demo-app#sec:modeling_users" class="heading"><span class="number">2.1.1</span> Моделирование пользователей</a></h3>


<p>Вариантов для модели данных пользователя, так же много, как много различных форм регистрации в сети; мы пойдем отчетливо минималистичным путем. У пользователей нашего demo app будет уникальный <code>целочисленный</code> идентификатор называемый <code>id</code>, публично видимое <code>имя </code> (тип - <code>string (строка)</code>), и <code>email</code> адрес  (также <code>string</code>) такой же как имя пользователя. Итоговая модель данных для пользователей представлена в <a class="ref" href="a-demo-app#fig:demo_user_model">Рис.&nbsp;2.2</a>.</p>

<div class="label" id="fig:demo_user_model"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_user_model.png" alt="demo_user_model" /></span></div><div class="caption"><span class="header">Рис. 2.2: </span><span class="description">Модель данных для пользователей.</span></div></div>


<p>AКак мы увидим в <a class="ref" href="modeling-and-viewing-users-one#sec:database_migrations">Разделе&nbsp;6.1.1</a>, табличка <code>users</code> в <a class="ref" href="a-demo-app#fig:demo_user_model">Рис.&nbsp;2.2</a> соответствует <em>таблице</em> в базе данных, и <code>id</code>, <code>name</code>, и <code>email</code> атрибуты это <em>столбцы</em> в этой таблице.</p>

<div class="label" id="sec:modeling_microposts"></div>


<h3><a id="sec:2.1.2" href="a-demo-app#sec:modeling_microposts" class="heading"><span class="number">2.1.2</span> Моделирование микросообщений</a></h3>


<p>Ядро модели данных микросообщений даже проще чем для пользователей: микросообщение имеет только <code>id</code> и поле <code>content</code> для текста микросообщения (тип- <code>string</code>).<sup class="footnote" id="fnref:2.3"><a href="#fn:2.3">3</a></sup> Есть дополнительная сложность: мы хотим <em>связать</em> каждое микросообщение с определенным пользователем; мы выполним это, записывая <code>user_id</code> владельца сообщения. Результаты показаны в  <a class="ref" href="a-demo-app#fig:demo_micropost_model">Рис.&nbsp;2.3</a>.</p>

<div class="label" id="fig:demo_micropost_model"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_micropost_model.png" alt="demo_micropost_model" /></span></div><div class="caption"><span class="header">Рис. 2.3: </span><span class="description">Модель данных для микросообщений.</span></div></div>


<p>Мы увидим в <a class="ref" href="a-demo-app#sec:demo_user_has_many_microposts">Разделе&nbsp;2.3.3</a> (и более полно в <a class="ref" href="user-microposts#top">Главе&nbsp;11</a>) как этот атрибут <code>user_id</code> позволяет нам кратко реализовать идею, что у пользователя потенциально есть много связанных микросообщений.</p>

<div class="label" id="sec:demo_users_resource"></div>


<h2><a id="sec:2.2" href="a-demo-app#sec:demo_users_resource" class="heading"><span class="number">2.2</span> Ресурс Users</a></h2>


<p>В этом разделе мы реализуем модель данных пользователей из <a class="ref" href="modeling_users#sec:modeling_users">Раздела&nbsp;2.1.1</a>, наряду с веб-интерфейсом к этой модели. Эта комбинация образует <em>ресурс Users</em>, который позволит нам думать о пользователях как об объектах, которые могут быть созданы, считаны, обновленны, и удаленны через сеть с использованием <a   href="http://ru.wikipedia.org/wiki/HTTP-протокол">HTTP протокола</a>.</p>

<p>Как обещалось во введении, наш ресурс Users будет создаваться программой scaffold generator, которая стандартно поставляется с каждым проектом Rails. Аргумент команды <code>scaffold</code> это имя ресурса в единственном числе (в данном случае, <code>User</code>), вместе с дополнительными параметрами для атрибутов модели данных:<sup class="footnote" id="fnref:2.4"><a href="#fn:2.4">4</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate scaffold User name:string email:string
<span class="go">      invoke  active_record</span>
<span class="go">      create    db/migrate/20100615004000_create_users.rb</span>
<span class="go">      create    app/models/user.rb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/unit/user_test.rb</span>
<span class="go">      create      test/fixtures/users.yml</span>
<span class="go">       route  resources :users</span>
<span class="go">      invoke  scaffold_controller</span>
<span class="go">      create    app/controllers/users_controller.rb</span>
<span class="go">      invoke    erb</span>
<span class="go">      create      app/views/users</span>
<span class="go">      create      app/views/users/index.html.erb</span>
<span class="go">      create      app/views/users/edit.html.erb</span>
<span class="go">      create      app/views/users/show.html.erb</span>
<span class="go">      create      app/views/users/new.html.erb</span>
<span class="go">      create      app/views/users/_form.html.erb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/functional/users_controller_test.rb</span>
<span class="go">      invoke    helper</span>
<span class="go">      create      app/helpers/users_helper.rb</span>
<span class="go">      invoke      test_unit</span>
<span class="go">      create        test/unit/helpers/users_helper_test.rb</span>
<span class="go">      invoke  stylesheets</span>
<span class="go">      create    public/stylesheets/scaffold.css</span>
</pre></div>
</div>


<p>Добавив <code>name:string</code> и <code>email:string</code>, мы добились того, что модель User приобрела форму из <a class="ref" href="a-demo-app#fig:demo_user_model">Рис.&nbsp;2.2</a>. (Отметьте, что нет надобности включать параметр для <code>id</code>; он создается Rails автоматически.<sup class="footnote" id="fnref:2.5"><a href="#fn:2.5">5</a></sup>)</p>

<p>Чтобы продолжить с демонстрационным приложением, мы сначала должны <em>migrate (мигрировать, переместить)</em> базу данных, используя <em>Rake</em> (<a class="ref" href="a-demo-app#sidebar:rake">Блок&nbsp;2.1</a>):</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rake db:migrate
<span class="go">==  CreateUsers: migrating ====================================================</span>
<span class="go">-- create_table(:users)</span>
<span class="go">   -&gt; 0.0017s</span>
<span class="go">==  CreateUsers: migrated (0.0018s) ===========================================</span>
</pre></div>
</div>


<p>Это просто обновляет базу данных с нашей новой моделью данных <code>users</code>. Мы узнаем больше о миграциях базы данных в <a class="ref" href="modeling-and-viewing-users-one#sec:database_migrations">Разделе&nbsp;6.1.1</a>.</p>

<p>Теперь мы можем запустить локальный веб-сервер, используя <code>rails s</code>, что является сокращением для <code>rails server</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails s
</pre></div>
</div>


<p>При этом демонстрационное приложение уже должно быть готово по адресу <a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a>.</p>

<div class="label" id="sidebar:rake"></div>


<div class="sidebar"><span class="title"><span class="header">Блок 2.1.</span><span class="description">Rake</span></span>
<p>В традиции Unix, <a  href="http://ru.wikipedia.org/wiki/Make"><em>make</em></a> утилита играет важную роль в сборке исполняемых программ из исходного кода; множество компьютерных хакеров зафиксировали в мышечной памяти строку</p>

<pre class="verbatim">  $ ./configure &amp;&amp; make &amp;&amp; sudo make install</pre>


<p>обычно используемую, чтобы скомпилировать код на Unix- системах (включая Linux и Mac OS&nbsp;X).</p>

<p>Rake это <em>Ruby make</em>, make -подобный язык написанный в Ruby. Rails использует Rake, в значительной степени, специально для неисчислимых небольших административных задач, необходимых при разработке поддерживаемых базой данных веб-приложений. <code>rake db:migrate</code> команда, вероятно, наиболее распространена, но есть и многие другие; можно увидеть список задач базы данных, используя <code>-T db</code>:</p>

<pre class="verbatim">  $ rake -T db</pre>


<p>Чтобы увидеть все доступные задачи Rake, запустите</p>

<pre class="verbatim">  $ rake -T</pre>


<p>Список, вероятно, будет подавляющим, но не волнуйтесь, Вы не должны знать все (или даже большую часть) этих команд. К концу  <em>Учебника Rails</em>, Вы будете знать все самые важные.</p>
</div>




<div class="label" id="sec:a_user_tour"></div>


<h3><a id="sec:2.2.1" href="a-demo-app#sec:a_user_tour" class="heading"><span class="number">2.2.1</span> Обзор пользователя</a></h3>


<p>При посещении корневого url&nbsp;<a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a> мы видим ту же самую дефолтную страницу Rails, что и в <a class="ref" href="beginning#fig:riding_rails_3">Рис.&nbsp;1.3</a>, но при генерировании ресурса Users scaffolding-ом мы также создали большое количество страниц для управления пользователями. Например, страницу для того, чтобы перечислить всех пользователей в  <a href="http://localhost:3000/users">/users</a>, и страницу для того, чтобы сделать нового пользователя в  <a href="http://localhost:3000/">/users/new</a>.<sup class="footnote" id="fnref:2.6"><a href="#fn:2.6">6</a></sup> Остальная часть этого Раздела, выделяется предпринятию ураганного тура через эти страницы пользователя (user). Поскольку мы продолжаем, полезно обратиться к <a class="ref" href="a-demo-app#table:user_urls">Table&nbsp;2.1</a>, которая показывает соответствие между страницами и URL.</p>

<div class="label" id="table:user_urls"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Action</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><a href="http://localhost:3000/users"><tt>/users</tt></a></td><td class="align_left"><code>index</code></td><td class="align_left">страница, чтобы перечислить всех пользователей</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/1"><tt>/users/1</tt></a></td><td class="align_left"><code>show</code></td><td class="align_left">страница, чтобы показать пользователя с id <code>1</code></td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/new"><tt>/users/new</tt></a></td><td class="align_left"><code>new</code></td><td class="align_left">страница для создания нового пользователя</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/1/edit"><tt>/users/1/edit</tt></a></td><td class="align_left"><code>edit</code></td><td class="align_left">страница, для редактирования пользователя с id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Таблица 2.1: </span><span class="description">Cоответствие между страницами и URL для ресурса Users.</span></div></div>


<p>Мы начинаем со страницы показывающей всех пользователей в нашем приложении, названной <a href="http://localhost:3000/users"><tt>index</tt></a>; как Вы могли бы ожидать, первоначально никаких пользователей нет (<a class="ref" href="a-demo-app#fig:demo_blank_user_index_rails_3">Рис.&nbsp;2.4</a>).</p>

<div class="label" id="fig:demo_blank_user_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_blank_user_index_rails_3.png" alt="demo_blank_user_index_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.4: </span><span class="description">Начальная index страница для ресурса Users (<a href="http://localhost:3000/users"><tt>/users</tt></a>).&nbsp;<a href="/images/figures/demo_blank_user_index_rails_3-full.png">(полный размер)</a></span></div></div>


<p>Чтобы создать нового пользователя, мы посещаем <a href="http://localhost:3000/users/new"><tt>new</tt></a>страницу, как показано на <a class="ref" href="a-demo-app#fig:demo_new_user_rails_3">Рис.&nbsp;2.5</a>. (В <a class="ref" href="sign-up#top">Главе&nbsp;8</a>, это станет страницей регистрации пользователя.)</p>

<div class="label" id="fig:demo_new_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_new_user_rails_3.png" alt="demo_new_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.5: </span><span class="description">Страница new user (<a href="http://localhost:3000/users/new"><tt>/users/new</tt></a>).&nbsp;<a href="/images/figures/demo_new_user_rails_3-full.png">(полный размер)</a></span></div></div>


<p>Мы можем создать пользователя, введя значения имени и адреса электронной почты в текстовые поля и затем нажав кнопку Create. Результат - страница <a href="http://localhost:3000/users/1"><tt>показывающая</tt></a> пользователя, как видно на <a class="ref" href="a-demo-app#fig:demo_show_user_rails_3">Рис.&nbsp;2.6</a>. (Зеленое приглашающее сообщение выполняется, с использованием <em>флэш</em>, о котором мы узнаем в <a class="ref" href="sign-up#sec:the_flash">Разделе&nbsp;8.3.3</a>.) Отметим, что в URL <a href="http://localhost:3000/users/1"><tt>/users/1</tt></a>; как Вы могли бы подозревать, цифра&nbsp;<code>1</code> просто атрибут <code>id</code> пользователя из  <a class="ref" href="a-demo-app#fig:demo_user_model">Рис.&nbsp;2.2</a>. В <a class="ref" href="modeling-and-viewing-users-two#sec:better_user_views">Разделе&nbsp;7.3</a>, эта страница станет профилем пользователя.</p>

<div class="label" id="fig:demo_show_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_show_user_rails_3.png" alt="demo_show_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.6: </span><span class="description">Страница, показывающая пользователя (<a href="http://localhost:3000/users/1"><tt>/users/1</tt></a>).&nbsp;<a href="/images/figures/demo_show_user_rails_3-full.png">(полный размер)</a></span></div></div>


<p>Чтобы изменить информацию пользователя, мы посещаем страницу <a href="http://localhost:3000/users/1/edit"><tt>edit</tt></a>  (<a class="ref" href="a-demo-app#fig:demo_edit_user_rails_3">Рис.&nbsp;2.7</a>). Изменяя информацию о пользователе и нажимая кнопку Update, мы изменяем информацию о пользователя в демонстрационном приложении (<a class="ref" href="a-demo-app#fig:demo_update_user_rails_3">Рис.&nbsp;2.8</a>). (Как мы увидим в <a class="ref" href="modeling-and-viewing-users-one#top">Глава&nbsp;6</a>, эти данные пользователя хранятся в бэкэнде базы данных.) Мы добавим функции edit/update (редактировать/обновить) пользователя к примеру приложения в  <a class="ref" href="updating-showing-and-deleting-users#sec:updating_users">Разделе&nbsp;10.1</a>.</p>

<div class="label" id="fig:demo_edit_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_edit_user_rails_3.png" alt="demo_edit_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.7: </span><span class="description">Страница  редактирования пользователя (<a href="http://localhost:3000/users/1/edit"><tt>/users/1/edit</tt></a>).&nbsp;<a href="/images/figures/demo_edit_user_rails_3-full.png">(полный размер)</a></span></div></div>




<div class="label" id="fig:demo_update_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_update_user_rails_3.png" alt="demo_update_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.8: </span><span class="description">Пользователь с обновленной информацией.&nbsp;<a href="/images/figures/demo_update_user_rails_3-full.png">(полный размер)</a></span></div></div>


<p>Теперь мы создадим второго пользователя, повторно посетив <a href="http://localhost:3000/users/new"><tt>new</tt></a> страницу и предоставив второй набор информации о пользователе; получившаяся <a href="http://localhost:3000/users"><tt>index</tt></a> показана на <a class="ref" href="a-demo-app#fig:demo_user_index_two_rails_3">Рис.&nbsp;2.9</a>. <a class="ref" href="updating-showing-and-deleting-users#sec:showing_users">Раздел&nbsp;10.3</a> преобразует index пользователя в более отполированную страницу для демонстрации всех пользователей.</p>

<div class="label" id="fig:demo_user_index_two_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_user_index_two_rails_3.png" alt="demo_user_index_two_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.9: </span><span class="description">index страница пользователя (<a href="http://localhost:3000/users"><tt>/users</tt></a>) со вторым пользователем.&nbsp;<a href="/images/figures/demo_user_index_two_rails_3-full.png">(полный размер)</a></span></div></div>


<p>Показав, как создавать, отображать и редактировать пользователей, мы переходим наконец к их уничтожению (<a class="ref" href="a-demo-app#fig:demo_destroy_user_rails_3">Рис.&nbsp;2.10</a>). Следует проверить, что клик по ссылке <a class="ref" href="a-demo-app#fig:demo_destroy_user_rails_3">Рис.&nbsp;2.10</a> уничтожает второго пользователя, приводя к index странице с одним пользователем. (Если это не работает, убедитесь, что JavaScript включен в Вашем браузере; Rails использует JavaScript, чтобы выдать запрос, который должен уничтожить пользователя.) <a class="ref" href="updating-showing-and-deleting-users#sec:destroying_users">Раздел&nbsp;10.4</a> добавляет удаление пользователя к демонстрационному приложению, заботясь об ограничении его использования специальным классом административных пользователей.</p>

<div class="label" id="fig:demo_destroy_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_destroy_user_rails_3.png" alt="demo_destroy_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.10: </span><span class="description">Уничтожение пользователя.&nbsp;<a href="/images/figures/demo_destroy_user_rails_3-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec:mvc_in_action"></div>


<h3><a id="sec:2.2.2" href="a-demo-app#sec:mvc_in_action" class="heading"><span class="number">2.2.2</span> MVC в действии</a></h3>


<p>Теперь, когда мы завершили быстрый обзор ресурса Пользователи (Users), давайте исследуем одну его определенную часть в контексте Модель-Представление-Контроллер (MVC) частично представленной в <a class="ref" href="beginning#sec:mvc">Разделе&nbsp;1.2.6</a>. Наша стратегия будет состоять в том, чтобы описать результаты типичного хита браузера; посещение index страницы пользователя в <a href="http://localhost:3000/users">/users</a>&mdash;в терминах MVC (<a class="ref" href="a-demo-app#fig:mvc_detailed">Рис.&nbsp;2.11</a>).</p>

<div class="label" id="fig:mvc_detailed"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/mvc_detailed.png" alt="mvc_detailed" /></span></div><div class="caption"><span class="header">Рис. 2.11: </span><span class="description">Подробная схема MVC в Rails.&nbsp;<a href="/images/figures/mvc_detailed-full.png">(полный размер)</a></span></div></div>




<ol><li>Браузер выдает запрос на URL <tt>/users</tt>.</li>
<li>Rails направляет <tt>/users</tt> к <code>index</code> действию в контроллере Users (Пользователи)</li>
<li> <code>Index</code> действие просит, чтобы модель User получила всех пользователей (<code>User.all</code>).</li>
<li>Модель User получает по запросу всех пользователей из базы данных.</li>
<li>Модель User возвращает список пользователей в контроллер.</li>
<li>Контроллер получает пользователей в <code>@users</code> переменной, которую передает <code>index</code> представлению.</li>
<li>Представление использует Embedded (Встроенный) Ruby, чтобы визуализировать страницу как HTML.</li>
<li>Контроллер возвращает HTML в браузер. <sup class="footnote" id="fnref:2.7"><a href="#fn:2.7">7</a></sup></li>
</ol>


<p>Мы начинаем с запроса, выданного браузером &mdash;то есть, с результата ввода URL в строке поиска или щелчка по ссылке (Шаг&nbsp;1 в <a class="ref" href="a-demo-app#fig:mvc_detailed">Рис.&nbsp;2.11</a>). Этот запрос вызывает <em>Rails маршрутизатор</em> (Шаг&nbsp;2), который отправляет к  надлежащему, <em>действию контроллера</em>, основываясь на URL (и, как мы увидим в <a class="ref" href="static-pages#sidebar:get_etc">Блоке&nbsp;3.1</a>, на типе запроса). Код создающий перенаправление URL пользователя к действиям контроллера для ресурса Users представлен в <a class="ref" href="a-demo-app#code:rails_routes">Листинге&nbsp;2.2</a>;<sup class="footnote" id="fnref:2.8"><a href="#fn:2.8">8</a></sup> этот код  фактически устанавливает таблицу пар URL/Действие, которые мы видели в  <a class="ref" href="a-demo-app#table:user_urls">Таблице&nbsp;2.1</a>.</p>

<div class="label" id="code:rails_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.2.</span> <span class="description">Маршруты Rails, с правилом для ресурса Users. <br /> <code>config/routes.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="no">DemoApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Страницы из <a class="ref" href="a-demo-app#sec:a_user_tour">Раздела&nbsp;2.2.1</a> соответствуют <em>действиям</em> в <em>контроллере</em> Users, который является набором связанных действий; контроллер, сгенерированный scaffolding,  схематично показан в <a class="ref" href="a-demo-app#code:demo_users_controller">Листинге&nbsp;2.3</a>. Отметьте запись <code>class UsersController &lt; ApplicationController</code>; это  пример <em>класса</em> Ruby с <em>наследованием</em>. (Мы обсудим наследование кратко в <a class="ref" href="a-demo-app#sec:inheritance_hierarchies">Разделе&nbsp;2.3.4</a> и охватим обе темы более подробно в <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">Разделе&nbsp;4.4</a>.)</p>

<div class="label" id="code:demo_users_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.3.</span> <span class="description">Контроллер Users в схематичной форме. <br /> <code>app/controllers/users_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Вы могли заметить, что действий больше чем страниц; <code>index</code>, <code>show</code>, <code>new</code>, и <code>edit</code> действия, все соответствуют страницам из <a class="ref" href="a-demo-app#sec:a_user_tour">Раздела&nbsp;2.2.1</a>, но есть также дополнительные <code>create</code> (создать), <code>update</code> (обновить), и <code>destroy</code> (разрушить) действия. Эти действия обычно не визуализируют страницы (хотя иногда могут); вместо этого, их основная цель состоит в том, чтобы изменять информацию о пользователях в базе данных. Этот полный комплект действий контроллера, сведенный в  <a class="ref" href="a-demo-app#table:demo_RESTful_users">Таблицу&nbsp;2.2</a>, представляет реализацию архитектуры REST в Rails (<a class="ref" href="a-demo-app#sidebar:REST">Блок&nbsp;2.2</a>). Отметьте в <a class="ref" href="a-demo-app#table:demo_RESTful_users">Таблице&nbsp;2.2</a> что есть некоторое наложение в URL; например, и user <code>show</code> и <code>update</code> действиям соответствует URL <tt>/users/1</tt>. Различие между ними в <a  rel="nofollow" href="http://ru.wikipedia.org/wiki/HTTP#.D0.9C.D0.B5.D1.82.D0.BE.D0.B4.D1.8B">методе запроса HTTP</a> на который они отвечают. Мы узнаем больше о методах запроса HTTP в  <a class="ref" href="static-pages#sec:TDD">Разделе&nbsp;3.2.2</a>.</p>

<div class="label" id="table:demo_RESTful_users"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_left"><strong>HTTP запрос</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Действие</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users</tt></td><td class="align_left"><code>index</code></td><td class="align_left">страница, со списком всех пользователей</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users/1</tt></td><td class="align_left"><code>show</code></td><td class="align_left">страница, показывающая пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users/new</tt></td><td class="align_left"><code>new</code></td><td class="align_left">страница, чтобы сделать нового пользователя</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left"><tt>/users</tt></td><td class="align_left"><code>create</code></td><td class="align_left">создание нового пользователя</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users/1/edit</tt></td><td class="align_left"><code>edit</code></td><td class="align_left">страница для редактирования пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>PUT</tt></td><td class="align_left"><tt>/users/1</tt></td><td class="align_left"><code>update</code></td><td class="align_left">обновление пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left"><tt>/users/1</tt></td><td class="align_left"><code>destroy</code></td><td class="align_left">удаление пользователя с id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Таблица 2.2: </span><span class="description">RESTful маршруты, обеспеченные ресурсом Users в <a class="ref" href="a-demo-app#code:rails_routes">Листинге&nbsp;2.2</a>.</span></div></div>




<div class="label" id="sidebar:REST"></div>


<div class="sidebar"><span class="title"><span class="header">Блок 2.2.</span><span class="description">REST (REpresentational State Transfer, («передача состояния представления»))</span></span>
<p>Если Вы много читали о веб-разработке Ruby on Rails, Вы видели много ссылок на “REST”, который является акронимом для (REpresentational State Transfer, «передача состояния представления»). REST - архитектурный стиль для разработки распределенных, сетевых систем и приложений, таких как World Wide Web и веб-приложения. Хотя теория REST довольно абстрактна, в контексте приложений Rails, REST означает, что большинство компонентов приложения (таких как пользователи и микросообщения) моделируется как <em>ресурсы</em> , которые могут быть созданы (Сreated), прочитаны (Read), обновленны (Updated), и удалены (Deleted) - операции, которые соответствуют и <a   href="http://ru.wikipedia.org/wiki/CRUD">операциям CRUD, реляционных баз данных</a> и четырем фундаментальным <a   href="http://ru.wikipedia.org/wiki/HTTP#.D0.9C.D0.B5.D1.82.D0.BE.D0.B4.D1.8B">методам запроса HTTP</a>: <tt>POST</tt>, <tt>GET</tt>, <tt>PUT</tt>, и <tt>DELETE</tt>. (Мы узнаем больше о запросах HTTP в <a class="ref" href="static-pages#sec:TDD">Разделе&nbsp;3.2.2</a> особенно в <a class="ref" href="static-pages#sidebar:get_etc">Блоке&nbsp;3.1</a>.)</p>

<p>Как разработчику приложений Rails, RESTful  стиль разработки помогает Вам сделать выбор о том, какие контроллеры и действия написать: Вы просто структурируете приложение, используя ресурсы, которые создаются, читаются, обновляются, и удаляются. В случае пользователей и микросообщений, этот процесс является простым, так как они - натуральные ресурсы по определению. В <a class="ref" href="following-users#top">Главе&nbsp;12</a>, мы увидим пример, где принципы REST позволяют нам моделировать более тонкую проблему &ldquo;Слежения за сообщениями пользователей&rdquo; естественным и удобным способом.</p>
</div>


<p>Чтобы исследовать отношения между контроллером Users и моделью User, давайте сосредоточимся на упрощенной версии <code>index</code> действия, показанную в <a class="ref" href="a-demo-app#code:demo_index_action">Листинге&nbsp;2.4</a>.<sup class="footnote" id="fnref:2.9"><a href="#fn:2.9">9</a></sup></p>

<div class="label" id="code:demo_index_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.4.</span> <span class="description">Упрощенное user index  действие для демонстрационного приложения. <br /> <code>app/controllers/users_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@users</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>У этого <code>index</code> действия есть строка <code>@users = User.all</code> (Шаг&nbsp;3), которая просит, чтобы модель User получила список всех пользователей из базы данных (Шаг&nbsp;4), и затем помещает их в переменную  <code>@users</code> (произносится &ldquo;at-users&rdquo;) (Шаг&nbsp;5). Сама модель User  появляется в  <a class="ref" href="a-demo-app#code:demo_user_model">Листинге&nbsp;2.5</a>; хотя она довольно проста, к ней прилагается большое количество функций из-за наследования  (<a class="ref" href="a-demo-app#sec:inheritance_hierarchies">Раздел&nbsp;2.3.4</a> и <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">Раздел&nbsp;4.4</a>). В частности, за счет использования библиотеки Rails назваемой <em>Active Record</em>, код в  <a class="ref" href="a-demo-app#code:demo_user_model">Листинге&nbsp;2.5</a> заставляет <code>User.all</code> возвратить всех пользователей.</p>

<div class="label" id="code:demo_user_model"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.5.</span> <span class="description">Модель User для демонстрационного приложения. <br /> <code>app/models/user.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Как только <code>@users</code> переменная определена, контроллер вызывает <em>представление </em> (Шаг&nbsp;6), показанное в <a class="ref" href="a-demo-app#code:demo_index_view">Листинге&nbsp;2.6</a>. Переменные, которые начинаются со знака <code>@</code>, называемые <em>переменными экземпляра</em>, автоматически доступны в представлении; в данном случае, представление <code>index.html.erb</code> в  <a class="ref" href="a-demo-app#code:demo_index_view">Листинге&nbsp;2.6</a> перебирает the <code>@users</code> список <code>@users</code> и выводит строку HTML для каждого.<sup class="footnote" id="fnref:2.10"><a href="#fn:2.10">10</a></sup></p>

<div class="label" id="code:demo_index_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.6.</span> <span class="description">Представление для user index.<br /> <code>app/views/users/index.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Листинг users<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Email<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

<span class="cp">&lt;%</span> <span class="vi">@users</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Show&#39;</span><span class="p">,</span> <span class="n">user</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">edit_user_path</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Destroy&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="ss">:confirm</span> <span class="o">=&gt;</span> <span class="s1">&#39;Are you sure?&#39;</span><span class="p">,</span>
<span class="ss">:method</span> <span class="o">=&gt;</span> <span class="ss">:delete</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;New User&#39;</span><span class="p">,</span> <span class="n">new_user_path</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p>Представление преобразует свое содержание в HТML (Шаг&nbsp;7), который затем возвращается контроллером в браузер для отображения (Шаг&nbsp;8).</p>

<div class="label" id="sec:weaknesses_of_this_users_resource"></div>


<h3><a id="sec:2.2.3" href="a-demo-app#sec:weaknesses_of_this_users_resource" class="heading"><span class="number">2.2.3</span> Недостатки данного Users ресурса</a></h3>


<p>Несмотря на полезность для общего обзора Rails, scaffold-ный ресурс Users имеет много серьезных недостатков.</p>

<ul><li><strong>Нет валидации данных.</strong> Наша модель User  безропотно принимает такие данные как пустые имена и недопустимые адреса электронной почты.</li>
<li><strong>Нет аутентификации.</strong> У нас нет понятия регистрации, и нет способа воспрепятствовать тому, чтобы любой пользователь выполнил любую операцию.</li>
<li><strong>Нет тестов.</strong> Что, технически, не вполне верно &mdash; scaffolding включает рудиментарные тесты &mdash; но сгенерированные тесты уродливы и негибки, и они не тестируют на подтверждение правильности данных, аутентификацию, или какие нибудь другие пользовательские потребности.</li>
<li><strong>Нет макета.</strong> Нет сколь нибудь связанного стиля сайта или навигации.</li>
<li><strong>Нет реального понимания.</strong> Если Вы понимаете код scaffold, Вам, вероятно, не стОит читать эту книгу.</li></ul>




<div class="label" id="sec:microposts_resource"></div>


<h2><a id="sec:2.3" href="a-demo-app#sec:microposts_resource" class="heading"><span class="number">2.3</span> Ресурс Microposts</a></h2>


<p>Сгенерировав и исследовав ресурс Users, мы поворачиваемся теперь к связанному ресурсу Microposts. На протяжении этого раздела я рекомендую сравнивать элементы ресурса Microposts с аналогичными элементами User из  <a class="ref" href="a-demo-app#sec:demo_users_resource">Раздела&nbsp;2.2</a>; вы должны увидеть, что эти два ресурса во многом параллельны друг другу. RESTful структура приложений Rails лучше всего усваивается посредством наблюдения за подобными повторяющимися формами; действительно, наблюдение параллельной структуры Users и Microposts даже на этой ранней стадии является одной из причин написания этой главы. (Как мы увидим, написание приложения, более устойчивого, нежели игрушечный пример в этой главе, требует значительных усилий &mdash; мы не увидим ресурс Microposts до  <a class="ref" href="user-microposts#top">Главы&nbsp;11</a>&mdash; и я не хотел так надолго откладывать его первое появление.)</p>

<div class="label" id="sec:a_micropost_microtour"></div>


<h3><a id="sec:2.3.1" href="a-demo-app#sec:a_micropost_microtour" class="heading"><span class="number">2.3.1</span> Микрообзор микросообщений</a></h3>


<p>Как и с ресурсом Users, мы генерируем код scaffold для ресурса Microposts, используя <code>rails generate scaffold</code>, в этом случае реализуя модель данных из <a class="ref" href="a-demo-app#fig:demo_micropost_model">Рис.&nbsp;2.3</a>:<sup class="footnote" id="fnref:2.11"><a href="#fn:2.11">11</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate scaffold Micropost content:string user_id:integer
<span class="go">      invoke  active_record</span>
<span class="go">      create    db/migrate/20100615004429_create_microposts.rb</span>
<span class="go">      create    app/models/micropost.rb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/unit/micropost_test.rb</span>
<span class="go">      create      test/fixtures/microposts.yml</span>
<span class="go">       route  resources :microposts</span>
<span class="go">      invoke  scaffold_controller</span>
<span class="go">      create    app/controllers/microposts_controller.rb</span>
<span class="go">      invoke    erb</span>
<span class="go">      create      app/views/microposts</span>
<span class="go">      create      app/views/microposts/index.html.erb</span>
<span class="go">      create      app/views/microposts/edit.html.erb</span>
<span class="go">      create      app/views/microposts/show.html.erb</span>
<span class="go">      create      app/views/microposts/new.html.erb</span>
<span class="go">      create      app/views/microposts/_form.html.erb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/functional/microposts_controller_test.rb</span>
<span class="go">      invoke    helper</span>
<span class="go">      create      app/helpers/microposts_helper.rb</span>
<span class="go">      invoke      test_unit</span>
<span class="go">      create        test/unit/helpers/microposts_helper_test.rb</span>
<span class="go">      invoke  stylesheets</span>
<span class="go">   identical    public/stylesheets/scaffold.css</span>
</pre></div>
</div>


<p>Чтобы обновить нашу базу данных с новой моделью данных, мы должны запустить миграцию как в <a class="ref" href="a-demo-app#sec:demo_users_resource">Разделе&nbsp;2.2</a>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rake db:migrate
<span class="go">==  CreateMicroposts: migrating ===============================================</span>
<span class="go">-- create_table(:microposts)</span>
<span class="go">   -&gt; 0.0023s</span>
<span class="go">==  CreateMicroposts: migrated (0.0026s) ======================================</span>
</pre></div>
</div>


<p>Теперь мы имеем возможность создавать микропосты тем же образом, каким мы создавали пользователей в <a class="ref" href="a-demo-app#sec:a_user_tour">Разделе&nbsp;2.2.1</a>. Как Вы могли бы предположить, генератор scaffold обновил файл маршрутов Rails с правилом для ресурса Microposts, как видно в  <a class="ref" href="a-demo-app#code:demo_microposts_resource">Листинге&nbsp;2.7</a>.<sup class="footnote" id="fnref:2.12"><a href="#fn:2.12">12</a></sup> Как и с users, <code>resources :microposts</code> маршрутное правило направляет  URL микросообщений на действия в контроллере Microposts, как видно в  <a class="ref" href="a-demo-app#table:demo_RESTful_microposts">Таблице&nbsp;2.3</a>.</p>

<div class="label" id="code:demo_microposts_resource"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.7.</span> <span class="description">Маршруты Rails, с новым правилом для ресурсов Microposts.<br /> <code>config/routes.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="no">DemoApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:microposts</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="table:demo_RESTful_microposts"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_left"><strong>HTTP запрос</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Действие</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts</tt></td><td class="align_left"><code>index</code></td><td class="align_left">страница, перечисляющая все микросообщения</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts/1</tt></td><td class="align_left"><code>show</code></td><td class="align_left">страница, показывающая микросообщения с id <code>1</code></td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts/new</tt></td><td class="align_left"><code>new</code></td><td class="align_left">страница, чтобы сделать новые микросообщения</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left"><tt>/microposts</tt></td><td class="align_left"><code>create</code></td><td class="align_left">создание нового микросообщения</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts/1/edit</tt></td><td class="align_left"><code>edit</code></td><td class="align_left">страница редактирования микросообщения с id <code>1</code></td></tr><tr><td class="align_left"><tt>PUT</tt></td><td class="align_left"><tt>/microposts/1</tt></td><td class="align_left"><code>update</code></td><td class="align_left">обновление микросообщения с id <code>1</code></td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left"><tt>/microposts/1</tt></td><td class="align_left"><code>destroy</code></td><td class="align_left">удаление микросообщения с id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Таблица 2.3: </span><span class="description">RESTful маршруты, обеспеченные ресурсом Microposts в <a class="ref" href="a-demo-app#code:demo_microposts_resource">Листинге&nbsp;2.7</a>.</span></div></div>


<p>Сам Microposts контроллер в схематичной форме представлен в <a class="ref" href="a-demo-app#code:demo_microposts_controller">Листинге&nbsp;2.8</a>. Отметьте, что, кроме наличия <code>MicropostsController</code> вместо <code>UsersController</code>, <a class="ref" href="a-demo-app#code:demo_microposts_controller">Листинг&nbsp;2.8</a> <em>идентичен</em> коду в <a class="ref" href="a-demo-app#code:demo_users_controller">Листинге&nbsp;2.3</a>. Это отражение REST архитектуры, характерной для обоих ресурсов.</p>

<div class="label" id="code:demo_microposts_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.8.</span> <span class="description">Контроллер Microposts в схематичной форме. <br /> <code>app/controllers/microposts_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Чтобы сделать несколько актуальных микросообщений, мы вводим информацию в new страницу микросообщений, <a href="http://localhost:3000/microposts/new">/microposts/new</a>, как видно в <a class="ref" href="a-demo-app#fig:demo_new_micropost_rails_3">Рис.&nbsp;2.12</a>.</p>

<div class="label" id="fig:demo_new_micropost_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_new_micropost_rails_3.png" alt="demo_new_micropost_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.12: </span><span class="description">New страница микросообщений (<a href="http://localhost:3000/microposts/new">/microposts/new</a>).&nbsp;<a href="http://railstutorial.org/images/figures/demo_new_micropost-full.png">(полный размер)</a></span></div></div>


<p>Создайте микросообщения или два,  удостоверьтесь, чтобы по крайней мере у одного был <code>user_id</code>&nbsp;=&nbsp;<code>1</code> для сопоставления с id первого пользователя, созданного в <a class="ref" href="a-demo-app#sec:a_user_tour">Разделе&nbsp;2.2.1</a>. Результат должен быть похож на <a class="ref" href="a-demo-app#fig:demo_micropost_index_rails_3">Рис.&nbsp;2.13</a>.</p>

<div class="label" id="fig:demo_micropost_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_micropost_index_rails_3.png" alt="demo_micropost_index_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.13: </span><span class="description"> Микропост index страница  (<a href="http://localhost:3000/microposts">/microposts</a>).&nbsp;<a href="http://railstutorial.org/images/figures/demo_micropost_index_rails_3-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec:putting_the_micro_in_microposts"></div>


<h3><a id="sec:2.3.2" href="a-demo-app#sec:putting_the_micro_in_microposts" class="heading"><span class="number">2.3.2</span> Помещение <em>микро</em> в микросообщения</a></h3>


<p>Каждое <em>микро</em>сообщение, достойное своего имени, должно иметь некоторые средства предписания длины сообщения. Реализация этого ограничения в Rails легка с <em>проверками допустимости</em> (валидацией); чтобы принять микросообщения с, самое большее, 140 символами (а-ля Twitter), мы используем проверку допустимости (валидацию) <em>длины</em>. В этой точке следует открыть файл <code>app/models/micropost.rb</code> в Вашем текстовом редакторе или IDE и заполнить это содержанием <a class="ref" href="a-demo-app#code:demo_length_validation">Листинга&nbsp;2.9</a>. (Использование <em>валидации</em> из <a class="ref" href="a-demo-app#code:demo_length_validation">Листинга&nbsp;2.9</a> характерно для Rails&nbsp;3; если Вы ранее работали с Rails&nbsp;2.3, следует сравнить это с использованием <code>validates_length_of</code>.)</p>

<div class="label" id="code:demo_length_validation"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.9.</span> <span class="description">Ограничение микросообщений максимумом в 140 знаков посредством валидации длины.<br /> <code>app/models/micropost.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Код в <a class="ref" href="a-demo-app#code:demo_length_validation">Листинге&nbsp;2.9</a> может выглядеть, довольно таинственно &mdash; мы рассмотрим валидацию, более тщательно  в <a class="ref" href="modeling-and-viewing-users-one#sec:user_validations">Разделе&nbsp;6.2</a>&mdash;но его эффект, станет вполне очевиден, если мы перейдем в новую страницу микросообщений и введем больше чем 140 символов для контента сообщения. Как видно в <a class="ref" href="a-demo-app#fig:micropost_length_error_rails_3">Рис.&nbsp;2.14</a>, Rails renders <em>error messages</em> Rails выдает <em>сообщение об ошибке</em> указывающее, что контент микросообщения является слишком длинным. (Мы узнаем больше о сообщениях об ошибках в <a class="ref" href="sign-up#sec:signup_error_messages">Разделе&nbsp;8.2.3</a>.)</p>

<div class="label" id="fig:micropost_length_error_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/micropost_length_error_rails_3.png" alt="micropost_length_error_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.14: </span><span class="description">Сообщение об ошибке для неудачно созданного микросообщения.&nbsp;<a href="http://railstutorial.org/images/figures/micropost_length_error_rails_3-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec:demo_user_has_many_microposts"></div>


<h3><a id="sec:2.3.3" href="a-demo-app#sec:demo_user_has_many_microposts" class="heading"><span class="number">2.3.3</span> A user <code>has_many</code> microposts (Пользователь <code>имеет_много</code> микросообщений)</a></h3>


<p>Одна из наиболее мощных функций Rails &#8211; возможность формировать <em>связи</em> между различными моделями данных. В случае нашей модели User  у каждого пользователя потенциально есть много микросообщений. Мы можем выразить это в коде, обновив модели User и Micropost как в <a class="ref" href="a-demo-app#code:demo_user_has_many_microposts">Листинге&nbsp;2.10</a> и <a class="ref" href="a-demo-app#code:demo_micropost_belongs_to_user">Листинге&nbsp;2.11</a>.</p>

<div class="label" id="code:demo_user_has_many_microposts"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.10.</span> <span class="description">У пользователя есть много микросообщений (user has many microposts). <br /> <code>app/models/user.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:microposts</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_micropost_belongs_to_user"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.11.</span> <span class="description">Микросообщения принадлежат пользователю (micropost belongs to a user).<br /> <code>app/models/micropost.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>

  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Мы можем посмотреть результат этой ассоциации в <a class="ref" href="a-demo-app#fig:micropost_user_association">Рис.&nbsp;2.15</a>. Из-за <code>user_id</code> столбца в таблице <code>microposts</code> Rails (используя Active Record) может вывести микросообщения, связанные с каждым пользователем.</p>

<div class="label" id="fig:micropost_user_association"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/micropost_user_association.png" alt="micropost_user_association" /></span></div><div class="caption"><span class="header">Рис. 2.15: </span><span class="description">Связь между микросообщениями и пользователями.</span></div></div>


<p>В  <a class="ref" href="user-microposts#top">Главе&nbsp;11</a> и <a class="ref" href="following-users#top">Главе&nbsp;12</a>, мы будем использовать ассоциацию пользователей и микросообщений и чтобы вывести на экран все микросообщения пользователя и чтобы создать Twitter-подобную подачу микросообщений. Пока, мы можем исследовать применение связи микросообщения-пользователь с помощью <em>консоли</em>, которая является полезным инструментом для взаимодействия с приложениями Rails. Мы сначала вызовем консоль командой <code>rails console</code> в командной строке, а затем получим первого пользователя из базы данных, используя <code>User.first</code> (поместив результаты в переменную <code>first_user</code>):<sup class="footnote" id="fnref:2.13"><a href="#fn:2.13">13</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="n">first_user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span>
<span class="go">=&gt; #&lt;User id: 1, name: &quot;Michael Hartl&quot;, email: &quot;michael@example.org&quot;,</span>
<span class="go">created_at: &quot;2010-04-03 02:01:31&quot;, updated_at: &quot;2010-04-03 02:01:31&quot;&gt;</span>
<span class="gp">&gt;&gt; </span><span class="n">first_user</span><span class="o">.</span><span class="n">microposts</span>
<span class="go">=&gt; [#&lt;Micropost id: 1, content: &quot;First micropost!&quot;, user_id: 1, created_at:</span>
<span class="go">&quot;2010-04-03 02:37:37&quot;, updated_at: &quot;2010-04-03 02:37:37&quot;&gt;, #&lt;Micropost id: 2,</span>
<span class="go">content: &quot;Second micropost&quot;, user_id: 1, created_at: &quot;2010-04-03 02:38:54&quot;,</span>
<span class="go">updated_at: &quot;2010-04-03 02:38:54&quot;&gt;]</span>
<span class="gp">&gt;&gt; </span><span class="nb">exit</span>
</pre></div>
</div>


<p>(Я включил последнюю строку только чтобы продемонстрировать, как выйти из консоли, и на большинстве систем Вы можете Ctrl-d с этой же целью.) Здесь мы получили доступ к микросообщениям пользователя, используя код <code>first_user.microposts</code>: с этим кодом Active Record автоматически возвращает все микросообщения с <code>user_id</code> равным id <code>first_user</code> (в данном случае,&nbsp;<code>1</code>). Мы узнаем намного больше о средствах ассоциации (связи) в Active Record в  <a class="ref" href="user-microposts#top">Главе&nbsp;11</a> и <a class="ref" href="following-users#top">Главе&nbsp;12</a>.</p>

<div class="label" id="sec:inheritance_hierarchies"></div>


<h3><a id="sec:2.3.4" href="a-demo-app#sec:inheritance_hierarchies" class="heading"><span class="number">2.3.4</span> Иерархия наследования</a></h3>


<p>Мы заканчиваем наше обсуждение демонстрационного приложения  кратким описанием иерархии классов  контроллеров и моделей в Rails. Это обсуждение будет иметь много смысла, только если у Вас был некоторый опыт объектно-ориентированного программирования (ООП); если Вы не изучали ООП, не стесняйтесь пропустить этот раздел. В частности, если Вы незнакомы с <em>классами</em> (обсуждаемыми в  <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">Разделе&nbsp;4.4</a>), я предлагаю вернуться к этому разделу позже.</p>

<p>Мы начнем со структуры наследования для моделей. Сравнивая  <a class="ref" href="a-demo-app#code:demo_user_class">Листинг&nbsp;2.12</a> и <a class="ref" href="a-demo-app#code:demo_micropost_class">Листинг&nbsp;2.13</a>, мы видим, что и модель User и модель Micropost наследовались (через левую угловую скобку&nbsp;<code>&lt;</code>) от <code>ActiveRecord::Base</code>, которая является базовым классом для моделей, обеспеченных ActiveRecord; схема, резюмирующая это отношение, представлена в  <a class="ref" href="a-demo-app#fig:demo_model_inheritance">Рис.&nbsp;2.16</a>. Благодаря наследованию от <code>ActiveRecord::Base</code> наши объекты модели получают возможность связываться с базой данных, обрабатывать столбцы базы данных, как Ruby атрибуты, и так далее.</p>

<div class="label" id="code:demo_user_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.12.</span> <span class="description">Класс <code>User</code>, с наследованием.<br /> <code>app/models/user.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_micropost_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.13.</span> <span class="description">Класс <code>Micropost</code> с наследованием. <br /> <code>app/models/micropost.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="fig:demo_model_inheritance"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_model_inheritance.png" alt="demo_model_inheritance" /></span></div><div class="caption"><span class="header">Рис. 2.16: </span><span class="description">Иерархия наследования для моделей User и Micropost.</span></div></div>


<p>Структура наследования для контроллеров лишь немногим более сложная. Сравнивая <a class="ref" href="a-demo-app#code:demo_users_controller_class">Листинг&nbsp;2.14</a> и <a class="ref" href="a-demo-app#code:demo_microposts_controller_class">Листинг&nbsp;2.15</a>, мы видим, что и контроллер User и контроллер Micropost наследовались от Application controller. Исследуя  <a class="ref" href="a-demo-app#code:demo_application_controller_class">Листинг&nbsp;2.16</a>, мы видим, что сам <code>ApplicationController</code> наследует от <code>ActionController::Base</code>;  это базовый класс для контроллеров, обеспеченных Action Pack библиотекой Rails. Отношения между этими классами иллюстрируются в <a class="ref" href="a-demo-app#fig:demo_controller_inheritance">Рис.&nbsp;2.17</a>.</p>

<div class="label" id="code:demo_users_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.14.</span> <span class="description">Класс <code>UsersController</code>, с наследованием. <br /> <code>app/controllers/users_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_microposts_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.15.</span> <span class="description">Класс <code>MicropostsController</code>, с наследованием. <br /> <code>app/controllers/microposts_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_application_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.16.</span> <span class="description">Класс <code>ApplicationController</code>, с наследованием.<br /> <code>app/controllers/application_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="fig:demo_controller_inheritance"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_controller_inheritance.png" alt="demo_controller_inheritance" /></span></div><div class="caption"><span class="header">Рис. 2.17: </span><span class="description">Иерархия наследования для контроллеров Users и Microposts.</span></div></div>


<p>Как и с наследованием моделей, будучи, в конечном счете, наследниками  <code>ActionController::Base</code> и Users и Microposts контроллеры имеют большое количество функций, таких как возможность управлять объектами модели, фильтровать входящие запросы HTTP, и визуализировать представления как HTML. Так как все контроллеры Rails наследовались от <code>ApplicationController</code>, правила, определенные в ApplicationController автоматически, применяются к каждому действию в приложении. Например, в <a class="ref" href="sign-up#sec:filtering_parameter_logging">Разделе&nbsp;8.2.4</a> мы увидим, как определение правила в Application контроллере позволяет нам фильтровать пароли от всех файлов системного журнала Rails, таким образом избегая серьезного потенциального нарушения защиты.</p>

<div class="label" id="sec:deploying_the_demo_app"></div>


<h3><a id="sec:2.3.5" href="a-demo-app#sec:deploying_the_demo_app" class="heading"><span class="number">2.3.5</span> Развертывание demo app</a></h3>


<p>Закончив с ресурсом Microposts, теперь хорошее время, чтобы отправить репозитарий в GitHub:<sup class="footnote" id="fnref:2.14"><a href="#fn:2.14">14</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -a -m <span class="s2">&quot;Done with the demo app&quot;</span>
<span class="gp">$</span> git push
</pre></div>
</div>


<p>Можно также развернуть demo app в Heroku:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku create
<span class="gp">$</span> git push heroku master
<span class="gp">$</span> heroku rake db:migrate
</pre></div>
</div>


<p>(Если это не работает у Вас, см. примечание для <a class="ref" href="beginning#code:gemfile_sqlite_heroku">Листинга&nbsp;1.8</a> для возможного исправления ошибки.) Отметим здесь заключительную строку, которая управляет миграциями базы данных на сервере Heroku. Это обновляет базу данных в Heroku с необходимой моделью данных пользователь/микросообщение. Если Вы хотите также отправить <em>данные</em> можете сделать это используя <tt>taps</tt> gem и <code>db:push</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install taps
<span class="gp">$</span> heroku db:push
</pre></div>
</div>




<h2><a id="sec:2.4" href="a-demo-app#sec:2.4" class="heading"><span class="number">2.4</span> Заключение</a></h2>


<p>Мы подошли к концу 9 144 метрового (30,000-foot ) обзора Rails приложения. У demo app, разработанного в этой главе, есть несколько достоинств и масса недостатков. <br /></p>

<p><strong>Достоинства</strong></p>

<ul><li>Общее представление о Rails</li>
<li>Введение в MVC</li>
<li>Первый вкус архитектуры REST</li>
<li>Начальное моделирование данных</li>
<li>Живое, поддерживаемое базой данных веб-приложение в production<sup class="footnote" id="fnref:2.15"><a href="#fn:2.15">15</a></sup></li>
</ul>


<p><strong>Недостатки</strong></p>

<ul><li>Нет собственного макета или стиля</li>
<li>Нет статических страниц (таких как "Главная" или "О нас")</li>
<li>Нет паролей пользователя</li>
<li>Нет изображений пользователя</li>
<li>Нет регистрирации</li>
<li>Нет безопасности</li>
<li>Нет автоматической связи пользователь/микросообщение</li>
<li>Нет понятий &ldquo;following&rdquo; or &ldquo;followed&rdquo;</li>
<li>Нет канала (RSS) micropost</li>
<li>Нет разработки через тестирование</li>
<li><strong>Нет реального понимания</strong></li></ul>


<p>Остальная часть этого учебного руководства выделяется усилению достоинств и устранению недостатков.</p>

<div class="navigation">  <a class="prev_page" href="beginning#top">
    &laquo;&nbsp;<span class="number">Глава 1</span> От нуля к развертыванию
  </a>
  <a class="next_page" href="static-pages#top">
    <span class="number">Глава 3</span> В основном статичные страницы&nbsp;&raquo;
  </a>
</div><div class="footnotes">
<ol>
<li id="fn:2.1">Я советую Вам не слишком присматриваться к сгенерированному коду; на данном этапе, это только смутит Вас.&nbsp;<a class="arrow" href="#fnref:2.1">&uarr;</a></li>
<li id="fn:2.2">Вспомните, что команда <code>rails</code> генерирует дефолтный <code>.gitignore</code> файл, но в зависимости от Вашей системы можно найти, что увеличенный файл из <a class="ref" href="beginning#code:gitignore">Листинга&nbsp;1.5</a> более удобен.&nbsp;<a class="arrow" href="#fnref:2.2">&uarr;</a></li>
<li id="fn:2.3">Моделируя более длинные сообщения,  для нормального (немикро) блога, следует использовать тип <code>text</code> вместо <code>string</code>.&nbsp;<a class="arrow" href="#fnref:2.3">&uarr;</a></li>
<li id="fn:2.4">Имя scaffold следует за соглашением в соответствии с которым, <em>модели</em> имеют единственное число, в отличие от ресурсов и контроллеров, которые используются во множественном числе. Таким образом, у нас есть <em>User</em> вместо <em>Users</em>.&nbsp;<a class="arrow" href="#fnref:2.4">&uarr;</a></li>
<li id="fn:2.5">User id необходим как <em>первичный ключ</em> в базе данных.&nbsp;<a class="arrow" href="#fnref:2.5">&uarr;</a></li>
<li id="fn:2.6">Начиная отсюда <tt>http://localhost:3000</tt> часть адреса неявна всякий раз, когда мы разрабатываем локально, и я буду обычно опускать ее.&nbsp;<a class="arrow" href="#fnref:2.6">&uarr;</a></li>
<li id="fn:2.7">Некоторые признаки(references)(??) указывают, на то, что представление возвращает HTML непосредственно браузеру (через веб-сервер, такой как Apache или Nginx). Независимо от деталей реализации я предпочитаю думать о контроллере как о центральном концентраторе через который проходят информационные потоки всего приложения.&nbsp;<a class="arrow" href="#fnref:2.7">&uarr;</a></li>
<li id="fn:2.8">Странная запись <code>:users</code> является <em>символом</em>, о котором мы узнаем в  <a class="ref" href="rails-flavored-ruby#sec:hashes_and_symbols">Разделе&nbsp;4.3.3</a>.&nbsp;<a class="arrow" href="#fnref:2.8">&uarr;</a></li>
<li id="fn:2.9">Код scaffold является уродливым и запутывающим, поэтому я обрезал его.&nbsp;<a class="arrow" href="#fnref:2.9">&uarr;</a></li>
<li id="fn:2.10">Помните, Вы, как предполагается, не понимаете этот код сейчас. Он показан только в целях иллюстрации.&nbsp;<a class="arrow" href="#fnref:2.10">&uarr;</a></li>
<li id="fn:2.11">Как и с User scaffold, генератор scaffold для микросообщений следует сингулярному соглашению для моделей Rails; таким образом, мы имеем, <code>generate Micropost</code>, а не <code>generate MicropostS</code>.&nbsp;<a class="arrow" href="#fnref:2.11">&uarr;</a></li>
<li id="fn:2.12">У кода scaffold могут быть дополнительные новые строки по сравнению с <a class="ref" href="a-demo-app#code:demo_microposts_resource">Листингом&nbsp;2.7</a>; это не повод для беспокойства, поскольку Ruby игнорирует дополнительные новые строки.&nbsp;<a class="arrow" href="#fnref:2.12">&uarr;</a></li>
<li id="fn:2.13">Ваше консольное приглашение, вероятно, будет чем-то вроде <code>ruby-1.9.2-head &gt;</code>, но я буду использовать <code>&gt;&gt;</code> чтобы приглашение не было связано с определенной версией Ruby.&nbsp;<a class="arrow" href="#fnref:2.13">&uarr;</a></li>
<li id="fn:2.14">Обычно, следует сделать меньшие, более частые фиксации, но для целей этой главы единственная большая фиксация в конце это нормально.&nbsp;<a class="arrow" href="#fnref:2.14">&uarr;</a></li>
<li id="fn:2.15">Если Вы развертывали в Heroku в <a class="ref" href="a-demo-app#sec:deploying_the_demo_app">Разделе&nbsp;2.3.5</a>.&nbsp;<a class="arrow" href="#fnref:2.15">&uarr;</a></li>
</ol>
</div>




