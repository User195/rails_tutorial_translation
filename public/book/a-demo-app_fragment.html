

<h1 class="title">Tutoriel Ruby on Rails </h1>


<h1 class="subtitle">  Apprendre Rails par l'exemple</h1>


<h2 class="author">Michael Hartl</h2>





<h1 class="contents">Contenu</h1>


<div id="table_of_contents"><ol>
<li class="chapter"><a href="beginning#top"><span class="number">Chapitre 1</span> De zéro au déploiement</a></li>
<li><ol>
<li class="section"><a href="beginning#sec:introduction"><span class="number">1.1</span> Introduction</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:comments_for_various_readers"><span class="number">1.1.1</span> Commentaires pour les lecteurs différents</a></li>
<li class="subsection"><a href="beginning#sec:1.1.2"><span class="number">1.1.2</span> &ldquo;Dimensionner&rdquo; Rails</a></li>
<li class="subsection"><a href="beginning#sec:conventions"><span class="number">1.1.3</span> Conventions utilisées dans ce livre</a></li></ol></li>
<li class="section"><a href="beginning#sec:up_and_running"><span class="number">1.2</span> [(Up and running)(En route pour le démarrage)]</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:development_tools"><span class="number">1.2.1</span> Environnements de développement</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:1.2.1.1">IDEs</a></li>
<li class="subsubsection"><a href="beginning#sec:1.2.1.2">Éditeurs de texte et lignes de commande</a></li>
<li class="subsubsection"><a href="beginning#sec:1.2.1.3">Navigateurs</a></li>
<li class="subsubsection"><a href="beginning#sec:1.2.1.4">Note à propos des outils</a></li></ol></li>
<li class="subsection"><a href="beginning#sec:rubygems"><span class="number">1.2.2</span> Ruby, RubyGems, Rails, et Git</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:rails_installer_windows">Installation de Rails (Windows)</a></li>
<li class="subsubsection"><a href="beginning#sec:install_git">Installer Git</a></li>
<li class="subsubsection"><a href="beginning#sec:install_ruby">Installer Ruby</a></li>
<li class="subsubsection"><a href="beginning#sec:install_rubygems">Installer RubyGems</a></li>
<li class="subsubsection"><a href="beginning#sec:install_rails">Installer Rails</a></li></ol></li>
<li class="subsection"><a href="beginning#sec:the_first_application"><span class="number">1.2.3</span> La première application</a></li>
<li class="subsection"><a href="beginning#sec:bundler"><span class="number">1.2.4</span> Bundler</a></li>
<li class="subsection"><a href="beginning#sec:rails_server"><span class="number">1.2.5</span> <code>Le serveur rails (rails server)</code></a></li>
<li class="subsection"><a href="beginning#sec:mvc"><span class="number">1.2.6</span> Modèles-Vue-Contrôleur (MVC)</a></li></ol></li>
<li class="section"><a href="beginning#sec:version_control"><span class="number">1.3</span> Contrôle de versions avec Git</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:git_setup"><span class="number">1.3.1</span> Installation et réglages</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:1.3.1.1">Initialisation des réglages système</a></li>
<li class="subsubsection"><a href="beginning#sec:1.3.1.2">Initialisation des réglages du dépôt (repository)</a></li></ol></li>
<li class="subsection"><a href="beginning#sec:adding_and_committing"><span class="number">1.3.2</span> Ajout et mandat de dépôt</a></li>
<li class="subsection"><a href="beginning#sec:1.3.3"><span class="number">1.3.3</span> Qu'est-ce que Git peut faire de bien pour vous&nbsp;?</a></li>
<li class="subsection"><a href="beginning#sec:github"><span class="number">1.3.4</span> GitHub</a></li>
<li class="subsection"><a href="beginning#sec:git_commands"><span class="number">1.3.5</span> Branch, edit, commit, merge</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:git_branch">Branch</a></li>
<li class="subsubsection"><a href="beginning#sec:git_edit">Edit</a></li>
<li class="subsubsection"><a href="beginning#sec:git_commit">Commit</a></li>
<li class="subsubsection"><a href="beginning#sec:git_merge">Merge</a></li>
<li class="subsubsection"><a href="beginning#sec:git_push">Push</a></li></ol></li></ol></li>
<li class="section"><a href="beginning#sec:deploying"><span class="number">1.4</span> Déploiement</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:1.4.1"><span class="number">1.4.1</span> Réglages Heroku</a></li>
<li class="subsection"><a href="beginning#sec:heroku_step_one"><span class="number">1.4.2</span> déploiement Heroku, première étape</a></li>
<li class="subsection"><a href="beginning#sec:1.4.3"><span class="number">1.4.3</span> Déploiement Heroku deployment, seconde étape</a></li>
<li class="subsection"><a href="beginning#sec:heroku_commands"><span class="number">1.4.4</span> Commandes Heroku</a></li></ol></li>
<li class="section"><a href="beginning#sec:beginning_conclusion"><span class="number">1.5</span> Conclusion</a></li></ol></li>
<li class="chapter"><a href="a-demo-app#top"><span class="number">Chapitre 2</span> Une application démo</a></li>
<li><ol>
<li class="section"><a href="a-demo-app#sec:planning_the_application"><span class="number">2.1</span> Planifier l'application</a></li>
<li><ol>
<li class="subsection"><a href="a-demo-app#sec:modeling_users"><span class="number">2.1.1</span> Modéliser les utilisateurs</a></li>
<li class="subsection"><a href="a-demo-app#sec:modeling_microposts"><span class="number">2.1.2</span> Modéliser les micro-messages</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec:demo_users_resource"><span class="number">2.2</span> La ressource Utilisateurs (Users)</a></li>
<li><ol>
<li class="subsection"><a href="a-demo-app#sec:a_user_tour"><span class="number">2.2.1</span> Un tour de l'utilisateur</a></li>
<li class="subsection"><a href="a-demo-app#sec:mvc_in_action"><span class="number">2.2.2</span> MVC en action</a></li>
<li class="subsection"><a href="a-demo-app#sec:weaknesses_of_this_users_resource"><span class="number">2.2.3</span> Faiblesses de la ressource Utilisateurs (Users)</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec:microposts_resource"><span class="number">2.3</span> La ressource Micro-messages (Microposts)</a></li>
<li><ol>
<li class="subsection"><a href="a-demo-app#sec:a_micropost_microtour"><span class="number">2.3.1</span> Un petit tour du micro-message</a></li>
<li class="subsection"><a href="a-demo-app#sec:putting_the_micro_in_microposts"><span class="number">2.3.2</span> Appliquer le <em>micro</em> aux micro-messages</a></li>
<li class="subsection"><a href="a-demo-app#sec:demo_user_has_many_microposts"><span class="number">2.3.3</span> Un utilisateur <code>has_many</code> (<code>possède plusieurs</code>) micro-messages</a></li>
<li class="subsection"><a href="a-demo-app#sec:inheritance_hierarchies"><span class="number">2.3.4</span> Hiérarchie des héritages</a></li>
<li class="subsection"><a href="a-demo-app#sec:deploying_the_demo_app"><span class="number">2.3.5</span> Déployer l'application Démo</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec:2.4"><span class="number">2.4</span> Conclusion</a></li></ol></li>
<li class="chapter"><a href="static-pages#top"><span class="number">Chapitre 3</span> Pages statiques courantes</a></li>
<li><ol>
<li class="section"><a href="static-pages#sec:static_pages"><span class="number">3.1</span> Pages statiques</a></li>
<li><ol>
<li class="subsection"><a href="static-pages#sec:truly_static_pages"><span class="number">3.1.1</span> Pages HTML statiques</a></li>
<li class="subsection"><a href="static-pages#sec:static_pages_with_rails"><span class="number">3.1.2</span> Les pages statiques avec Rails</a></li></ol></li>
<li class="section"><a href="static-pages#sec:first_tests"><span class="number">3.2</span> Premiers tests</a></li>
<li><ol>
<li class="subsection"><a href="static-pages#sec:testing_tools"><span class="number">3.2.1</span> Outils de test</a></li>
<li><ol>
<li class="subsubsection"><a href="static-pages#sec:autotest">Auto-test</a></li></ol></li>
<li class="subsection"><a href="static-pages#sec:TDD"><span class="number">3.2.2</span> TDD : Rouge, Vert, Refactor</a></li>
<li><ol>
<li class="subsubsection"><a href="static-pages#sec:spork">Spork</a></li>
<li class="subsubsection"><a href="static-pages#sec:red">Rouge</a></li>
<li class="subsubsection"><a href="static-pages#sec:green">Vert</a></li>
<li class="subsubsection"><a href="static-pages#sec:refactor">Refactor</a></li></ol></li></ol></li>
<li class="section"><a href="static-pages#sec:slightly_dynamic_pages"><span class="number">3.3</span> Pages (un peu) dynamiques</a></li>
<li><ol>
<li class="subsection"><a href="static-pages#sec:testing_a_title_change"><span class="number">3.3.1</span> Test d'un changement de titre</a></li>
<li class="subsection"><a href="static-pages#sec:passing_title_tests"><span class="number">3.3.2</span> Réussir les tests de titre</a></li>
<li class="subsection"><a href="static-pages#sec:instance_variables_embedded_ruby"><span class="number">3.3.3</span> Variables d'instance et Ruby embarqué</a></li>
<li class="subsection"><a href="static-pages#sec:layouts"><span class="number">3.3.4</span> Supprimer les répétitions avec les [(layouts)]</a></li></ol></li>
<li class="section"><a href="static-pages#sec:static_pages_conclusion"><span class="number">3.4</span> Conclusion</a></li>
<li class="section"><a href="static-pages#sec:static_pages_Exercices"><span class="number">3.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="rails-flavored-ruby#top"><span class="number">Chapitre 4</span> [(Rails-flavored Ruby)(Rails au goût Ruby)]</a></li>
<li><ol>
<li class="section"><a href="rails-flavored-ruby#sec:motivation"><span class="number">4.1</span> Motivation</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:title_helper"><span class="number">4.1.1</span> Un « helper » (« aideur ») pour le titre (<code>title</code>)</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:cascading_style_sheets"><span class="number">4.1.2</span> Feuilles de styles (CSS — Cascading Style Sheets)</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:strings_and_methods"><span class="number">4.2</span> Chaines de caractères et méthodes</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:comments"><span class="number">4.2.1</span> Commentaires</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:strings"><span class="number">4.2.2</span> Chaines de caractères</a></li>
<li><ol>
<li class="subsubsection"><a href="rails-flavored-ruby#sec:printing">Impression</a></li>
<li class="subsubsection"><a href="rails-flavored-ruby#sec:single_quoted_strings">Chaines de caractères « single-quoté »</a></li></ol></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:objects_and_message_passing"><span class="number">4.2.3</span> Objets et passage de message</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:method_definitions"><span class="number">4.2.4</span> Définition de méthode</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:back_to_the_title_helper"><span class="number">4.2.5</span> Retour à l'« helper » de titre</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:other_data_structures"><span class="number">4.3</span> Autres structures de données</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:arrays_and_ranges"><span class="number">4.3.1</span> Tableaux et rangs</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:blocks"><span class="number">4.3.2</span> Blocs</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:hashes_and_symbols"><span class="number">4.3.3</span> Tables de hachage et symboles</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:css_revisited"><span class="number">4.3.4</span> CSS revisitées</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:ruby_classes"><span class="number">4.4</span> Classes Ruby</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:constructors"><span class="number">4.4.1</span> Constructeurs</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:a_class_of_our_own"><span class="number">4.4.2</span> Héritages de classes</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:modifying_built_in_classes"><span class="number">4.4.3</span> Modifier les classes d'origine</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:a_controller_class"><span class="number">4.4.4</span> Classe de contrôleur</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:a_user_class"><span class="number">4.4.5</span> Classe utiliateur</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:Exercices"><span class="number">4.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="filling-in-the-layout#top"><span class="number">Chapitre 5</span> Achever la mise en page</a></li>
<li><ol>
<li class="section"><a href="filling-in-the-layout#sec:structure"><span class="number">5.1</span> Ajout de structure</a></li>
<li><ol>
<li class="subsection"><a href="filling-in-the-layout#sec:adding_to_the_layout"><span class="number">5.1.1</span> Navigation du site</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:custom_css"><span class="number">5.1.2</span> Personnalisation CSS</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:partials"><span class="number">5.1.3</span> Partiels (Partials)</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec:layout_links"><span class="number">5.2</span> Liens pour la mise en page</a></li>
<li><ol>
<li class="subsection"><a href="filling-in-the-layout#sec:integration_tests"><span class="number">5.2.1</span> Test d'intégration</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:rails_routes"><span class="number">5.2.2</span> Routes Rails</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:named_routes"><span class="number">5.2.3</span> Nommer les routes</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec:user_signup"><span class="number">5.3</span> Inscription de l'utilisateur : une première étape</a></li>
<li><ol>
<li class="subsection"><a href="filling-in-the-layout#sec:users_controller"><span class="number">5.3.1</span> Contrôleur Utilisateur (Users controller)</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:signup_url"><span class="number">5.3.2</span> URL d'inscription</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec:layout_conclusion"><span class="number">5.4</span> Conclusion</a></li>
<li class="section"><a href="filling-in-the-layout#sec:layout_Exercices"><span class="number">5.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="modeling-and-viewing-users-one#top"><span class="number">Chapitre 6</span> Modéliser et afficher les utilisateurs, partie I</a></li>
<li><ol>
<li class="section"><a href="modeling-and-viewing-users-one#sec:user_model"><span class="number">6.1</span> Modèle utilisateur (User model)</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:database_migrations"><span class="number">6.1.1</span> Migrations de la base de données</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:the_model_file"><span class="number">6.1.2</span> Le fichier modèle</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:model_annotation">[(Model annotation)]</a></li>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:accessible_attributes">Attributs accessibles</a></li></ol></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:creating_user_objects"><span class="number">6.1.3</span> Créer des objets Utilisateur</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:finding_user_objects"><span class="number">6.1.4</span> Recherche dans les objets Utilisateurs (Users)</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:updating_user_objects"><span class="number">6.1.5</span> Actualisation des objets Utilisateurs (Users)</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:user_validations"><span class="number">6.2</span> Validations utilisateur</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:presence_validation"><span class="number">6.2.1</span> Valider l'existence</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:length_validation"><span class="number">6.2.2</span> Valider la longueur</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:format_validation"><span class="number">6.2.3</span> Valider le format</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:uniqueness_validation"><span class="number">6.2.4</span> Valider l'unicité</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:the_caveat">L'avertissement d'unicité</a></li></ol></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:viewing_users"><span class="number">6.3</span> Afficher les utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:rails_environments"><span class="number">6.3.1</span> Débuggage et environnements Rails</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:users_show"><span class="number">6.3.2</span> Modèle, Vue et Contrôleur Utilisateur</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:a_users_resource"><span class="number">6.3.3</span> Ressource Utilisateurs</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:params_in_debug">[(<code>params</code> in <code>debug</code>)]</a></li></ol></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:6.4"><span class="number">6.4</span> Conclusion</a></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:6.5"><span class="number">6.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="modeling-and-viewing-users-two#top"><span class="number">Chapitre 7</span> Modéliser et afficher les utilisateurs, partie II</a></li>
<li><ol>
<li class="section"><a href="modeling-and-viewing-users-two#sec:insecure_passwords"><span class="number">7.1</span> Mots de passe non sûrs</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_validations"><span class="number">7.1.1</span> Valider le mot de passe</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_migration"><span class="number">7.1.2</span> Migrer un mot de passe</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_active_record_callback"><span class="number">7.1.3</span> Un <em>callback</em> de l'Active Record</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:secure_passwords"><span class="number">7.2</span> Sécuriser les mots de passe</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_secure_password_test"><span class="number">7.2.1</span> Test de mot de passe sûr</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:secure_password_theory"><span class="number">7.2.2</span> Un peu de théorie sur les mots de passe sécurisés</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:implementing_has_password"><span class="number">7.2.3</span> Implémenter la méthode <code>has_password?</code></a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_authenticate_method"><span class="number">7.2.4</span> Méthode d'authentification</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:better_user_views"><span class="number">7.3</span> Meilleures vues d'utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:tests_with_factories"><span class="number">7.3.1</span> Tester la page de l'utilisateur (avec factories)</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_name_and_a_gravatar"><span class="number">7.3.2</span> Un nom et un Gravatar</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-two#sec:a_gravatar_helper">Un « helper » de Gravatar</a></li></ol></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_user_sidebar"><span class="number">7.3.3</span> Une barre utilisateur latérale</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:7.4"><span class="number">7.4</span> Conclusion</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:7.4.1"><span class="number">7.4.1</span> Commit Git</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:heroku_deploy"><span class="number">7.4.2</span> Déploiement Heroku</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:more_modeling_users_Exercices"><span class="number">7.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="sign-up#top"><span class="number">Chapitre 8</span> Inscription</a></li>
<li><ol>
<li class="section"><a href="sign-up#sec:signup_form"><span class="number">8.1</span> Formulaire d'inscription</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:using_form_for"><span class="number">8.1.1</span> Utiliser  <code>form_for</code></a></li>
<li class="subsection"><a href="sign-up#sec:the_form_html"><span class="number">8.1.2</span> Le formulaire HTML</a></li></ol></li>
<li class="section"><a href="sign-up#sec:signup_failure"><span class="number">8.2</span> Échec de l'inscription</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:testing_failure"><span class="number">8.2.1</span> Test de l'échec</a></li>
<li class="subsection"><a href="sign-up#sec:a_working_form"><span class="number">8.2.2</span> Un formulaire fonctionnel</a></li>
<li class="subsection"><a href="sign-up#sec:signup_error_messages"><span class="number">8.2.3</span> Inscription&nbsp;: messages d'erreur</a></li>
<li class="subsection"><a href="sign-up#sec:filtering_parameter_logging"><span class="number">8.2.4</span> Filtrage des paramètres d'identification</a></li></ol></li>
<li class="section"><a href="sign-up#sec:signup_success"><span class="number">8.3</span> Succès de l'inscription</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:testing_success"><span class="number">8.3.1</span> Tester le succès de l'inscription</a></li>
<li class="subsection"><a href="sign-up#sec:the_finished_signup_form"><span class="number">8.3.2</span> Le formulaire d'inscription finalisé</a></li>
<li class="subsection"><a href="sign-up#sec:the_flash"><span class="number">8.3.3</span> Le message «&nbsp;flash&nbsp;»</a</a></li>
<li class="subsection"><a href="sign-up#sec:the_first_signup"><span class="number">8.3.4</span> La première inscription</a></li></ol></li>
<li class="section"><a href="sign-up#sec:rspec_integration_tests"><span class="number">8.4</span> Test d'intégration RSpec</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:integration_tests_with_style"><span class="number">8.4.1</span> Tests d'intégration avec les styles</a></li>
<li class="subsection"><a href="sign-up#sec:failed_signup"><span class="number">8.4.2</span> Un échec d'inscription ne devrait pas créer un nouvel utilisateur</a></li>
<li class="subsection"><a href="sign-up#sec:successful_signup"><span class="number">8.4.3</span> Le succès d'une inscription devrait créer un nouvel utilisateur</a></li></ol></li>
<li class="section"><a href="sign-up#sec:8.5"><span class="number">8.5</span> Conclusion</a></li>
<li class="section"><a href="sign-up#sec:signup_Exercices"><span class="number">8.6</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="sign-in-sign-out#top"><span class="number">Chapitre 9</span> Connexion, déconnexion</a></li>
<li><ol>
<li class="section"><a href="sign-in-sign-out#sec:sessions"><span class="number">9.1</span> Les sessions</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:sessions_controller"><span class="number">9.1.1</span> Le contrôleur de session</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:signin_form"><span class="number">9.1.2</span> Formulaire d'identification</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:signin_failure"><span class="number">9.2</span> Échec de l'identification</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:reviewing_form_submission"><span class="number">9.2.1</span> Examen de la soumission du formulaire</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:failed_signin"><span class="number">9.2.2</span> Échec de l'identification (test et code)</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:signin_success"><span class="number">9.3</span> Succès de l'identification</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:the_completed_create_action"><span class="number">9.3.1</span> L'action <code>create</code> («&nbsp;créer&nbsp;») finalisée</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:remember_me"><span class="number">9.3.2</span> Se souvenir de moi</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:current_user"><span class="number">9.3.3</span> Utilisateur courant</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:signing_out"><span class="number">9.4</span> Déconnexion</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:destroying_sessions"><span class="number">9.4.1</span> Détruire la session</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:signin_upon_signup"><span class="number">9.4.2</span> Connection à l'inscription</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:changing_the_layout_links"><span class="number">9.4.3</span> Changement des liens de la mise en plage</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:signin_out_integration_tests"><span class="number">9.4.4</span> Test d'intégration de l'identification/déconnexion</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:9.5"><span class="number">9.5</span> Conclusion</a></li>
<li class="section"><a href="sign-in-sign-out#sec:sign_in_out_Exercices"><span class="number">9.6</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="updating-showing-and-deleting-users#top"><span class="number">Chapitre 10</span> Actualiser, afficher et supprimer de l'utilisateur</a></li>
<li><ol>
<li class="section"><a href="updating-showing-and-deleting-users#sec:updating_users"><span class="number">10.1</span> Actualiser l'utilisateur</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:edit_form"><span class="number">10.1.1</span> Formulaire de modification</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:enabling_edits"><span class="number">10.1.2</span> Permettre les modifications</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:protecting_pages"><span class="number">10.2</span> Protéger les pages</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_signed_in_users"><span class="number">10.2.1</span> Utilisateurs identifiés requis</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_the_right_user"><span class="number">10.2.2</span> Nécessité du bon utilisateur</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:friendly_forwarding"><span class="number">10.2.3</span> Redirection conviviale</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:showing_users"><span class="number">10.3</span> Afficher les utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:user_index"><span class="number">10.3.1</span> Liste des utilisateurs</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:sample_users"><span class="number">10.3.2</span> Exemples d'utilisateurs</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:pagination"><span class="number">10.3.3</span> Pagination</a></li>
<li><ol>
<li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:testing_pagination">Test de la pagination</a></li></ol></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:partial_refactoring"><span class="number">10.3.4</span> Restructuration des partielles</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:destroying_users"><span class="number">10.4</span> Supprimer des utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:administrative_users"><span class="number">10.4.1</span> Utilisateurs administrateurs</a></li>
<li><ol>
<li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:revisiting_attr_accessible">Révision de <code>attr_accessible</code></a></li></ol></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:the_destroy_action"><span class="number">10.4.2</span> L'action <code>destroy</code> («&nbsp;supprimer&nbsp;»)</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:10.5"><span class="number">10.5</span> Conclusion</a></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:updating_deleting_Exercices"><span class="number">10.6</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="user-microposts#top"><span class="number">Chapitre 11</span> Micro-messages d'utilisateur</a></li>
<li><ol>
<li class="section"><a href="user-microposts#sec:a_micropost_model"><span class="number">11.1</span> Le modèle Micropost («&nbsp;Micro-message&nbsp;»)</a></li>
<li><ol>
<li class="subsection"><a href="user-microposts#sec:the_basic_model"><span class="number">11.1.1</span> Le modèle initial</a></li>
<li><ol>
<li class="subsubsection"><a href="user-microposts#sec:accessible_attribute">Attributs accessibles</a></li></ol></li>
<li class="subsection"><a href="user-microposts#sec:user_micropost_associations"><span class="number">11.1.2</span> Associations Utilisateur/micro-messages</a></li>
<li class="subsection"><a href="user-microposts#sec:ordering_and_dependency"><span class="number">11.1.3</span> Affinements du micro-message</a></li>
<li><ol>
<li class="subsubsection"><a href="user-microposts#sec:default_scope">Portée par défaut</a></li>
<li class="subsubsection"><a href="user-microposts#sec:dependent_destroy">Dependent: destroy (dépendances de la suppression)</a></li></ol></li>
<li class="subsection"><a href="user-microposts#sec:micropost_validations"><span class="number">11.1.4</span> Validations du micro-message</a></li></ol></li>
<li class="section"><a href="user-microposts#sec:showing_microposts"><span class="number">11.2</span> Afficher les micro-messages</a></li>
<li><ol>
<li class="subsection"><a href="user-microposts#sec:augmenting_the_user_show_page"><span class="number">11.2.1</span> Etoffement de la page de l'utilisateur</a></li>
<li class="subsection"><a href="user-microposts#sec:sample_microposts"><span class="number">11.2.2</span> Exemples de micro-messages</a></li></ol></li>
<li class="section"><a href="user-microposts#sec:manipulating_microposts"><span class="number">11.3</span> Manipuler les micro-messages</a></li>
<li><ol>
<li class="subsection"><a href="user-microposts#sec:access_control"><span class="number">11.3.1</span> Contrôle de l'accès</a></li>
<li class="subsection"><a href="user-microposts#sec:creating_microposts"><span class="number">11.3.2</span> Créer des micro-messages</a></li>
<li class="subsection"><a href="user-microposts#sec:a_proto_feed"><span class="number">11.3.3</span> Une proto-alimentation</a></li>
<li class="subsection"><a href="user-microposts#sec:destroying_microposts"><span class="number">11.3.4</span> Supprimer des micro-messages</a></li>
<li class="subsection"><a href="user-microposts#sec:testing_the_new_home_page"><span class="number">11.3.5</span> Test de la nouvelle page d'accueil</a></li></ol></li>
<li class="section"><a href="user-microposts#sec:11.4"><span class="number">11.4</span> Conclusion</a></li>
<li class="section"><a href="user-microposts#sec:micropost_Exercices"><span class="number">11.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="following-users#top"><span class="number">Chapitre 12</span> Suivi des utilisateurs</a></li>
<li><ol>
<li class="section"><a href="following-users#sec:the_relationship_model"><span class="number">12.1</span> Le modèle Relation (Relationship model)</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:a_problem_with_the_data_model"><span class="number">12.1.1</span> Un problème du modèle de données (et sa solution)</a></li>
<li class="subsection"><a href="following-users#sec:relationship_user_associations"><span class="number">12.1.2</span> Associations Utilisateur/Relations</a></li>
<li class="subsection"><a href="following-users#sec:relationship_validations"><span class="number">12.1.3</span> Validations</a></li>
<li class="subsection"><a href="following-users#sec:following"><span class="number">12.1.4</span> Auteurs suivis</a></li>
<li class="subsection"><a href="following-users#sec:followers"><span class="number">12.1.5</span> Lecteurs</a></li></ol></li>
<li class="section"><a href="following-users#sec:a_web_interface_for_following_and_followers"><span class="number">12.2</span> Une interface web pour les auteurs suivis et les lecteurs</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:sample_following_data"><span class="number">12.2.1</span> Exemple de donnée de suivi</a></li>
<li class="subsection"><a href="following-users#sec:stats_and_a_follow_form"><span class="number">12.2.2</span> Statistiques et formulaire de suivi</a></li>
<li class="subsection"><a href="following-users#sec:following_and_followers_pages"><span class="number">12.2.3</span> Pages d'auteurs suivis et de lecteurs</a></li>
<li class="subsection"><a href="following-users#sec:a_working_follow_button_the_standard_way"><span class="number">12.2.4</span> Un bouton de suivi fonctionnant de façon standard</a></li>
<li class="subsection"><a href="following-users#sec:a_working_follow_button_with_ajax"><span class="number">12.2.5</span> Un bouton fonctionnant avec Ajax</a></li></ol></li>
<li class="section"><a href="following-users#sec:the_status_feed"><span class="number">12.3</span> L'état de l'alimention</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:motivation_and_strategy"><span class="number">12.3.1</span> Motivation et stratégie</a></li>
<li class="subsection"><a href="following-users#sec:a_first_feed_implementation"><span class="number">12.3.2</span> Une première implémentation de peuplement</a></li>
<li class="subsection"><a href="following-users#sec:scopes_subselects_and_a_lambda"><span class="number">12.3.3</span> Portées, sous-requêtes et fonction <em>lambda</em></a></li>
<li class="subsection"><a href="following-users#sec:the_new_status_feed"><span class="number">12.3.4</span> Nouvel état de l'alimentation</a></li></ol></li>
<li class="section"><a href="following-users#sec:following_conclusion"><span class="number">12.4</span> Conclusion</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:extensions_to_the_sample_application"><span class="number">12.4.1</span> Extensions de l'application exemple</a></li>
<li><ol>
<li class="subsubsection"><a href="following-users#sec:replies">Réponses</a></li>
<li class="subsubsection"><a href="following-users#sec:messaging">Notification</a></li>
<li class="subsubsection"><a href="following-users#sec:follower_notifications">Notifications aux lecteurs</a></li>
<li class="subsubsection"><a href="following-users#sec:password_reminders">Rappel du mot de passe</a></li>
<li class="subsubsection"><a href="following-users#sec:signup_confirmation">Confirmation d'inscription</a></li>
<li class="subsubsection"><a href="following-users#sec:rss_feed">Alimentation RSS</a></li>
<li class="subsubsection"><a href="following-users#sec:rest_api">REST API</a></li>
<li class="subsubsection"><a href="following-users#sec:search">Recherche</a></li></ol></li>
<li class="subsection"><a href="following-users#sec:guide_to_further_resources"><span class="number">12.4.2</span> Guide vers d'autres ressources</a></li></ol></li>
<li class="section"><a href="following-users#sec:following_Exercices"><span class="number">12.5</span> Exercices</a></li></ol></li></ol></div>

<div id="main_content"></div>

<p> <span class="preamble">
 <span id="foreword">
<strong> Avant-propos</strong> <br />
 </span>
 </span></p>

<p>Ma précédente compagnie (CD Baby) fut une des premières à basculer intégralement vers Ruby on Rails, et à rebasculer aussi intégralement vers PHP (googlez-moi si vous voulez prendre la mesure du drame). On m'a tellement recommandé ce livre Michael Hartl que je n'ai pu faire autrement que de le lire. C'est ainsi que le <em>Tutoriel Ruby on Rails</em> m'a fait revenir à nouveau à Rails.</p>
<p>Bien qu'ayant parcouru de nombreux livres sur Rails, c'est ce tutoriel-là qui m'a véritablement «&nbsp;mis en possession&nbsp;» de Rails. Tout est fait ici «&nbsp;à la manière de Rails&nbsp;» —&nbsp;une manière qui ne m'avait jamais semblé naturelle avant que je ne lise ce livre. C'est aussi le seul ouvrage sur Rails qui met en place, d'un bout à l'autre, un <em>Développement Dirigé par les Tests</em> (<em>Test-Driven Development</em>), une approche que je savais hautement recommandée par les experts mais dont je n'avais jamais compris aussi bien la pertinence que dans ce livre. Enfin, en incluant Git, GitHub et Heroku dans les exemples de la démonstration, l'auteur vous donne vraiment le goût de ce qu'est le développement d'un projet dans la vie réelle. Et le exemples de code ne sont pas en reste.</p> 
	
<p>La narration linéaire adoptée par ce tutoriel est vraiment un bon format. Personnellement, j'ai étudié <em>Le Tutoriel Rails</em> en trois longues journées, en faisant tous les exemples et les exercices proposés à la fin de chaque chapitre. C'est en lisant ce livre du début à la fin, sans sauter la moindre partie, qu'on en tire tout le bénéfice.</p>

<p>Régalez-vous&nbsp;!</p>

<p><a href="http://sivers.org/">Derek Sivers</a> (<a href="http://sivers.org/">sivers.org</a>) <br />
<em>Précédemment&nbsp;: Fondateur de </em> <a href="http://www.cdbaby.com/"><em>CD Baby</em></a> <br />
<em>Actuellement&nbsp;: Fondateur de </em> <a href="http://thoughts.pro/"><em>Thoughts Ltd.</em></a> <br /></p>

<p> <span class="preamble">
<strong> Remerciements</strong> <br />
 </span></p>

<p>Ce <em>Tutoriel Ruby on Rails</em> doit beaucoup à mon livre précédent sur Rails, <em>RailsSpace</em>, et donc à mon co-auteur <a href="http://aure.com/">Aurelius Prochazka</a>. J'aimerais remercier Aure à la fois pour le travail qu'il a accompli sur ce précédent livre et pour son soutien pour le présent ouvrage. J'aimerais aussi remercier Debra Williams Cauley, mon éditeur pour les deux ouvrages&nbsp;; aussi longtemps qu'elle jouera avec moi au baseball, je continuerai d'écrire des livres pour elle.</p>

<p>J'aimerais remercier une longue liste de Rubyistes qui m'ont parlé et inspiré au cours des années&nbsp;: David Heinemeier Hansson, Yehuda Katz, Carl Lerche, Jeremy Kemper, Xavier Noria, Ryan Bates, Geoffrey Grosenbach, Peter Cooper, Matt Aimonetti, Gregg Pollack, Wayne&nbsp;E. Seguin, Amy Hoy, Dave Chelimsky, Pat Maddox, Tom Preston-Werner, Chris Wanstrath, Chad Fowler, Josh Susser, Obie Fernandez, Ian McFarland, Steven Bristol, Giles Bowkett, Evan Dorn, Long Nguyen, James Lindenbaum, Adam Wiggins, Tikhon Bernstam, Ron Evans, Wyatt Greene, Miles Forrest, les gens bien de Pivotal Labs, le gang Heroku, les mecs de thoughtbot et l'équipe de GitHub. Enfin, tellement, tellement, tellement de lecteurs —&nbsp;beaucoup trop pour les citer tous&nbsp;— qui ont contribué par leur rapport de bogues et leurs suggestions durant l'écriture de ce livre, et je tiens à saluer leur aide sans laquelle ce livre ne serait pas ce qu'il est. <br /></p>

<p> <span class="preamble">
 <span id="author">
<strong> À propos de l'auteur</strong> <br />
 </span>
 </span></p>

<p><a href="http://michaelhartl.com/">Michael Hartl</a> est programmeur, éducateur et entrepreneur. Il est le co-auteur de <em>RailsSpace</em>, un tutoriel Rails publié en 2007, et a été co-fondateur et développeur en chef de <a href="http://insoshi.com/">Insoshi</a>, une plateforme de réseau social <a href="http://github.com/popular/forked">populaire</a> en Ruby on Rails. Précédement, il a enseigné la théorie et la physique informatique au <a href="http://www.caltech.edu/">California Institute of Technology</a> (Caltech), où il a reçu le Lifetime Achievement Award for Excellence en enseignement. Michael est diplômé du <a href="http://college.harvard.edu/">Harvard College</a>, a un <a href="http://resolver.caltech.edu/CaltechETD:etd-05222003-161626">Ph.D. en physique</a> (un doctorat. NdT) de <a href="http://www.caltech.edu/">Caltech</a>, et il est ancien élève du programme des entrepreneurs <a href="http://ycombinator.com/">Y&nbsp;Combinator</a>. <br /></p>

<p> <span id="license" class="preamble">
<strong> Copyright et license</strong> <br />
 </span></p>

<p><em>Le Tutoriel Ruby on Rails&nbsp;: apprendre Rails par l'exemple</em>. Copyright &copy; 2010 par Michael Hartl. Tout le code source du <em>Tutoriel Ruby on Rails</em> est disponible sous la license <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> et la licence <a href="http://en.wikipedia.org/wiki/Beerware">Beerware License</a>.</p>

<pre class="verbatim">   Copyright (c) 2010 Michael Hartl

   Permission est accordée, à titre gratuit, à toute personne obtenant
   une copie de ce logiciel et la documentation associée, pour faire des 
   modification dans le logiciel sans restriction et sans limitation des
   droits d’utiliser, copier, modifier, fusionner, publier, distribuer,
   concéder sous licence, et / ou de vendre les copies du Logiciel, et à
   autoriser les personnes auxquelles le Logiciel est meublé de le faire, 
   sous réserve des conditions suivantes:

   L’avis de copyright ci-dessus et cette autorisation doit être inclus
   dans toutes les copies ou parties substantielles du Logiciel.

   LE LOGICIEL EST FOURNI «TEL QUEL», SANS GARANTIE D’AUCUNE SORTE, 
   EXPLICITE OU IMPLICITE, Y COMPRIS, MAIS SANS S’Y LIMITER, LES 
   GARANTIES DE QUALITÉ MARCHANDE, ADAPTATION À UN USAGE PARTICULIER ET
   D’ABSENCE DE CONTREFAÇON. EN AUCUN CAS LES AUTEURS OU TITULAIRES DU
   ETRE TENU RESPONSABLE DE TOUT DOMMAGE, RÉCLAMATION OU AUTRES
   RESPONSABILITÉ, SOIT DANS UNE ACTION DE CONTRAT, UN TORT OU AUTRE,
   PROVENANT DE, DE OU EN RELATION AVEC LE LOGICIEL OU L’UTILISATION OU
   DE TRANSACTIONS AUTRES LE LOGICIEL.
	
</pre>




<pre class="verbatim">/*
 * ------------------------------------------------------------
 * &quot;LA LICENCE BEERWARE&quot; (Révision 42)&nbsp;:
 * Michael Hartl a écrit ce code. Aussi longtemps que vous
 * conservez cette note, vous pouvez faire ce que vous voulez
 * de ce travail. Si nous nous rencontrons un jour, et que vous
 * pensez que ce travail en vaut la peine, vous pourrez me
 * payer une bière en retour.
 * ------------------------------------------------------------
 */</pre>




<div id="top"></div>


<h1 class="chapter"><a id="sec:2" href="a-demo-app#top" class="heading"><span class="number">Chapitre 2</span> Une application Démo</a></h1>


<p>Dans ce chapitre, nous développerons une simple application de démonstration pour révéler un peu de la puissance de Rails. Le but est d'obtenir une vue d'ensemble de la programmation Ruby on Rails (et du développement web en général) en générant rapidement une application par l'utilisation du <em>générateur d'échaffaudage</em> (<em>scaffold generators</em>).<sup class="footnote" id="fnref:2.1"><a href="#fn:2.1">1</a></sup> Comme explicité dans le <a class="ref" href="beginning#sidebar:scaffolding">Box&nbsp;1.1</a>, la suite du livre adoptera une approche opposée à celle-ci, en développant une application étape étape après étape, en expliquant chaque nouveau concept qui apparaitra, mais pour un aperçu rapide (et quelque rapide gratification), il n'y a rien de mieux que la construction par échaffaudage. L'application Démo en résultant nous permettra d'interagir avec elle par le biais des URLs, en nous donnant un aperçu de la structure d'une application Rails, incluant un premier exemple de l'<em>architecture REST</em> préconisée par Rails.</p>

<p>Comme avec l'application exemple que nous développerons par la suite, l'application Démo consistera en des <em>utilisateurs</em> (<em>users</em>) et leur <em>micro-messages</em> (<em>microposts</em>) associés (constituant une application minimaliste de type Twitter). [(The functionality will be utterly under-developed)(Sa fontionnalité sera sous-développée)], et beaucoup d'étape du développement paraitront magiques, mais ne vous inquiétez pas&nbsp;: l'application exemple complète développera une application similaire depuis le tout départ au <a class="ref" href="static-pages#top">chapitre&nbsp;3</a>, et je fournirai d'abondantes références concernant les points abordés. Dans le même temps, soyez patient et gardez la foi &mdash;&nbsp;l'objectif de ce tutoriel est de vous conduire <em>au-delà</em> de la superficialité de l'approche par échaffaudage pour atteindre une compréhension profonde de Rails.</p>

<div class="label" id="sec:planning_the_application"></div>


<h2><a id="sec:2.1" href="a-demo-app#sec:planning_the_application" class="heading"><span class="number">2.1</span> Planifier l'application</a></h2>


<p>Dans cette section, nous allons poser les plan de notre application démo. Comme dans la <a class="ref" href="beginning#sec:the_first_application">section&nbsp;1.2.3</a>, nous commencerons par générer le squelette de l'application en utilisant la commande <code>rails</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects
<span class="gp">$</span> rails new demo_app
<span class="gp">$</span> <span class="nb">cd </span>demo_app
</pre></div>
</div>


<p>Ensuite, nous utiliserons l'éditeur de texte pour actualiser le contenu du fichier <code>Gemfile</code> utile à Bundler avec le code de l'<a class="ref" href="a-demo-app#code:demo_gemfile_sqlite_version_redux">extrait&nbsp;2.1</a>.</p>

<div class="label" id="code:demo_gemfile_sqlite_version_redux"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.1.</span> <span class="description">Un fichier <code>Gemfile</code> pour l'application Démo.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.7&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3-ruby&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.2&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s1">&#39;sqlite3&#39;</span>
</pre></div>
</div></div>


<p>(Souvenez-vous de la <a class="ref" href="beginning#sec:bundler">section&nbsp;1.2.4</a> que vous pouvez avoir besoin de la version <tt>1.2.5</tt> du gem <tt>sqlite3-ruby</tt> si vous êtes sous OS&nbsp;X Leopard.) Nous installons alors et incluons les gems en utilisant <code>bundle</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Pour finir, nous initialiserons un repository Git et ferons le premier dépôt&nbsp;:<sup class="footnote" id="fnref:2.2"><a href="#fn:2.2">2</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git init
<span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Initial commit&quot;</span>
</pre></div>
</div>


<div class="label" id="fig:create_demo_repo"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/create_demo_repo.png" alt="create_demo_repo" /></span></div><div class="caption"><span class="header">Illustration 2.1: </span><span class="description">Créer un repository pour l'application Démo sur GitHub.&nbsp;<a href="http://railstutorial.org/images/figures/create_demo_repo-full.png">(taille normale)</a></span></div></div>


<p>Vous pouvez aussi, optionnellement, créer un nouveau repository (<a class="ref" href="a-demo-app#fig:create_demo_repo">Illustration&nbsp;2.1</a>) et le «&nbsp;pusher&nbsp;» vers GitHub&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin git@github.com:&lt;username&gt;/demo_app.git
<span class="gp">$</span> git push origin master
</pre></div>
</div>


<p>Nous sommes à présent prêts à construire l'application elle-même. La première étape typique quand on fabrique une application web est de créer un <em>modèle de données</em>, qui est une représentation de la structure nécessaire à notre application. Dans notre cas, l'application Démo sera un [(stripped-down microblog)(micro-blog)], avec uniquement des utilisateurs et de courts (micro) messages. Ainsi, nous commencerons par le modèle de données pour les <em>utilisateurs</em> de l'application (<a class="ref" href="a-demo-app#sec:modeling_users">Section&nbsp;2.1.1</a>), et nous ajouterons ensuite un modèle de données pour les <em>micro-messages</em> (<em>microposts</em>) (<a class="ref" href="a-demo-app#sec:modeling_microposts">Section&nbsp;2.1.2</a>).</p>

<div class="label" id="sec:modeling_users"></div>


<h3><a id="sec:2.1.1" href="a-demo-app#sec:modeling_users" class="heading"><span class="number">2.1.1</span> Modéliser les utilisateurs</a></h3>


<p>Il y a autant de modèles de données utilisateurs sur le web qu'il y a de formulaires d'inscription&nbsp;; nous adopterons définitivement une approche minimaliste. Les utilisateurs de notre application Démo possèderont un identifiant unique appelé <code>id</code>, un <code>name</code> affiché publiquement (de type chaine de caractère, <code>string</code>) et une adresse mail (de type également <code>string</code>) qui servira de double au nom d'utilisateur (<em>username</em>). Un résumé du modèle de données pour les utilisateurs est visible dans l' <a class="ref" href="a-demo-app#fig:demo_user_model">illustration&nbsp;2.2</a>.</p>

<div class="label" id="fig:demo_user_model"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_user_model.png" alt="demo_user_model" /></span></div><div class="caption"><span class="header">Illustration 2.2: </span><span class="description">Le modèle de données pour les utilisateurs.</span></div></div>


<p>Comme nous le verrons en commençant la <a class="ref" href="modeling-and-viewing-users-one#sec:database_migrations">section&nbsp;6.1.1</a>, le label <code>users</code> (<code>utilisateurs</code>) dans l'<a class="ref" href="a-demo-app#fig:demo_user_model">illustration&nbsp;2.2</a> correspond à une <em>table</em> dans la base de données, et les attributs <code>id</code>, <code>name</code>, et <code>email</code> correspondent aux colonnes de cette table.</p>

<div class="label" id="sec:modeling_microposts"></div>


<h3><a id="sec:2.1.2" href="a-demo-app#sec:modeling_microposts" class="heading"><span class="number">2.1.2</span> Modéliser les micro-messages</a></h3>


<p>Le cœur du modèle de données des micro-messages (<em>microposts</em>) est souvent plus simple que celui des utilisateurs&nbsp;: un micro-message possède seulement un champ <code>id</code> (identifiant) et un champ <code>content</code> (contenu) pour le texte du micro-message (de type <code>string</code>).<sup class="footnote" id="fnref:2.3"><a href="#fn:2.3">3</a></sup> Demeure cependant quelques complications&nbsp;: nous voulons <em>associer</em> chaque micro-message à un utilisateur particulier&nbsp;; nous accomplirons cela en enregistrant le <code>user_id</code> (identifiant d'utilisateur) de l'auteur du message. Le résultat apparait dans l'<a class="ref" href="a-demo-app#fig:demo_micropost_model">illustration&nbsp;2.3</a>.</p>

<div class="label" id="fig:demo_micropost_model"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_micropost_model.png" alt="demo_micropost_model" /></span></div><div class="caption"><span class="header">Illustration 2.3: </span><span class="description">Le modèle de données pour les micro-messages.</span></div></div>

<p>Nous verrons à la <a class="ref" href="a-demo-app#sec:demo_user_has_many_microposts">section&nbsp;2.3.3</a> (et plus profondément au <a class="ref" href="user-microposts#top">chapitre&nbsp;11</a>) comment cette attribut <code>user_id</code> nous permet d'exprimer de façon succinte le fait qu'un utilisateur est potentiellement associé à plusieurs micro-messages.</p>

<div class="label" id="sec:demo_users_resource"></div>


<h2><a id="sec:2.2" href="a-demo-app#sec:demo_users_resource" class="heading"><span class="number">2.2</span> La ressouce Utilisateur (Users)</a></h2>


<p>Dans cette section, nous allons implémenter le modèle de données utilisateurs de la <a class="ref" href="a-demo-app#sec:modeling_users">section&nbsp;2.1.1</a>, en même temps qu'une interface web pour ce modèle. La combinaison des deux constituera une <em>ressource utilisateurs</em> (<em>Users resource</em>) qui nous permettra de penser les utilisateurs comment des <em>objets</em> (<em>objects</em>) qui peuvent être créés, consultés, actualisés et supprimés sur le web via le <a href="http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">protocole HTTP</a>.</p>

<p>Comme promis dans l'introduction, notre ressource utilisateurs sera créée par un programme de génération d'échaffaudage, présent de façon standard dans chaque projet Rails. L'argument de la commande <code>scaffold</code> (<em>échaffaudage</em>) est la version singulier du nom de la ressource (dans ce cas, <code>User</code>), auquel on peut ajouter en paramètres optionnels les attributs du modèle de données&nbsp;:<sup class="footnote" id="fnref:2.4"><a href="#fn:2.4">4</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate scaffold User name:string email:string
<span class="go">      invoke  active_record</span>
<span class="go">      create    db/migrate/20100615004000_create_users.rb</span>
<span class="go">      create    app/models/user.rb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/unit/user_test.rb</span>
<span class="go">      create      test/fixtures/users.yml</span>
<span class="go">       route  resources :users</span>
<span class="go">      invoke  scaffold_controller</span>
<span class="go">      create    app/controllers/users_controller.rb</span>
<span class="go">      invoke    erb</span>
<span class="go">      create      app/views/users</span>
<span class="go">      create      app/views/users/index.html.erb</span>
<span class="go">      create      app/views/users/edit.html.erb</span>
<span class="go">      create      app/views/users/show.html.erb</span>
<span class="go">      create      app/views/users/new.html.erb</span>
<span class="go">      create      app/views/users/_form.html.erb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/functional/users_controller_test.rb</span>
<span class="go">      invoke    helper</span>
<span class="go">      create      app/helpers/users_helper.rb</span>
<span class="go">      invoke      test_unit</span>
<span class="go">      create        test/unit/helpers/users_helper_test.rb</span>
<span class="go">      invoke  stylesheets</span>
<span class="go">      create    public/stylesheets/scaffold.css</span>
</pre></div>
</div>


<p>En ajoutant <code>name:string</code> et <code>email:string</code>, nous nous sommes arrangés pour que le modèle de données User prenne la forme définie dans l'<a class="ref" href="a-demo-app#fig:demo_user_model">illustration&nbsp;2.2</a> (notez qu'il n'y a nul besoin d'inclure un paramètre pour l'attribut&nbsp;<code>id</code>&nbsp;; il est créé automatiquement par Rails.<sup class="footnote" id="fnref:2.5"><a href="#fn:2.5">5</a></sup>)</p>

<p>Pour procéder à l'application Démo, nous avons d'abord besoin de <em>migrer</em> (<em>migrate</em>) la base de données en utilisant <em>Rake</em> (<a class="ref" href="a-demo-app#sidebar:rake">Box&nbsp;2.1</a>):</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rake db:migrate
<span class="go">==  CreateUsers: migrating ====================================================</span>
<span class="go">-- create_table(:users)</span>
<span class="go">   -&gt; 0.0017s</span>
<span class="go">==  CreateUsers: migrated (0.0018s) ===========================================</span>
</pre></div>
</div>


<p>Cette procédure actualise simplement la base de données avec notre nouveau modèle de données utilisateurs (<code>users</code>). Nous en apprendrons plus à propos des migrations de la base de données au début de la <a class="ref" href="modeling-and-viewing-users-one#sec:database_migrations">section&nbsp;6.1.1</a>.</p>

<p>Cela fait, nous pouvons lancer le serveur web local en utilisant la commande <code>rails s</code>, qui est le raccourci de la commande <code>rails server</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails s
</pre></div>
</div>


<p>L'application Démo devrait maintenant être accessible à l'adresse <a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a> de votre navigateur.</p>

<div class="label" id="sidebar:rake"></div>


<div class="sidebar"><span class="title"><span class="header">Box 2.1.</span><span class="description">Rake</span></span>
<p>Dans la tradition Unix, l'utilitaire <a href="http://en.wikipedia.org/wiki/Make_(software)"><em>make</em></a> joue un rôle important pour construire des programmes exécutable à partir de leur code source&nbsp;; plus d'un hacker s'est entrainé à mémoriser la ligne…</p>

<pre class="verbatim">  $ ./configure &amp;&amp; make &amp;&amp; sudo make install</pre>


<p>… utilisée couramment pour compiler du code sur les systèmes Unix (incluant Linux et les systèmes OS&nbsp;X de Mac).</p>

<p>Rake est <em>Ruby make</em>, un langage similaire à make écrit en Ruby. Rails utilise intensivement Rake, spécialement pour les innombrables petites tâches administratives nécessaires quand on développe des applications web faisant un usage soutenu des bases de données. La commande <code>rake db:migrate</code> est probablement la plus courante, mais il y en existe beaucoup d'autres&nbsp;; vous pouvez trouver une liste des tâches propres aux bases de données en utilisant le paramètre <code>-T db</code>&nbsp;:</p>

<pre class="verbatim">  $ rake -T db</pre>


<p>Pour voir toutes les tâches Rake utilisables, jouez&nbsp;:</p>

<pre class="verbatim">  $ rake -T</pre>


<p>La liste est impressionnante, mais ne vous inquiétez pas, vous n'avez pas besoin de connaitre toutes, ni même la plupart, de ces commandes. En arrivant à la fin de ce <em>Tutoriel Rails</em>, vous en connaitrez les principales.</p>
</div>




<div class="label" id="sec:a_user_tour"></div>


<h3><a id="sec:2.2.1" href="a-demo-app#sec:a_user_tour" class="heading"><span class="number">2.2.1</span> Un tour de l'utilisateur</a></h3>


<p>Rejoindre l'url racine&nbsp;<a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a> affichera la même page Rails par défaut présenter dans l'<a class="ref" href="beginning#fig:riding_rails_3">illustration&nbsp;1.3</a>, mais en générant l'échaffaudate de la ressource utilisateurs nous avons également créé une grand nombre de pages pour manipuler ce utilisateurs. Par exemple, la page pour afficher les utilisateurs, en ajoutant <a href="http://localhost:3000/users">/users</a>, et la page pour créer un nouvel utilisateur en ajoutant <a href="http://localhost:3000/">/users/new</a>.<sup class="footnote" id="fnref:2.6"><a href="#fn:2.6">6</a></sup> La suite de cette section présentera un tour rapide de ces pages utilisateurs. En le suivant, il peut être utile de se référer à la <a class="ref" href="a-demo-app#table:user_urls">table&nbsp;2.1</a>, qui présente la correspondance entre les pages et les URLs respectives.</p>

<div class="label" id="table:user_urls"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Action</strong></th><th class="align_left"><strong>Contenu</strong></th></tr><tr class="top_bar"><td class="align_left"><a href="http://localhost:3000/users"><tt>/users</tt></a></td><td class="align_left"><code>index</code></td><td class="align_left">page listant les utilisateurs</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/1"><tt>/users/1</tt></a></td><td class="align_left"><code>show</code></td><td class="align_left">page de l'utilisateur d'id <code>1</code></td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/new"><tt>/users/new</tt></a></td><td class="align_left"><code>new</code></td><td class="align_left">page pour créer un nouvel utilisateur</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/1/edit"><tt>/users/1/edit</tt></a></td><td class="align_left"><code>edit</code></td><td class="align_left">page d'édition de l'utilisateur d'id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Table 2.1: </span><span class="description">Correspondance entre pages et URLs de la ressource Users.</span></div></div>


<p>Nous commençons avec la page listant tous les utilisateurs de notre application, appelée <a href="http://localhost:3000/users"><tt>index</tt></a>&nbsp;; comme nous pouvons nous y attendre, il n'y a pour le moment aucun utilisateur (<a class="ref" href="a-demo-app#fig:demo_blank_user_index_rails_3">illustration&nbsp;2.4</a>).</p>

<div class="label" id="fig:demo_blank_user_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_blank_user_index_rails_3.png" alt="demo_blank_user_index_rails_3" /></span></div><div class="caption"><span class="header">Illustration 2.4: </span><span class="description">La page index initiale de la ressource utilisateurs (<a href="http://localhost:3000/users"><tt>/users</tt></a>).&nbsp;<a href="/images/figures/demo_blank_user_index_rails_3-full.png">(taille normale)</a></span></div></div>


<p>Pour créer un nouvel utilisateur, visitons la page <a href="http://localhost:3000/users/new"><tt>new</tt></a>, comme montrée dans l'<a class="ref" href="a-demo-app#fig:demo_new_user_rails_3">illustration&nbsp;2.5</a> (au <a class="ref" href="sign-up#top">chapitre&nbsp;8</a>, cette page deviendra la page d'inscription).</p>

<div class="label" id="fig:demo_new_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_new_user_rails_3.png" alt="demo_new_user_rails_3" /></span></div><div class="caption"><span class="header">Illustration 2.5: </span><span class="description">La page de nouvel utilisateur (<a href="http://localhost:3000/users/new"><tt>/users/new</tt></a>).&nbsp;<a href="/images/figures/demo_new_user_rails_3-full.png">(taille normale)</a></span></div></div>


<p>Nous pouvons créer un nouvel utilisateur en entrant les valeurs du nom et de l'email dans les champs de texte correspondants et en cliquant ensuite sur le bouton Créer (<em>Create</em>). Le résultat est la page d'utilisateur <a href="http://localhost:3000/users/1"><tt>show</tt></a>, telle que l'<a class="ref" href="a-demo-app#fig:demo_show_user_rails_3">illustration&nbsp;2.6</a> la présente (le message vert de bienvenue est accompli en utilisant le <em>flash</em>, que nous aborderons dans la <a class="ref" href="sign-up#sec:the_flash">section&nbsp;8.3.3</a>). Notez que l'URL est à présent <a href="http://localhost:3000/users/1"><tt>/users/1</tt></a>&nbsp;; comme vous pouvez vous en douter, le nombre&nbsp;<code>1</code> est l'identifiant de l'utilisateur (l'attribut <code>id</code>) de l'<a class="ref" href="a-demo-app#fig:demo_user_model">illustration&nbsp;2.2</a>. À la <a class="ref" href="modeling-and-viewing-users-two#sec:better_user_views">section&nbsp;7.3</a>, cette page deviendra la page du profil de l'utilisateur.</p>

<div class="label" id="fig:demo_show_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_show_user_rails_3.png" alt="demo_show_user_rails_3" /></span></div><div class="caption"><span class="header">Illustration 2.6: </span><span class="description">La page affichant l'utilisateur (<a href="http://localhost:3000/users/1"><tt>/users/1</tt></a>).&nbsp;<a href="/images/figures/demo_show_user_rails_3-full.png">(taille normale)</a></span></div></div>


<p>Pour modifier les informations de l'utilisateur, nous nous rendons sur la page <a href="http://localhost:3000/users/1/edit"><tt>edit</tt></a> page (<a class="ref" href="a-demo-app#fig:demo_edit_user_rails_3">Illustration&nbsp;2.7</a>). En modifiant les informations de l'utilisateur et en cliquant sur le bouton Update, nous changerons les informations dans l'application Démo (<a class="ref" href="a-demo-app#fig:demo_update_user_rails_3">Illustration&nbsp;2.8</a>) (comme nous le verrons en détail en abordant le <a class="ref" href="modeling-and-viewing-users-one#top">chapitre&nbsp;6</a>, les données de l'utilisateur sont stockées dans la base de données). Nous ajouterons les fonctionnalités edit/update à l'application exemple dans la <a class="ref" href="updating-showing-and-deleting-users#sec:updating_users">section&nbsp;10.1</a>.</p>

<div class="label" id="fig:demo_edit_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_edit_user_rails_3.png" alt="demo_edit_user_rails_3" /></span></div><div class="caption"><span class="header">Illustration 2.7: </span><span class="description">La page d'édition de l'utilisateur (<a href="http://localhost:3000/users/1/edit"><tt>/users/1/edit</tt></a>).&nbsp;<a href="/images/figures/demo_edit_user_rails_3-full.png">(taille normale)</a></span></div></div>




<div class="label" id="fig:demo_update_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_update_user_rails_3.png" alt="demo_update_user_rails_3" /></span></div><div class="caption"><span class="header">Illustration 2.8: </span><span class="description">Un utilisateur dont les informations ont été actualisées.&nbsp;<a href="/images/figures/demo_update_user_rails_3-full.png">(taille normale)</a></span></div></div>


<p>Nous allons maintenant créer un second utilisateur en revisitant la page <a href="http://localhost:3000/users/new"><tt>new</tt></a> et en soumettant un second jeu d'informations&nbsp;; l'<a href="http://localhost:3000/users"><tt>index</tt></a> en résultant est présenté dans l'<a class="ref" href="a-demo-app#fig:demo_user_index_two_rails_3">illustration&nbsp;2.9</a>. La <a class="ref" href="updating-showing-and-deleting-users#sec:showing_users">section&nbsp;10.3</a> permettra de polisser cette page d'index affichant tous les utilisateurs.</p>

<div class="label" id="fig:demo_user_index_two_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_user_index_two_rails_3.png" alt="demo_user_index_two_rails_3" /></span></div><div class="caption"><span class="header">Illustration 2.9: </span><span class="description">La page d'index des utilisateurs (<a href="http://localhost:3000/users"><tt>/users</tt></a>) avec un autre utilisateur.&nbsp;<a href="/images/figures/demo_user_index_two_rails_3-full.png">(taille normale)</a></span></div></div>


<p>Ayant vu comment créer, afficher et éditer les utilisateurs, nous en arrivons maintenant à voir comment les détruire (<a class="ref" href="a-demo-app#fig:demo_destroy_user_rails_3">Illustration&nbsp;2.10</a>). Vous devriez pouvoir vérifier qu'un clic sur le lien de l'<a class="ref" href="a-demo-app#fig:demo_destroy_user_rails_3">illustration&nbsp;2.10</a> détruit le second utilisateur, réduisant la page d'index à un seul utilisateur (si cela ne fonctionne pas, assurez-vous que JavaScript soit activé dans votre navigateur&nbsp;; Rails utilise JavaScript pour procéder à la requête nécessaire à la destruction d'un utilisateur). La <a class="ref" href="updating-showing-and-deleting-users#sec:destroying_users">section&nbsp;10.4</a> ajoute la suppression de l'utilisateur à l'application exemple, en prenant soin de restreindre l'usage de cette fonctionnalité aux seuls administrateurs du site (utilisateurs de classe «&nbsp;administrateur&nbsp;»).</p>

<div class="label" id="fig:demo_destroy_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_destroy_user_rails_3.png" alt="demo_destroy_user_rails_3" /></span></div><div class="caption"><span class="header">Illustration 2.10: </span><span class="description">Destruire un utilisateur.&nbsp;<a href="/images/figures/demo_destroy_user_rails_3-full.png">(taille normale)</a></span></div></div>


<div class="label" id="sec:mvc_in_action"></div>


<h3><a id="sec:2.2.2" href="a-demo-app#sec:mvc_in_action" class="heading"><span class="number">2.2.2</span> MVC en action</a></h3>


<p>Maintenant que nous avons accompli un rapide aperçu de la ressource utilisateurs (<em>Users</em>), examinons une partie singulière de cette ressource dans le contexte du principe Modèle-Vue-Contrôleur introduit à la <a class="ref" href="beginning#sec:mvc">section&nbsp;1.2.6</a>. Notre stratégie sera de décrire le résultat d'un «&nbsp;hit&nbsp;» typique de navigateur &mdash;&nbsp;une visite à la page d'index des utilisateurs, à l'adresse <a href="http://localhost:3000/users">/users</a>&nbsp;&mdash; en terme de MVC (<a class="ref" href="a-demo-app#fig:mvc_detailed">Illustration&nbsp;2.11</a>).</p>

<div class="label" id="fig:mvc_detailed"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/mvc_detailed.png" alt="mvc_detailed" /></span></div><div class="caption"><span class="header">Illustration 2.11: </span><span class="description">Un diagramme détaillé du MVC dans Rails.&nbsp;<a href="/images/figures/mvc_detailed-full.png">(taille normale)</a></span></div></div>




<ol>
<li>Le navigateur reçoit une requête pour l'URL <tt>/users</tt>&nbsp;;</li>
<li>Rails déroute <tt>/users</tt> vers une action <code>index</code> dans le contrôleur Users (<em>Utilisateurs</em>)&nbsp;;</li>
<li>L'action <code>index</code> demande au modèle User de récupérer tous les utilisateurs (<code>User.all</code>)&nbsp;;</li>
<li>Le modèle User tire tous les utilisateurs de la base de données&nbsp;;</li>
<li>Le modèle User retourne au contrôleur la liste des utilisateurs&nbsp;;</li>
<li>Le contrôleur place les utilisateurs dans la variable <code>@users</code>, variable qui est passée à la vue <code>index</code>&nbsp;;</li>
<li>La vue utilise le code Ruby embarqué pour rendre la page au format HTML&nbsp;;</li>
<li>Le contrôleur renvoie le code HTML au navigateur, qui affiche la page.<sup class="footnote" id="fnref:2.7"><a href="#fn:2.7">7</a></sup></li>
</ol>


<p>Nous commençons par une requête provenant du navigateur &mdash;&nbsp;par exemple, après avoir tapé une URL dans la barre d'adresse du navigateur ou avoir cliqué un lien (étape &nbsp;1 de l'<a class="ref" href="a-demo-app#fig:mvc_detailed">illustration&nbsp;2.11</a>). Cette requête atteint le <em>routeur Rails</em> (étape&nbsp;2), qui la dispatche vers l'<em>action de contrôleur</em> adéquate basée sur l'URL (et, comme nous le verrons dans le <a class="ref" href="static-pages#sidebar:get_etc">Box&nbsp;3.1</a>, le <em>type</em> de requête). Le code pour créer la carte des URLs utilisateur vers les actions de contrôleur de la ressource Users est présenté dans l'<a class="ref" href="a-demo-app#code:rails_routes">illustration&nbsp;2.2</a>;<sup class="footnote" id="fnref:2.8"><a href="#fn:2.8">8</a></sup> ce code définit effectivement la table des paires URL/action pairs vue dans la <a class="ref" href="a-demo-app#table:user_urls">table&nbsp;2.1</a>.</p>

<div class="label" id="code:rails_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.2.</span> <span class="description">Le routage Rails, avec une règle pour la ressource Users. <br /> <code>config/routes.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="no">DemoApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Les pages du tour de la <a class="ref" href="a-demo-app#sec:a_user_tour">section&nbsp;2.2.1</a> correspond aux <em>actions</em> dans le <em>controller</em> des utilisateurs , qui est une collection d'actions correspondantes&nbsp;; le contrôleur généré par l'écheffaudage est présenté schématiquement dans <a class="ref" href="a-demo-app#code:demo_users_controller">extrait&nbsp;2.3</a>. Remarquez la notation <code>class UsersController &lt; ApplicationController</code>&nbsp;; c'est une exemple de <em>classe</em> Ruby avec <em>héritage</em> (nous discuterons brièvement des héritage de classe à la <a class="ref" href="a-demo-app#sec:inheritance_hierarchies">section&nbsp;2.3.4</a> et couvrirons ces deux sujets plus en détail à la <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">section&nbsp;4.4</a>).</p>

<div class="label" id="code:demo_users_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.3.</span> <span class="description">Schéma du contrôleur utilisateurs. <br /> <code>app/controllers/users_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Vous pouvez noter qu'il y a plus d'actions que de pages&nbsp;; les actions <code>index</code>, <code>show</code>, <code>new</code>, et <code>edit</code> correspondent toutes à la <a class="ref" href="a-demo-app#sec:a_user_tour">section&nbsp;2.2.1</a>, mais il y a aussi les actions supplémentaires <code>create</code>, <code>update</code>, et <code>destroy</code>. Ces actions ne retournent pas, typiquement, de pages (bien qu'elles le font dans certains cas)&nbsp;; leur rôle principal est plutôt de modifier les informations des utilisateurs dans la base de données. Cette liste complète des actions du contrôleur, résumée dans la <a class="ref" href="a-demo-app#table:demo_RESTful_users">table&nbsp;2.2</a>, représente l'implémentation de l'architecture REST en Rails (<a class="ref" href="a-demo-app#sidebar:REST">Box&nbsp;2.2</a>). Notez, dans la <a class="ref" href="a-demo-app#table:demo_RESTful_users">table&nbsp;2.2</a>, qu'il y a certains chevauchements dans les URLs&nbsp;; par exemple, les actions utilisateur <code>show</code> (<em>afficher</em>) et <code>update</code> (<em>actualiser</em>) correspondent toutes deux à l'URL <tt>/users/1</tt>. La distinction entre l'une et l'autre est la <a href="http://en.wikipedia.org/wiki/HTTP_request#Request_methods">méthode de requête HTTP</a> (<em>HTTP request method</em>) à laquelle elles répondent. Nous en apprendrons plus à propos de ces méthodes de requête HTTP à la <a class="ref" href="static-pages#sec:TDD">section&nbsp;3.2.2</a>.</p>

<div class="label" id="table:demo_RESTful_users"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_left"><strong>Requête HTTP</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Action</strong></th><th class="align_left"><strong>Propos</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users</tt></td><td class="align_left"><code>index</code></td><td class="align_left">page listant tous les utilisateurs</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users/1</tt></td><td class="align_left"><code>show</code></td><td class="align_left">page affichat l'utilisateur d'id <code>1</code></td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users/new</tt></td><td class="align_left"><code>new</code></td><td class="align_left">page pour créer un nouvel utilisateur</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left"><tt>/users</tt></td><td class="align_left"><code>create</code></td><td class="align_left">créer un nouvel utilisateur</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users/1/edit</tt></td><td class="align_left"><code>edit</code></td><td class="align_left">page pour éditer l'utilisateur d'id <code>1</code></td></tr><tr><td class="align_left"><tt>PUT</tt></td><td class="align_left"><tt>/users/1</tt></td><td class="align_left"><code>update</code></td><td class="align_left">actualiser l'utilisateur d'id&nbsp;<code>1</code></td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left"><tt>/users/1</tt></td><td class="align_left"><code>destroy</code></td><td class="align_left">détruire l'utilisateur d'id&nbsp;<code>1</code></td></tr></table></div><div class="caption"><span class="header">Table 2.2: </span><span class="description">Routages RESTful fournit par la ressource Users dans l'<a class="ref" href="a-demo-app#code:rails_routes">extrait&nbsp;2.2</a>.</span></div></div>


<div class="label" id="sidebar:REST"></div>


<div class="sidebar"><span class="title"><span class="header">Box 2.2.</span><span class="description">REpresentational State Transfer (REST)</span></span>
<p>Si vous en lisez plus sur le développement web Ruby on Rails, vous noterez un grand nombre d'allusions à &ldquo;&nbsp;REST&nbsp;&rdquo;, acronyme de REpresentational State Transfer (NdT. Qui pourrait se traduire par «&nbsp;Représentation de l'état de transfert&nbsp;»). REST est un style d'architecture pour le développement 
<p>If you read much about Ruby on Rails web development, you&rsquo;ll see a lot of references to &ldquo;REST&rdquo;, which is an acronym for REpresentational State Transfer. REST is an architectural style for les systèmes de réseau [(developing distributed)(à développement distribué)] et les logiciels tels que le World Wide Web et les applications web. Bien que la théorie REST soit quelque peu abstraite, dans le contexte des applications Rails REST signifie que la plupart des composants de l'application (comme les utilisateurs ou les micro-messages) sont modelés comme des <em>ressources</em> qui peuvent être créées, lues, actualisées et supprimées &mdash;&nbsp;opérations qui correspondent aux <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">opérations CRUD des bases de données relationnelles</a> tout comme aux quatres <a href="http://en.wikipedia.org/wiki/HTTP_request#Request_methods">méthode de requête HTTP</a> fondamentales&nbsp;: <tt>POST</tt>, <tt>GET</tt>, <tt>PUT</tt>, et <tt>DELETE</tt> (nous en apprendrons plus à propos des requêtes HTTP à la <a class="ref" href="static-pages#sec:TDD">section&nbsp;3.2.2</a> et spécialement au <a class="ref" href="static-pages#sidebar:get_etc">Box&nbsp;3.1</a>).</p>

<p>En tant que développeur d'application Rails, the développement de style RESTful vous aide à faire des choix quant à quel contrôleur ou quelles actions écrire&nbsp;: vous structurez simplement l'application en utilisant les ressources qui peuvent être créées, lues, actualisées ou supprimées. Dans les cas des utilisateurs et des micro-messages, ce processus est simple, puisqu'elles sont par défaut des ressources de plein droit. Au <a class="ref" href="following-users#top">chapitre&nbsp;12</a>, nous aborderons un exemple où les principes REST nous permettent de modéliser un problème subtil, le &ldquo;&nbsp;suivi des utilisateurs&nbsp;&rdquo;, d'une façon naturelle et efficiente.</p>
</div>


<p>Pour examine la relation entre contrôleur utilisateur et modèle utilisateur, concentrons-nous sur une version simplifiée de l'action <code>index</code> vue dans l'<a class="ref" href="a-demo-app#code:demo_index_action">extrait&nbsp;2.4</a>.<sup class="footnote" id="fnref:2.9"><a href="#fn:2.9">9</a></sup></p>

<div class="label" id="code:demo_index_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.4.</span> <span class="description">L'action utilisateur <code>index</code> simplifiée pour l'application Démo. <br /> <code>app/controllers/users_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@users</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Cette action <code>index</code> implémente la ligne <code>@users = User.all</code> (étape&nbsp;3), qui demande au modèle utilisateur de récupérer de la base de données une liste de tous les utilisateus (étape&nbsp;4), et de les placer dans une variable <code>@users</code> (prononcez &ldquo;at-users&rdquo; en anglais) (étape&nbsp;5). Le modèle utilisateur lui-même apparait dans l''<a class="ref" href="a-demo-app#code:demo_user_model">extrait&nbsp;2.5</a>&nbsp;; bien que plutôt ordinaire, il arrive équipé d'un grand nombre de fonctionnalités grâce à l'héritage de classe (<a class="ref" href="a-demo-app#sec:inheritance_hierarchies">section&nbsp;2.3.4</a> et <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">section&nbsp;4.4</a>). En particulier, en utilisant la librairie Rails de noim <em>Active Record</em>, le code de l'<a class="ref" href="a-demo-app#code:demo_user_model">extrait&nbsp;2.5</a> se débrouille pour que <code>User.all</code> retourne tous les utilisateurs.</p>

<div class="label" id="code:demo_user_model"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.5.</span> <span class="description">Le modèle Utilisateur (<em>User</em>) pour l'application Démo. <br /> <code>app/models/user.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Une fois la variable <code>@users</code> renseignée, le contrôleur appelle la <em>vue</em> (<em>view</em>) (étape&nbsp;6), vue dans l'<a class="ref" href="a-demo-app#code:demo_index_view">extrait&nbsp;2.6</a>. Les variables commençant par le caractère <code>@</code>, appelées <em>variables d'instance</em> (<em>instance variables</em>), sont automatiquement accessibles dans la vue&nbsp;; dans ce cas précis, la vue <code>index.html.erb</code> de l'<a class="ref" href="a-demo-app#code:demo_index_view">extrait&nbsp;2.6</a> boucle itérativement sur la liste <code>@users</code> et sort une ligne HTML à chaque itération.<sup class="footnote" id="fnref:2.10"><a href="#fn:2.10">10</a></sup></p>

<div class="label" id="code:demo_index_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.6.</span> <span class="description">La vue pour l'index utilisateurs (vous n'êtes pas supposés le comprendre tout de suite). <br /> <code>app/views/users/index.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Liste des utilisateurs<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Email<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

<span class="cp">&lt;%</span> <span class="vi">@users</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Montrer&#39;</span><span class="p">,</span> <span class="n">user</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Modifier&#39;</span><span class="p">,</span> <span class="n">edit_user_path</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Détruire&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="ss">:confirm</span> <span class="o">=&gt;</span> <span class="s1">&#39;Êtes-vous certain&nbsp;?&#39;</span><span class="p">,</span>
<span class="ss">:method</span> <span class="o">=&gt;</span> <span class="ss">:delete</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;New User&#39;</span><span class="p">,</span> <span class="n">new_user_path</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p>La vue convertit son contenu en code HTML (étape&nbsp;7), qui est alors retourné par le contrôleur au navigateur qui va l'afficher (étape&nbsp;8).</p>

<div class="label" id="sec:weaknesses_of_this_users_resource"></div>


<h3><a id="sec:2.2.3" href="a-demo-app#sec:weaknesses_of_this_users_resource" class="heading"><span class="number">2.2.3</span> Faiblesse de cette ressource utilisateur</a></h3>


<p>Bien qu'excellent pour donner un aperçu général de Rails, la ressource Utilisateurs de l'échaffaudage souffre d'un certain nombre de faiblesses.</p>

<ul>
<li><strong>Pas de validation de données.</strong> Notre modèle utilisateur accepte aussi bien et sans broncher les noms vides ou les adresses mail invalides&nbsp;;</li>
<li><strong>Pas d'authentification.</strong> Nous n'avons aucune notion d'identification ou de déconnexion, et aucun moyen de prévenir un utilisateur quelconque d'exécuter une opération quelconque&nbsp;;</li>
<li><strong>Pas de tests.</strong> Techniquement, ça n'est pas tout à fait juste &mdash;&nbsp;l'échaffaudage inclut des tests rudimentaires&nbsp;&mdash; mais les test générés automatiquement son laids et rigides, et ils ne testent pas la validation des données, l'authentification ou autres besoins personnalisés.</li>
<li><strong>Pas de mise en page.</strong> Il n'y a pas de charte graphique.</li>
<li><strong>Pas de compréhension réelle.</strong> Si vous comprenez le code de l'échaffaudage, alors vous ne devriez peut-être pas lire ce livre.</li>
</ul>




<div class="label" id="sec:microposts_resource"></div>


<h2><a id="sec:2.3" href="a-demo-app#sec:microposts_resource" class="heading"><span class="number">2.3</span> La ressource micro-messages</a></h2>


<p>Après avoir généré et exploré la ressource utilisateurs, nous nous tournons à présent vers la ressource associée des micro-messages. Tout au long de cette section, je recommande de comparer les éléments de la ressource micro-messages avec les éléments analogues de la ressource utilisateur de la <a class="ref" href="a-demo-app#sec:demo_users_resource">section&nbsp;2.2</a>&nbsp;; vous devriez constater que les deux ressources s'apparente l'une à l'autre en de nombreux points. La structure RESTful des applications Rails est mieux «&nbsp;absorbée&nbsp;» grâce à cette sorte de répétition formelle&nbsp;; vraiment, constater le parallèle de structure entre les ressources Utilisateurs et Micro-messages, même à cette étape peu avancée, est une des raisons d'être première de ce chapitre (comme nous le verrons, l'écriture d'applications plus solide que l'exemple enfantin de ce chapitre demande des efforts considérables &mdash;&nbsp;nous ne reverrons pas la ressource Micro-messages avant le <a class="ref" href="user-microposts#top">chapitre&nbsp;11</a>&nbsp;&mdash; et je ne voulais pas retarder son introduction aussi loin).</p>

<div class="label" id="sec:a_micropost_microtour"></div>


<h3><a id="sec:2.3.1" href="a-demo-app#sec:a_micropost_microtour" class="heading"><span class="number">2.3.1</span> Un petit tour du micro-message</a></h3>


<p>Comme avec la ressource utilisateurs, nous allons générer le code de l'échaffaudage de la ressource des micro-messages (<em>Microposts</em>) en utilisant le code <code>rails generate scaffold</code>, dans ce cas en implémentant le modèle de données de l'<a class="ref" href="a-demo-app#fig:demo_micropost_model">illustration&nbsp;2.3</a>:<sup class="footnote" id="fnref:2.11"><a href="#fn:2.11">11</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate scaffold Micropost content:string user_id:integer
<span class="go">      invoke  active_record</span>
<span class="go">      create    db/migrate/20100615004429_create_microposts.rb</span>
<span class="go">      create    app/models/micropost.rb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/unit/micropost_test.rb</span>
<span class="go">      create      test/fixtures/microposts.yml</span>
<span class="go">       route  resources :microposts</span>
<span class="go">      invoke  scaffold_controller</span>
<span class="go">      create    app/controllers/microposts_controller.rb</span>
<span class="go">      invoke    erb</span>
<span class="go">      create      app/views/microposts</span>
<span class="go">      create      app/views/microposts/index.html.erb</span>
<span class="go">      create      app/views/microposts/edit.html.erb</span>
<span class="go">      create      app/views/microposts/show.html.erb</span>
<span class="go">      create      app/views/microposts/new.html.erb</span>
<span class="go">      create      app/views/microposts/_form.html.erb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/functional/microposts_controller_test.rb</span>
<span class="go">      invoke    helper</span>
<span class="go">      create      app/helpers/microposts_helper.rb</span>
<span class="go">      invoke      test_unit</span>
<span class="go">      create        test/unit/helpers/microposts_helper_test.rb</span>
<span class="go">      invoke  stylesheets</span>
<span class="go">   identical    public/stylesheets/scaffold.css</span>
</pre></div>
</div>


<p>Pour actualiser notre base de données avec le nouveau modèle de données, il est nécessaire de demander une nouvelle migration comme dans la <a class="ref" href="a-demo-app#sec:demo_users_resource">section&nbsp;2.2</a>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rake db:migrate
<span class="go">==  CreateMicroposts: migrating ===============================================</span>
<span class="go">-- create_table(:microposts)</span>
<span class="go">   -&gt; 0.0023s</span>
<span class="go">==  CreateMicroposts: migrated (0.0026s) ======================================</span>
</pre></div>
</div>


<p>Maintenant nous sommes en mesure de créer des micro-messages de la même façon que nous avons créé des utilisateurs dans la <a class="ref" href="a-demo-app#sec:a_user_tour">section&nbsp;2.2.1</a>. Comme vous pouvez vous en douter, le générateur d'échaffaudage a actualisé le fichier de routage Rails avec des règles pour la ressource Microposts (<em>Micro-messages</em>), comme montré dans l'<a class="ref" href="a-demo-app#code:demo_microposts_resource">extrait&nbsp;2.7</a>.<sup class="footnote" id="fnref:2.12"><a href="#fn:2.12">12</a></sup> Comme pour les utilisateurs, la règle des routages <code>resources :microposts</code> dirige les URLs des micro-messages vers les actions correspondantes dans le contrôleur Microposts, comme présenté dans la <a class="ref" href="a-demo-app#table:demo_RESTful_microposts">table&nbsp;2.3</a>.</p>

<div class="label" id="code:demo_microposts_resource"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.7.</span> <span class="description">Le routage Rails, avec une nouvelle règle pour les ressources Microposts. <br /> <code>config/routes.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="no">DemoApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:microposts</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="table:demo_RESTful_microposts"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_left"><strong>Requête HTTP</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Action</strong></th><th class="align_left"><strong>But</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts</tt></td><td class="align_left"><code>index</code></td><td class="align_left">page listant tous les micro-messages</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts/1</tt></td><td class="align_left"><code>show</code></td><td class="align_left">page affichant le micro-message d'id <code>1</code></td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts/new</tt></td><td class="align_left"><code>new</code></td><td class="align_left">page créant une nouveau micro-message</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left"><tt>/microposts</tt></td><td class="align_left"><code>create</code></td><td class="align_left">crée le nouveau micro-message</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts/1/edit</tt></td><td class="align_left"><code>edit</code></td><td class="align_left">page pour éditer le micro-message d'id <code>1</code></td></tr><tr><td class="align_left"><tt>PUT</tt></td><td class="align_left"><tt>/microposts/1</tt></td><td class="align_left"><code>update</code></td><td class="align_left">actualiser le micro-message d'id <code>1</code></td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left"><tt>/microposts/1</tt></td><td class="align_left"><code>destroy</code></td><td class="align_left">détruire le micro-message d'id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Table 2.3: </span><span class="description">Routes RESTful fournis par la ressource Microposts resource dans l'<a class="ref" href="a-demo-app#code:demo_microposts_resource">extrait&nbsp;2.7</a>.</span></div></div>


<p>La contrôleur Microposts lui-même apparait dans sa forme schématique dans l'<a class="ref" href="a-demo-app#code:demo_microposts_controller">extrait&nbsp;2.8</a>. Notez que, hormis le <code>MicropostsController</code> à la place du <code>UsersController</code>, l'<a class="ref" href="a-demo-app#code:demo_microposts_controller">extrait&nbsp;2.8</a> est <em>identique</em> au code de l'<a class="ref" href="a-demo-app#code:demo_users_controller">extrait&nbsp;2.3</a>. C'est une conséquence de l'architecture REST commune aux deux ressources.</p>

<div class="label" id="code:demo_microposts_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.8.</span> <span class="description">Le contrôleur Microposts en forme schématique. <br /> <code>app/controllers/microposts_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Pour faire quelques micro-messages, nous entrons les informations dans la page de création des micro-messages, <a href="http://localhost:3000/microposts/new">/microposts/new</a>, comme montré dans l''<a class="ref" href="a-demo-app#fig:demo_new_micropost_rails_3">illustration&nbsp;2.12</a>.</p>

<div class="label" id="fig:demo_new_micropost_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_new_micropost_rails_3.png" alt="demo_new_micropost_rails_3" /></span></div><div class="caption"><span class="header">Illustration 2.12: </span><span class="description">La page de création du micro-message (<a href="http://localhost:3000/microposts/new">/microposts/new</a>).&nbsp;<a href="http://railstutorial.org/images/figures/demo_new_micropost-full.png">(taille normale)</a></span></div></div>


<p>À ce stade, poursuivez et créez un ou deux micro-messages, en vous assurant que l'un au moins possède un <code>user_id</code> de&nbsp;<code>1</code> pour correspondre à l'identifiant du premier utilisateur créé dans la <a class="ref" href="a-demo-app#sec:a_user_tour">section&nbsp;2.2.1</a>. Le résultat devrait s'apparenter à celui de l'<a class="ref" href="a-demo-app#fig:demo_micropost_index_rails_3">illustration&nbsp;2.13</a>.</p>

<div class="label" id="fig:demo_micropost_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_micropost_index_rails_3.png" alt="demo_micropost_index_rails_3" /></span></div><div class="caption"><span class="header">Illustration 2.13&nbsp;: </span><span class="description">La page d'index des micro-messages (<a href="http://localhost:3000/microposts">/microposts</a>).&nbsp;<a href="http://railstutorial.org/images/figures/demo_micropost_index_rails_3-full.png">(taille normale)</a></span></div></div>




<div class="label" id="sec:putting_the_micro_in_microposts"></div>


<h3><a id="sec:2.3.2" href="a-demo-app#sec:putting_the_micro_in_microposts" class="heading"><span class="number">2.3.2</span> Appliquer le <em>micro</em> aux micro-messages</a></h3>


<p>Tout <em>micro</em>-message digne de ce nom devrait avoir les moyens de faire respecter la longueur de son texte. Implémenter cette contrainte en Rails est simple avec les <em>validations</em>&nbsp;; pour acception les micro-messages d'au plus 140 caractères (à la Twitter), une utilisons une validation de longueur (<em>length</em>). À ce stade, vous devriez ouvrir le fichier <code>app/models/micropost.rb</code> dans votre éditeur de texte ou votre IDE et le remplir avec le contenu de l'<a class="ref" href="a-demo-app#code:demo_length_validation">extrait&nbsp;2.9</a> (l'utilisation de <code>validates</code> dans l'<a class="ref" href="a-demo-app#code:demo_length_validation">extrait&nbsp;2.9</a> est caractéristique de la version 3 de Rails&nbsp;; si vous avez travaillé précédemment avec Rails&nbsp;2.3, vous devriez comparer cet usage à l'utilisation de l'ancien <code>validates_length_of</code>).</p>

<div class="label" id="code:demo_length_validation"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.9.</span> <span class="description">Contraindre la longueur maximale des micro-messages à 140 caractères avec la validation de longueur. <br /> <code>app/models/micropost.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Le code de l'<a class="ref" href="a-demo-app#code:demo_length_validation">extrait&nbsp;2.9</a> peut sembler plutôt mystérieux &mdash;&nbsp;nous couvrirons la question des validations plus profondément à la <a class="ref" href="modeling-and-viewing-users-one#sec:user_validations">section&nbsp;6.2</a>&nbsp;&mdash; mais ses effets sont significatifs si nous nous rendons à la page de création des micro-messages et que nous entrons un messages de plus de 140 caractères. Comme nous pouvons le voir dans l'<a class="ref" href="a-demo-app#fig:micropost_length_error_rails_3">illustration&nbsp;2.14</a>, Rails renvoie un message d'erreur (<em>error messages</em>) indiquant que le contenu du message est trop long (nous en apprendrons plus à propos des messages d'erreur à la <a class="ref" href="sign-up#sec:signup_error_messages">section&nbsp;8.2.3</a>.)</p>

<div class="label" id="fig:micropost_length_error_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/micropost_length_error_rails_3.png" alt="micropost_length_error_rails_3" /></span></div><div class="caption"><span class="header">Illustration 2.14: </span><span class="description">Messages d'erreur à l'échec de la création d'un message.&nbsp;<a href="http://railstutorial.org/images/figures/micropost_length_error_rails_3-full.png">(taille normale)</a></span></div></div>


<div class="label" id="sec:demo_user_has_many_microposts"></div>


<h3><a id="sec:2.3.3" href="a-demo-app#sec:demo_user_has_many_microposts" class="heading"><span class="number">2.3.3</span> Un utilisateur <em>possède plusieurs</em> (<code>has_many</code>) micro-messages</a></h3>


<p>L'une des fonctionnalités les plus puissantes de Rails est la possibilité de former des <em>associations</em> entre plusieurs modèles de données. Dans le cas de notre modèle utilisateur, chaque utilisateur produit potentiellement plusieurs messages. Nous pouvons exprimer cela en code en actualisant les modèles User (<em>Utilisateur</em>) et Micropost (<em>Micro-message</em>) conformément à l'<a class="ref" href="a-demo-app#code:demo_user_has_many_microposts">extrait&nbsp;2.10</a> et l'<a class="ref" href="a-demo-app#code:demo_micropost_belongs_to_user">extrait&nbsp;2.11</a>.</p>

<div class="label" id="code:demo_user_has_many_microposts"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.10.</span> <span class="description">Un utilisateur possède plusieurs micro-messages. <br /> <code>app/models/user.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:microposts</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_micropost_belongs_to_user"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.11.</span> <span class="description">Un micro-message appartient à un utilisateur. <br /> <code>app/models/micropost.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>

  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Nous pouvons visualiser le résultat de cette association dans l'<a class="ref" href="a-demo-app#fig:micropost_user_association">illustration&nbsp;2.15</a>. Grâce à la colonne <code>user_id</code> de la table <code>microposts</code>, Rails (en utilisant Active Record) peut déduire les micro-messages associés à chaque utilisateur.</p>

<div class="label" id="fig:micropost_user_association"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/micropost_user_association.png" alt="micropost_user_association" /></span></div><div class="caption"><span class="header">Illustration 2.15: </span><span class="description">L'association entre les micro-messages et les utilisateurs.</span></div></div>


<p>Au <a class="ref" href="user-microposts#top">chapitre&nbsp;11</a> et au <a class="ref" href="following-users#top">chapitre&nbsp;12</a>, nous utiliserons l'association entre utilisateurs et micro-messages pour afficher tous les micro-messages d'un utilisateur donné et pour construire une <em>alimentation</em> à la façon de Twitter. Pour le moment, nous pouvons examiner les implications de cette association en utilisant la <em>console</em>, qui est un outil utile pour interagir avec les applications Rails. Nous invoquons tout d'abord la console avec <code>rails console</code> en ligne de commande, puis récupérons le premier utilisateur dans la base de données en tapant <code>User.first</code> (en plaçant le résultat dans la variable <code>first_user</code> &emdash;&nbsp;<em>premier_utilisateur</em>)&nbsp;:<sup class="footnote" id="fnref:2.13"><a href="#fn:2.13">13</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="n">first_user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span>
<span class="go">=&gt; #&lt;User id: 1, name: &quot;Michael Hartl&quot;, email: &quot;michael@example.org&quot;,</span>
<span class="go">created_at: &quot;2010-04-03 02:01:31&quot;, updated_at: &quot;2010-04-03 02:01:31&quot;&gt;</span>
<span class="gp">&gt;&gt; </span><span class="n">first_user</span><span class="o">.</span><span class="n">microposts</span>
<span class="go">=&gt; [#&lt;Micropost id: 1, content: &quot;First micropost!&quot;, user_id: 1, created_at:</span>
<span class="go">&quot;2010-04-03 02:37:37&quot;, updated_at: &quot;2010-04-03 02:37:37&quot;&gt;, #&lt;Micropost id: 2,</span>
<span class="go">content: &quot;Second micropost&quot;, user_id: 1, created_at: &quot;2010-04-03 02:38:54&quot;,</span>
<span class="go">updated_at: &quot;2010-04-03 02:38:54&quot;&gt;]</span>
<span class="gp">&gt;&gt; </span><span class="nb">exit</span>
</pre></div>
</div>


<p>(J'ajoute la dernière ligne pour montrer comment sortir de la console Rails, et sur la plupart des systèmes vous pouvez taper Ctrl-d pour obtenir le même résultat). Ici nous avons obtenu les micro-messages de l'utilisateur en utilisant le code <code>first_user.microposts</code>&nbsp;: grâce à ce code, Active Record retourne automatiquement tous les micro-messages dont le <code>user_id</code> est égal à l'identifiant du <code>first_user</code> (<code>1</code>, dans ce cas précis). Nous en apprendrons plus à propos des facilités des associations avec Active Record au <a class="ref" href="user-microposts#top">chapitre&nbsp;11</a> et au <a class="ref" href="following-users#top">chapitre&nbsp;12</a>.</p>

<div class="label" id="sec:inheritance_hierarchies"></div>


<h3><a id="sec:2.3.4" href="a-demo-app#sec:inheritance_hierarchies" class="heading"><span class="number">2.3.4</span> Hiérarchie des héritages</a></h3>


<p>Nous terminons notre discussion sur l'application Démo par une brève description des hiérarchies des classes contrôleur (<em>controller</em>) et modèle (<em>model</em>) dans Rails. Cette discussion n'aura vraiment de sens que si vous possédez une expérience de la programmation orientée objet (OOP)&nbsp;; si vous n'avez pas étudié l'OOP, sentez-vous libre de sauter cette section. En particulier, si vous n'êtes pas familier des <em>classes</em> (en discussion à la <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">section&nbsp;4.4</a>), je vous suggère de revenir ultérieurement à cette section.</p>

<p>Nous commençons par l'héritage de structure pour les modèles. En comparant l'<a class="ref" href="a-demo-app#code:demo_user_class">extrait&nbsp;2.12</a> et l'<a class="ref" href="a-demo-app#code:demo_micropost_class">extrait&nbsp;2.13</a>, vous voyez que le modèle User (<em>Utilisateur</em>) tout comme le modèle Micropos (<em>Micro-message</em>) hérite (via le signe&nbsp;<code>&lt;</code>) de  <code>ActiveRecord::Base</code>, qui est la classe de base pour les modèles fournis par ActiveRecord&nbsp;; un diagramme résumant cette relation est présenté par l'<a class="ref" href="a-demo-app#fig:demo_model_inheritance">illustration&nbsp;2.16</a>. C'est en héritant de <code>ActiveRecord::Base</code> que nos modèles d'objet acquièrent la faculté de communiquer avec la base de données, traitent les colonnes de cette base comme des attributs Ruby, etc.</p>

<div class="label" id="code:demo_user_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.12.</span> <span class="description">La classe-objet <code>User</code>, avec héritage. <br /> <code>app/models/user.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_micropost_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.13.</span> <span class="description">La classe-objet <code>Micropost</code>, avec héritage. <br /> <code>app/models/micropost.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="fig:demo_model_inheritance"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_model_inheritance.png" alt="demo_model_inheritance" /></span></div><div class="caption"><span class="header">illustration 2.16: </span><span class="description">La hiérarchie d'héritage pour les modèles User et Micropost.</span></div></div>


<p>La structure héritée pour les contrôleurs est juste un peu plus complexe. En comparant l'<a class="ref" href="a-demo-app#code:demo_users_controller_class">extrait&nbsp;2.14</a> avec l'<a class="ref" href="a-demo-app#code:demo_microposts_controller_class">extrait&nbsp;2.15</a>, nous voyons que le contrôleur Users (<em>Utilisateurs</em>) comme le contrôleur Microposts (<em>Micro-messages</em>) héritent du contrôleur Application. En examinant l'<a class="ref" href="a-demo-app#code:demo_application_controller_class">extrait&nbsp;2.16</a>, nous voyons que <code>ApplicationController</code> lui-même hérite de <code>ActionController::Base</code>&nbsp;; c'est la classe-objet de base pour les contrôleurs fournis par la librairie Rails Action Pack. Les relations entre ces classes sont présentées dans l'<a class="ref" href="a-demo-app#fig:demo_controller_inheritance">illustration&nbsp;2.17</a>.</p>

<div class="label" id="code:demo_users_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.14.</span> <span class="description">La classe-objet <code>UsersController</code>, avec l'héritage. <br /> <code>app/controllers/users_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_microposts_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.15.</span> <span class="description">La classe-objet <code>MicropostsController</code>, avec héritage. <br /> <code>app/controllers/microposts_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_application_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 2.16.</span> <span class="description">La classe-objet <code>ApplicationController</code>, avec héritage. <br /> <code>app/controllers/application_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="fig:demo_controller_inheritance"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_controller_inheritance.png" alt="demo_controller_inheritance" /></span></div><div class="caption"><span class="header">Illustration 2.17: </span><span class="description">La hiérarchie d'héritage pour les contrôleurs Users (<em>Utilisateurs</em>) et Microposts (<em>Micro-messages</em>).</span></div></div>


<p>Comme pour l'héritage du modèle, en héritant en fin de compte de <code>ActionController::Base</code>, le contrôleur Users tout comme le contrôleur Microposts héritent d'un grand nombre de fonctionnalités, telles que la capacité de manipuler les objets du modèle, de filtrer les requêtes HTTP entrantes, et de rendre les vues en code HTML. Puisque tous les contrôleurs Rails héritent de <code>ApplicationController</code>, les règles définies dans le contrôleur de l'application sont automatiquement appliquées à toutes les actions à l'intérieur de l'application. Par exemple, nous verrons dans la <a class="ref" href="sign-up#sec:filtering_parameter_logging">section&nbsp;8.2.4</a> comment une règle définie dans le contrôleur de l'application nous permet de filtrer tous les mots de passe de tous les fichiers, évitant ainsi l'éventualité d'un sérieux trou de sécurité.</p>

<div class="label" id="sec:deploying_the_demo_app"></div>


<h3><a id="sec:2.3.5" href="a-demo-app#sec:deploying_the_demo_app" class="heading"><span class="number">2.3.5</span> Déployer l'application Démo</a></h3>


<p>Avec l'achèvement de la ressource Micropost, il est temps à présent de «&nbsp;pusher&nbsp;» le repository vers GitHub&nbsp;:<sup class="footnote" id="fnref:2.14"><a href="#fn:2.14">14</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -a -m <span class="s2">&quot;Fin de l'application demo&quot;</span>
<span class="gp">$</span> git push
</pre></div>
</div>


<p>Vous pouvez également déployer l'application démo vers Heroku&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku create
<span class="gp">$</span> git push heroku master
<span class="gp">$</span> heroku rake db:migrate
</pre></div>
</div>


<p>(Si cela ne fonctionne pas chez vous, voyez la note juste au-dessus de l'<a class="ref" href="beginning#code:gemfile_sqlite_heroku">extrait&nbsp;1.8</a> pour une solution possible) Remarquez la ligne finale ici, qui lance la migration de la base de données sur le serveur Heroku. Cela actualise la base de données sur Herokuavec le modèle de données user/micropost nécessaire. Si vous voulez également «&nbsp;pusher&nbsp;» les données (<em>data</em>), vous pouvez le faire en utilisant le gem <tt>taps</tt> et <code>db:push</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install taps
<span class="gp">$</span> heroku db:push
</pre></div>
</div>




<h2><a id="sec:2.4" href="a-demo-app#sec:2.4" class="heading"><span class="number">2.4</span> Conclusion</a></h2>


<p>Nous sommes arrivés à la fin de la «&nbsp;vue par satellite&nbsp;» d'une application Rails. L'application Démo développée dans ce chapitre possède plusieurs points forts et une multitude de faiblesses. <br /></p>

<p><strong>Points forts</strong></p>

<ul>
<li>Aperçu général de Rails&nbsp;;</li>
<li>Introduction au principe M-V-C&nbsp;;</li>
<li>Avant goût de l'architecture REST&nbsp;;</li>
<li>Initiation à la modélisation de données&nbsp;;</li>
<li>Une application à base de données fonctionnelle, en mode production&nbsp;;<sup class="footnote" id="fnref:2.15"><a href="#fn:2.15">15</a></sup></li>
</ul>


<p><strong>Points faibles</strong></p>

<ul>
<li>Pas de mise en forme ni de style&nbsp;;</li>
<li>Pas de pages statiques (telles que la page d'accueil ou l'aide)&nbsp;;</li>
<li>Pas de mot de passe utilisateur&nbsp;;</li>
<li>Pas d'avatars utilisateurs&nbsp;;</li>
<li>Pas d'identification&nbsp;;</li>
<li>Pas de sécurité&nbsp;;</li>
<li>Pas d'association automatique entre utilisateur et micro-messages&nbsp;;</li>
<li>Pas de notion de suivi de message (du côté auteur ou lecteur)&nbsp;;</li>
<li>Pas d'<em>alimentation</em> de micro-messages&nbsp;;</li>
<li>Pas de développement conduit par le test&nbsp;;</li>
<li><strong>Pas de réelle compréhension&nbsp;;</strong></li>
</ul>


<p>La suite de ce tutoriel est dédié à la construction sur les points forts et à l'élimination systématique des points faibles.</p>

<div class="navigation">  <a class="prev_page" href="beginning#top">
    &laquo;&nbsp;<span class="number">Chapitre 1</span> De zéro au déploiement
  </a>
  <a class="next_page" href="static-pages#top">
    <span class="number">Chapitre 3</span> Pages statiques courantes&nbsp;&raquo;
  </a>
</div><div class="footnotes">
<ol>
<li id="fn:2.1">Je vous conjure de ne pas regarder de trop prêt le code généré&nbsp;; à ce niveau, il ne pourrait que vous embrouiller.&nbsp;<a class="arrow" href="#fnref:2.1">&uarr;</a></li>
<li id="fn:2.2">Rappelez-vous que la commande <code>rails</code> produit un fichier <code>.gitignore</code> par défaut, mais suivant votre système vous devrez trouver le fichier augmenté de l'<a class="ref" href="beginning#code:gitignore">extrait&nbsp;1.5</a> qui sera plus efficient.&nbsp;<a class="arrow" href="#fnref:2.2">&uarr;</a></li>
<li id="fn:2.3">En modélisant de plus longs messages, comme ceux d'un blog, vous devrez utiliser le type <code>text</code> plutôt que le type<code>string</code>.&nbsp;<a class="arrow" href="#fnref:2.3">&uarr;</a></li>
<li id="fn:2.4">Le nom de l'échaffaudage respecte la convention des <em>modèles</em> (<em>models</em>), qui sont singulier, contrairement aux ressources et aux contrôleurs, qui sont pluriel. Ainsi, nous utilisons <code>User</code> (<em>Utilisateur</em>) plutôt que <code>Users</code> (<em>Utilisateurs</em>).&nbsp;<a class="arrow" href="#fnref:2.4">&uarr;</a></li>
<li id="fn:2.5">L'identifiant de l'utilisateur est nécessaire comme <em>clé primaire</em> dans la base de données.&nbsp;<a class="arrow" href="#fnref:2.5">&uarr;</a></li>
<li id="fn:2.6">Puisque le port <tt>http://localhost:3000</tt> de l'adresse est implicite chaque fois que nous développons en local, je l'omettrai à partir de maintenant.&nbsp;<a class="arrow" href="#fnref:2.6">&uarr;</a></li>
<li id="fn:2.7">Certaines sources indiquent que la vue retourne le code HTML directement au navigateur (via un serveur web comme Apache ou Nginx). Indépendamment des détails d'implémentation, je préfère penser le contrôleur comme un hub central au travers duquel passe toutes les informations de l'application.&nbsp;<a class="arrow" href="#fnref:2.7">&uarr;</a></li>
<li id="fn:2.8">La notation étrange <code>:users</code> est <em>symbolique</em>, ce que nous aborderons dans la <a class="ref" href="rails-flavored-ruby#sec:hashes_and_symbols">section&nbsp;4.3.3</a>.&nbsp;<a class="arrow" href="#fnref:2.8">&uarr;</a></li>
<li id="fn:2.9">Le code de l'échaffaudage est laid et troublant, donc je l'ai supprimé.&nbsp;<a class="arrow" href="#fnref:2.9">&uarr;</a></li>
<li id="fn:2.10">Rappelez-vous que vous n'êtes pas supposé comprendre ce code tout de suite. Il est indiqué uniquement à titre d'illustration.&nbsp;<a class="arrow" href="#fnref:2.10">&uarr;</a></li>
<li id="fn:2.11">Comme pour l'échaffaudage de l'utilisateur, le générateur d'échaffaudage pour les micro-messages suit la convention du singulier des modèles Rails&nbsp;; ainsi, nous utilisons <code>generate Micropost</code>.&nbsp;<a class="arrow" href="#fnref:2.11">&uarr;</a></li>
<li id="fn:2.12">Le code de l'échaffaudage peut comprendre des retours à la ligne supplémentaires par rapport à l'<a class="ref" href="a-demo-app#code:demo_microposts_resource">extrait&nbsp;2.7</a>&nbsp;; ça n'est pas important, puisque Ruby ignore ces retours à la ligne.&nbsp;<a class="arrow" href="#fnref:2.12">&uarr;</a></li>
<li id="fn:2.13">Votre invite de console présentera probablement quelque chose comme  <code>ruby-1.9.2-head &gt;</code>, mais j'utiliserai <code>&gt;&gt;</code> de telle sorte que l'invite ne soit pas liée à une version de Ruby spécifique.&nbsp;<a class="arrow" href="#fnref:2.13">&uarr;</a></li>
<li id="fn:2.14">D'ordinaire, vous devriez faire des dépôts plus petits et plus fréquents, mais pour le propos de ce chapitre, un simple dépôt important conviendra parfaitement.&nbsp;<a class="arrow" href="#fnref:2.14">&uarr;</a></li>
<li id="fn:2.15">Si vous déployez votre site sur Heroku à la <a class="ref" href="a-demo-app#sec:deploying_the_demo_app">section&nbsp;2.3.5</a>.&nbsp;<a class="arrow" href="#fnref:2.15">&uarr;</a></li>
</ol>
</div>