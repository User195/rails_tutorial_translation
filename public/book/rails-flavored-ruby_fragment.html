<!--
	Chapitre : 4 Rails au goût Ruby
-->


<h1 class="contents">Contenu</h1>


<div id="table_of_contents"><ol>
<li class="chapter"><a href="beginning#top"><span class="number">Chapitre 1</span> De zéro au déploiement</a></li>
<li><ol>
<li class="section"><a href="beginning#sec:introduction"><span class="number">1.1</span> Introduction</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:comments_for_various_readers"><span class="number">1.1.1</span> Commentaires pour les lecteurs différents</a></li>
<li class="subsection"><a href="beginning#sec:1.1.2"><span class="number">1.1.2</span> &ldquo;Dimensionner&rdquo; Rails</a></li>
<li class="subsection"><a href="beginning#sec:conventions"><span class="number">1.1.3</span> Conventions utilisées dans ce livre</a></li></ol></li>
<li class="section"><a href="beginning#sec:up_and_running"><span class="number">1.2</span> [(Up and running)(En route pour le démarrage)]</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:development_tools"><span class="number">1.2.1</span> Environnements de développement</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:1.2.1.1">IDEs</a></li>
<li class="subsubsection"><a href="beginning#sec:1.2.1.2">Éditeurs de texte et lignes de commande</a></li>
<li class="subsubsection"><a href="beginning#sec:1.2.1.3">Navigateurs</a></li>
<li class="subsubsection"><a href="beginning#sec:1.2.1.4">Note à propos des outils</a></li></ol></li>
<li class="subsection"><a href="beginning#sec:rubygems"><span class="number">1.2.2</span> Ruby, RubyGems, Rails, et Git</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:rails_installer_windows">Installation de Rails (Windows)</a></li>
<li class="subsubsection"><a href="beginning#sec:install_git">Installer Git</a></li>
<li class="subsubsection"><a href="beginning#sec:install_ruby">Installer Ruby</a></li>
<li class="subsubsection"><a href="beginning#sec:install_rubygems">Installer RubyGems</a></li>
<li class="subsubsection"><a href="beginning#sec:install_rails">Installer Rails</a></li></ol></li>
<li class="subsection"><a href="beginning#sec:the_first_application"><span class="number">1.2.3</span> La première application</a></li>
<li class="subsection"><a href="beginning#sec:bundler"><span class="number">1.2.4</span> Bundler</a></li>
<li class="subsection"><a href="beginning#sec:rails_server"><span class="number">1.2.5</span> <code>Le serveur rails (rails server)</code></a></li>
<li class="subsection"><a href="beginning#sec:mvc"><span class="number">1.2.6</span> Modèles-Vue-Contrôleur (MVC)</a></li></ol></li>
<li class="section"><a href="beginning#sec:version_control"><span class="number">1.3</span> Contrôle de versions avec Git</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:git_setup"><span class="number">1.3.1</span> Installation et réglages</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:1.3.1.1">Initialisation des réglages système</a></li>
<li class="subsubsection"><a href="beginning#sec:1.3.1.2">Initialisation des réglages du dépôt (repository)</a></li></ol></li>
<li class="subsection"><a href="beginning#sec:adding_and_committing"><span class="number">1.3.2</span> Ajout et mandat de dépôt</a></li>
<li class="subsection"><a href="beginning#sec:1.3.3"><span class="number">1.3.3</span> Qu'est-ce que Git peut faire de bien pour vous&nbsp;?</a></li>
<li class="subsection"><a href="beginning#sec:github"><span class="number">1.3.4</span> GitHub</a></li>
<li class="subsection"><a href="beginning#sec:git_commands"><span class="number">1.3.5</span> Branch, edit, commit, merge</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:git_branch">Branch</a></li>
<li class="subsubsection"><a href="beginning#sec:git_edit">Edit</a></li>
<li class="subsubsection"><a href="beginning#sec:git_commit">Commit</a></li>
<li class="subsubsection"><a href="beginning#sec:git_merge">Merge</a></li>
<li class="subsubsection"><a href="beginning#sec:git_push">Push</a></li></ol></li></ol></li>
<li class="section"><a href="beginning#sec:deploying"><span class="number">1.4</span> Déploiement</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:1.4.1"><span class="number">1.4.1</span> Réglages Heroku</a></li>
<li class="subsection"><a href="beginning#sec:heroku_step_one"><span class="number">1.4.2</span> déploiement Heroku, première étape</a></li>
<li class="subsection"><a href="beginning#sec:1.4.3"><span class="number">1.4.3</span> Déploiement Heroku deployment, seconde étape</a></li>
<li class="subsection"><a href="beginning#sec:heroku_commands"><span class="number">1.4.4</span> Commandes Heroku</a></li></ol></li>
<li class="section"><a href="beginning#sec:beginning_conclusion"><span class="number">1.5</span> Conclusion</a></li></ol></li>
<li class="chapter"><a href="a-demo-app#top"><span class="number">Chapitre 2</span> Une application démo</a></li>
<li><ol>
<li class="section"><a href="a-demo-app#sec:planning_the_application"><span class="number">2.1</span> Planifier l'application</a></li>
<li><ol>
<li class="subsection"><a href="a-demo-app#sec:modeling_users"><span class="number">2.1.1</span> Modéliser les utilisateurs</a></li>
<li class="subsection"><a href="a-demo-app#sec:modeling_microposts"><span class="number">2.1.2</span> Modéliser les micro-messages</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec:demo_users_resource"><span class="number">2.2</span> La ressource Utilisateurs (Users)</a></li>
<li><ol>
<li class="subsection"><a href="a-demo-app#sec:a_user_tour"><span class="number">2.2.1</span> Un tour de l'utilisateur</a></li>
<li class="subsection"><a href="a-demo-app#sec:mvc_in_action"><span class="number">2.2.2</span> MVC en action</a></li>
<li class="subsection"><a href="a-demo-app#sec:weaknesses_of_this_users_resource"><span class="number">2.2.3</span> Faiblesses de la ressource Utilisateurs (Users)</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec:microposts_resource"><span class="number">2.3</span> La ressource Micro-messages (Microposts)</a></li>
<li><ol>
<li class="subsection"><a href="a-demo-app#sec:a_micropost_microtour"><span class="number">2.3.1</span> Un petit tour du micro-message</a></li>
<li class="subsection"><a href="a-demo-app#sec:putting_the_micro_in_microposts"><span class="number">2.3.2</span> Appliquer le <em>micro</em> aux micro-messages</a></li>
<li class="subsection"><a href="a-demo-app#sec:demo_user_has_many_microposts"><span class="number">2.3.3</span> Un utilisateur <code>has_many</code> (<code>possède plusieurs</code>) micro-messages</a></li>
<li class="subsection"><a href="a-demo-app#sec:inheritance_hierarchies"><span class="number">2.3.4</span> Hiérarchie des héritages</a></li>
<li class="subsection"><a href="a-demo-app#sec:deploying_the_demo_app"><span class="number">2.3.5</span> Déployer l'application Démo</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec:2.4"><span class="number">2.4</span> Conclusion</a></li></ol></li>
<li class="chapter"><a href="static-pages#top"><span class="number">Chapitre 3</span> Pages statiques courantes</a></li>
<li><ol>
<li class="section"><a href="static-pages#sec:static_pages"><span class="number">3.1</span> Pages statiques</a></li>
<li><ol>
<li class="subsection"><a href="static-pages#sec:truly_static_pages"><span class="number">3.1.1</span> Pages HTML statiques</a></li>
<li class="subsection"><a href="static-pages#sec:static_pages_with_rails"><span class="number">3.1.2</span> Les pages statiques avec Rails</a></li></ol></li>
<li class="section"><a href="static-pages#sec:first_tests"><span class="number">3.2</span> Premiers tests</a></li>
<li><ol>
<li class="subsection"><a href="static-pages#sec:testing_tools"><span class="number">3.2.1</span> Outils de test</a></li>
<li><ol>
<li class="subsubsection"><a href="static-pages#sec:autotest">Auto-test</a></li></ol></li>
<li class="subsection"><a href="static-pages#sec:TDD"><span class="number">3.2.2</span> TDD : Rouge, Vert, Refactor</a></li>
<li><ol>
<li class="subsubsection"><a href="static-pages#sec:spork">Spork</a></li>
<li class="subsubsection"><a href="static-pages#sec:red">Rouge</a></li>
<li class="subsubsection"><a href="static-pages#sec:green">Vert</a></li>
<li class="subsubsection"><a href="static-pages#sec:refactor">Refactor</a></li></ol></li></ol></li>
<li class="section"><a href="static-pages#sec:slightly_dynamic_pages"><span class="number">3.3</span> Pages (un peu) dynamiques</a></li>
<li><ol>
<li class="subsection"><a href="static-pages#sec:testing_a_title_change"><span class="number">3.3.1</span> Test d'un changement de titre</a></li>
<li class="subsection"><a href="static-pages#sec:passing_title_tests"><span class="number">3.3.2</span> Réussir les tests de titre</a></li>
<li class="subsection"><a href="static-pages#sec:instance_variables_embedded_ruby"><span class="number">3.3.3</span> Variables d'instance et Ruby embarqué</a></li>
<li class="subsection"><a href="static-pages#sec:layouts"><span class="number">3.3.4</span> Supprimer les répétitions avec les <em>layouts</em></a></li></ol></li>
<li class="section"><a href="static-pages#sec:static_pages_conclusion"><span class="number">3.4</span> Conclusion</a></li>
<li class="section"><a href="static-pages#sec:static_pages_Exercices"><span class="number">3.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="rails-flavored-ruby#top"><span class="number">Chapitre 4</span> Rails au goût Ruby</a></li>
<li><ol>
<li class="section"><a href="rails-flavored-ruby#sec:motivation"><span class="number">4.1</span> Motivation</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:title_helper"><span class="number">4.1.1</span> Un « helper » (« aideur ») pour le titre (<code>title</code>)</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:cascading_style_sheets"><span class="number">4.1.2</span> Feuilles de styles (CSS — Cascading Style Sheets)</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:strings_and_methods"><span class="number">4.2</span> Chaines de caractères et méthodes</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:comments"><span class="number">4.2.1</span> Commentaires</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:strings"><span class="number">4.2.2</span> Chaines de caractères</a></li>
<li><ol>
<li class="subsubsection"><a href="rails-flavored-ruby#sec:printing">Impression</a></li>
<li class="subsubsection"><a href="rails-flavored-ruby#sec:single_quoted_strings">Chaines de caractères « single-quoté »</a></li></ol></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:objects_and_message_passing"><span class="number">4.2.3</span> Objets et passage de message</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:method_definitions"><span class="number">4.2.4</span> Définition de méthode</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:back_to_the_title_helper"><span class="number">4.2.5</span> Retour à l'« helper » de titre</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:other_data_structures"><span class="number">4.3</span> Autres structures de données</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:arrays_and_ranges"><span class="number">4.3.1</span> Tableaux et rangs</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:blocks"><span class="number">4.3.2</span> Blocs</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:hashes_and_symbols"><span class="number">4.3.3</span> Tables de hachage et symboles</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:css_revisited"><span class="number">4.3.4</span> CSS revisitées</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:ruby_classes"><span class="number">4.4</span> Classes Ruby</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:constructors"><span class="number">4.4.1</span> Constructeurs</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:a_class_of_our_own"><span class="number">4.4.2</span> Héritages de classes</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:modifying_built_in_classes"><span class="number">4.4.3</span> Modifier les classes d'origine</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:a_controller_class"><span class="number">4.4.4</span> Classe de contrôleur</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:a_user_class"><span class="number">4.4.5</span> Classe utiliateur</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:Exercices"><span class="number">4.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="filling-in-the-layout#top"><span class="number">Chapitre 5</span> Poursuivre la mise en page</a></li>
<li><ol>
<li class="section"><a href="filling-in-the-layout#sec:structure"><span class="number">5.1</span> Ajout de structure</a></li>
<li><ol>
<li class="subsection"><a href="filling-in-the-layout#sec:adding_to_the_layout"><span class="number">5.1.1</span> Navigation du site</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:custom_css"><span class="number">5.1.2</span> Personnalisation CSS</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:partials"><span class="number">5.1.3</span> Partiels (Partials)</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec:layout_links"><span class="number">5.2</span> Liens pour la mise en page</a></li>
<li><ol>
<li class="subsection"><a href="filling-in-the-layout#sec:integration_tests"><span class="number">5.2.1</span> Test d'intégration</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:rails_routes"><span class="number">5.2.2</span> Routes Rails</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:named_routes"><span class="number">5.2.3</span> Nommer les routes</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec:user_signup"><span class="number">5.3</span> Inscription de l'utilisateur : une première étape</a></li>
<li><ol>
<li class="subsection"><a href="filling-in-the-layout#sec:users_controller"><span class="number">5.3.1</span> Contrôleur Utilisateur (Users controller)</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:signup_url"><span class="number">5.3.2</span> URL d'inscription</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec:layout_conclusion"><span class="number">5.4</span> Conclusion</a></li>
<li class="section"><a href="filling-in-the-layout#sec:layout_Exercices"><span class="number">5.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="modeling-and-viewing-users-one#top"><span class="number">Chapitre 6</span> Modéliser et afficher les utilisateurs, partie I</a></li>
<li><ol>
<li class="section"><a href="modeling-and-viewing-users-one#sec:user_model"><span class="number">6.1</span> Modèle utilisateur (User model)</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:database_migrations"><span class="number">6.1.1</span> Migrations de la base de données</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:the_model_file"><span class="number">6.1.2</span> Le fichier modèle</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:model_annotation">[(Model annotation)]</a></li>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:accessible_attributes">Attributs accessibles</a></li></ol></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:creating_user_objects"><span class="number">6.1.3</span> Créer des objets Utilisateur</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:finding_user_objects"><span class="number">6.1.4</span> Recherche dans les objets Utilisateurs (Users)</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:updating_user_objects"><span class="number">6.1.5</span> Actualisation des objets Utilisateurs (Users)</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:user_validations"><span class="number">6.2</span> Validations utilisateur</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:presence_validation"><span class="number">6.2.1</span> Valider l'existence</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:length_validation"><span class="number">6.2.2</span> Valider la longueur</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:format_validation"><span class="number">6.2.3</span> Valider le format</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:uniqueness_validation"><span class="number">6.2.4</span> Valider l'unicité</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:the_caveat">L'avertissement d'unicité</a></li></ol></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:viewing_users"><span class="number">6.3</span> Afficher les utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:rails_environments"><span class="number">6.3.1</span> Débuggage et environnements Rails</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:users_show"><span class="number">6.3.2</span> Modèle, Vue et Contrôleur Utilisateur</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:a_users_resource"><span class="number">6.3.3</span> Ressource Utilisateurs</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:params_in_debug">[(<code>params</code> in <code>debug</code>)]</a></li></ol></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:6.4"><span class="number">6.4</span> Conclusion</a></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:6.5"><span class="number">6.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="modeling-and-viewing-users-two#top"><span class="number">Chapitre 7</span> Modéliser et afficher les utilisateurs, partie II</a></li>
<li><ol>
<li class="section"><a href="modeling-and-viewing-users-two#sec:insecure_passwords"><span class="number">7.1</span> Mots de passe non sûrs</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_validations"><span class="number">7.1.1</span> Valider le mot de passe</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_migration"><span class="number">7.1.2</span> Migrer un mot de passe</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_active_record_callback"><span class="number">7.1.3</span> Un <em>callback</em> de l'Active Record</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:secure_passwords"><span class="number">7.2</span> Sécuriser les mots de passe</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_secure_password_test"><span class="number">7.2.1</span> Test de mot de passe sûr</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:secure_password_theory"><span class="number">7.2.2</span> Un peu de théorie sur la sécurisation des mots de passe</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:implementing_has_password"><span class="number">7.2.3</span> Implémenter la méthode <code>has_password?</code></a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_authenticate_method"><span class="number">7.2.4</span> Méthode d'authentification</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:better_user_views"><span class="number">7.3</span> Meilleures vues d'utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:tests_with_factories"><span class="number">7.3.1</span> Tester la page de l'utilisateur (avec <em>factories</em>)</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_name_and_a_gravatar"><span class="number">7.3.2</span> Un nom et un Gravatar</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-two#sec:a_gravatar_helper">Un « helper » de Gravatar</a></li></ol></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_user_sidebar"><span class="number">7.3.3</span> Une barre utilisateur latérale</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:7.4"><span class="number">7.4</span> Conclusion</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:7.4.1"><span class="number">7.4.1</span> Dépôt Git</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:heroku_deploy"><span class="number">7.4.2</span> Déploiement Heroku</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:more_modeling_users_Exercices"><span class="number">7.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="sign-up#top"><span class="number">Chapitre 8</span> Inscription</a></li>
<li><ol>
<li class="section"><a href="sign-up#sec:signup_form"><span class="number">8.1</span> Formulaire d'inscription</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:using_form_for"><span class="number">8.1.1</span> Utiliser  <code>form_for</code></a></li>
<li class="subsection"><a href="sign-up#sec:the_form_html"><span class="number">8.1.2</span> Le formulaire HTML</a></li></ol></li>
<li class="section"><a href="sign-up#sec:signup_failure"><span class="number">8.2</span> Échec de l'inscription</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:testing_failure"><span class="number">8.2.1</span> Test de l'échec</a></li>
<li class="subsection"><a href="sign-up#sec:a_working_form"><span class="number">8.2.2</span> Un formulaire fonctionnel</a></li>
<li class="subsection"><a href="sign-up#sec:signup_error_messages"><span class="number">8.2.3</span> Inscription&nbsp;: messages d'erreur</a></li>
<li class="subsection"><a href="sign-up#sec:filtering_parameter_logging"><span class="number">8.2.4</span> Filtrer les paramètres d'identification</a></li></ol></li>
<li class="section"><a href="sign-up#sec:signup_success"><span class="number">8.3</span> Succès de l'inscription</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:testing_success"><span class="number">8.3.1</span> Tester le succès de l'inscription</a></li>
<li class="subsection"><a href="sign-up#sec:the_finished_signup_form"><span class="number">8.3.2</span> Le formulaire d'inscription finalisé</a></li>
<li class="subsection"><a href="sign-up#sec:the_flash"><span class="number">8.3.3</span> Le message «&nbsp;flash&nbsp;»</a</a></li>
<li class="subsection"><a href="sign-up#sec:the_first_signup"><span class="number">8.3.4</span> La première inscription</a></li></ol></li>
<li class="section"><a href="sign-up#sec:rspec_integration_tests"><span class="number">8.4</span> Test d'intégration RSpec</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:integration_tests_with_style"><span class="number">8.4.1</span> Tests d'intégration avec les styles</a></li>
<li class="subsection"><a href="sign-up#sec:failed_signup"><span class="number">8.4.2</span> Un échec d'inscription ne devrait pas créer un nouvel utilisateur</a></li>
<li class="subsection"><a href="sign-up#sec:successful_signup"><span class="number">8.4.3</span> Le succès d'une inscription devrait créer un nouvel utilisateur</a></li></ol></li>
<li class="section"><a href="sign-up#sec:8.5"><span class="number">8.5</span> Conclusion</a></li>
<li class="section"><a href="sign-up#sec:signup_Exercices"><span class="number">8.6</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="sign-in-sign-out#top"><span class="number">Chapitre 9</span> Connexion, déconnexion</a></li>
<li><ol>
<li class="section"><a href="sign-in-sign-out#sec:sessions"><span class="number">9.1</span> Les sessions</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:sessions_controller"><span class="number">9.1.1</span> Le contrôleur de session</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:signin_form"><span class="number">9.1.2</span> Formulaire d'identification</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:signin_failure"><span class="number">9.2</span> Échec de l'identification</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:reviewing_form_submission"><span class="number">9.2.1</span> Examen de la soumission du formulaire</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:failed_signin"><span class="number">9.2.2</span> Échec de l'identification (test et code)</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:signin_success"><span class="number">9.3</span> Succès de l'identification</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:the_completed_create_action"><span class="number">9.3.1</span> L'action <code>create</code> («&nbsp;créer&nbsp;») finalisée</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:remember_me"><span class="number">9.3.2</span> Se souvenir de moi</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:current_user"><span class="number">9.3.3</span> Utilisateur courant</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:signing_out"><span class="number">9.4</span> Déconnexion</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:destroying_sessions"><span class="number">9.4.1</span> Détruire la session</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:signin_upon_signup"><span class="number">9.4.2</span> Connection à l'inscription</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:changing_the_layout_links"><span class="number">9.4.3</span> Changement des liens de la mise en plage</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:signin_out_integration_tests"><span class="number">9.4.4</span> Test d'intégration de l'identification/déconnexion</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:9.5"><span class="number">9.5</span> Conclusion</a></li>
<li class="section"><a href="sign-in-sign-out#sec:sign_in_out_Exercices"><span class="number">9.6</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="updating-showing-and-deleting-users#top"><span class="number">Chapitre 10</span> Actualiser, afficher et supprimer des utilisateurs</a></li>
<li><ol>
<li class="section"><a href="updating-showing-and-deleting-users#sec:updating_users"><span class="number">10.1</span> Actualiser l'utilisateur</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:edit_form"><span class="number">10.1.1</span> Formulaire de modification</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:enabling_edits"><span class="number">10.1.2</span> Permettre les modifications</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:protecting_pages"><span class="number">10.2</span> Protéger les pages</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_signed_in_users"><span class="number">10.2.1</span> Utilisateurs identifiés requis</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_the_right_user"><span class="number">10.2.2</span> Nécessité du bon utilisateur</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:friendly_forwarding"><span class="number">10.2.3</span> Redirection conviviale</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:showing_users"><span class="number">10.3</span> Afficher les utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:user_index"><span class="number">10.3.1</span> Liste des utilisateurs</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:sample_users"><span class="number">10.3.2</span> Exemples d'utilisateurs</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:pagination"><span class="number">10.3.3</span> Pagination</a></li>
<li><ol>
<li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:testing_pagination">Test de la pagination</a></li></ol></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:partial_refactoring"><span class="number">10.3.4</span> Restructuration des partielles</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:destroying_users"><span class="number">10.4</span> Supprimer des utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:administrative_users"><span class="number">10.4.1</span> Utilisateurs administrateurs</a></li>
<li><ol>
<li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:revisiting_attr_accessible">Révision de <code>attr_accessible</code></a></li></ol></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:the_destroy_action"><span class="number">10.4.2</span> L'action <code>destroy</code> («&nbsp;supprimer&nbsp;»)</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:10.5"><span class="number">10.5</span> Conclusion</a></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:updating_deleting_Exercices"><span class="number">10.6</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="user-microposts#top"><span class="number">Chapitre 11</span> Micro-messages d'utilisateur</a></li>
<li><ol>
<li class="section"><a href="user-microposts#sec:a_micropost_model"><span class="number">11.1</span> Le modèle Micropost («&nbsp;Micro-message&nbsp;»)</a></li>
<li><ol>
<li class="subsection"><a href="user-microposts#sec:the_basic_model"><span class="number">11.1.1</span> Le modèle initial</a></li>
<li><ol>
<li class="subsubsection"><a href="user-microposts#sec:accessible_attribute">Attributs accessibles</a></li></ol></li>
<li class="subsection"><a href="user-microposts#sec:user_micropost_associations"><span class="number">11.1.2</span> Associations Utilisateur/micro-messages</a></li>
<li class="subsection"><a href="user-microposts#sec:ordering_and_dependency"><span class="number">11.1.3</span> Affinements du micro-message</a></li>
<li><ol>
<li class="subsubsection"><a href="user-microposts#sec:default_scope">Portée par défaut</a></li>
<li class="subsubsection"><a href="user-microposts#sec:dependent_destroy">Dependent: destroy (dépendances de la suppression)</a></li></ol></li>
<li class="subsection"><a href="user-microposts#sec:micropost_validations"><span class="number">11.1.4</span> Validations du micro-message</a></li></ol></li>
<li class="section"><a href="user-microposts#sec:showing_microposts"><span class="number">11.2</span> Afficher les micro-messages</a></li>
<li><ol>
<li class="subsection"><a href="user-microposts#sec:augmenting_the_user_show_page"><span class="number">11.2.1</span> Etoffement de la page de l'utilisateur</a></li>
<li class="subsection"><a href="user-microposts#sec:sample_microposts"><span class="number">11.2.2</span> Exemples de micro-messages</a></li></ol></li>
<li class="section"><a href="user-microposts#sec:manipulating_microposts"><span class="number">11.3</span> Manipuler les micro-messages</a></li>
<li><ol>
<li class="subsection"><a href="user-microposts#sec:access_control"><span class="number">11.3.1</span> Contrôle de l'accès</a></li>
<li class="subsection"><a href="user-microposts#sec:creating_microposts"><span class="number">11.3.2</span> Créer des micro-messages</a></li>
<li class="subsection"><a href="user-microposts#sec:a_proto_feed"><span class="number">11.3.3</span> Une proto-alimentation</a></li>
<li class="subsection"><a href="user-microposts#sec:destroying_microposts"><span class="number">11.3.4</span> Supprimer des micro-messages</a></li>
<li class="subsection"><a href="user-microposts#sec:testing_the_new_home_page"><span class="number">11.3.5</span> Test de la nouvelle page d'accueil</a></li></ol></li>
<li class="section"><a href="user-microposts#sec:11.4"><span class="number">11.4</span> Conclusion</a></li>
<li class="section"><a href="user-microposts#sec:micropost_Exercices"><span class="number">11.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="following-users#top"><span class="number">Chapitre 12</span> Suivi des utilisateurs</a></li>
<li><ol>
<li class="section"><a href="following-users#sec:the_relationship_model"><span class="number">12.1</span> Le modèle Relation (Relationship model)</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:a_problem_with_the_data_model"><span class="number">12.1.1</span> Un problème du modèle de données (et sa solution)</a></li>
<li class="subsection"><a href="following-users#sec:relationship_user_associations"><span class="number">12.1.2</span> Associations Utilisateur/Relations</a></li>
<li class="subsection"><a href="following-users#sec:relationship_validations"><span class="number">12.1.3</span> Validations</a></li>
<li class="subsection"><a href="following-users#sec:following"><span class="number">12.1.4</span> Auteurs suivis</a></li>
<li class="subsection"><a href="following-users#sec:followers"><span class="number">12.1.5</span> Lecteurs</a></li></ol></li>
<li class="section"><a href="following-users#sec:a_web_interface_for_following_and_followers"><span class="number">12.2</span> Une interface web pour les auteurs suivis et les lecteurs</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:sample_following_data"><span class="number">12.2.1</span> Exemple de donnée de suivi</a></li>
<li class="subsection"><a href="following-users#sec:stats_and_a_follow_form"><span class="number">12.2.2</span> Statistiques et formulaire de suivi</a></li>
<li class="subsection"><a href="following-users#sec:following_and_followers_pages"><span class="number">12.2.3</span> Pages d'auteurs suivis et de lecteurs</a></li>
<li class="subsection"><a href="following-users#sec:a_working_follow_button_the_standard_way"><span class="number">12.2.4</span> Un bouton de suivi fonctionnant de façon standard</a></li>
<li class="subsection"><a href="following-users#sec:a_working_follow_button_with_ajax"><span class="number">12.2.5</span> Un bouton fonctionnant avec Ajax</a></li></ol></li>
<li class="section"><a href="following-users#sec:the_status_feed"><span class="number">12.3</span> L'état de l'alimention</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:motivation_and_strategy"><span class="number">12.3.1</span> Motivation et stratégie</a></li>
<li class="subsection"><a href="following-users#sec:a_first_feed_implementation"><span class="number">12.3.2</span> Une première implémentation de peuplement</a></li>
<li class="subsection"><a href="following-users#sec:scopes_subselects_and_a_lambda"><span class="number">12.3.3</span> Portées, sous-requêtes et fonction <em>lambda</em></a></li>
<li class="subsection"><a href="following-users#sec:the_new_status_feed"><span class="number">12.3.4</span> Nouvel état de l'alimentation</a></li></ol></li>
<li class="section"><a href="following-users#sec:following_conclusion"><span class="number">12.4</span> Conclusion</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:extensions_to_the_sample_application"><span class="number">12.4.1</span> Extensions de l'application exemple</a></li>
<li><ol>
<li class="subsubsection"><a href="following-users#sec:replies">Réponses</a></li>
<li class="subsubsection"><a href="following-users#sec:messaging">Notification</a></li>
<li class="subsubsection"><a href="following-users#sec:follower_notifications">Notifications aux lecteurs</a></li>
<li class="subsubsection"><a href="following-users#sec:password_reminders">Rappel du mot de passe</a></li>
<li class="subsubsection"><a href="following-users#sec:signup_confirmation">Confirmation d'inscription</a></li>
<li class="subsubsection"><a href="following-users#sec:rss_feed">Alimentation RSS</a></li>
<li class="subsubsection"><a href="following-users#sec:rest_api">REST API</a></li>
<li class="subsubsection"><a href="following-users#sec:search">Recherche</a></li></ol></li>
<li class="subsection"><a href="following-users#sec:guide_to_further_resources"><span class="number">12.4.2</span> Guide vers d'autres ressources</a></li></ol></li>
<li class="section"><a href="following-users#sec:following_Exercices"><span class="number">12.5</span> Exercices</a></li></ol></li></ol></div>


<div id="main_content"></div>

<p> <span class="preamble">
 <span id="foreword">
<strong> Avant-propos</strong> <br />
 </span>
 </span></p>

<p>Ma précédente compagnie (CD Baby) fut une des premières à basculer intégralement vers Ruby on Rails, et à rebasculer aussi intégralement vers PHP (googlez-moi si vous voulez prendre la mesure du drame). On m'a tellement recommandé ce livre Michael Hartl que je n'ai pu faire autrement que de le lire. C'est ainsi que le <em>Tutoriel Ruby on Rails</em> m'a fait revenir à nouveau à Rails.</p>
<p>Bien qu'ayant parcouru de nombreux livres sur Rails, c'est ce tutoriel-là qui m'a véritablement «&nbsp;mis en possession&nbsp;» de Rails. Tout est fait ici «&nbsp;à la manière de Rails&nbsp;» —&nbsp;une manière qui ne m'avait jamais semblé naturelle avant que je ne lise ce livre. C'est aussi le seul ouvrage sur Rails qui met en place, d'un bout à l'autre, un <em>Développement Dirigé par les Tests</em> (<em>Test-Driven Development</em>), une approche que je savais hautement recommandée par les experts mais dont je n'avais jamais compris aussi bien la pertinence que dans ce livre. Enfin, en incluant Git, GitHub et Heroku dans les exemples de la démonstration, l'auteur vous donne vraiment le goût de ce qu'est le développement d'un projet dans la vie réelle. Et le exemples de code ne sont pas en reste.</p> 
	
<p>La narration linéaire adoptée par ce tutoriel est vraiment un bon format. Personnellement, j'ai étudié <em>Le Tutoriel Rails</em> en trois longues journées, en faisant tous les exemples et les exercices proposés à la fin de chaque chapitre. C'est en lisant ce livre du début à la fin, sans sauter la moindre partie, qu'on en tire tout le bénéfice.</p>

<p>Régalez-vous&nbsp;!</p>

<p><a href="http://sivers.org/">Derek Sivers</a> (<a href="http://sivers.org/">sivers.org</a>) <br />
<em>Précédemment&nbsp;: Fondateur de </em> <a href="http://www.cdbaby.com/"><em>CD Baby</em></a> <br />
<em>Actuellement&nbsp;: Fondateur de </em> <a href="http://thoughts.pro/"><em>Thoughts Ltd.</em></a> <br /></p>

<p> <span class="preamble">
<strong> Remerciements</strong> <br />
 </span></p>

<p>Ce <em>Tutoriel Ruby on Rails</em> doit beaucoup à mon livre précédent sur Rails, <em>RailsSpace</em>, et donc à mon co-auteur <a href="http://aure.com/">Aurelius Prochazka</a>. J'aimerais remercier Aure à la fois pour le travail qu'il a accompli sur ce précédent livre et pour son soutien pour le présent ouvrage. J'aimerais aussi remercier Debra Williams Cauley, mon éditeur pour les deux ouvrages&nbsp;; aussi longtemps qu'elle jouera avec moi au baseball, je continuerai d'écrire des livres pour elle.</p>

<p>J'aimerais remercier une longue liste de Rubyistes qui m'ont parlé et inspiré au cours des années&nbsp;: David Heinemeier Hansson, Yehuda Katz, Carl Lerche, Jeremy Kemper, Xavier Noria, Ryan Bates, Geoffrey Grosenbach, Peter Cooper, Matt Aimonetti, Gregg Pollack, Wayne&nbsp;E. Seguin, Amy Hoy, Dave Chelimsky, Pat Maddox, Tom Preston-Werner, Chris Wanstrath, Chad Fowler, Josh Susser, Obie Fernandez, Ian McFarland, Steven Bristol, Giles Bowkett, Evan Dorn, Long Nguyen, James Lindenbaum, Adam Wiggins, Tikhon Bernstam, Ron Evans, Wyatt Greene, Miles Forrest, les gens bien de Pivotal Labs, le gang Heroku, les mecs de thoughtbot et l'équipe de GitHub. Enfin, tellement, tellement, tellement de lecteurs —&nbsp;beaucoup trop pour les citer tous&nbsp;— qui ont contribué par leur rapport de bogues et leurs suggestions durant l'écriture de ce livre, et je tiens à saluer leur aide sans laquelle ce livre ne serait pas ce qu'il est. <br /></p>

<p> <span class="preamble">
 <span id="author">
<strong> À propos de l'auteur</strong> <br />
 </span>
 </span></p>

<p><a href="http://michaelhartl.com/">Michael Hartl</a> est programmeur, éducateur et entrepreneur. Il est le co-auteur de <em>RailsSpace</em>, un tutoriel Rails publié en 2007, et a été co-fondateur et développeur en chef de <a href="http://insoshi.com/">Insoshi</a>, une plateforme de réseau social <a href="http://github.com/popular/forked">populaire</a> en Ruby on Rails. Précédement, il a enseigné la théorie et la physique informatique au <a href="http://www.caltech.edu/">California Institute of Technology</a> (Caltech), où il a reçu le Lifetime Achievement Award for Excellence en enseignement. Michael est diplômé du <a href="http://college.harvard.edu/">Harvard College</a>, a un <a href="http://resolver.caltech.edu/CaltechETD:etd-05222003-161626">Ph.D. en physique</a> (un doctorat. NdT) de <a href="http://www.caltech.edu/">Caltech</a>, et il est ancien élève du programme des entrepreneurs <a href="http://ycombinator.com/">Y&nbsp;Combinator</a>. <br /></p>

<p> <span id="license" class="preamble">
<strong> Copyright et license</strong> <br />
 </span></p>

<p><em>Le Tutoriel Ruby on Rails&nbsp;: apprendre Rails par l'exemple</em>. Copyright &copy; 2010 par Michael Hartl. Tout le code source du <em>Tutoriel Ruby on Rails</em> est disponible sous la license <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> et la licence <a href="http://en.wikipedia.org/wiki/Beerware">Beerware License</a>.</p>

<pre class="verbatim">   Copyright (c) 2010 Michael Hartl

   Permission est accordée, à titre gratuit, à toute personne obtenant
   une copie de ce logiciel et la documentation associée, pour faire des 
   modification dans le logiciel sans restriction et sans limitation des
   droits d’utiliser, copier, modifier, fusionner, publier, distribuer,
   concéder sous licence, et / ou de vendre les copies du Logiciel, et à
   autoriser les personnes auxquelles le Logiciel est meublé de le faire, 
   sous réserve des conditions suivantes:

   L’avis de copyright ci-dessus et cette autorisation doit être inclus
   dans toutes les copies ou parties substantielles du Logiciel.

   LE LOGICIEL EST FOURNI «TEL QUEL», SANS GARANTIE D’AUCUNE SORTE, 
   EXPLICITE OU IMPLICITE, Y COMPRIS, MAIS SANS S’Y LIMITER, LES 
   GARANTIES DE QUALITÉ MARCHANDE, ADAPTATION À UN USAGE PARTICULIER ET
   D’ABSENCE DE CONTREFAÇON. EN AUCUN CAS LES AUTEURS OU TITULAIRES DU
   ETRE TENU RESPONSABLE DE TOUT DOMMAGE, RÉCLAMATION OU AUTRES
   RESPONSABILITÉ, SOIT DANS UNE ACTION DE CONTRAT, UN TORT OU AUTRE,
   PROVENANT DE, DE OU EN RELATION AVEC LE LOGICIEL OU L’UTILISATION OU
   DE TRANSACTIONS AUTRES LE LOGICIEL.
	
</pre>




<pre class="verbatim">/*
 * ------------------------------------------------------------
 * &quot;LA LICENCE BEERWARE&quot; (Révision 42)&nbsp;:
 * Michael Hartl a écrit ce code. Aussi longtemps que vous
 * conservez cette note, vous pouvez faire ce que vous voulez
 * de ce travail. Si nous nous rencontrons un jour, et que vous
 * pensez que ce travail en vaut la peine, vous pourrez me
 * payer une bière en retour.
 * ------------------------------------------------------------
 */</pre>



<div id="top"></div>


<h1 class="chapitre"><a id="sec:4" href="rails-flavored-ruby#top" class="heading"><span class="number">chapitre 4</span> Rails au goût Ruby</a></h1>


<p>En s'appuyant sur les exemples du <a class="ref" href="static-pages#top">chapitre&nbsp;3</a>, ce chapitre explore quelques éléments Ruby importants pour Rails. Ruby est un vaste langage, mais heureusement le sous-ensemble nécessaire pour être productif en tant que développeur Rails est relativement limité. Plus encore, ce sous-ensemble est  <em>différent</em> de l'approche habituelle de l'apprentissage de Ruby, ce pourquoi, si votre but est de construire des applications web dynamiques, je recommande d'apprendre Rails d'abord, en picorant quelques éléments Ruby chemin faisant. Pour devenir un <em>expert</em> Rails, vous avez besoin de comprendre Ruby plus profondément, et ce livre vous donne de solides fondations sur lesquelles former cette expertise. Comme indiqué à la <a class="ref" href="beginning#sec:comments_for_various_readers">section&nbsp;1.1.1</a>, après avoir achevé ce <em>Tutoriel Rails</em> je vous suggère de lire des livres de pur Ruby, tels que  <a href="http://www.amazon.com/gp/product/1430223634?ie=UTF8&amp;tag=httpwwwrailst-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1430223634"><em>Beginning Ruby</em></a>, <a href="http://www.amazon.com/gp/product/1933988657?ie=UTF8&amp;tag=httpwwwrailst-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1933988657"><em>The Well-Grounded Rubyist</em></a> ou <a href="http://www.amazon.com/gp/product/B000P28V8Q?ie=UTF8&amp;tag=httpwwwrailst-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B000P28V8Q"><em>The Ruby Way</em></a>.</p>

<p>Ce chapitre couvre beaucoup de points, et il est possible que vous ne les saisissiez pas du premier coup. Rassurez-vous, j'y reviendrai fréquemment au cours des prochains chapitres.</p>

<div class="label" id="sec:motivation"></div>


<h2><a id="sec:4.1" href="rails-flavored-ruby#sec:motivation" class="heading"><span class="number">4.1</span> Motivation</a></h2>


<p>Comme nous l'avons vu dans le dernier chapitre, il est possible de développer le squelette d'une application Rails, et même de commencer à la tester, sans aucune connaissance du langage Ruby. Nous avons fait cela en nous appuyant sur le code de contrôleur et de test généré automatiquement et en suivant les exemples trouvés. Cette situation ne peut tout de même pas durer éternellement, cependant, et nous ouvrirons ce chapitre avec un certain nombre d'ajouts au site qui vont nous permettre de nous confronter à nos limites en langage Ruby.</p>

<div class="label" id="sec:title_helper"></div>


<h3><a id="sec:4.1.1" href="rails-flavored-ruby#sec:title_helper" class="heading"><span class="number">4.1.1</span> Un «&nbsp;helper&nbsp;» de titre</a></h3>


<p>Quand nous avons vu la dernière fois notre application, nous avions juste actualisé les pages statiques classiques pour utiliser le <em>layout</em> Rails dans le but d'éliminer les redondances de code présentes dans nos vues (<a class="ref" href="rails-flavored-ruby#code:application_layout_redux">extrait&nbsp;4.1</a>).</p>

<div class="label" id="code:application_layout_redux"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 4.1.</span> <span class="description">Le layout du site de l'application exemple. <br /> <code>app/views/layouts/application.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple App du Tutoriel Ruby on Rails | <span class="cp">&lt;%=</span> <span class="vi">@titre</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tag</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Ce layout fonctionne bien, mais il contient une partie qui pourrait être encore améliorée. Rappelez-vous que la ligne de titre&nbsp;:</p>

<div class="code"><div class="highlight"><pre>Simple App du Tutoriel Ruby on Rails | <span class="cp">&lt;%=</span> <span class="vi">@titre</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>… s'appuie sur la définition de <code>@titre</code> dans les actions, telle que&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
    <span class="vi">@titre</span> <span class="o">=</span> <span class="s2">&quot;Home&quot;</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
</pre></div>
</div>


<p>Mais que se passe-t-il si nous ne définissons pas la variable <code>@titre</code>&nbsp;? C'est une bonne convention graphique d'avoir toujours une <em>base de titre</em> sur chaque page, avec une variable optionnelle si on a besoin d'être plus précis. Nous avons <em>presque</em> accompli cela avec notre présent layout, à une nuance près&nbsp;: comme vous pouvez le voir si vous supprimez la déclaration de <code>@titre</code> dans l'une des actions, en l'absence de la variable <code>@titre</code> le titre s'affiche comme suit&nbsp;:</p>

<div class="code"><div class="highlight"><pre>Simple App du Tutoriel Ruby on Rails | 
</pre></div>
</div>


<p>En d'autres termes, il y a une base de titre satisfaisante, mais il y a aussi un caractère de barre verticale&nbsp;«&nbsp;<code>|</code>&nbsp;» à la fin de cette base de titre.</p>

<p>Une façon courante de traiter ce cas est de définir un <em>helper</em> (un «&nbsp;<em>assistant</em>&nbsp;», un «&nbsp;auxiliaire&nbsp;». NdT), qui est une fonction conçue pour être utilisée avec les vues. Définissons un <em>helper</em> titre  qui retourne une base de titre, «&nbsp;Simple App du Tutoriel Ruby on Rails&nbsp;», si aucune variable <code>@titre</code> n'est définie, et ajoute une barre verticale dans le cas où cette variable serait définie (<a class="ref" href="rails-flavored-ruby#code:title_helper">extrait&nbsp;4.2</a>).<sup class="footnote" id="fnref:4.1"><a href="#fn:4.1">1</a></sup></p>

<div class="label" id="code:title_helper"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 4.2.</span> <span class="description">Définir un <em>helper</em> de titre. <br /> <code>app/helpers/application_helper.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">module</span> <span class="nn">ApplicationHelper</span>

  <span class="c1"># Retourner un titre basé sur la page.</span>
  <span class="k">def</span> <span class="nf">titre</span>
    <span class="n">base_titre</span> <span class="o">=</span> <span class="s2">&quot;Simple App du Tutoriel Ruby on Rails&quot;</span>
    <span class="k">if</span> <span class="vi">@titre</span><span class="o">.</span><span class="n">nil?</span>
      <span class="n">base_titre</span>
    <span class="k">else</span>
      <span class="s2">&quot;</span><span class="si">#{</span><span class="n">base_titre</span><span class="si">}</span><span class="s2"> | </span><span class="si">#{</span><span class="vi">@titre</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Ce code peut sembler très simple aux yeux d'un développeur Rails expérimenté, mais il est en réalité <em>plein</em> de nouvelles idées Ruby&nbsp;: modules, commentaires, déclaration de variable locale, booléens, contrôle de flux, interpolation de chaine, et retour de valeur. Nous allons passer en revue chacune de ces idées au cours de ce chapitre.</p>

<p>Maintenant que nous avons un <em>helper</em>, nous pouvons l'utiliser pour simplifier notre layout en remplaçant&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;title&gt;</span>Simple App du Tutoriel Ruby on Rails | <span class="cp">&lt;%=</span> <span class="vi">@titre</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
</pre></div>
</div>


<p>… par&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">titre</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
</pre></div>
</div>


<p>… comme on peut le voir dans l'<a class="ref" href="rails-flavored-ruby#code:application_layout_full_title">extrait&nbsp;4.3</a>.
Notez en particulier le basculement de la variable d'instance <code>@titre</code> vers la méthode de l'<em>helper</em> <code>titre</code> (sans le signe arobase, <code>@</code>). En utilisant Autotest ou <code>rspec spec/</code>, vous devriez pouvoir vérifier que les tests du <a class="ref" href="static-pages#top">chapitre&nbsp;3</a> réussissent toujours.</p>

<div class="label" id="code:application_layout_full_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 4.3.</span> <span class="description">Le layout du site de l'application exemple. <br /> <code>app/views/layouts/application.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">titre</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tag</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>




<div class="label" id="sec:cascading_style_sheets"></div>


<h3><a id="sec:4.1.2" href="rails-flavored-ruby#sec:cascading_style_sheets" class="heading"><span class="number">4.1.2</span> Feuilles de styles en cascade (CCS &mdash;&nbsp;Cascading Style Sheets)</a></h3>


<p>Il y a une seconde addition à notre site qui peut sembler simple mais introduit de nouveaux concepts Ruby&nbsp;: l'inclusion de <rw>feuilles de styles</rw> dans le layout de notre site. Bien que ce soit un livre sur le développement web, pas sur le design web, nous utiliserons les feuilles de styles en cascade (CSS) pour donner un minimum de style à notre application exemple, et nous utiliserons pour cela le framework <a href="http://www.blueprintcss.org/">Blueprint CSS</a>.</p>

<p>Pour commencer, <a href="http://github.com/joshuaclayton/blueprint-css/zipball/master">téléchargez le dernier Blueprint CSS</a> (pour la simplicité, je présuppose que vous téléchargez Blueprint dans un dossier <code>Downloads</code>, mais utilisez le dossier que vous voulez). En utilisant soit le mode en ligne de commande soit un outil graphique, copiez le dossier de Blueprint CSS <code>blueprint</code> dans le dossier <code>public/stylesheets</code> de votre application exemple, un dossier spécial où Rails conserve les feuilles de styles. Sur mon Mac, la commande ressemble à celle-ci, mais dans le détail elle peut varier pour vous&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="nv">$ </span>cp -r ~/Downloads/joshuaclayton-blueprint-css-&lt;version number&gt;/blueprint <span class="se">\</span>
&gt; public/stylesheets/
</pre></div>
</div>

<p>Ici <code>cp</code> est la commande Unix pour <em>copier</em>, et le drapeau <code>-r</code> copie récursivement (nécessaire pour copier tous les sous-dossiers) (comme mentionné brièvement à la <a class="ref" href="static-pages#sec:autotest">section&nbsp;3.2.1.1</a>, le tilde <tt class="verb">~</tt> signifie «dossier home» en Unix). <em>Note&nbsp;:</em> vous ne devriez <em>pas</em> coller le signe&nbsp;«&nbsp;<tt class="verb">&gt;</tt>&nbsp;» dans votre terminal. Si vous collez la première ligne avec ce signe et pressez la touche retour-chariot, vous verrez «&nbsp;<tt class="verb">&gt;</tt>&nbsp;» indiquant une continuation de ligne. Vous devrez alors coller dans la seconde ligne et presser la touche Retour-chariot une nouvelle fois pour exécuter la commande. Notez aussi que vous aurez à renseigner le numéro de version à la main, puisqu'il change à chaque actualisation de Blueprint. Enfin, assurez-vous de <em>ne pas</em> taper&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="nv">$ </span>cp -r ~/Downloads/joshuaclayton-blueprint-css-&lt;version number&gt;/blueprint/ <span class="se">\</span>
&gt; public/stylesheets/
</pre></div>
</div>


<p>… qui a une balance («&nbsp;/&nbsp;») à la fin <code>&hellip;/blueprint/</code>. Cela déposerait le <em>contenu</em> du dossier Blueprint dans le dossier <code>public/stylesheets</code> au lieu de déplacer le dossier <code>blueprint</code> lui-même.</p>

<p>Une fois que les feuilles de styles se trouvent dans le bon dossier, Rails fournit un <em>helper</em> pour les inclure dans nos pages en utilisant du Ruby embarqué (<a class="ref" href="rails-flavored-ruby#code:layout_with_stylesheets">extrait&nbsp;4.4</a>).</p>

<div class="label" id="code:layout_with_stylesheets"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 4.4.</span> <span class="description">Ajout de feuilles de styles au layout de l'application exemple. <br /> <code>app/views/layouts/application.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">titre</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tag</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s1">&#39;blueprint/screen&#39;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;screen&#39;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s1">&#39;blueprint/print&#39;</span><span class="p">,</span>  <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;print&#39;</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Concentrons-nous sur les nouvelles lignes&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s1">&#39;blueprint/screen&#39;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;screen&#39;</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s1">&#39;blueprint/print&#39;</span><span class="p">,</span>  <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;print&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>Elles utilisent l'<em>helper</em> Rails intégré <code>stylesheet_link_tag</code>, détaillé dans l'API Rails.<sup class="footnote" id="fnref:4.2"><a href="#fn:4.2">2</a></sup> La première ligne <code>stylesheet_link_tag</code> inclut la feuille de style <code>blueprint/screen.css</code> pour l'écran (par exemple le moniteur de votre ordinateur), et la seconde inclut <code>blueprint/print.css</code> pour l'impression (l'helper ajoute automatiquement l'extension <code>.css</code> au nom de fichier s'il est absent, donc je l'ai omis pour la brièveté). Comme pour l'helper de titre, pour un développeur Rails expérimenté ces lignes semblent vraiment simples, mais elles contiennent au moins quatre nouvelles idées&nbsp;: les méthodes Rails intégrées, l'invocation de méthode avec l'omission des parenthèses, les symboles et les tableaux hash. Ce chapitre couvre aussi ces nouvelles idées (nous verrons le code HTML produit par ces feuilles de styles dans l'<a class="ref" href="rails-flavored-ruby#code:css_source">extrait&nbsp;4.6</a> de la <a class="ref" href="rails-flavored-ruby#sec:css_revisited">section&nbsp;4.3.4</a>).</p>

<p>En passant, notons que les nouvelles feuilles de styles ne changent pas l'aspect de notre site, c'est seulement un bon début (<a class="ref" href="rails-flavored-ruby#fig:home_with_stylesheet">illustration&nbsp;4.1</a>). Nous travaillerons sur cette fondation au <a class="ref" href="filling-in-the-layout#top">chapitre&nbsp;5</a>.<sup class="footnote" id="fnref:4.3"><a href="#fn:4.3">3</a></sup></p>

<div class="label" id="fig:home_with_stylesheet"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/home_with_stylesheet.png" alt="home_with_stylesheet" /></span></div><div class="caption"><span class="header">Illustration 4.1: </span><span class="description">La page d'accueil avec les nouvelles feuilles de styles Blueprint.&nbsp;<a href="http://railstutorial.org/images/figures/home_with_stylesheet-full.png">(taille normale)</a></span></div></div>




<div class="label" id="sec:strings_and_methods"></div>


<h2><a id="sec:4.2" href="rails-flavored-ruby#sec:strings_and_methods" class="heading"><span class="number">4.2</span> Chaines de caractères et méthodes</a></h2>


<p>Notre outil principal pour apprendre Ruby sera la <em>console Rails </em>, qui est un outil en ligne de commande pour intéragir avec les applications Rails. La console elle-même est construite au sommet de Ruby (<code>irb</code>), elle a donc accès à toute la puissance du langage (comme nous le verrons à la <a class="ref" href="rails-flavored-ruby#sec:a_controller_class">section&nbsp;4.4.4</a>, la console a aussi accès à l'environnement Rails). Démarrez la console en ligne de commande comme suit&nbsp;:<sup class="footnote" id="fnref:4.4"><a href="#fn:4.4">4</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="go">Loading development environment (Rails 3.0.7)</span>
<span class="gp">&gt;&gt; </span>
</pre></div>
</div>


<p>Par défaut, la console commence en <em>environnement de développement</em>, qui est l'un des trois environnements séparés définis par Rails (les deux autres environnements sont l'environnement de <em>test</em> et l'environnement de <em>production</em>). Cette distinction ne sera pas importante dans ce chapitre&nbsp;; nous en apprendrons plus sur les environemments à la <a class="ref" href="modeling-and-viewing-users-one#sec:rails_environments">section&nbsp;6.3.1</a>.</p>

<p>La console est un puissant outil d'apprentissage, et vous devrez toujours vous sentir libre de l'explorer &mdash;&nbsp;ne vous inquiétez pas, vous ne casserez (probablement) rien. En utilisant la console, tapez Ctrl-C si vous vous retrouvez coincé, ou Ctrl-D pour quitter cette console.</p>

<p>Tout au long de ce chapitre, vous pourrez trouver utile de consulter l'API Ruby.<sup class="footnote" id="fnref:4.5"><a href="#fn:4.5">5</a></sup> Cet API est emballée (peut-être même <em>trop</em> emballée) avec des informations&nbsp;; par exemple, pour en apprendre plus sur les chaines de caractères Ruby vous pouvez consulter l'entrée de l'API Ruby pour la classe <code>String</code>.</p>

<div class="label" id="sec:comments"></div>


<h3><a id="sec:4.2.1" href="rails-flavored-ruby#sec:comments" class="heading"><span class="number">4.2.1</span> Commentaires</a></h3>


<p>Les <em>commentaires</em> Ruby commencent par le signe dièse&nbsp;<code>#</code> et s'étendent jusqu'à la fin de la ligne. Ruby (et donc Rails) ignore les commentaires, mais ils sont utiles pour les lecteurs humains (à commencer, souvent, par l'auteur du code lui-même&nbsp;!). Dans le code&nbsp;:</p>

<div class="code"><div class="highlight"><pre>  <span class="c1"># Retourne un titre propre à la page.</span>
  <span class="k">def</span> <span class="nf">titre</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
</pre></div>
</div>


<p>… la première ligne est un commentaire indiquant le rôle joué par la fonction qui le suit.</p>

<p>D'ordinaire, vous n'incluez pas de commentaires dans les sessions de console, mais dans le but de cet apprentissage, j'en incluerai dans ce qui suit, comme cela&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="mi">17</span> <span class="o">+</span> <span class="mi">42</span>   <span class="c1"># Addition d'entiers</span>
<span class="go">=&gt; 59</span>
</pre></div>
</div>


<p>Si vous poursuivez cette section en tapant ou en copiant-collant les commandes dans votre console, vous pouvez bien sûr omettre ces commentaires&nbsp;; la console les ignorera de toute façon.</p>

<div class="label" id="sec:strings"></div>


<h3><a id="sec:4.2.2" href="rails-flavored-ruby#sec:strings" class="heading"><span class="number">4.2.2</span> Chaines de caractères</a></h3>


<p><em>la chaine de caractères</em> (<em>Strings</em>) est probablement la structure de données la plus importante des applications web, puisque les pages web consistent en fin de compte en des chaines de texte envoyées par le serveur aux navigateurs. Commençons à explorer ces chaines de caractères avec la console, cette fois en commençant avec <code>rails&nbsp;c</code> (si vous avez déjà quitté votre console. NdT), qui est un raccourci pour la commande <code>rails console</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails c</span>
<span class="gp">&gt;&gt; </span><span class="s2">&quot;&quot;</span>         <span class="c1"># Une chaine vide</span>
<span class="go">=&gt; &quot;&quot;</span>
<span class="gp">&gt;&gt; </span><span class="s2">&quot;foo&quot;</span>      <span class="c1"># Une chaine non vide</span>
<span class="go">=&gt; &quot;foo&quot;</span>
</pre></div>
</div>


<p>Voici des <em>chaines littérales</em>, créées en utilisant les guillemets doubles «&nbsp;<code>"</code>&nbsp;». La console écrit le résultat de l'évaluation de chaque ligne, qui dans le cas d'une chaine littérale est juste la chaine elle-même.</p>

<p>Nous pouvons aussi <em>concaténer</em> des chaines avec l'opérateur <code>+</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s2">&quot;foo&quot;</span> <span class="o">+</span> <span class="s2">&quot;bar&quot;</span>    <span class="c1"># Concaténation de chaines</span>
<span class="go">=&gt; &quot;foobar&quot;</span>
</pre></div>
</div>


<p>Ici, l'évaluation de <code>"foo"</code> <em>plus</em> <code>"bar"</code> donne la chaine <code>"foobar"</code>.<sup class="footnote" id="fnref:4.6"><a href="#fn:4.6">6</a></sup></p>

<p>Une autre façon de contruire des chaines de caractère se fait via l'<em>interpolation</em> en utilisant la syntaxe spéciale <code>#{}</code>&nbsp;:<sup class="footnote" id="fnref:4.7"><a href="#fn:4.7">7</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">first_name</span> <span class="o">=</span> <span class="s2">&quot;Michael&quot;</span>    <span class="c1"># Déclaration de variable</span>
<span class="go">=&gt; &quot;Michael&quot;</span>
<span class="gp">&gt;&gt; </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">first_name</span><span class="si">}</span><span class="s2"> Hartl&quot;</span>     <span class="c1"># Interpolation de chaine</span>
<span class="go">=&gt; &quot;Michael Hartl&quot;</span>
</pre></div>
</div>


<p>Ici, nous avons <em>assigné</em> la valeur <code>"Michael"</code> à la variable <code>first_name</code> et l'avons <em>interpolée</em> à l'intérieur de la chaine <code>"#{first_name} Hartl"</code>. Nous pouvons aussi assigner les deux chaines à une variable&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">first_name</span> <span class="o">=</span> <span class="s2">&quot;Michael&quot;</span>
<span class="go">=&gt; &quot;Michael&quot;</span>
<span class="gp">&gt;&gt; </span><span class="n">last_name</span> <span class="o">=</span> <span class="s2">&quot;Hartl&quot;</span>
<span class="go">=&gt; &quot;Hartl&quot;</span>
<span class="gp">&gt;&gt; </span><span class="n">first_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">last_name</span>    <span class="c1"># Concaténation, avec une espace <!-- féminin en typo ! -->entre les deux</span>
<span class="go">=&gt; &quot;Michael Hartl&quot;</span>
<span class="gp">&gt;&gt; </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">last_name</span><span class="si">}</span><span class="s2">&quot;</span>    <span class="c1"># L'interpolation équivalente</span>
<span class="go">=&gt; &quot;Michael Hartl&quot;</span>
</pre></div>
</div>


<p>Notez que les deux expressions finales sont équivalentes, mais je préfère la version interpolée&nbsp;; avoir à ajouter une simple espace<!-- féminin en typo --> <code>"&nbsp;"</code> semble un peu maladroit («&nbsp;espace&nbsp;» est féminine en typographie. NdT).</p>

<div class="label" id="sec:printing"></div>


<h4><a id="sec:4.2.2.1" href="rails-flavored-ruby#sec:printing" class="heading">Impression</a></h4>


<p>Pour <em>imprimer</em> une chaine de caractères, la fonction Ruby utilisée le plus couramment est <code>puts</code> (prononcez «&nbsp;poute esse&nbsp;», pour «put string»)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="nb">puts</span> <span class="s2">&quot;foo&quot;</span>     <span class="c1"># put string</span>
<span class="go">foo</span>
<span class="go">=&gt; nil</span>
</pre></div>
</div>


<p>La méthode <code>puts</code> entraine un <em>effet secondaire</em>&nbsp;: l'expression <code>puts "foo"</code> affiche la chaine à l'écran et ne retourne ensuite <a href="http://www.answers.com/nil">litéralement rien du tout</a>&nbsp;: <code>nil</code> (<em>nul</em>), qui est une valeur Ruby spéciale pour «&nbsp;<a href="http://www.youtube.com/watch?v=AsZ9qFofOwo">rien du tout</a>&nbsp;» (par la suite, je supprimerai parfois la partie «&nbsp;<code>=&gt; nil</code>&nbsp;» pour la simplicité).</p>

<p>L'utilisation de <code>puts</code> ajoute automatiquement un caractère de nouvelle ligne&nbsp;<tt class="verb">\n</tt> à la sortie&nbsp;; la méthode <code>print</code> liée ne le fait pas&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="nb">print</span> <span class="s2">&quot;foo&quot;</span>    <span class="c1"># imprime la chaine (~&tilde;= puts, mais sans nouvelle ligne)</span>
<span class="go">foo=&gt; nil</span>
<span class="gp">&gt;&gt; </span><span class="nb">print</span> <span class="s2">&quot;foo</span><span class="se">\n</span><span class="s2">&quot;</span>  <span class="c1"># = puts &quot;foo&quot;</span>
<span class="go">foo</span>
<span class="go">=&gt; nil</span>
</pre></div>
</div>




<div class="label" id="sec:single_quoted_strings"></div>


<h4><a id="sec:4.2.2.2" href="rails-flavored-ruby#sec:single_quoted_strings" class="heading">Chaines de caractères avec apostrophe simple</a></h4>


<p>Tous les exemples précédents utilisaient les <em>chaines entre guillemets</em>, mais Ruby supporte aussi les <em>chaines entre apostrophes</em>. Pour de nombreux usages, les deux types de chaines sont en fait identiques&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s1">&#39;foo&#39;</span>          <span class="c1"># Une chaine apostrophe simple</span>
<span class="go">=&gt; &quot;foo&quot;</span>
<span class="gp">&gt;&gt; </span><span class="s1">&#39;foo&#39;</span> <span class="o">+</span> <span class="s1">&#39;bar&#39;</span>
<span class="go">=&gt; &quot;foobar&quot;</span>
</pre></div>
</div>


<p>Il existe cependant une différence de taille&nbsp;; Ruby ne procède à aucune interpolation à l'intérieur d'une chaine apostrophe simple&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s1">&#39;#{foo} bar&#39;</span>     <span class="c1"># Les chaines apostrophe empêchent l'interpolation</span>
<span class="go">=&gt; &quot;\#{foo} bar&quot;</span>
</pre></div>
</div>


<p>Notez comment la console retourne des valeurs en utilisant des chaines entre guillemets (tel que «&nbsp;<code>#</code>&nbsp;» ci-dessus), ce qui demande d'utiliser le caractère spécial d'échappement (<em>backslash</em>, «&nbsp;\&nbsp;»).</p>

<p>Si les chaines entre guillemets peuvent faire tout ce que font les chaines entre apostrophes, et peuvent interpoler, quelle est l'utilité des chaines apostrophiées&nbsp;? Elles sont souvent utiles parce qu'elles sont vraiment <em>littérales</em>, et contiennent réellement les caractères que vous tapez. Par exemple, le caractère d'échappement «&nbsp;backslash&nbsp;» est un caractère spécial sur la plupart des systèmes, comme dans le retour à la ligne&nbsp;<tt class="verb">\n</tt>. Si vous voulez qu'une variable contienne un caractère d'échappement littéral, les apostrophes seront plus pratiques&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s1">&#39;\n&#39;</span>       <span class="c1"># Une combinaison à échappement littéral</span>
<span class="go">=&gt; &quot;\\n&quot;</span>
</pre></div>
</div>


<p>Comme avec le caractère «&nbsp;<code>#</code>&nbsp;» de notre exemple précédent, Ruby a besoin d'échapper le caractère d'échappement lui-même&nbsp;; à l'intérieur d'une chaine entre guillemets, un échappement littéral doit être représenté par <em>deux</em> échappements. Pour un court exemple comme celui-là, il n'y a pas un gain énorme, mais s'il y a beaucoup de choses à échapper ça peut être d'une grande utilité&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s1">&#39;Les nouvelles lignes (\n) et les tabulations (\t) utilisent toutes</span>
<span class="s1">&nbsp;&nbsp;&nbsp;deux les échappements \.&#39;</span>
<span class="go">=&gt; &quot;Les nouvelles lignes (\\n) et les tabulations (\\t) utilisent toutes</span>
<span class="go">deux les échappements \\.&quot;</span>
</pre></div>
</div>




<div class="label" id="sec:objects_and_message_passing"></div>


<h3><a id="sec:4.2.3" href="rails-flavored-ruby#sec:objects_and_message_passing" class="heading"><span class="number">4.2.3</span> Objets et passage de message</a></h3>


<p>Tout, en Ruby, les chaines et même la valeur <code>nil</code> (<em>nul</em>), sont des <rw>objets</rw>. Nous verrons le sens technique de cela à la <a class="ref" href="rails-flavored-ruby#sec:a_class_of_our_own">section&nbsp;4.4.2</a>, et je pense que personne n'a jamais compris ce qu'était un <em>objet</em> en en lisant la définition dans un livre&nbsp;; vous devez vous faire une idée intuitive des objets en consultant un grand nombre d'exemples.</p>

<p>Il est beaucoup plus facile de décrire ce que les objets <em>font</em>, qui est de répondre aux messages. Un objet comme une chaine de caractères, par exemple, peut répondre au message <code>length</code> (<em>longueur</em>), qui retourne le nombre de signes/caractères de la chaine&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s2">&quot;foobar&quot;</span><span class="o">.</span><span class="n">length</span>        <span class="c1"># Passer le message &quot;length&quot; à la chaine</span>
<span class="go">=&gt; 6</span>
</pre></div>
</div>


<p>Typiquement, les messages qui peuvent être passés aux objets sont appelés des <rw>méthodes</rw>, qui sont des fonctions définies pour ces objets.<sup class="footnote" id="fnref:4.8"><a href="#fn:4.8">8</a></sup> Les chaines répondent aussi à la méthode <code>empty?</code> (<em>vide&nbsp;?</em>)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s2">&quot;foobar&quot;</span><span class="o">.</span><span class="n">empty?</span>
<span class="go">=&gt; false</span>        <span class="c1"># = Faux</span>
<span class="gp">&gt;&gt; </span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">empty?</span>
<span class="go">=&gt; true</span>         <span class="c1"># = Vrai</span>
</pre></div>
</div>


<p>Notez le point d'interrogation à la fin de la méthode <code>empty?</code>. C'est une convention Ruby indiquant que la valeur de retour est <em>booléenne</em>&nbsp;: <code>true</code> (<em>vrai</em>) ou <code>false</code> (<em>faux</em>). Les booléens sont particulièrement utiles pour le <em>contrôle de flux</em>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;foobar&quot;</span>
<span class="gp">&gt;&gt; </span><span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">empty?</span>
<span class="gp">&gt;&gt; </span>  <span class="s2">&quot;La chaine est vide&quot;</span>
<span class="gp">&gt;&gt; </span><span class="k">else</span>
<span class="gp">&gt;&gt; </span>  <span class="s2">&quot;La chaine n'est pas vide&quot;</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">=&gt; &quot;La chaine n'est pas vide&quot;</span>
</pre></div>
</div>


<p>Les booléens peuvent aussi être combinés en utilisant les opérateurs <code>&amp;&amp;</code> («&nbsp;et&nbsp;»), <code>||</code> («&nbsp;ou&nbsp;») et <code>!</code> («&nbsp;pas&nbsp;»)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span>
<span class="go">=&gt; &quot;foo&quot;</span>
<span class="gp">&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="go">=&gt; &quot;&quot;</span>
<span class="gp">&gt;&gt; </span><span class="nb">puts</span> <span class="s2">&quot;Les deux chaines sont vides&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">empty?</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">.</span><span class="n">empty?</span>
<span class="go">=&gt; nil</span>
<span class="gp">&gt;&gt; </span><span class="nb">puts</span> <span class="s2">&quot;L'une des chaines est vide&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">empty?</span> <span class="o">||</span> <span class="n">y</span><span class="o">.</span><span class="n">empty?</span>
<span class="go">&quot;L'une des chaines est vide&quot;</span>
<span class="go">=&gt; nil</span>
<span class="gp">&gt;&gt; </span><span class="nb">puts</span> <span class="s2">&quot;x n'est pas vide&quot;</span> <span class="k">if</span> <span class="o">!</span><span class="n">x</span><span class="o">.</span><span class="n">empty?</span>
<span class="go">&quot;x n'est pas vide&quot;</span>
</pre></div>
</div>


<p>Puisque tout en Ruby est objet, il en découle que <code>nil</code> (la valeur <em>nul</em>) est un objet, donc elle peut répondre aussi aux méthodes.  On en trouve un exemple avec la méthode <code>to_s</code> qui peut dans l'absolu convertir tout objet en chaine de caractères&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="kp">nil</span><span class="o">.</span><span class="n">to_s</span>
<span class="go">=&gt; &quot;&quot;</span>
</pre></div>
</div>


<p>Cela apparait certainement comme une chaine vide, comme nous pouvons le vérifier en <em>chainant</em> les messages que nous passons à <code>nil</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="kp">nil</span><span class="o">.</span><span class="n">empty?</span>
<span class="go">NoMethodError: You have a nil object when you didn&#39;t expect it!</span>
<span class="go">You might have expected an instance of Array.</span>
<span class="go">The error occurred while evaluating nil.empty?</span>
<span class="go"><span class="c1">(</span></span>
<span class="go"><span class="c1">Traduction du message d'erreur&nbsp;:</span></span>
<span class="go"><span class="c1">ErreurDAbsenceDeMethode: Vous avez un objet null inattendu&nbsp;!</span></span>
<span class="go"><span class="c1">Vous attendiez peut-être une instance de tableau (Array)</span></span>
<span class="go"><span class="c1">L'erreur est survenue en évaluant l'expression nil.empty?</span></span>
<span class="go"><span class="c1">)</span></span>
<span class="gp">&gt;&gt; </span><span class="kp">nil</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">empty?</span>      <span class="c1"># Chainage du message</span>
<span class="go">=&gt; true</span>
</pre></div>
</div>


<p>Nous voyons ici que l'objet <code>nil</code> ne répond pas de lui-même à la méthode <code>empty?</code>, mais <code>nil.to_s</code> le fait.</p>

<p>Il existe une méthode spéciale pour tester la <code>nullité</code>, que vous devriez être en mesure de deviner&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s2">&quot;foo&quot;</span><span class="o">.</span><span class="n">nil?</span>
<span class="go">=&gt; false</span>
<span class="gp">&gt;&gt; </span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">nil?</span>
<span class="go">=&gt; false</span>
<span class="gp">&gt;&gt; </span><span class="kp">nil</span><span class="o">.</span><span class="n">nil?</span>
<span class="go">=&gt; true</span>
</pre></div>
</div>


<p>Si vous retournez à l'<a class="ref" href="rails-flavored-ruby#code:title_helper">extrait&nbsp;4.2</a>, vous verrez que l'<em>helper</em> de titre (<code>titre</code>) teste pour voir si la variable <code>@titre</code> est <code>nil</code> en utilisant la méthode <code>nil?</code>. C'est le signe qu'il y a quelque chose de spécial à propos des variables d'instance (les variables commençant par le signe «&nbsp;<code>@</code>&nbsp;»), qui peut être mieux compris en les comparant aux variables ordinaires. Par exemple, supposons que nous entrions les deux variables <code>titre</code> et <code>@titre</code> à la console sans les définir avant&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">titre</span>        <span class="c1"># Houps ! Nous n'avons pas défini la variable titre.</span>
<span class="go">NameError: undefined local variable or method `titre&#39; </span>
<span class="gp">&gt;&gt; </span><span class="vi">@titre</span>       <span class="c1"># Une variable d'instance dans la console</span>
<span class="go">=&gt; nil</span>
<span class="gp">&gt;&gt; </span><span class="nb">puts</span> <span class="s2">&quot;Il n'y a pas de telle variable d'instance.&quot;</span> <span class="k">if</span> <span class="vi">@titre</span><span class="o">.</span><span class="n">nil?</span>
<span class="go">Il n'y a pas de telle variable d'instance.</span>
<span class="go">=&gt; nil</span>
<span class="gp">&gt;&gt; </span><span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@titre</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Interpolation de @titre quand elle est nulle</span>
<span class="go">=&gt; &quot;&quot;</span>
</pre></div>
</div>


<p>Vous pouvez voir dans cet exemple que Ruby se plaint si nous essayons d'évaluer une variable locale, mais ne renvoie pas cette plainte pour une variable d'instance qui n'existe pas&nbsp;; au lieu de ça, les variables d'instance prennent la valeur <code>nil</code> si elles ne sont pas définies. Cela explique pourquoi le code&nbsp;:</p>

<div class="code"><div class="highlight"><pre>Simple App du Tutoriel Ruby on Rails | <span class="cp">&lt;%=</span> <span class="vi">@titre</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>… devient&nbsp;:</p>

<div class="code"><div class="highlight"><pre>Simple App du Tutoriel Ruby on Rails | 
</pre></div>
</div>


<p>… quand <code>@titre</code> est <code>nil</code>&nbsp;: Le Ruby embarqué insère la chaine correspondant à la variable donnée, et la chaine correspondant à la valeur <code>nil</code> est une chaine vide&nbsp;<code>""</code>.</p>

<p>Le dernier exemple montre aussi un usage alternatif du mot-clé <code>if</code>&nbsp;: Ruby vous permet d'écrire des blocs qui ne sont évalués que si l'expression suivant le <code>if</code> est vraie. Il existe un mot-clé complémentaire, <code>unless</code> (<em>sauf</em>), qui fonctionne de la même façon, mais à l'opposé&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;foobar&quot;</span>
<span class="gp">&gt;&gt; </span><span class="nb">puts</span> <span class="s2">&quot;La chaine &#39;</span><span class="si">#{</span><span class="n">string</span><span class="si">}</span><span class="s2">&#39; n'est pas vide.&quot;</span> <span class="k">unless</span> <span class="n">string</span><span class="o">.</span><span class="n">empty?</span>
<span class="go">La chaine string &#39;foobar&#39; n'est pas vide.</span>
<span class="go">=&gt; nil</span>
</pre></div>
</div>


<p>Il est important de noter que l'objet <code>nil</code> est spécial, dans le sens où c'est le <em>seul</em> objet Ruby qui est <em>faux</em> dans un contexte booléen, à part bien sûr l'objet <code>false</code> lui-même&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="k">if</span> <span class="kp">nil</span>
<span class="gp">&gt;&gt; </span>  <span class="kp">true</span>
<span class="gp">&gt;&gt; </span><span class="k">else</span>
<span class="gp">&gt;&gt; </span>  <span class="kp">false</span>        <span class="c1"># nil est faux</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">=&gt; false</span>
</pre></div>
</div>

<p>En particulier, tous les autres objets Ruby sont <em>true</em>, même 0&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="k">if</span> <span class="mi">0</span>
<span class="gp">&gt;&gt; </span>  <span class="kp">true</span>        <span class="c1"># 0 (et toute autre valeur que nil et false) est vrai</span>
<span class="gp">&gt;&gt; </span><span class="k">else</span>
<span class="gp">&gt;&gt; </span>  <span class="kp">false</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">=&gt; true</span>
</pre></div>
</div>


<div class="label" id="sec:method_definitions"></div>


<h3><a id="sec:4.2.4" href="rails-flavored-ruby#sec:method_definitions" class="heading"><span class="number">4.2.4</span> Définition des méthodes</a></h3>


<p>La console nous permet de définir des <rw>méthodes</rw> de la même façon que nous le faisions avec l'action <code>home</code> de l'<a class="ref" href="static-pages#code:pages_controller">extrait&nbsp;3.6</a> ou l'<em>helper</em> de <code>titre</code> de l'<a class="ref" href="rails-flavored-ruby#code:title_helper">extrait&nbsp;4.2</a> (définir des méthodes dans la console est un peu lourd, et d'ordinaire on utilise plutôt un fichier, mais c'est pratique ici pour les besoins de la démonstration). Par exemple, définissons une fonction <code>string_message</code> qui prend un seul <em>argument</em> et retourne un message en fonction de la nullité ou non de l'argument&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="k">def</span> <span class="nf">string_message</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="gp">&gt;&gt; </span>  <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">empty?</span>
<span class="gp">&gt;&gt; </span>    <span class="s2">&quot;C'est une chaine vide&nbsp;!&quot;</span>
<span class="gp">&gt;&gt; </span>  <span class="k">else</span>
<span class="gp">&gt;&gt; </span>    <span class="s2">&quot;La chaine n'est pas vide.&quot;</span>
<span class="gp">&gt;&gt; </span>  <span class="k">end</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">=&gt; nil</span>
<span class="gp">&gt;&gt; </span><span class="nb">puts</span> <span class="n">string_message</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="go">C'est une chaine vide&nbsp;!</span>
<span class="gp">&gt;&gt; </span><span class="nb">puts</span> <span class="n">string_message</span><span class="p">(</span><span class="s2">&quot;foobar&quot;</span><span class="p">)</span>
<span class="go">La chaine n'est pas vide.</span>
</pre></div>
</div>


<p>Notez que les fonctions Ruby ont un <em>retour implicite</em>, ce qui signifie qu'elles retournent la valeur de la dernière expression évaluée &mdash;&nbsp;dans ce cas, l'un des deux messages, en fonction du fait que l'argument <code>string</code> de la fonction est vide ou non. Mais Ruby possède aussi une façon de définir le retour de façon explicite&nbsp;; la fonction suivante est équivalente à celle ci-dessus&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="k">def</span> <span class="nf">string_message</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="gp">&gt;&gt; </span>  <span class="k">return</span> <span class="s2">&quot;C'est une chaine vide&nbsp;!&quot;</span> <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">empty?</span>
<span class="gp">&gt;&gt; </span>  <span class="k">return</span> <span class="s2">&quot;La chaine n'est pas vide.&quot;</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
</pre></div>
</div>


<p>Le lecteur attentif pourra noter que le second <code>return</code> ici est en fait superfétatoire &mdash;&nbsp;étant la dernière expression de la fonction, la chaine <code>"La chaine n'est pas vide."</code> sera retournée sans égard pour le mot-clé <code>return</code>, mais utiliser <code>return</code> aux deux endroits présente une symétrie plaisante.</p>

<div class="label" id="sec:back_to_the_title_helper"></div>


<h3><a id="sec:4.2.5" href="rails-flavored-ruby#sec:back_to_the_title_helper" class="heading"><span class="number">4.2.5</span> Retour à l'<em>helper</em> <code>titre</code></a></h3>


<p>Nous sommes maintenant en mesure de comprendre l'<em>helper</em> <code>titre</code> de l'<a class="ref" href="rails-flavored-ruby#code:title_helper">extrait&nbsp;4.2</a>&nbsp;:<sup class="footnote" id="fnref:4.9"><a href="#fn:4.9">9</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="k">module</span> <span class="nn">ApplicationHelper</span>

  <span class="c1"># Retourne un titre propre à la page.               # Commentaire de documentation</span>
  <span class="k">def</span> <span class="nf">titre</span>                                           <span class="c1"># Définition de la méthode</span>
    <span class="n">base_titre</span> <span class="o">=</span> <span class="s2">&quot;Simple App du Tutoriel Ruby on Rails&quot;</span>  <span class="c1"># Assignement de variable</span>
    <span class="k">if</span> <span class="vi">@titre</span><span class="o">.</span><span class="n">nil?</span>                                    <span class="c1"># Test booléen pour la nullité</span>
      <span class="n">base_titre</span>                                      <span class="c1"># Retour implicite</span>
    <span class="k">else</span>
      <span class="s2">&quot;</span><span class="si">#{</span><span class="n">base_titre</span><span class="si">}</span><span class="s2"> | </span><span class="si">#{</span><span class="vi">@titre</span><span class="si">}</span><span class="s2">&quot;</span>                     <span class="c1"># Interpolation de chaine</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>


<p>Ces éléments &mdash;&nbsp;fonction, définition, assignement de variable, tests booléens, contrôle de flux et extrapolation de chaine&nbsp;&mdash; se combinent pour créer une méthode d'helper compacte à utiliser dans notre <em>layout</em>. L'élément final est <code>module ApplicationHelper</code>&nbsp;: le code dans les modules Ruby peut être <em>divisé</em> en classes Ruby. En écrivant du Ruby ordinaire, vous écrivez souvent des modules et les inclurez explicitement vous-mêmes, mais dans notre cas Rails gère l'inclusion automatiquement pour nous. Le résultat est que la méthode <code>titre</code> est <a href="http://catb.org/jargon/html/A/automagically.html"><em>automagiquement</em></a>&nbsp;(sic) accessible à toutes nos vues.</p>

<div class="label" id="sec:other_data_structures"></div>


<h2><a id="sec:4.3" href="rails-flavored-ruby#sec:other_data_structures" class="heading"><span class="number">4.3</span> Autres structures de données</a></h2>


<p>Bien que les applications web produisent en dernier lieu des chaines de caractères, la <em>fabrication</em> de ces chaines peut requérir l'utilisation de tout autant d'autres <rw>structures de données</rw>. Dans cette section, nous allons étudier quelques structures de données Ruby importante pour la conception d'applications Rails.</p>

<div class="label" id="sec:arrays_and_ranges"></div>


<h3><a id="sec:4.3.1" href="rails-flavored-ruby#sec:arrays_and_ranges" class="heading"><span class="number">4.3.1</span> Tableaux (Arrays) et rangs (ranges)</a></h3>


<p>Un tableau (<em>array</em>) est juste une liste d'éléments dans un ordre particulier. Nous n'avons pas encore abordé les tableaux dans ce <em>Tutoriel Rails</em>, mais les comprendre offre de bonnes bases pour comprendre les tables de hachage (<em>hashes</em>) (<a class="ref" href="rails-flavored-ruby#sec:hashes_and_symbols">section&nbsp;4.3.3</a>) et les aspects de la modélisation des données de Rails (tels que l'association <code>has_many</code> vue à la <a class="ref" href="a-demo-app#sec:demo_user_has_many_microposts">section&nbsp;2.3.3</a> et couverte plus largement à la <a class="ref" href="user-microposts#sec:user_micropost_associations">section&nbsp;11.1.2</a>).</p>

<p>Jusqu'ici nous avons passé beaucoup de temps à comprendre les chaines de caractères, et il existe une façon naturelle de passer des chaines aux tableaux en utilisant la méthode <code>split</code> (<em>scinder</em>)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span> <span class="s2">&quot;foo bar     baz&quot;</span><span class="o">.</span><span class="n">split</span>     <span class="c1"># Scinde une chaine en trois éléments</span>
<span class="go">=&gt; [&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;]</span>
</pre></div>
</div>


<p>Le résultat de cette opération est un tableau de trois chaines. Par défaut,  <code>split</code> divise une chaine en tableau en la scindant selon les <em>espaces blancs</em> (<em>whitespace</em>), mais vous pouvez scinder tout aussi bien selon n'importe quelle autre signe ou caractère&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s2">&quot;fooxbarxbazx&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="go">=&gt; [&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;]</span>
</pre></div>
</div>


<p>Conformément à la convention respectée par de nombreux langages informatiques, les tableaux Ruby sont <em>zero-offset</em> (<em>décalage-zéro</em>), ce qui signifie que le premier élément dans la liste possède l'index&nbsp;0, le deuxième l'index&nbsp;1, et ainsi de suite&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="o">[</span><span class="mi">42</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">17</span><span class="o">]</span>
<span class="go">=&gt; [42, 8, 17]</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>               <span class="c1"># Ruby utilise les crochets pour accéder aux éléments.</span>
<span class="go">=&gt; 42</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
<span class="go">=&gt; 8</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
<span class="go">=&gt; 17</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span>              <span class="c1"># Les indices peuvent même être négatifs&nbsp;!</span>
<span class="go">=&gt; 17</span>
</pre></div>
</div>


<p>Nous voyons ici que Ruby utilise des crochets pour accéder aux éléments du tableau. En addition à cette notation par crochets, Ruby offre des synonymes pour l'accès à certains éléments particuliers&nbsp;:<sup class="footnote" id="fnref:4.10"><a href="#fn:4.10">10</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">a</span>                  <span class="c1"># Pour se rappeler ce qu'est &#39;a&#39; </span>
<span class="go">=&gt; [42, 8, 17]</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">first</span>
<span class="go">=&gt; 42</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">second</span>
<span class="go">=&gt; 8</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">last</span>
<span class="go">=&gt; 17</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">last</span> <span class="o">==</span> <span class="n">a</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span>    <span class="c1"># Comparaison, avec ==</span>
<span class="go">=&gt; true</span>
</pre></div>
</div>


<p>La dernière ligne introduit l'opérateur de comparaison d'égalité «&nbsp;<code>==</code>&nbsp;», que Ruby partage avec de nombreux autres langages, tout comme les opérateurs liés «&nbsp;<code>!=</code>&nbsp;» («&nbsp;<em>différent de…</em>&nbsp;»), etc.&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">length</span>       <span class="c1"># Les tableaux répondent aussi à la méthode &#39;length&#39;.</span>
<span class="go">=&gt; 3</span>
<span class="gp">&gt;&gt; </span><span class="n">x</span> <span class="o">==</span> <span class="mi">3</span>
<span class="go">=&gt; true</span>
<span class="gp">&gt;&gt; </span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span>
<span class="go">=&gt; false</span>
<span class="gp">&gt;&gt; </span><span class="n">x</span> <span class="o">!=</span> <span class="mi">1</span>
<span class="go">=&gt; true</span>
<span class="gp">&gt;&gt; </span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">1</span>
<span class="go">=&gt; true</span>
<span class="gp">&gt;&gt; </span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span>
<span class="go">=&gt; false</span>
</pre></div>
</div>


<p>En addition à <code>length</code> (aperçu dans la première ligne ci-dessus), les tableaux répondent à une foule d'autres méthodes&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">sort</span>
<span class="go">=&gt; [8, 17, 42]</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">reverse</span>
<span class="go">=&gt; [17, 8, 42]</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shuffle</span>
<span class="go">=&gt; [17, 42, 8]</span>
</pre></div>
</div>


<p>Vous pouvez aussi faire des ajouts aux tableaux avec l'opérateur «&nbsp;push&nbsp;», <code>&lt;&lt;</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span>                     <span class="c1"># Pousser 7 dans le tableau</span>
<span class="go">[42, 8, 17, 7]</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;foo&quot;</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;bar&quot;</span>        <span class="c1"># Chainer les ajouts</span>
<span class="go">[42, 8, 17, 7, &quot;foo&quot;, &quot;bar&quot;]</span>
</pre></div>
</div>


<p>Ce dernier exemple montre que vous pouvez chainer les ajouts ensemble, et aussi que, contrairement aux tableaux dans d'autres langages, les tableaux Ruby peuvent contenir des éléments de types différents (dans ce cas, des chaines de caractères et des entiers).</p>

<p>Nous avons vu précédemment que <code>split</code> convertissait une chaine de caractères en tableau. Nous pouvons également faire le chemin inverse avec la méthode <code>join</code> (<em>joindre</em>)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">a</span>
<span class="go">=&gt; [42, 8, 17, 7, &quot;foo&quot;, &quot;bar&quot;]</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">join</span>                       <span class="c1"># Joindre avec rien</span>
<span class="go">=&gt; &quot;428177foobar&quot;</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>                 <span class="c1"># Joindre avec virgule-espace</span>
<span class="go">=&gt; &quot;42, 8, 17, 7, foo, bar&quot;</span>
</pre></div>
</div>


<p>Très proches des tableaux <rw>arrays</rw>, on trouve les rangs (<rw>ranges</rw>), qui peuvent probablement être plus facilement compréhensibles en les convertissant en tableaux à l'aide de la méhode <code>to_a</code> («&nbsp;to_a&nbsp;» pour «&nbsp;to array&nbsp;», <em>vers un tableau</em>)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">9</span>
<span class="go">=&gt; 0..9</span>
<span class="gp">&gt;&gt; </span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">9</span><span class="o">.</span><span class="n">to_a</span>              <span class="c1"># Oops, call to_a on 9</span>
<span class="go">ArgumentError: bad value for range</span>
<span class="c1">(NdT. ErreurArgument: mauvaise valeur pour le rang)</span>
<span class="gp">&gt;&gt; </span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>            <span class="c1"># Utiliser les parenthèses pour appeler to_a sur un rang</span>
<span class="go">=&gt; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
</pre></div>
</div>


<P>Bien que <code>0..9</code> soit un rang valide, la seconde expression ci-dessus montre que nous avons besoin d'ajouter des parenthèses pour lui appliquer la méthode.</p>

<p>Les Rangs sont utiles pour tirer des éléments d'un tableau&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="sx">%w[foo bar baz quux]</span>         <span class="c1"># Utilisez %w pour faire un tableau de chaines.</span>
<span class="go">=&gt; [&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;, &quot;quux&quot;]</span>
<span class="gp">&gt;&gt; </span><span class="n">a</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">2</span><span class="o">]</span>
<span class="go">=&gt; [&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;]</span>
</pre></div>
</div>


<p>Les <rw>rangs</rw> fonctionnent aussi avec les caractères&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>
<span class="go">=&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;]</span>
</pre></div>
</div>


<div class="label" id="sec:blocks"></div>

<h3><a id="sec:4.3.2" href="rails-flavored-ruby#sec:blocks" class="heading"><span class="number">4.3.2</span> Blocs</a></h3>


<p>Les tableaux (<em>arrays</em>) et les rangs (<em>ranges</em>) répondent tous deux à une foule de méthodes qui acceptent des <em>blocs</em>. Ces <em>blocs</em> sont en même temps une des fonctionnalités les plus puissantes et de celles qui entrainent le plus de confusion&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="nb">puts</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="p">}</span>
<span class="go">2</span>
<span class="go">4</span>
<span class="go">6</span>
<span class="go">8</span>
<span class="go">10</span>
<span class="go">=&gt; 1..5</span>
</pre></div>
</div>


<p>Ce code appelle la méthode <code>each</code> (<em>chaque</em>)  sur le rang <code>(1..5)</code> et lui passe le bloc <code>{ |i| puts 2 * i }</code>. La barre verticale autour du nom de la variable dans&nbsp;<code>|i|</code> est la syntaxe Ruby pour une <rw>variable de bloc</rw>, et c'est à la méthode de savoir ce qu'elle doit faire avec le bloc&nbsp;, dans ce cas précis, la méthode <code>each</code> du rang peut traiter le bloc avec une simple variable locale, que nous avons appelée&nbsp;<code>i</code>, et elle exécute simplement le bloc pour chaque valeur de ce rang (elle exécute <code>puts 2 * i</code> avec <code>i = 1</code> &mdash;&nbsp;premier terme du rang&nbsp;&mdash;, elle exécute <code>puts 2 * i</code> avec <code>i = 2</code>, etc. jusqu'à <code>i = 5</code> &mdash;&nbsp;dernier élément du rang&nbsp;&mdash;).</p>

<p>Les accolades sont une façon d'indiquer un bloc, mais il existe une autre façon&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
<span class="gp">?&gt; </span>  <span class="nb">puts</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">2</span>
<span class="go">4</span>
<span class="go">6</span>
<span class="go">8</span>
<span class="go">10</span>
<span class="go">=&gt; 1..5</span>
</pre></div>
</div>


<p>Les blocs peuvent comprendre plus d'une ligne, et en comprennent souvent plus d'une. Dans le <em>Tutoriel Rails</em> nous suivrons la convention courante d'utiliser les accolades seulement pour les blocs d'une courte ligne et la syntaxe <code>do..end</code> pour les blocs à ligne longue ou à plusieurs lignes&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span>
<span class="gp">?&gt; </span>  <span class="nb">puts</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">number</span>
<span class="gp">&gt;&gt; </span>  <span class="nb">puts</span> <span class="s1">&#39;--&#39;</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">2</span>
<span class="go">--</span>
<span class="go">4</span>
<span class="go">--</span>
<span class="go">6</span>
<span class="go">--</span>
<span class="go">8</span>
<span class="go">--</span>
<span class="go">10</span>
<span class="go">--</span>
<span class="go">=&gt; 1..5</span>
</pre></div>
</div>


<p>Ici j'ai utilisé <code>number</code> au lieu de &nbsp;<code>i</code> juste pour souligner que n'importe quel nom de variable peut convenir.</p>

<p>Sans avoir de substantielles connaissances en programmation, il n'y pas de raccourci pour comprendre les blocs&nbsp;; vous avez juste besoin d'en rencontrer beaucoup, et à la longue vous vous y ferez.<sup class="footnote" id="fnref:4.11"><a href="#fn:4.11">11</a></sup> Heureusement, les humains sont assez bons pour faire des généralisations à partir d'exemples concrets&nbsp;; en voilà d'autres, en incluant deux qui utilisent la méthode <code>map</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="mi">3</span><span class="o">.</span><span class="n">times</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">&quot;Betelgeuse!&quot;</span> <span class="p">}</span>   <span class="c1"># 3.fois prend un bloc sans variable.</span>
<span class="go">&quot;Betelgeuse!&quot;</span>
<span class="go">&quot;Betelgeuse!&quot;</span>
<span class="go">&quot;Betelgeuse!&quot;</span>
<span class="go">=&gt; 3</span>
<span class="gp">&gt;&gt; </span><span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="p">}</span>          <span class="c1"># La notation ** correspond à &#39;puissance&#39;.</span>
<span class="go">=&gt; [1, 4, 9, 16, 25]</span>
<span class="gp">&gt;&gt; </span><span class="sx">%w[a b c]</span>                        <span class="c1"># Rappel&nbsp;: fait des tableaux de chaines.</span>
<span class="go">=&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</span>
<span class="gp">&gt;&gt; </span><span class="sx">%w[a b c]</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">char</span><span class="o">|</span> <span class="n">char</span><span class="o">.</span><span class="n">upcase</span> <span class="p">}</span>
<span class="go">=&gt; [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]</span>
</pre></div>
</div>


<p>Comme vous pouvez le voir, la méthode <code>map</code> retourne le résultat après avoir appliqué le bloc donné à chaque élément d'un tableau ou d'un rang.</p>

<p>En passant, nous sommes maintenant en mesure de comprendre la ligne de Ruby que j'avais posée à la <a class="ref" href="beginning#sec:heroku_commands">section&nbsp;1.4.4</a> pour générer des sous-domaines aléatoires&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">shuffle</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">7</span><span class="o">].</span><span class="n">join</span>
</pre></div>
</div>


<p>Déconstruisons-la pas à pas&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>                     <span class="c1"># Un tableau de l'alphabet</span>
<span class="go">=&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;, &quot;k&quot;, &quot;l&quot;, &quot;m&quot;, &quot;n&quot;, &quot;o&quot;,</span>
<span class="go">&quot;p&quot;, &quot;q&quot;, &quot;r&quot;, &quot;s&quot;, &quot;t&quot;, &quot;u&quot;, &quot;v&quot;, &quot;w&quot;, &quot;x&quot;, &quot;y&quot;, &quot;z&quot;]</span>
<span class="gp">&gt;&gt; </span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">shuffle</span>             <span class="c1"># Mélangeons-le</span>
<span class="go">=&gt; [&quot;c&quot;, &quot;g&quot;, &quot;l&quot;, &quot;k&quot;, &quot;h&quot;, &quot;z&quot;, &quot;s&quot;, &quot;i&quot;, &quot;n&quot;, &quot;d&quot;, &quot;y&quot;, &quot;u&quot;, &quot;t&quot;, &quot;j&quot;, &quot;q&quot;,</span>
<span class="go">&quot;b&quot;, &quot;r&quot;, &quot;o&quot;, &quot;f&quot;, &quot;e&quot;, &quot;w&quot;, &quot;v&quot;, &quot;m&quot;, &quot;a&quot;, &quot;x&quot;, &quot;p&quot;]</span>
<span class="gp">&gt;&gt; </span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">shuffle</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">7</span><span class="o">]</span>       <span class="c1"># Tirons les huit premiers éléments.</span>
<span class="go">=&gt; [&quot;f&quot;, &quot;w&quot;, &quot;i&quot;, &quot;a&quot;, &quot;h&quot;, &quot;p&quot;, &quot;c&quot;, &quot;x&quot;]</span>
<span class="gp">&gt;&gt; </span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">shuffle</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">7</span><span class="o">].</span><span class="n">join</span>  <span class="c1"># join pour faire une chaine.</span>
<span class="go">=&gt; &quot;mznpybuj&quot;</span>
</pre></div>
</div>




<div class="label" id="sec:hashes_and_symbols"></div>


<h3><a id="sec:4.3.3" href="rails-flavored-ruby#sec:hashes_and_symbols" class="heading"><span class="number">4.3.3</span> Tables de hachage et symboles</a></h3>


<p>Les <rw>tables de hachage</rw> (ou <em>tableaux dynamiques</em>) sont essentiellement une généralisation des tableaux-arrays&nbsp;: vous pouvez les considérer basiquement comme des tableaux, mais qui ne sont pas limités aux indices entiers (en fait, certains langages, spécialement Perl, appellent les tables de hachage des <em>tableaux associatifs</em> pour cette raison). Au lieu de ça, les indices d'une table de hachage, ou <rw>keys</rw> (<em>clés</em>), peuvent être presque n'importe quel objet. Par exemple, nous pouvons utiliser des chaines de caractères comme clés&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="p">{}</span>                          <span class="c1"># {} est une table de hachage vide.</span>
<span class="go">=&gt; {}</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">[</span><span class="s2">&quot;first_name&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Michael&quot;</span>     <span class="c1"># Clé &quot;first_name&quot;, valeur &quot;Michael&quot;</span>
<span class="go">=&gt; &quot;Michael&quot;</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">[</span><span class="s2">&quot;last_name&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Hartl&quot;</span>        <span class="c1"># Clé &quot;last_name&quot;, valeur &quot;Hartl&quot;</span>
<span class="go">=&gt; &quot;Hartl&quot;</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">[</span><span class="s2">&quot;first_name&quot;</span><span class="o">]</span>                 <span class="c1"># L'accès aux éléments fonctionne comme</span>
<span class="go">=&gt; &quot;Michael&quot;</span>                          <span class="c1"># sur les tableaux.</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span>                               <span class="c1"># Une représentation littérale de la</span>       
<span class="gp">&nbsp;&nbsp;&nbsp;</span><span class="n">&nbsp;</span>                                  <span class="c1"># table de hachage</span>
<span class="go">=&gt; {&quot;last_name&quot;=&gt;&quot;Hartl&quot;, &quot;first_name&quot;=&gt;&quot;Michael&quot;}</span>
</pre></div>
</div>


<p>Les tables de hachages sont indiquées avec des accolades contenant des paires clé-valeur&nbsp;; une paire d'accolades sans clé-valeurs &mdash;&nbsp;c'est-à-dire <code>{}</code>&nbsp;&mdash; est une table vide. Il est important de noter que les accolades pour les tables de hachage n'ont rien à voir avec les accolades pour les blocs (oui, ça peut être source de confusion). Bien que les tables de hachage ressemblent aux tableaux, une différence importante est que les tables ne garantissent pas, en règle générale, de garder leurs éléments dans un ordre particulier.<sup class="footnote" id="fnref:4.12"><a href="#fn:4.12">12</a></sup> Si l'ordre importe, utilisez un tableau.</p>

<p>Plutôt que de définir les tables de hachage item après item en utilisant les crochets, il est facile d'utiliser leur représentation littérale&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;first_name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Michael&quot;</span><span class="p">,</span> <span class="s2">&quot;last_name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Hartl&quot;</span> <span class="p">}</span>
<span class="go">=&gt; {&quot;last_name&quot;=&gt;&quot;Hartl&quot;, &quot;first_name&quot;=&gt;&quot;Michael&quot;}</span>
</pre></div>
</div>


<p>Ici j'ai utilisé la convention habituelle de Ruby qui consiste à placer une extra espace<!-- "espace" est féminine en typo --> aux deux extrémités de la table de hachage &mdash;&nbsp;une convention ignorée par la sortie de la console… (ne me demandez pas pourquoi les espaces sont conventionnelles<!-- "espace" est féminin en type -->&nbsp;; probablement quelques uns des premiers programmeurs influents aimaient l'aspect des extra espaces, et la convention a pris).</p>

<p>Jusqu'ici nous avons utilisé des chaines comme clé de hachage, mais en Rails il est bien plus courant d'utiliser plutôt des <rw>symbols</rw> (<em>symboles</em>). Les symboles ressemblent aux chaines de caractères, mais sont préfixés par le signe «&nbsp;deux points&nbsp;» au lieu d'être entourés par des guillemets ou des apostrophes. Par exemple, <code>:nom</code> est un symbole. Vous pouvez penser les symboles comme des chaines sans le bagage correspondant&nbsp;:<sup class="footnote" id="fnref:4.13"><a href="#fn:4.13">13</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s2">&quot;nom&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="go">=&gt; [&quot;n&quot;, &quot;o&quot;, &quot;m&quot;]</span>
<span class="gp">&gt;&gt; </span><span class="ss">:nom</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="go">NoMethodError: undefined method `split&#39; for :nom:Symbol</span>
<span class="c1">(Traduction&nbsp;:</span>
<span class="c1">ErreurAucuneMethode&nbsp;: méthode `split&#39; indéfinie pour le symbole :nom)</span>
<span class="gp">&gt;&gt; </span><span class="s2">&quot;foobar&quot;</span><span class="o">.</span><span class="n">reverse</span>
<span class="go">=&gt; &quot;raboof&quot;</span>
<span class="gp">&gt;&gt; </span><span class="ss">:foobar</span><span class="o">.</span><span class="n">reverse</span>
<span class="go">NoMethodError: undefined method `reverse&#39; for :foobar:Symbol</span>
<span class="c1">(Traduction&nbsp;:</span>
<span class="c1">ErreurAucuneMethode&nbsp;: méthode `reverse&#39; indéfinie pour le symbole :foobar)</span>
</pre></div>
</div>


<p>Les symboles sont un type de données spécial de Ruby partagé avec seulement quelques autres langages, donc ils peuvent sembler bizarres au début, mais Rails les utilise beaucoup, donc vous vous y habituerez vite.</p>

<p>En termes de symboles comme clé de table de hachage, nous pouvons définir une table <code>personne</code> comme suit&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">personne</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:nom</span> <span class="o">=&gt;</span> <span class="s2">&quot;Michael Hartl&quot;</span><span class="p">,</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">&quot;michael@example.com&quot;</span> <span class="p">}</span>
<span class="go">=&gt; {:nom=&gt;&quot;Michael Hartl&quot;, :email=&gt;&quot;michael@example.com&quot;}</span>
<span class="gp">&gt;&gt; </span><span class="n">personne</span><span class="o">[</span><span class="ss">:nom</span><span class="o">]</span>               <span class="c1"># Accès à la valeur correspondant à :nom.</span>
<span class="go">=&gt; &quot;Michael Hartl&quot;</span>
<span class="gp">&gt;&gt; </span><span class="n">personne</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span>          <span class="c1"># Accès à la valeur d'une clé indéfinie.</span>
<span class="go">=&gt; nil</span>
</pre></div>
</div>


<p>Nous voyons ici, dans le dernier exemple, que la valeur pour une clé indéfinie est simplement la valeur <code>nil</code> (<em>nul</em>).</p>

<p>Les valeurs d'une table de hachage peuvent virtuellement être n'importe quoi, même d'autres tables de hachage, comme on peut le voir dans l'<a class="ref" href="rails-flavored-ruby#code:nested_hashes">extrait&nbsp;4.5</a>.</p>

<div class="label" id="code:nested_hashes"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 4.5.</span> <span class="description">Tables imbriquées.</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>        <span class="c1"># Défini une table appelée &#39;params&#39; (&#39;paramètres&#39;).</span>
<span class="go">=&gt; {}</span>
<span class="gp">&gt;&gt; </span><span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:nom</span> <span class="o">=&gt;</span> <span class="s2">&quot;Michael Hartl&quot;</span><span class="p">,</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">&quot;mhartl@example.com&quot;</span> <span class="p">}</span>
<span class="go">=&gt; {:nom=&gt;&quot;Michael Hartl&quot;, :email=&gt;&quot;mhartl@example.com&quot;}</span>
<span class="gp">&gt;&gt; </span><span class="n">params</span>
<span class="go">=&gt; {:user=&gt;{:nom=&gt;&quot;Michael Hartl&quot;, :email=&gt;&quot;mhartl@example.com&quot;}}</span>
<span class="gp">&gt;&gt; </span> <span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">][</span><span class="ss">:email</span><span class="o">]</span>
<span class="go">=&gt; &quot;mhartl@example.com&quot;</span>
</pre></div>
</div></div>


<p>Ces sortes de tables de table, ou <em>tables imbriquées</em>, sont intensivement utilisées par Rails, comme nous le verrons au début de la <a class="ref" href="sign-up#sec:signup_failure">section&nbsp;8.2</a>.</p>

<p>Comme pour les tableaux et les rangs, les tables de hachage répondent à la méthode <code>each</code>. Par exemple, considérons une table appelée <code>flash</code> avec des clés pour deux conditions, <code>:success</code> (<em>succès</em>) et <code>:error</code> (<em>erreur</em>)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">flash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:success</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ça marche&nbsp;!&quot;</span><span class="p">,</span> <span class="ss">:error</span> <span class="o">=&gt;</span> <span class="s2">&quot;Raté… :-(&quot;</span> <span class="p">}</span>
<span class="go">=&gt; {:success=&gt;&quot;Ça marche&nbsp;!&quot;, :error=&gt;&quot;Raté… :-(&quot;}</span>
<span class="gp">&gt;&gt; </span><span class="n">flash</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
<span class="gp">?&gt; </span>  <span class="nb">puts</span> <span class="s2">&quot;La clé </span><span class="si">#{</span><span class="n">key</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2"> a la valeur </span><span class="si">#{</span><span class="n">value</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">La clé :success a la valeur &quot;Ça marche&nbsp;!&quot;</span>
<span class="go">La clé :error a la valeur &quot;Raté… :-(&quot;</span>
</pre></div>
</div>


<p>Notez que, tandis que la méthode <code>each</code> des tableaux prend un bloc avec une seule variable, <code>each</code> pour les tables de hachage en prend deux, une variable pour la <em>clé</em> et une variable pour la <em>valeur</em>. Ainsi, la méthode <code>each</code> pour les tables de hachage fait son itération à travers la table une <em>paire</em> clé-valeur à la fois.</p>

<p>L'exemple précédent utilise la méthode utile <code>inspect</code>, qui retourne une chaine avec une représentation littérale de l'objet qui l'appelle&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="nb">puts</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>            <span class="c1"># Rend une liste comme chaine.</span>
<span class="go">1</span>
<span class="go">2</span>
<span class="go">3</span>
<span class="go">4</span>
<span class="go">5</span>
<span class="gp">&gt;&gt; </span><span class="nb">puts</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">inspect</span>    <span class="c1"># Rend une liste littérale.</span>
<span class="go">[1, 2, 3, 4, 5]</span>
<span class="gp">&gt;&gt; </span><span class="nb">puts</span> <span class="ss">:nom</span><span class="p">,</span> <span class="ss">:nom</span><span class="o">.</span><span class="n">inspect</span>
<span class="go">name</span>
<span class="go">:nom</span>
<span class="gp">&gt;&gt; </span><span class="nb">puts</span> <span class="s2">&quot;Ça marche&nbsp;!&quot;</span><span class="p">,</span> <span class="s2">&quot;Ça marche&nbsp;!&quot;</span><span class="o">.</span><span class="n">inspect</span>
<span class="go">Ça marche&nbsp;!</span>
<span class="go">&quot;Ça marche&nbsp;!&quot;</span>
</pre></div>
</div>


<p>En passant, utiliser <code>inspect</code> pour imprimer un objet est assez courant pour qu'il y ait un raccourci pour le faire, la fonction <code>p</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="nb">p</span> <span class="ss">:nom</span>             <span class="c1"># Identique à &#39;puts :nom.inspect&#39;</span>
<span class="go">:nom</span>
</pre></div>
</div>




<div class="label" id="sec:css_revisited"></div>


<h3><a id="sec:4.3.4" href="rails-flavored-ruby#sec:css_revisited" class="heading"><span class="number">4.3.4</span> CSS Revisité</a></h3>


<p>Il est temps maintenant de revisiter les lignes de l'<a class="ref" href="rails-flavored-ruby#code:layout_with_stylesheets">extrait&nbsp;4.4</a> utilisées dans le layout pour inclure les feuilles de styles en cascade&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s1">&#39;blueprint/screen&#39;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;screen&#39;</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s1">&#39;blueprint/print&#39;</span><span class="p">,</span>  <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;print&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>Nous sommes maintenant tout près de pouvoir les comprendre. Comme mentionné brièvement à la <a class="ref" href="rails-flavored-ruby#sec:cascading_style_sheets">section&nbsp;4.1.2</a>, Rails définit une fonction spéciale pour inclure les feuilles de styles, et&nbsp;: </p>

<div class="code"><div class="highlight"><pre><span class="n">stylesheet_link_tag</span> <span class="s1">&#39;blueprint/screen&#39;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;screen&#39;</span>
</pre></div>
</div>


<p>… est un appel à cette fonction. Mais il demeure deux mystères. <em>Primo</em>, où sont les parenthèses&nbsp;? En Ruby, elles sont optionnelles&nbsp;; ces deux lignes sont équivalentes&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="c1"># Les parenthèses optionnelles à l'appel de la fonction.</span>
<span class="n">stylesheet_link_tag</span><span class="p">(</span><span class="s1">&#39;blueprint/screen&#39;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;screen&#39;</span><span class="p">)</span>
<span class="n">stylesheet_link_tag</span> <span class="s1">&#39;blueprint/screen&#39;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;screen&#39;</span>
</pre></div>
</div>


<p><em>Secondo</em>, l'argument <code>:media</code> ressemble à une table de hachage, mais où sont les accolades&nbsp;? Quand une table de hachage est le  <em>dernier</em> argument d'une fonction, ses accolades sont optionnelles&nbsp;; ces deux lignes sont donc équivalentes&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="c1"># Accolades optionnelles sur l'argument final.</span>
<span class="n">stylesheet_link_tag</span> <span class="s1">&#39;blueprint/screen&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;screen&#39;</span> <span class="p">}</span>
<span class="n">stylesheet_link_tag</span> <span class="s1">&#39;blueprint/screen&#39;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;screen&#39;</span>
</pre></div>
</div>


<p>Donc, nous voyons maintenant que chacune des lignes&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s1">&#39;blueprint/screen&#39;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;screen&#39;</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s1">&#39;blueprint/print&#39;</span><span class="p">,</span>  <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;print&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>… appellent la fonction <code>stylesheet_link_tag</code> avec deux arguments&nbsp;: une chaine de caractères, indiquant le chemin d'accès (relatif) au fichier de la feuille de styles CSS, et une table de hachage, indiquant le type de média concerné (<code>&rsquo;screen&rsquo;</code> pour l'écran de l'ordinateur et <code>&rsquo;print&rsquo;</code> pour la version imprimée). Grâce au balisage <tt class="verb">&lt;%= %&gt;</tt>, les résultats sont insérés dans le template par ERb, et si vous regardez le code source de la page dans votre navigateur vous pourrez voir le code nécessaire pour inclure une feuille de styles (<a class="ref" href="rails-flavored-ruby#code:css_source">extrait&nbsp;4.6</a>).<sup class="footnote" id="fnref:4.14"><a href="#fn:4.14">14</a></sup></p>

<div class="label" id="code:css_source"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 4.6.</span> <span class="description">Le code HTML produit par l'inclusion d'une CSS.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;/stylesheets/blueprint/screen.css&quot;</span> <span class="na">media=</span><span class="s">&quot;screen&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span>
<span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;/stylesheets/blueprint/print.css&quot;</span> <span class="na">media=</span><span class="s">&quot;print&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span>
<span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div></div>




<div class="label" id="sec:ruby_classes"></div>


<h2><a id="sec:4.4" href="rails-flavored-ruby#sec:ruby_classes" class="heading"><span class="number">4.4</span> Classes Ruby</a></h2>


<p>Nous avons dit auparavant que tout dans Ruby était <rw>objet</rw>, et dans cette section nous serons amenés à définir les nôtres. Ruby, comme beaucoup de langages orienté-objet, utilise les <rw>classes</rw> pour organiser les méthodes&nbsp;; ces classes sont alors <em>instanciées</em> pour créer des objets. Si vous êtes débutant en programmation orienté-objet (POO), cela peut ressembler à du charabia, donc étudions quelques exemples concrets.</p>

<div class="label" id="sec:constructors"></div>


<h3><a id="sec:4.4.1" href="rails-flavored-ruby#sec:constructors" class="heading"><span class="number">4.4.1</span> Constructeurs</a></h3>


<p>Nous avons vu beaucoup d'exemples d'utilisation des classes pour instancier des objets, mais nous devons encore le faire de façon explicite. Par exemple, nous avons instancié une chaine de caractère en utilisant les guillemets, qui est le <em>constructeur littéral</em> de chaines&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;foobar&quot;</span>       <span class="c1"># Un constructeur littéral de chaine utilisant les guillemets</span>
<span class="go">=&gt; &quot;foobar&quot;</span>
<span class="gp">&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">class</span>
<span class="go">=&gt; String</span>
</pre></div>
</div>


<p>Nous voyons ici que la chaine répond à la méthode <code>class</code>, et retourne simplement la classe à laquelle elle appartient («&nbsp;String&nbsp;», <em>Chaine</em>).</p>

<p>Plutôt que d'utiliser un constructeur littéral, nous pouvons utiliser le <em>contructeur nommé</em> équivalent, ce qui implique d'appeler la méthode <code>new</code> sur le nom de la classe&nbsp;:<sup class="footnote" id="fnref:4.15"><a href="#fn:4.15">15</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="nb">String</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;foobar&quot;</span><span class="p">)</span>   <span class="c1"># Un constructeur nommé pour les chaines</span>
<span class="go">=&gt; &quot;foobar&quot;</span>
<span class="gp">&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">class</span>
<span class="go">=&gt; String</span>
<span class="gp">&gt;&gt; </span><span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;foobar&quot;</span>
<span class="go">=&gt; true</span>
</pre></div>
</div>


<p>C'est équivalent au constructeur littéral, mais c'est plus explicite sur ce que nous faisons.</p>

<p>Les Tableaux (<rw>Arrays</rw>) fonctionnent de la même façon que les chaines&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">)</span>
<span class="go">=&gt; [1, 3, 2]</span>
</pre></div>
</div>


<p>Les tables de hachage (<rw>Hash</rw>), en revanche, sont différentes. Tandis que le constructeur de tableau <code>Array.new</code> prend une valeur initiale pour le tableau, <code>Hash.new</code> prend une valeur <em>par défaut</em> pour la table, qui est la valeur de la table pour une clé inexistante&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span>
<span class="go">=&gt; {}</span>
<span class="gp">&gt;&gt; </span><span class="n">h</span><span class="o">[</span><span class="ss">:foo</span><span class="o">]</span>            <span class="c1"># Essai d'accès à la valeur d'une clé :foo inexistante.</span>
<span class="go">=&gt; nil</span>
<span class="gp">&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>    <span class="c1"># pour que les clés inexistantes retournent 0 plutôt que nil.</span>
<span class="go">=&gt; {}</span>
<span class="gp">&gt;&gt; </span><span class="n">h</span><span class="o">[</span><span class="ss">:foo</span><span class="o">]</span>
<span class="go">=&gt; 0</span>
</pre></div>
</div>




<div class="label" id="sec:a_class_of_our_own"></div>


<h3><a id="sec:4.4.2" href="rails-flavored-ruby#sec:a_class_of_our_own" class="heading"><span class="number">4.4.2</span> Héritage de classe</a></h3>


<p>Quand on apprend les classes, il est utile de trouver la <em>hiérarchie de classe</em> en utilisant la méthode <code>superclass</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="nb">String</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;foobar&quot;</span><span class="p">)</span>
<span class="go">=&gt; &quot;foobar&quot;</span>
<span class="gp">&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">class</span>                        <span class="c1"># Trouver la classe de s.</span>
<span class="go">=&gt; String</span>
<span class="gp">&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span>             <span class="c1"># Trouver la superclasse de la classe String.</span>
<span class="go">=&gt; Object</span>
<span class="gp">&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span>  <span class="c1"># Ruby 1.9 -> BasicObject</span>
<span class="go">=&gt; BasicObject </span>
<span class="gp">&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span>
<span class="go">=&gt; nil</span>
</pre></div>
</div>


<p>Dans le diagramme de cette héritage hiérarchique dans l<a class="ref" href="rails-flavored-ruby#fig:string_inheritance_ruby_1_9">illustration&nbsp;4.2</a>, nous voyons que la superclasse de <code>String</code> (<em>Chaine</em>) est la classe <code>Object</code> et la superclasse de la classe <code>Object</code> est la classe <code>BasicObject</code>, mais  <code>BasicObject</code> ne possède pas de superclasse. Ce modèle est vrai pour chaque objet Ruby&nbsp;: remontez la hiérarchie des classes assez loin, et chaque classe Ruby héritera en fin de compte de la classe <code>BasicObject</code>, qui n'a pas de superclasse elle-même. C'est l'explication technique de «tout en Ruby est objet».</p>

<div class="label" id="fig:string_inheritance_ruby_1_9"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/string_inheritance_ruby_1_9.png" alt="string_inheritance_ruby_1_9" /></span></div><div class="caption"><span class="header">Illustration 4.2: </span><span class="description">La hiérarchie des héritages pour la classe <code>String</code>.</span></div></div>


<p>Pour comprendre les classes un peu plus profondément, il n'y a rien de mieux que de construire les nôtres. Construison une classe <code>Mot</code> possédant une méthode <code>palindrome?</code> qui retourne <code>true</code> (<em>vrai</em>) si le mot est un palindrome (s'il s'épelle de la même façon à l'endroit et à l'envers)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="k">class</span> <span class="nc">Mot</span>
<span class="gp">&gt;&gt; </span>  <span class="k">def</span> <span class="nf">palindrome?</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="gp">&gt;&gt; </span>    <span class="n">string</span> <span class="o">==</span> <span class="n">string</span><span class="o">.</span><span class="n">reverse</span>
<span class="gp">&gt;&gt; </span>  <span class="k">end</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">=&gt; nil</span>
</pre></div>
</div>


<p>Nous pouvons l'utiliser comme suit&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="no">Mot</span><span class="o">.</span><span class="n">new</span>              <span class="c1"># Fait un nouvel objet Mot.</span>
<span class="go">=&gt; #&lt;Mot:0x22d0b20&gt;</span>
<span class="gp">&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">palindrome?</span><span class="p">(</span><span class="s2">&quot;foobar&quot;</span><span class="p">)</span>
<span class="go">=&gt; false</span>
<span class="gp">&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">palindrome?</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">)</span>
<span class="go">=&gt; true</span>
</pre></div>
</div>


<p>Si cet exemple vous semble un peu artificiel, tant mieux&nbsp;; c'est à dessein. C'est étrange de créer une nouvelle classe juste pour créer une méthode qui prend une chaine de caractère comme argument. Puisqu'un mot <em>est une</em> chaine de caractères, il semble naturel que notre classe <code>Mot</code> <em>hérite</em> de la classe <code>String</code>, comme nous le voyons dans l'<a class="ref" href="rails-flavored-ruby#code:word_class">extrait&nbsp;4.7</a> (vous devriez quitter la console et la relancer pour effacer l'ancienne définition de  <code>Mot</code>).</p>

<div class="label" id="code:word_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 4.7.</span> <span class="description">Définir une classe <code>Mot</code> dans la console.</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="k">class</span> <span class="nc">Mot</span> <span class="o">&lt;</span> <span class="nb">String</span>             <span class="c1"># Mot hérite de String.</span>
<span class="gp">&gt;&gt; </span>  <span class="c1"># Renvoie true si la chaine est son propre inverse.</span>
<span class="gp">&gt;&gt; </span>  <span class="k">def</span> <span class="nf">palindrome?</span>
<span class="gp">&gt;&gt; </span>    <span class="nb">self</span> <span class="o">==</span> <span class="nb">self</span><span class="o">.</span><span class="n">reverse</span>        <span class="c1"># self est la chaine elle-même.</span>
<span class="gp">&gt;&gt; </span>  <span class="k">end</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">=&gt; nil</span>
</pre></div>
</div></div>


<p>Ici <code>Mot &lt; String</code> est la syntaxe d'héritage Ruby (discuté brièvement à la <a class="ref" href="static-pages#sec:static_pages_with_rails">section&nbsp;3.1.2</a>), qui s'assure que, en plus de la nouvelle méthode <code>palindrome?</code>, les mots héritent des mêmes méthodes que les chaines de caractères&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="no">Mot</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">)</span>    <span class="c1"># Fait un nouveau Mot, initialisé à  &quot;level&quot;.</span>
<span class="go">=&gt; &quot;level&quot;                  </span>
<span class="gp">&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">palindrome?</span>            <span class="c1"># Mot possèdent la méthode palindrome?.</span>
<span class="go">=&gt; true                     </span>
<span class="gp">&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">length</span>                 <span class="c1"># Mot héritent aussi de toutes les méthodes des chaines.</span>
<span class="go">=&gt; 5</span>
</pre></div>
</div>


<p>Puisque la classe <code>Mot</code> hérite de la classe <code>String</code>, nous pouvons utiliser la console pour voir la hiérarchie des classes explicitement&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">class</span>
<span class="go">=&gt; Mot</span>
<span class="gp">&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span>
<span class="go">=&gt; String</span>
<span class="gp">&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span>
<span class="go">=&gt; Object</span>
</pre></div>
</div>


<p>Cette hiérarchie est présentée dans l'<a class="ref" href="rails-flavored-ruby#fig:word_inheritance_ruby_1_9">illustration&nbsp;4.3</a>.</p>

<div class="label" id="fig:word_inheritance_ruby_1_9"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/word_inheritance_ruby_1_9.png" alt="word_inheritance_ruby_1_9" /></span></div><div class="caption"><span class="header">Illustration 4.3: </span><span class="description">La hiérarchie de l'héritage pour une classe (non-intégré) <code>Mot</code> de l'<a class="ref" href="rails-flavored-ruby#code:word_class">extrait&nbsp;4.7</a>.</span></div></div>


<p>Dans l'<a class="ref" href="rails-flavored-ruby#code:word_class">extrait&nbsp;4.7</a>, notez que vérifier que le mot est son propre inverse implique d'avoir accès au mot à l'intérieur de la classe <code>Mot</code>. Ruby nous permet de le faire en utilisant le mot-clé <code>self</code>&nbsp;: à l'intérieur de la classe <code>Mot</code>, <code>self</code> est l'objet lui-même, ce qui signifie que nous pouvons utiliser&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="nb">self</span> <span class="o">==</span> <span class="nb">self</span><span class="o">.</span><span class="n">reverse</span>
</pre></div>
</div>


<p>… pour vérifier que le mot est un palindrome.<sup class="footnote" id="fnref:4.16"><a href="#fn:4.16">16</a></sup></p>

<div class="label" id="sec:modifying_built_in_classes"></div>


<h3><a id="sec:4.4.3" href="rails-flavored-ruby#sec:modifying_built_in_classes" class="heading"><span class="number">4.4.3</span> Modifier les classes d'origine</a></h3>


<p>Bien que l'héritage soit une idée puissante, dans le cas des palindromes il peut être plus naturel d'ajouter la méthode <code>palindrome?</code> à la classe <code>String</code> elle-même, ce qui, entre autres choses, nous permettrait d'appeler <code>palindrome?</code> sur une chaine littérale, ce que nous ne pouvons pas encore faire&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s2">&quot;level&quot;</span><span class="o">.</span><span class="n">palindrome?</span>
<span class="go">NoMethodError: undefined method `palindrome?&#39; for &quot;level&quot;:String</span>
<span class="c1">(Traduction&nbsp;:</span>
<span class="c1">ErreurAbsenceMethode&nbsp;: méthode `palindrome?&#39; indéfinie pour la chaine &quot;level&quot;</span>
</pre></div>
</div>


<p>Assez étonnamment, Ruby vous laisse le faire&nbsp;; les classes Ruby peuvent être <em>ouvertes</em> et modifiée, permettant au commun des mortels d'y ajouter ses propres méthodes&nbsp;:<sup class="footnote" id="fnref:4.17"><a href="#fn:4.17">17</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="k">class</span> <span class="nc">String</span>
<span class="gp">&gt;&gt; </span>  <span class="c1"># Retourne vrai si la chaine est son propre inverse.</span>
<span class="gp">&gt;&gt; </span>  <span class="k">def</span> <span class="nf">palindrome?</span>
<span class="gp">&gt;&gt; </span>    <span class="nb">self</span> <span class="o">==</span> <span class="nb">self</span><span class="o">.</span><span class="n">reverse</span>
<span class="gp">&gt;&gt; </span>  <span class="k">end</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">=&gt; nil</span>
<span class="gp">&gt;&gt; </span><span class="s2">&quot;kayak&quot;</span><span class="o">.</span><span class="n">palindrome?</span>
<span class="go">=&gt; true</span>
</pre></div>
</div>


<p>(Je ne sais pas ce qui est le plus sympa&nbsp;: que Ruby nous laisse ajouter des méthodes à des classes intégrées ou que <code>«&nbsp;kayak&nbsp;»</code> soit un palindrome.)</p>

<p>Modifier les classes intégrées est une technique puissante, mais avec un grand pouvoir vient une grande responsabilité, et il est considéré comme une mauvaise chose d'ajouter des méthodes aux classes intégrées sans avoir une <em>réelle</em> bonne raison de le faire. Rails a réellement de bonnes raisons&nbsp;; par exmple, dans les applications web, nous voulons souvent nous assurer que les variables ne soient pas <em>vierges</em> (<em>blank</em>) &mdash;&nbsp;par exemple le nom d'un utilisateur doit être autre chose que des espaces ou autre <a href="http://en.wikipedia.org/wiki/Whitespace_(computer_science)">espace blanc</a>&nbsp;&mdash; donc Rails ajoute la méthode <code>blank?</code> à Ruby. Puisque la console Rails inclut automatiquement les extensions Rails, nous pouvons voir un exemple ici (celui-ci ne fonctionne pas en plein  <code>irb</code>)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">blank?</span>
<span class="go">=&gt; true</span>
<span class="gp">&gt;&gt; </span><span class="s2">&quot;      &quot;</span><span class="o">.</span><span class="n">empty?</span>
<span class="go">=&gt; false</span>
<span class="gp">&gt;&gt; </span><span class="s2">&quot;      &quot;</span><span class="o">.</span><span class="n">blank?</span>
<span class="go">=&gt; true</span>
<span class="gp">&gt;&gt; </span><span class="kp">nil</span><span class="o">.</span><span class="n">blank?</span>
<span class="go">=&gt; true</span>
</pre></div>
</div>


<p>Nous voyons qu'une chaine constituée d'espaces n'est pas vide (<em>empty</em>), mais elle est vierge (<em>blank</em>). Notez aussi que <code>nil</code> est vierge&nbsp;; puisque <code>nil</code> n'est pas une chaine de caractères, c'est une indication que Rails, en réalité, ajoute la méthode booléenne <code>blank?</code> à la classe de base <code>String</code>, qui est elle-même (comme nous l'avons vu au début de cette section) un <code>Objet</code>. Nous verrons d'autres exemples d'addition de Rails aux classes Ruby à la <a class="ref" href="sign-in-sign-out#sec:remember_me">section&nbsp;9.3.2</a>.</p>

<div class="label" id="sec:a_controller_class"></div>


<h3><a id="sec:4.4.4" href="rails-flavored-ruby#sec:a_controller_class" class="heading"><span class="number">4.4.4</span> Une classe contrôleur</a></h3>


<p>Tous ces propos sur les classes et l'héritage peut avoir ravivé quelque souvenir, puisque nous les avons déjà vu auparavant, dans le contrôleur Pages (<a class="ref" href="static-pages#code:pages_controller_with_title">extrait&nbsp;3.24</a>):</p>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
    <span class="vi">@titre</span> <span class="o">=</span> <span class="s2">&quot;Accueil&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">contact</span>
    <span class="vi">@titre</span> <span class="o">=</span> <span class="s2">&quot;Contact&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">about</span>
    <span class="vi">@titre</span> <span class="o">=</span> <span class="s2">&quot;À Propos&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>


<p>Vous êtes maintenant en mesure d'apprécier, au moins vaguement, ce que ce code signifie&nbsp;: <code>PagesController</code> est une classe qui hérite de la classe <code>ApplicationController</code>, et arrive toute équipée des méthodes <code>home</code> (<em>accueil</em>), <code>contact</code>, et <code>about</code> (<em>à propos</em>), chacune d'elle définissant une variable d'instance <code>@titre</code> (<em>titre</em>). Puisque chaque session de console Rails charge l'environnement local Rails, nous pouvons même créer un contrôleur explicitement et examiner sa hiérarchir de classe&nbsp;:<sup class="footnote" id="fnref:4.18"><a href="#fn:4.18">18</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">controller</span> <span class="o">=</span> <span class="no">PagesController</span><span class="o">.</span><span class="n">new</span>
<span class="go">=&gt; #&lt;PagesController:0x22855d0&gt;</span>
<span class="gp">&gt;&gt; </span><span class="n">controller</span><span class="o">.</span><span class="n">class</span>
<span class="go">=&gt; PagesController</span>
<span class="gp">&gt;&gt; </span><span class="n">controller</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span>
<span class="go">=&gt; ApplicationController</span>
<span class="gp">&gt;&gt; </span><span class="n">controller</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span>
<span class="go">=&gt; ActionController::Base</span>
<span class="gp">&gt;&gt; </span><span class="n">controller</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span>
<span class="go">=&gt; ActionController::Metal</span>
<span class="gp">&gt;&gt; </span><span class="n">controller</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span>
<span class="go">=&gt; AbstractController::Base</span>
<span class="gp">&gt;&gt; </span><span class="n">controller</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">superclass</span>
<span class="go">=&gt; Object</span>
</pre></div>
</div>


<p>Le diagramme de cette hiérarchie est présenté dans l'<a class="ref" href="rails-flavored-ruby#fig:pages_controller_inheritance_rails_3">illustration&nbsp;4.4</a>.</p>

<div class="label" id="fig:pages_controller_inheritance_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/pages_controller_inheritance_rails_3.png" alt="pages_controller_inheritance_rails_3" /></span></div><div class="caption"><span class="header">Illustration 4.4: </span><span class="description">La hiérarchir d'héritage du contrôleur Pages.</span></div></div>


<p>Nous pouvons même appeler les actions du contrôleur à l'intérieur de la console, tout comme des méthodes&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">controller</span><span class="o">.</span><span class="n">home</span>
<span class="go">=&gt; &quot;Accueil&quot;</span>
</pre></div>
</div>


<p>Cette valeur de retour <code>"Accueil"</code> vient de l'assignement <code>@titre = "Accueil"</code> dans l'action <code>home</code>.</p>

<p>Mais attendez  &mdash;&nbsp;les actions n'ont pas de valeurs de retour, du moins pas celles qui nous intéressent. Pour ce qui est de l'action <code>home</code>, comme nous l'avons vu au <a class="ref" href="static-pages#top">chapitre&nbsp;3</a>, sa fonction est de rendre une page web. Et je suis certain de ne pas me souvenir avoir jamais appelé <code>PagesController.new</code> quelque part. Que se passe-t-il donc&nbsp;?…</p>

<p>Ce qui se passe, c'est que Rails est <em>écrit en</em> Ruby, mais que Rails <em>n'est pas</em> Ruby. Certaines classes Rails sont utilisées comme des objets Ruby ordinaires, mais d'autres sont conçues pour les capacités magiques de Rails. Rails est <a href="http://fr.wikipedia.org/wiki/Sui_generis"><em>sui generis</em></a>, et devrait être étudié et compris indépendamment de Ruby. C'est pourquoi, si votre intérêt principal est de programmer des applications web, je vous recommande d'étudier Rails d'abord, puis d'apprendre Ruby avant de revenir à Rails.</p>

<div class="label" id="sec:a_user_class"></div>


<h3><a id="sec:4.4.5" href="rails-flavored-ruby#sec:a_user_class" class="heading"><span class="number">4.4.5</span> Une classe utilisateur (<em>user</em>)</a></h3>


<p>Nous terminons notre tour de Ruby avec une classe de notre propre cru, une classe utilisateur <code>User</code> qui anticipe le modèle utilisateur qui sera utilisé au <a class="ref" href="modeling-and-viewing-users-one#top">chapitre&nbsp;6</a>.</p>

<p>Jusqu'ici nous avons entré les définitions des classes à la console, mais cela devient rapidement fatigant&nbsp;; nous allons plutôt créer un fichier <code>example_user.rb</code> dans notre dossier racine Rails et allons le remplir avec le code de l'<a class="ref" href="rails-flavored-ruby#code:example_user">extrait&nbsp;4.8</a> (souvenez-vous de la <a class="ref" href="beginning#sec:conventions">section&nbsp;1.1.3</a>&nbsp;: la racine de Rails est le dossier racine de votre <em>application</em>&nbsp;; par exemple, la racine Rails de ma propre application exemple est <tt>/Users/mhartl/rails_projects/sample_app</tt>).</p>

<div class="label" id="code:example_user"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 4.8.</span> <span class="description">Code pour un exemple d'utilisateur. <br /> <code>example_user.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span>
  <span class="kp">attr_accessor</span> <span class="ss">:nom</span><span class="p">,</span> <span class="ss">:email</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="vi">@nom</span>  <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:nom</span><span class="o">]</span>
    <span class="vi">@email</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">formatted_email</span>
    <span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@nom</span><span class="si">}</span><span class="s2"> &lt;</span><span class="si">#{</span><span class="vi">@email</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Il y a beaucoup de choses d'un coup ici, donc reprenons ce code pas à pas. La première ligne&nbsp;:</p>

<div class="code"><div class="highlight"><pre>  <span class="kp">attr_accessor</span> <span class="ss">:nom</span><span class="p">,</span> <span class="ss">:email</span>
</pre></div>
</div>


<p>… crée un <em>accesseur d'attribut</em> (<em>attribute accessor</em>) pour le nom de l'utilisateur et son adresse email. Cela crée les méthodes «getter» («&nbsp;<em>obteneur</em>&nbsp;») et «setter» («&nbsp;<em>assigneur</em>&nbsp;») qui nous permettent comme leur nom l'indique d'obtenir (<em>get</em>) et d'assigner (<em>set</em>) les variables d'instance <code>@nom</code> et <code>@email</code>.</p>

<p>La première méthode, <code>initialize</code>, est spéciale en Ruby&nbsp;: c'est la méthode appelée quand nous exécutons le code <code>User.new</code>. Cette méthode particulière <code>initialize</code> reçoit un argument, <code>attributes</code> (<em>attributs</em>)&nbsp;:</p>

<div class="code"><div class="highlight"><pre>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="vi">@nom</span>  <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:nom</span><span class="o">]</span>
    <span class="vi">@email</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span>
  <span class="k">end</span>
</pre></div>
</div>


<p>Ici la variable <code>attributes</code> a une <em>valeur par défaut</em> égale à une table de hachage vide, donc nous pouvons définir un utilisateur sans nom et sans adresse email (en vous souvenant de la <a class="ref" href="rails-flavored-ruby#sec:hashes_and_symbols">section&nbsp;4.3.3</a>&nbsp;: les tables de hachage retournent <code>nil</code> pour une clé inexistante, donc <code>attributes[:nom]</code> sera <code>nil</code> s'il n'y a pas de clé  <code>:nom</code>, même chose pour <code>attributes[:email]</code>).</p>

<p>Enfin, notre classe définit une méthode appelée <code>formatted_email</code> qui utilise les valeurs assignées aux variables <code>@nom</code> et <code>@email</code> pour construire une version bien formatée de l'adresse email en utilisant l'interpolation de chaine (<a class="ref" href="rails-flavored-ruby#sec:strings">section&nbsp;4.2.2</a>)&nbsp;:</p>

<div class="code"><div class="highlight"><pre>  <span class="k">def</span> <span class="nf">formatted_email</span>
    <span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@nom</span><span class="si">}</span><span class="s2"> &lt;</span><span class="si">#{</span><span class="vi">@email</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
  <span class="k">end</span>
</pre></div>
</div>


<p>Lançons la console, appelons (<code>require</code>) le code de l'exemple d'utilisateur et essayons notre classe User ainsi définie&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="nb">require</span> <span class="s1">&#39;./example_user&#39;</span>     <span class="c1"># C'est la façon de charger le code de example_user.</span>
<span class="go">=&gt; [&quot;User&quot;]</span>
<span class="gp">&gt;&gt; </span><span class="n">example</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span>
<span class="go">=&gt; #&lt;User:0x224ceec @email=nil, @nom=nil&gt;</span>
<span class="gp">&gt;&gt; </span><span class="n">example</span><span class="o">.</span><span class="n">nom</span>                 <span class="c1"># nul puisque  attributes[:nom] est nul</span>
<span class="go">=&gt; nil</span>
<span class="gp">&gt;&gt; </span><span class="n">example</span><span class="o">.</span><span class="n">nom</span> <span class="o">=</span> <span class="s2">&quot;Exemple d'utilisateur&quot;</span>           <span class="c1"># Assigne un nom non nul</span>
<span class="go">=&gt; &quot;Exemple d'utilisateur&quot;</span>
<span class="gp">&gt;&gt; </span><span class="n">example</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;user@example.com&quot;</span>      <span class="c1"># et une adresse email non nulle</span>
<span class="go">=&gt; &quot;user@example.com&quot;</span>
<span class="gp">&gt;&gt; </span><span class="n">example</span><span class="o">.</span><span class="n">formatted_email</span>
<span class="go">=&gt; &quot;Exemple d'utilisateur &lt;user@example.com&gt;&quot;</span>
</pre></div>
</div>


<p>Ici le <code>&rsquo;.&rsquo;</code> signifie en Unix «&nbsp;dossier courant&nbsp;», et <code>&rsquo;./example_user&rsquo;</code> dit à Ruby de chercher un fichier d'exemple d'utilisateur dans ce dossier courant. Le code suivant crée un exemple d'utilisateur vide et définit le nom et l'adresse mail en assignant directement les attributs respectifs (l'assignement «&nbsp;depuis l'extérieur&nbsp;» est rendu possible par la ligne <code>attr_accessor</code> de l'<a class="ref" href="rails-flavored-ruby#code:example_user">extrait&nbsp;4.8</a>). Quand nous écrivons&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="n">example</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Exemple d'utilisateur&quot;</span>
</pre></div>
</div>


<p>… Ruby assigne (<em>set</em>) la valeur <code>Exemple d'utilisateur</code> à la variable <code>@nom</code> (de même pour l'attribut <code>email</code>), que nous utilisons alors pour la méthode <code>formatted_email</code>.</p>

<p>Souvenez-vous d'après la <a class="ref" href="rails-flavored-ruby#sec:css_revisited">section&nbsp;4.3.4</a> que nous pouvons omettre les accolades pour une table de hachage en argument final d'une fonction, nous pouvons donc créer une autre utilisateur avec des valeurs prédéfinies en passant une table de hachage à la méthode <code>initialize</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:nom</span> <span class="o">=&gt;</span> <span class="s2">&quot;Michael Hartl&quot;</span><span class="p">,</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">&quot;mhartl@example.com&quot;</span><span class="p">)</span>
<span class="go">=&gt; #&lt;User:0x225167c @email=&quot;mhartl@example.com&quot;, @nom=&quot;Michael Hartl&quot;&gt;</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">formatted_email</span>
<span class="go">=&gt; &quot;Michael Hartl &lt;mhartl@example.com&gt;&quot;</span>
</pre></div>
</div>


<p>Nous verrons en abordant le <a class="ref" href="sign-up#top">chapitre&nbsp;8</a> qu'initialiser des objets en utilisant un attribut de type table de hachage est courant pour les applications Rails.</p>

<div class="label" id="sec:exercises"></div>


<h2><a id="sec:4.5" href="rails-flavored-ruby#sec:exercises" class="heading"><span class="number">4.5</span> Exercises</a></h2>




<ol>

<li>En utilisant l'<a class="ref" href="rails-flavored-ruby#code:string_shuffle">extrait&nbsp;4.9</a> comme guide, combinez les méthode <code>split</code> (<em>découper</em>), <code>shuffle</code> (<em>mélanger</em>), et <code>join</code> (<em>joindre</em>) pour écrire une fonction qui mélange les lettres d'une chaine de caractère donnée.</li>

<li>En vous appuyant sur l'<a class="ref" href="rails-flavored-ruby#code:string_shuffle_two">extrait&nbsp;4.10</a>, ajoutez une méthode <code>shuffle</code> à la classe <code>String</code>.</li>

<li>Créez trois tables de hachage appelées <code>personne1</code>, <code>personne2</code> et <code>personne3</code>, contenant les clés <code>:prenom</code> pour le prénom et <code>:nom</code> pour le patronyme. Créez alors des paramètres de telle sorte que <code>params[:pere]</code> soit la <code>personne1</code>, <code>params[:mere]</code> soit la <code>personne2</code> et <code>params[:enfant]</code> soit la <code>personne3</code>. Vérifiez que, par exemple, <code>params[:pere][:prenom]</code> ait la bonne valeur.</li>

<li>Trouvez une version en ligne de l'API Ruby et consultez la méthode de hachage (<code>Hash</code>) <code>merge</code> (<em>fusionner</em>).</li>
</ol>




<div class="label" id="code:string_shuffle"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 4.9.</span> <span class="description">Squelette d'une fonction chaine <code>shuffle</code>.</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="k">def</span> <span class="nf">string_shuffle</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt; </span>  <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="sc">?.</span><span class="p">?</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">=&gt; nil</span>
<span class="gp">&gt;&gt; </span><span class="n">string_shuffle</span><span class="p">(</span><span class="s2">&quot;foobar&quot;</span><span class="p">)</span>
</pre></div>
</div></div>




<div class="label" id="code:string_shuffle_two"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 4.10.</span> <span class="description">Squelette d'une méthode <code>shuffle</code> attachée à la classe <code>String</code>.</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="k">class</span> <span class="nc">String</span>
<span class="gp">&gt;&gt; </span>  <span class="k">def</span> <span class="nf">shuffle</span>
<span class="gp">&gt;&gt; </span>    <span class="nb">self</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="sc">?.</span><span class="p">?</span>
<span class="gp">&gt;&gt; </span>  <span class="k">end</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">=&gt; nil</span>
<span class="gp">&gt;&gt; </span><span class="s2">&quot;foobar&quot;</span><span class="o">.</span><span class="n">shuffle</span>
</pre></div>
</div></div>




<div class="navigation">  <a class="prev_page" href="static-pages#top">
    &laquo;&nbsp;<span class="number">chapitre 3</span> Page statiques courantes
  </a>
  <a class="next_page" href="filling-in-the-layout#top">
    <span class="number">chapitre 5</span> Poursuivre la mise en page&nbsp;&raquo;
  </a>
</div><div class="footnotes">
<ol>
<li id="fn:4.1">Si un <em>helper</em> est spécifique à un contrôleur particulier, vous devrez le placer dans le fichier helper correspondant&nbsp;; par exemple, les helpers du contrôleur Pages vont généralement dans le fichier <code>app/helpers/pages_helper.rb</code>. Dans notre cas, nous comptons que l'helper <code>titre</code> soit utilisé sur toutes les pages du site, et Rails possède un fichier helper spécial pour ça&nbsp;: <code>app/helpers/application_helper.rb</code>.&nbsp;<a class="arrow" href="#fnref:4.1">&uarr;</a></li>
<li id="fn:4.2">Je ne fournis pas de liens vers des API car ils ont une fâcheuse tendance à se démoder assez rapidement. Google reste votre guide. En passant, «&nbsp;API&nbsp;» signifie «<a href="http://en.wikipedia.org/wiki/Application_programming_interface">Application Programming Interface</a>» (<em>Interface de Programmation des Applications</em>).&nbsp;<a class="arrow" href="#fnref:4.2">&uarr;</a></li>
<li id="fn:4.3">Si vous êtes impatient, sentez-vous libre de consulter le <a href="http://wiki.github.com/joshuaclayton/blueprint-css/quick-start-tutorial">Tutoriel de démarrage rapide de Blueprint CSS</a>.&nbsp;<a class="arrow" href="#fnref:4.3">&uarr;</a></li>
<li id="fn:4.4">Souvenez-vous que l'invite de la console sera quelque chose comme <code>ruby-1.9.2-head &gt;</code>, mais les exemples utilisent &nbsp;<code>&gt;&gt;</code> puisque les version de Ruby varieront.&nbsp;<a class="arrow" href="#fnref:4.4">&uarr;</a></li>
<li id="fn:4.5">Comme pour l'API Rails, les liens vers les API Ruby sont vite dépassés, bien que moins rapidement. Google reste encore une fois votre guide.&nbsp;<a class="arrow" href="#fnref:4.5">&uarr;</a></li>
<li id="fn:4.6">Pour en savoir plus sur l'origine de «&nbsp;foo&nbsp;» et de «&nbsp;bar&nbsp;» &mdash;&nbsp;et, en particulier, la possible <em>non</em>-relation de «&nbsp;foobar&nbsp;» à «&nbsp;FUBAR&nbsp;»&nbsp;&mdash; voyez l'<a href="http://www.catb.org/jargon/html/F/foo.html">entrée «&nbsp;foo&nbsp;» dans le fichier Jargon</a>.&nbsp;<a class="arrow" href="#fnref:4.6">&uarr;</a></li>
<li id="fn:4.7">Les programmeurs familiers de Perl ou de PHP peuvent comparer cela à l'interpolation automatique du signe dollar des variables dans des expressions telles que <code>"foo $bar"</code>.&nbsp;<a class="arrow" href="#fnref:4.7">&uarr;</a></li>
<li id="fn:4.8">Mes excuses par avance pour passer sans considération du terme <em>fonction</em> (<em>function</em>) à celui de <em>méthode</em> (<em>method</em>) tout au long de chapitre&nbsp;; en Ruby, ce sont les mêmes choses&nbsp;: toutes les méthodes sont des fonctions, et toutes les fonctions sont des méthodes, puisque <em>tout en Ruby est objet</em>.&nbsp;<a class="arrow" href="#fnref:4.8">&uarr;</a></li>
<li id="fn:4.9">Bien, il restera encore <em>une</em> chose de côté que nous ne comprenons pas, qui est&nbsp;: comment Rails lie toutes ces choses ensemble&nbsp;: diriger les URLs vers les actions, rendre l'<em>helper</em>  <code>titre</code> utilisable dans les vues, etc. C'est un sujet intéressant, et je vous encourage à le creuser, mais savoir <em>comment</em> Rails fonctione n'est pas nécessaire pour <em>utiliser</em> Rails (pour une compréhension plus profonde, je recommande <a href="http://www.amazon.com/gp/product/0321601661?ie=UTF8&amp;tag=httpwwwrailst-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0321601661"><em>The Rails&nbsp;3 Way</em></a> par Obie Fernandez).&nbsp;<a class="arrow" href="#fnref:4.9">&uarr;</a></li>
<li id="fn:4.10">La méthode <code>second</code> utilisée ici n'est pas une partie de Ruby lui-même, mais est ajouté par Rails. Ça fonctionne dans ce cas parce la console Rails inclut automatiquement les extensions Rails à Ruby.&nbsp;<a class="arrow" href="#fnref:4.10">&uarr;</a></li>
<li id="fn:4.11">Les experts en programmation, d'un autre côté, peuvent tirer profit du fait de savoir que ces blocs sont des <em>closures</em> (ou «&nbsp;fermetures&nbsp;»), qui sont des fonctions anonymes ponctuelles avec des données attachées.&nbsp;<a class="arrow" href="#fnref:4.11">&uarr;</a></li>
<li id="fn:4.12">Ruby 1.9 garantit actuellement que les tables de hachage gardent leurs éléments dans le même ordre d'entrée, mais il serait imprudent de compter sur un ordre particulier dans ces tables.&nbsp;<a class="arrow" href="#fnref:4.12">&uarr;</a></li>
<li id="fn:4.13">Comme résultat d'avoir moins de bagages, les symboles sont plus simples à se comparer entre eux&nbsp;; les chaines de caractères ont besoin d'être comparées signe à signe tandis que les symboles peuvent être comparés d'un seul coup. Ça les rend idéal pour l'utilisation en tant que clé de table de hachage.&nbsp;<a class="arrow" href="#fnref:4.13">&uarr;</a></li>
<li id="fn:4.14">Vous voyez peut-être des nombres amusants, comme <code>?1257465942</code>, après les noms des fichiers CSS. Ils sont insérés par Rails pour s'assurer que les navigateurs rechargeront le code CSS quand il changera sur le serveur.&nbsp;<a class="arrow" href="#fnref:4.14">&uarr;</a></li>
<li id="fn:4.15">Ces résultats peuvent varier en fonction de la version de Ruby que vous utilisez. Cet exemple présume que vous utilisez la version &nbsp;1.9.2.&nbsp;<a class="arrow" href="#fnref:4.15">&uarr;</a></li>
<li id="fn:4.16">Pour en savoir plus sur les classes Ruby et le mot-clé <code>self</code>, consultez le pots <a href="http://railstips.org/">RailsTips</a> «<a href="http://railstips.org/blog/archives/2006/11/18/class-and-instance-variables-in-ruby/">Class and Instance Variables in Ruby</a>» (<em>Classe et variables d'instance en Ruby</em>).&nbsp;<a class="arrow" href="#fnref:4.16">&uarr;</a></li>
<li id="fn:4.17">Pour les familiers de JavaScript, cette fonctionnalité est comparable à l'utilisation des objets de prototype de classe intégrés pour augmenter une classe (merci au lecteur <a href="http://getsatisfaction.com/railstutorial/topics/adding_methods_to_built_in_classes_comparable_to_using_javascripts_prototype_object">Erik Eldridge</a> de me l'avoir suggéré).&nbsp;<a class="arrow" href="#fnref:4.17">&uarr;</a></li>
<li id="fn:4.18">Vous n'avez pas besoin de savoir ce que font chacune des classes de la hiérarchie. Moi-même, je ne sais pas ce qu'elles font toutes, alors que je programme en Ruby on Rails depuis 2005. Cela signifie soit (a) que je suis tout bonnement incompétent, soit (b) que vous pouvez être un développeur Rails qualifié sans en connaitre les entrailles. J'espère pour vous et moi que c'est la dernière proposition qui est la bonne.&nbsp;<a class="arrow" href="#fnref:4.18">&uarr;</a></li>
</ol>
</div>
