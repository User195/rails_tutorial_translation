<!--
	chapitre : 3 Pages statiques courantes
-->

<h1 class="title">Tutoriel Ruby on Rails </h1>


<h1 class="subtitle"> Apprendre Rails par l'exemple</h1>


<h2 class="author">Michael Hartl</h2>


<h1 class="contents">Contenu</h1>


<div id="table_of_contents"><ol>
<li class="chapter"><a href="beginning#top"><span class="number">Chapitre 1</span> De zéro au déploiement</a></li>
<li><ol>
<li class="section"><a href="beginning#sec:introduction"><span class="number">1.1</span> Introduction</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:comments_for_various_readers"><span class="number">1.1.1</span> Commentaires pour les lecteurs différents</a></li>
<li class="subsection"><a href="beginning#sec:1.1.2"><span class="number">1.1.2</span> &ldquo;Dimensionner&rdquo; Rails</a></li>
<li class="subsection"><a href="beginning#sec:conventions"><span class="number">1.1.3</span> Conventions utilisées dans ce livre</a></li></ol></li>
<li class="section"><a href="beginning#sec:up_and_running"><span class="number">1.2</span> Debout et au boulot</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:development_tools"><span class="number">1.2.1</span> Environnements de développement</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:1.2.1.1">IDEs</a></li>
<li class="subsubsection"><a href="beginning#sec:1.2.1.2">Éditeurs de texte et lignes de commande</a></li>
<li class="subsubsection"><a href="beginning#sec:1.2.1.3">Navigateurs</a></li>
<li class="subsubsection"><a href="beginning#sec:1.2.1.4">Note à propos des outils</a></li></ol></li>
<li class="subsection"><a href="beginning#sec:rubygems"><span class="number">1.2.2</span> Ruby, RubyGems, Rails, et Git</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:rails_installer_windows">Installation de Rails (Windows)</a></li>
<li class="subsubsection"><a href="beginning#sec:install_git">Installer Git</a></li>
<li class="subsubsection"><a href="beginning#sec:install_ruby">Installer Ruby</a></li>
<li class="subsubsection"><a href="beginning#sec:install_rubygems">Installer RubyGems</a></li>
<li class="subsubsection"><a href="beginning#sec:install_rails">Installer Rails</a></li></ol></li>
<li class="subsection"><a href="beginning#sec:the_first_application"><span class="number">1.2.3</span> La première application</a></li>
<li class="subsection"><a href="beginning#sec:bundler"><span class="number">1.2.4</span> Bundler</a></li>
<li class="subsection"><a href="beginning#sec:rails_server"><span class="number">1.2.5</span> <code>Le serveur rails (rails server)</code></a></li>
<li class="subsection"><a href="beginning#sec:mvc"><span class="number">1.2.6</span> Modèles-Vue-Contrôleur (MVC)</a></li></ol></li>
<li class="section"><a href="beginning#sec:version_control"><span class="number">1.3</span> Contrôle de versions avec Git</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:git_setup"><span class="number">1.3.1</span> Installation et réglages</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:1.3.1.1">Initialisation des réglages système</a></li>
<li class="subsubsection"><a href="beginning#sec:1.3.1.2">Initialisation des réglages du dépôt (repository)</a></li></ol></li>
<li class="subsection"><a href="beginning#sec:adding_and_committing"><span class="number">1.3.2</span> Ajout et mandat de dépôt</a></li>
<li class="subsection"><a href="beginning#sec:1.3.3"><span class="number">1.3.3</span> Qu'est-ce que Git peut faire de bien pour vous&nbsp;?</a></li>
<li class="subsection"><a href="beginning#sec:github"><span class="number">1.3.4</span> GitHub</a></li>
<li class="subsection"><a href="beginning#sec:git_commands"><span class="number">1.3.5</span> Branch, edit, commit, merge</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:git_branch">Branch</a></li>
<li class="subsubsection"><a href="beginning#sec:git_edit">Edit</a></li>
<li class="subsubsection"><a href="beginning#sec:git_commit">Commit</a></li>
<li class="subsubsection"><a href="beginning#sec:git_merge">Merge</a></li>
<li class="subsubsection"><a href="beginning#sec:git_push">Push</a></li></ol></li></ol></li>
<li class="section"><a href="beginning#sec:deploying"><span class="number">1.4</span> Déploiement</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:1.4.1"><span class="number">1.4.1</span> Réglages Heroku</a></li>
<li class="subsection"><a href="beginning#sec:heroku_step_one"><span class="number">1.4.2</span> Déploiement Heroku, première étape</a></li>
<li class="subsection"><a href="beginning#sec:1.4.3"><span class="number">1.4.3</span> Déploiement Heroku, seconde étape</a></li>
<li class="subsection"><a href="beginning#sec:heroku_commands"><span class="number">1.4.4</span> Commandes Heroku</a></li></ol></li>
<li class="section"><a href="beginning#sec:beginning_conclusion"><span class="number">1.5</span> Conclusion</a></li></ol></li>
<li class="chapter"><a href="a-demo-app#top"><span class="number">Chapitre 2</span> Une application démo</a></li>
<li><ol>
<li class="section"><a href="a-demo-app#sec:planning_the_application"><span class="number">2.1</span> Planifier l'application</a></li>
<li><ol>
<li class="subsection"><a href="a-demo-app#sec:modeling_users"><span class="number">2.1.1</span> Modéliser les utilisateurs</a></li>
<li class="subsection"><a href="a-demo-app#sec:modeling_microposts"><span class="number">2.1.2</span> Modéliser les micro-messages</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec:demo_users_resource"><span class="number">2.2</span> La ressource Utilisateurs (Users)</a></li>
<li><ol>
<li class="subsection"><a href="a-demo-app#sec:a_user_tour"><span class="number">2.2.1</span> Un tour de l'utilisateur</a></li>
<li class="subsection"><a href="a-demo-app#sec:mvc_in_action"><span class="number">2.2.2</span> MVC en action</a></li>
<li class="subsection"><a href="a-demo-app#sec:weaknesses_of_this_users_resource"><span class="number">2.2.3</span> Faiblesses de la ressource Utilisateurs (Users)</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec:microposts_resource"><span class="number">2.3</span> La ressource Micro-messages (Microposts)</a></li>
<li><ol>
<li class="subsection"><a href="a-demo-app#sec:a_micropost_microtour"><span class="number">2.3.1</span> Un petit tour du micro-message</a></li>
<li class="subsection"><a href="a-demo-app#sec:putting_the_micro_in_microposts"><span class="number">2.3.2</span> Appliquer le <em>micro</em> aux micro-messages</a></li>
<li class="subsection"><a href="a-demo-app#sec:demo_user_has_many_microposts"><span class="number">2.3.3</span> Un utilisateur <code>has_many</code> micro-messages</a></li>
<li class="subsection"><a href="a-demo-app#sec:inheritance_hierarchies"><span class="number">2.3.4</span> Hiérarchie des héritages</a></li>
<li class="subsection"><a href="a-demo-app#sec:deploying_the_demo_app"><span class="number">2.3.5</span> Déployer l'application Démo</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec:2.4"><span class="number">2.4</span> Conclusion</a></li></ol></li>
<li class="chapter"><a href="static-pages#top"><span class="number">Chapitre 3</span> Pages statiques courantes</a></li>
<li><ol>
<li class="section"><a href="static-pages#sec:static_pages"><span class="number">3.1</span> Pages statiques</a></li>
<li><ol>
<li class="subsection"><a href="static-pages#sec:truly_static_pages"><span class="number">3.1.1</span> Pages HTML statiques</a></li>
<li class="subsection"><a href="static-pages#sec:static_pages_with_rails"><span class="number">3.1.2</span> Les pages statiques avec Rails</a></li></ol></li>
<li class="section"><a href="static-pages#sec:first_tests"><span class="number">3.2</span> Premiers tests</a></li>
<li><ol>
<li class="subsection"><a href="static-pages#sec:testing_tools"><span class="number">3.2.1</span> Outils de test</a></li>
<li><ol>
<li class="subsubsection"><a href="static-pages#sec:autotest">Auto-test</a></li></ol></li>
<li class="subsection"><a href="static-pages#sec:TDD"><span class="number">3.2.2</span> TDD : Rouge, Vert, Refactor</a></li>
<li><ol>
<li class="subsubsection"><a href="static-pages#sec:spork">Spork</a></li>
<li class="subsubsection"><a href="static-pages#sec:red">Rouge</a></li>
<li class="subsubsection"><a href="static-pages#sec:green">Vert</a></li>
<li class="subsubsection"><a href="static-pages#sec:refactor">Refactor</a></li></ol></li></ol></li>
<li class="section"><a href="static-pages#sec:slightly_dynamic_pages"><span class="number">3.3</span> Pages (un peu) dynamiques</a></li>
<li><ol>
<li class="subsection"><a href="static-pages#sec:testing_a_title_change"><span class="number">3.3.1</span> Test d'un changement de titre</a></li>
<li class="subsection"><a href="static-pages#sec:passing_title_tests"><span class="number">3.3.2</span> Réussir les tests de titre</a></li>
<li class="subsection"><a href="static-pages#sec:instance_variables_embedded_ruby"><span class="number">3.3.3</span> Variables d'instance et Ruby embarqué</a></li>
<li class="subsection"><a href="static-pages#sec:layouts"><span class="number">3.3.4</span> Supprimer les répétitions avec les <em>layouts</em></a></li></ol></li>
<li class="section"><a href="static-pages#sec:static_pages_conclusion"><span class="number">3.4</span> Conclusion</a></li>
<li class="section"><a href="static-pages#sec:static_pages_Exercices"><span class="number">3.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="rails-flavored-ruby#top"><span class="number">Chapitre 4</span> Rails au goût Ruby</a></li>
<li><ol>
<li class="section"><a href="rails-flavored-ruby#sec:motivation"><span class="number">4.1</span> Motivation</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:title_helper"><span class="number">4.1.1</span> Un <em>helper</em> pour le titre</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:cascading_style_sheets"><span class="number">4.1.2</span> Feuilles de styles (CSS — Cascading Style Sheets)</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:strings_and_methods"><span class="number">4.2</span> Chaines de caractères et méthodes</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:comments"><span class="number">4.2.1</span> Commentaires</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:strings"><span class="number">4.2.2</span> Chaines de caractères</a></li>
<li><ol>
<li class="subsubsection"><a href="rails-flavored-ruby#sec:printing">Impression</a></li>
<li class="subsubsection"><a href="rails-flavored-ruby#sec:single_quoted_strings">Chaines de caractères «&nbsp;apostrophées&nbsp;»</a></li></ol></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:objects_and_message_passing"><span class="number">4.2.3</span> Objets et passage de message</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:method_definitions"><span class="number">4.2.4</span> Définition de méthode</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:back_to_the_title_helper"><span class="number">4.2.5</span> Retour à l'« helper » de titre</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:other_data_structures"><span class="number">4.3</span> Autres structures de données</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:arrays_and_ranges"><span class="number">4.3.1</span> Tableaux et rangs</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:blocks"><span class="number">4.3.2</span> Blocs</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:hashes_and_symbols"><span class="number">4.3.3</span> Tables de hachage et symboles</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:css_revisited"><span class="number">4.3.4</span> CSS revisitées</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:ruby_classes"><span class="number">4.4</span> Classes Ruby</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:constructors"><span class="number">4.4.1</span> Constructeurs</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:a_class_of_our_own"><span class="number">4.4.2</span> Héritages de classes</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:modifying_built_in_classes"><span class="number">4.4.3</span> Modifier les classes d'origine</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:a_controller_class"><span class="number">4.4.4</span> Classe de contrôleur</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:a_user_class"><span class="number">4.4.5</span> La classe utilisateur</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:Exercices"><span class="number">4.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="filling-in-the-layout#top"><span class="number">Chapitre 5</span> Poursuivre la mise en page</a></li>
<li><ol>
<li class="section"><a href="filling-in-the-layout#sec:structure"><span class="number">5.1</span> Ajout de structure</a></li>
<li><ol>
<li class="subsection"><a href="filling-in-the-layout#sec:adding_to_the_layout"><span class="number">5.1.1</span> Navigation du site</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:custom_css"><span class="number">5.1.2</span> Personnalisation CSS</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:partials"><span class="number">5.1.3</span> Partiels</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec:layout_links"><span class="number">5.2</span> Liens pour la mise en page</a></li>
<li><ol>
<li class="subsection"><a href="filling-in-the-layout#sec:integration_tests"><span class="number">5.2.1</span> Test d'intégration</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:rails_routes"><span class="number">5.2.2</span> Routes Rails</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:named_routes"><span class="number">5.2.3</span> Nommer les routes</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec:user_signup"><span class="number">5.3</span> Inscription de l'utilisateur : une première étape</a></li>
<li><ol>
<li class="subsection"><a href="filling-in-the-layout#sec:users_controller"><span class="number">5.3.1</span> Contrôleur Utilisateur</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:signup_url"><span class="number">5.3.2</span> URL d'inscription</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec:layout_conclusion"><span class="number">5.4</span> Conclusion</a></li>
<li class="section"><a href="filling-in-the-layout#sec:layout_Exercices"><span class="number">5.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="modeling-and-viewing-users-one#top"><span class="number">Chapitre 6</span> Modéliser et afficher les utilisateurs, partie I</a></li>
<li><ol>
<li class="section"><a href="modeling-and-viewing-users-one#sec:user_model"><span class="number">6.1</span> Modèle utilisateur</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:database_migrations"><span class="number">6.1.1</span> Migrations de la base de données</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:the_model_file"><span class="number">6.1.2</span> Le fichier modèle</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:model_annotation">Annotation des modèles</a></li>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:accessible_attributes">Attributs accessibles</a></li></ol></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:creating_user_objects"><span class="number">6.1.3</span> Créer des objets Utilisateur</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:finding_user_objects"><span class="number">6.1.4</span> Recherche dans les objets Utilisateurs</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:updating_user_objects"><span class="number">6.1.5</span> Actualisation des objets Utilisateurs</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:user_validations"><span class="number">6.2</span> Validations utilisateur</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:presence_validation"><span class="number">6.2.1</span> Valider l'existence</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:length_validation"><span class="number">6.2.2</span> Valider la longueur</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:format_validation"><span class="number">6.2.3</span> Valider le format</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:uniqueness_validation"><span class="number">6.2.4</span> Valider l'unicité</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:the_caveat">L'avertissement d'unicité</a></li></ol></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:viewing_users"><span class="number">6.3</span> Afficher les utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:rails_environments"><span class="number">6.3.1</span> Débuggage et environnements Rails</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:users_show"><span class="number">6.3.2</span> Modèle, Vue et Contrôleur Utilisateur</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:a_users_resource"><span class="number">6.3.3</span> Ressource Utilisateurs</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:params_in_debug">Paramètres pour le déboggage</a></li></ol></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:6.4"><span class="number">6.4</span> Conclusion</a></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:6.5"><span class="number">6.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="modeling-and-viewing-users-two#top"><span class="number">Chapitre 7</span> Modéliser et afficher les utilisateurs, partie II</a></li>
<li><ol>
<li class="section"><a href="modeling-and-viewing-users-two#sec:insecure_passwords"><span class="number">7.1</span> Mots de passe non sécurisés</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_validations"><span class="number">7.1.1</span> Valider le mot de passe</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_migration"><span class="number">7.1.2</span> Migrer un mot de passe</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_active_record_callback"><span class="number">7.1.3</span> <em>Fonction de rappel</em> dans l'Active Record</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:secure_passwords"><span class="number">7.2</span> Sécuriser les mots de passe</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_secure_password_test"><span class="number">7.2.1</span> Test de mot de passe sécurisé</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:secure_password_theory"><span class="number">7.2.2</span> Un peu de théorie sur la sécurisation des mots de passe</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:implementing_has_password"><span class="number">7.2.3</span> Implémenter la méthode <code>has_password?</code></a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_authenticate_method"><span class="number">7.2.4</span> Méthode d'authentification</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:better_user_views"><span class="number">7.3</span> Meilleures vues d'utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:tests_with_factories"><span class="number">7.3.1</span> Tester la page de l'utilisateur (avec <em>factories</em>)</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_name_and_a_gravatar"><span class="number">7.3.2</span> Un nom et un Gravatar</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-two#sec:a_gravatar_helper">Un « helper » de Gravatar</a></li></ol></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_user_sidebar"><span class="number">7.3.3</span> Une barre utilisateur latérale</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:7.4"><span class="number">7.4</span> Conclusion</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:7.4.1"><span class="number">7.4.1</span> Dépôt Git</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:heroku_deploy"><span class="number">7.4.2</span> Déploiement Heroku</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:more_modeling_users_Exercices"><span class="number">7.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="sign-up#top"><span class="number">Chapitre 8</span> Inscription</a></li>
<li><ol>
<li class="section"><a href="sign-up#sec:signup_form"><span class="number">8.1</span> Formulaire d'inscription</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:using_form_for"><span class="number">8.1.1</span> Utiliser  <code>form_for</code></a></li>
<li class="subsection"><a href="sign-up#sec:the_form_html"><span class="number">8.1.2</span> Le formulaire HTML</a></li></ol></li>
<li class="section"><a href="sign-up#sec:signup_failure"><span class="number">8.2</span> Échec de l'inscription</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:testing_failure"><span class="number">8.2.1</span> Test de l'échec</a></li>
<li class="subsection"><a href="sign-up#sec:a_working_form"><span class="number">8.2.2</span> Un formulaire fonctionnel</a></li>
<li class="subsection"><a href="sign-up#sec:signup_error_messages"><span class="number">8.2.3</span> Inscription&nbsp;: messages d'erreur</a></li>
<li class="subsection"><a href="sign-up#sec:filtering_parameter_logging"><span class="number">8.2.4</span> Filtrer les paramètres d'identification</a></li></ol></li>
<li class="section"><a href="sign-up#sec:signup_success"><span class="number">8.3</span> Succès de l'inscription</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:testing_success"><span class="number">8.3.1</span> Tester le succès de l'inscription</a></li>
<li class="subsection"><a href="sign-up#sec:the_finished_signup_form"><span class="number">8.3.2</span> Le formulaire d'inscription finalisé</a></li>
<li class="subsection"><a href="sign-up#sec:the_flash"><span class="number">8.3.3</span> Le message «&nbsp;flash&nbsp;»</a</a></li>
<li class="subsection"><a href="sign-up#sec:the_first_signup"><span class="number">8.3.4</span> La première inscription</a></li></ol></li>
<li class="section"><a href="sign-up#sec:rspec_integration_tests"><span class="number">8.4</span> Test d'intégration RSpec</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:integration_tests_with_style"><span class="number">8.4.1</span> Tests d'intégration avec les styles</a></li>
<li class="subsection"><a href="sign-up#sec:failed_signup"><span class="number">8.4.2</span> Un échec d'inscription ne devrait pas créer un nouvel utilisateur</a></li>
<li class="subsection"><a href="sign-up#sec:successful_signup"><span class="number">8.4.3</span> Le succès d'une inscription devrait créer un nouvel utilisateur</a></li></ol></li>
<li class="section"><a href="sign-up#sec:8.5"><span class="number">8.5</span> Conclusion</a></li>
<li class="section"><a href="sign-up#sec:signup_Exercices"><span class="number">8.6</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="sign-in-sign-out#top"><span class="number">Chapitre 9</span> Connexion, déconnexion</a></li>
<li><ol>
<li class="section"><a href="sign-in-sign-out#sec:sessions"><span class="number">9.1</span> Les sessions</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:sessions_controller"><span class="number">9.1.1</span> Le contrôleur de session</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:signin_form"><span class="number">9.1.2</span> Formulaire d'identification</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:signin_failure"><span class="number">9.2</span> Échec de l'identification</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:reviewing_form_submission"><span class="number">9.2.1</span> Examen de la soumission du formulaire</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:failed_signin"><span class="number">9.2.2</span> Échec de l'identification (test et code)</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:signin_success"><span class="number">9.3</span> Succès de l'identification</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:the_completed_create_action"><span class="number">9.3.1</span> L'action <code>create</code> finalisée</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:remember_me"><span class="number">9.3.2</span> Se souvenir de moi</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:current_user"><span class="number">9.3.3</span> Utilisateur courant</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:signing_out"><span class="number">9.4</span> Déconnexion</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:destroying_sessions"><span class="number">9.4.1</span> Détruire la session</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:signin_upon_signup"><span class="number">9.4.2</span> Connexion à l'inscription</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:changing_the_layout_links"><span class="number">9.4.3</span> Changement des liens de la mise en page</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:signin_out_integration_tests"><span class="number">9.4.4</span> Test d'intégration de l'identification/déconnexion</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:9.5"><span class="number">9.5</span> Conclusion</a></li>
<li class="section"><a href="sign-in-sign-out#sec:sign_in_out_Exercices"><span class="number">9.6</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="updating-showing-and-deleting-users#top"><span class="number">Chapitre 10</span> Actualiser, afficher et supprimer des utilisateurs</a></li>
<li><ol>
<li class="section"><a href="updating-showing-and-deleting-users#sec:updating_users"><span class="number">10.1</span> Actualiser l'utilisateur</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:edit_form"><span class="number">10.1.1</span> Formulaire de modification</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:enabling_edits"><span class="number">10.1.2</span> Permettre les modifications</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:protecting_pages"><span class="number">10.2</span> Protéger les pages</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_signed_in_users"><span class="number">10.2.1</span> Utilisateurs identifiés requis</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_the_right_user"><span class="number">10.2.2</span> Nécessité du bon utilisateur</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:friendly_forwarding"><span class="number">10.2.3</span> Redirection conviviale</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:showing_users"><span class="number">10.3</span> Afficher les utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:user_index"><span class="number">10.3.1</span> Liste des utilisateurs</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:sample_users"><span class="number">10.3.2</span> Exemples d'utilisateurs</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:pagination"><span class="number">10.3.3</span> Pagination</a></li>
<li><ol>
<li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:testing_pagination">Test de la pagination</a></li></ol></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:partial_refactoring"><span class="number">10.3.4</span> Restructuration des partiels</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:destroying_users"><span class="number">10.4</span> Supprimer des utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:administrative_users"><span class="number">10.4.1</span> Utilisateurs administrateurs</a></li>
<li><ol>
<li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:revisiting_attr_accessible">Révision de <code>attr_accessible</code></a></li></ol></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:the_destroy_action"><span class="number">10.4.2</span> L'action <code>destroy</code> («&nbsp;supprimer&nbsp;»)</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:10.5"><span class="number">10.5</span> Conclusion</a></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:updating_deleting_Exercices"><span class="number">10.6</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="user-microposts#top"><span class="number">Chapitre 11</span> Micro-messages d'utilisateurs</a></li>
<li><ol>
<li class="section"><a href="user-microposts#sec:a_micropost_model"><span class="number">11.1</span> Le modèle Micropost («&nbsp;Micro-message&nbsp;»)</a></li>
<li><ol>
<li class="subsection"><a href="user-microposts#sec:the_basic_model"><span class="number">11.1.1</span> Le modèle initial</a></li>
<li><ol>
<li class="subsubsection"><a href="user-microposts#sec:accessible_attribute">Attributs accessibles</a></li></ol></li>
<li class="subsection"><a href="user-microposts#sec:user_micropost_associations"><span class="number">11.1.2</span> Associations Utilisateur/micro-messages</a></li>
<li class="subsection"><a href="user-microposts#sec:ordering_and_dependency"><span class="number">11.1.3</span> Affinements du micro-message</a></li>
<li><ol>
<li class="subsubsection"><a href="user-microposts#sec:default_scope">Portée par défaut</a></li>
<li class="subsubsection"><a href="user-microposts#sec:dependent_destroy">Dépendances de la suppression</a></li></ol></li>
<li class="subsection"><a href="user-microposts#sec:micropost_validations"><span class="number">11.1.4</span> Validations du micro-message</a></li></ol></li>
<li class="section"><a href="user-microposts#sec:showing_microposts"><span class="number">11.2</span> Afficher les micro-messages</a></li>
<li><ol>
<li class="subsection"><a href="user-microposts#sec:augmenting_the_user_show_page"><span class="number">11.2.1</span> Etoffement de la page de l'utilisateur</a></li>
<li class="subsection"><a href="user-microposts#sec:sample_microposts"><span class="number">11.2.2</span> Exemples de micro-messages</a></li></ol></li>
<li class="section"><a href="user-microposts#sec:manipulating_microposts"><span class="number">11.3</span> Manipuler les micro-messages</a></li>
<li><ol>
<li class="subsection"><a href="user-microposts#sec:access_control"><span class="number">11.3.1</span> Contrôle de l'accès</a></li>
<li class="subsection"><a href="user-microposts#sec:creating_microposts"><span class="number">11.3.2</span> Créer des micro-messages</a></li>
<li class="subsection"><a href="user-microposts#sec:a_proto_feed"><span class="number">11.3.3</span> Une proto-alimentation</a></li>
<li class="subsection"><a href="user-microposts#sec:destroying_microposts"><span class="number">11.3.4</span> Supprimer des micro-messages</a></li>
<li class="subsection"><a href="user-microposts#sec:testing_the_new_home_page"><span class="number">11.3.5</span> Test de la nouvelle page d'accueil</a></li></ol></li>
<li class="section"><a href="user-microposts#sec:11.4"><span class="number">11.4</span> Conclusion</a></li>
<li class="section"><a href="user-microposts#sec:micropost_Exercices"><span class="number">11.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="following-users#top"><span class="number">Chapitre 12</span> Suivi des utilisateurs</a></li>
<li><ol>
<li class="section"><a href="following-users#sec:the_relationship_model"><span class="number">12.1</span> Le modèle Relation (Relationship model)</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:a_problem_with_the_data_model"><span class="number">12.1.1</span> Un problème du modèle de données (et sa solution)</a></li>
<li class="subsection"><a href="following-users#sec:relationship_user_associations"><span class="number">12.1.2</span> Associations Utilisateur/Relations</a></li>
<li class="subsection"><a href="following-users#sec:relationship_validations"><span class="number">12.1.3</span> Validations</a></li>
<li class="subsection"><a href="following-users#sec:following"><span class="number">12.1.4</span> Auteurs suivis</a></li>
<li class="subsection"><a href="following-users#sec:followers"><span class="number">12.1.5</span> Les Lecteurs</a></li></ol></li>
<li class="section"><a href="following-users#sec:a_web_interface_for_following_and_followers"><span class="number">12.2</span> Une interface web pour les auteurs et les lecteurs</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:sample_following_data"><span class="number">12.2.1</span> Exemple de donnée de suivi</a></li>
<li class="subsection"><a href="following-users#sec:stats_and_a_follow_form"><span class="number">12.2.2</span> Statistiques et formulaire de suivi</a></li>
<li class="subsection"><a href="following-users#sec:following_and_followers_pages"><span class="number">12.2.3</span> Pages d'auteurs suivis et de lecteurs</a></li>
<li class="subsection"><a href="following-users#sec:a_working_follow_button_the_standard_way"><span class="number">12.2.4</span> Un bouton de suivi standard</a></li>
<li class="subsection"><a href="following-users#sec:a_working_follow_button_with_ajax"><span class="number">12.2.5</span> Un bouton fonctionnant avec Ajax</a></li></ol></li>
<li class="section"><a href="following-users#sec:the_status_feed"><span class="number">12.3</span> L'état de l'alimentation</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:motivation_and_strategy"><span class="number">12.3.1</span> Motivation et stratégie</a></li>
<li class="subsection"><a href="following-users#sec:a_first_feed_implementation"><span class="number">12.3.2</span> Une première implémentation de peuplement</a></li>
<li class="subsection"><a href="following-users#sec:scopes_subselects_and_a_lambda"><span class="number">12.3.3</span> Champs d'application, sous-sélections et lambda</a></li>
<li class="subsection"><a href="following-users#sec:the_new_status_feed"><span class="number">12.3.4</span> Nouvel état de l'alimentation</a></li></ol></li>
<li class="section"><a href="following-users#sec:following_conclusion"><span class="number">12.4</span> Conclusion</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:extensions_to_the_sample_application"><span class="number">12.4.1</span> Extensions de l'application exemple</a></li>
<li><ol>
<li class="subsubsection"><a href="following-users#sec:replies">Réponses</a></li>
<li class="subsubsection"><a href="following-users#sec:messaging">Notification</a></li>
<li class="subsubsection"><a href="following-users#sec:follower_notifications">Notifications aux lecteurs</a></li>
<li class="subsubsection"><a href="following-users#sec:password_reminders">Rappel du mot de passe</a></li>
<li class="subsubsection"><a href="following-users#sec:signup_confirmation">Confirmation d'inscription</a></li>
<li class="subsubsection"><a href="following-users#sec:rss_feed">Alimentation RSS</a></li>
<li class="subsubsection"><a href="following-users#sec:rest_api">REST API</a></li>
<li class="subsubsection"><a href="following-users#sec:search">Recherche</a></li></ol></li>
<li class="subsection"><a href="following-users#sec:guide_to_further_resources"><span class="number">12.4.2</span> Guide vers d'autres ressources</a></li></ol></li>
<li class="section"><a href="following-users#sec:following_Exercices"><span class="number">12.5</span> Exercices</a></li></ol></li></ol></div>

<div id="main_content"></div>

<p> <span class="preamble">
 <span id="foreword">
<strong> Avant-propos</strong> <br />
 </span>
 </span></p>

<p>Ma précédente compagnie (CD Baby) fut une des premières à basculer intégralement vers Ruby on Rails, et à rebasculer aussi intégralement vers PHP (googlez-moi si vous voulez prendre la mesure du drame). On m'a tellement recommandé ce livre Michael Hartl que je n'ai pu faire autrement que de le lire. C'est ainsi que le <em>Tutoriel Ruby on Rails</em> m'a fait revenir à nouveau à Rails.</p>
<p>Bien qu'ayant parcouru de nombreux livres sur Rails, c'est ce tutoriel-là qui m'a véritablement «&nbsp;mis en possession&nbsp;» de Rails. Tout est fait ici «&nbsp;à la manière de Rails&nbsp;» —&nbsp;une manière qui ne m'avait jamais semblé naturelle avant que je ne lise ce livre. C'est aussi le seul ouvrage sur Rails qui met en place, d'un bout à l'autre, un <em>Développement Dirigé par les Tests</em> (<em>Test-Driven Development</em>), une approche que je savais hautement recommandée par les experts mais dont je n'avais jamais compris aussi bien la pertinence que dans ce livre. Enfin, en incluant Git, GitHub et Heroku dans les exemples de la démonstration, l'auteur vous donne vraiment le goût de ce qu'est le développement d'un projet dans la vie réelle. Et le exemples de code ne sont pas en reste.</p> 
	
<p>La narration linéaire adoptée par ce tutoriel est vraiment un bon format. Personnellement, j'ai étudié <em>Le Tutoriel Rails</em> en trois longues journées, en faisant tous les exemples et les exercices proposés à la fin de chaque chapitre. C'est en lisant ce livre du début à la fin, sans sauter la moindre partie, qu'on en tire tout le bénéfice.</p>

<p>Régalez-vous&nbsp;!</p>

<p><a href="http://sivers.org/">Derek Sivers</a> (<a href="http://sivers.org/">sivers.org</a>) <br />
<em>Précédemment&nbsp;: Fondateur de </em> <a href="http://www.cdbaby.com/"><em>CD Baby</em></a> <br />
<em>Actuellement&nbsp;: Fondateur de </em> <a href="http://thoughts.pro/"><em>Thoughts Ltd.</em></a> <br /></p>

<p> <span class="preamble">
<strong> Remerciements</strong> <br />
 </span></p>

<p>Ce <em>Tutoriel Ruby on Rails</em> doit beaucoup à mon livre précédent sur Rails, <em>RailsSpace</em>, et donc à mon co-auteur <a href="http://aure.com/">Aurelius Prochazka</a>. J'aimerais remercier Aure à la fois pour le travail qu'il a accompli sur ce précédent livre et pour son soutien pour le présent ouvrage. J'aimerais aussi remercier Debra Williams Cauley, mon éditeur pour les deux ouvrages&nbsp;; aussi longtemps qu'elle jouera avec moi au baseball, je continuerai d'écrire des livres pour elle.</p>

<p>J'aimerais remercier une longue liste de Rubyistes qui m'ont parlé et inspiré au cours des années&nbsp;: David Heinemeier Hansson, Yehuda Katz, Carl Lerche, Jeremy Kemper, Xavier Noria, Ryan Bates, Geoffrey Grosenbach, Peter Cooper, Matt Aimonetti, Gregg Pollack, Wayne&nbsp;E. Seguin, Amy Hoy, Dave Chelimsky, Pat Maddox, Tom Preston-Werner, Chris Wanstrath, Chad Fowler, Josh Susser, Obie Fernandez, Ian McFarland, Steven Bristol, Giles Bowkett, Evan Dorn, Long Nguyen, James Lindenbaum, Adam Wiggins, Tikhon Bernstam, Ron Evans, Wyatt Greene, Miles Forrest, les gens bien de Pivotal Labs, le gang Heroku, les mecs de thoughtbot et l'équipe de GitHub. Enfin, tellement, tellement, tellement de lecteurs —&nbsp;beaucoup trop pour les citer tous&nbsp;— qui ont contribué par leur rapport de bogues et leurs suggestions durant l'écriture de ce livre, et je tiens à saluer leur aide sans laquelle ce livre ne serait pas ce qu'il est. <br /></p>

<p> <span class="preamble">
 <span id="author">
<strong> À propos de l'auteur</strong> <br />
 </span>
 </span></p>

<p><a href="http://michaelhartl.com/">Michael Hartl</a> est programmeur, éducateur et entrepreneur. Il est le co-auteur de <em>RailsSpace</em>, un tutoriel Rails publié en 2007, et a été co-fondateur et développeur en chef de <a href="http://insoshi.com/">Insoshi</a>, une plateforme de réseau social <a href="http://github.com/popular/forked">populaire</a> en Ruby on Rails. Précédement, il a enseigné la théorie et la physique informatique au <a href="http://www.caltech.edu/">California Institute of Technology</a> (Caltech), où il a reçu le Lifetime Achievement Award for Excellence en enseignement. Michael est diplômé du <a href="http://college.harvard.edu/">Harvard College</a>, a un <a href="http://resolver.caltech.edu/CaltechETD:etd-05222003-161626">Ph.D. en physique</a> (un doctorat. NdT) de <a href="http://www.caltech.edu/">Caltech</a>, et il est ancien élève du programme des entrepreneurs <a href="http://ycombinator.com/">Y&nbsp;Combinator</a>. <br /></p>

<p> <span id="license" class="preamble">
<strong> Copyright et license</strong> <br />
 </span></p>

<p><em>Le Tutoriel Ruby on Rails&nbsp;: apprendre Rails par l'exemple</em>. Copyright &copy; 2010 par Michael Hartl. Tout le code source du <em>Tutoriel Ruby on Rails</em> est disponible sous la license <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> et la licence <a href="http://en.wikipedia.org/wiki/Beerware">Beerware License</a>.</p>

<pre class="verbatim">   Copyright (c) 2010 Michael Hartl

   Permission est accordée, à titre gratuit, à toute personne obtenant
   une copie de ce logiciel et la documentation associée, pour faire des 
   modification dans le logiciel sans restriction et sans limitation des
   droits d’utiliser, copier, modifier, fusionner, publier, distribuer,
   concéder sous licence, et / ou de vendre les copies du Logiciel, et à
   autoriser les personnes auxquelles le Logiciel est meublé de le faire, 
   sous réserve des conditions suivantes:

   L’avis de copyright ci-dessus et cette autorisation doit être inclus
   dans toutes les copies ou parties substantielles du Logiciel.

   LE LOGICIEL EST FOURNI «TEL QUEL», SANS GARANTIE D’AUCUNE SORTE, 
   EXPLICITE OU IMPLICITE, Y COMPRIS, MAIS SANS S’Y LIMITER, LES 
   GARANTIES DE QUALITÉ MARCHANDE, ADAPTATION À UN USAGE PARTICULIER ET
   D’ABSENCE DE CONTREFAÇON. EN AUCUN CAS LES AUTEURS OU TITULAIRES DU
   ETRE TENU RESPONSABLE DE TOUT DOMMAGE, RÉCLAMATION OU AUTRES
   RESPONSABILITÉ, SOIT DANS UNE ACTION DE CONTRAT, UN TORT OU AUTRE,
   PROVENANT DE, DE OU EN RELATION AVEC LE LOGICIEL OU L’UTILISATION OU
   DE TRANSACTIONS AUTRES LE LOGICIEL.
	
</pre>




<pre class="verbatim">/*
 * ------------------------------------------------------------
 * &quot;LA LICENCE BEERWARE&quot; (Révision 42)&nbsp;:
 * Michael Hartl a écrit ce code. Aussi longtemps que vous
 * conservez cette note, vous pouvez faire ce que vous voulez
 * de ce travail. Si nous nous rencontrons un jour, et que vous
 * pensez que ce travail en vaut la peine, vous pourrez me
 * payer une bière en retour.
 * ------------------------------------------------------------
 */</pre>




<div id="top"></div>


<h1 class="chapter"><a id="sec:3" href="static-pages#top" class="heading"><span class="number">Chapitre 3</span> Pages statiques courantes</a></h1>


<p>Dans ce chapitre, nous commencerons à développer l'<strong><em>Application Exemple</em></strong> qui nous servira de base tout au long de ce tutoriel. Bien que cette <em>Application Exemple</em> puissent éventuellement avoir des utilisateurs, des micro-messages et un patch d'authentification complet, nous commencerons par un sujet en apparence plus limité&nbsp;: la création de pages statiques. Malgré son apparente simplicité, la création de pages statiques est une exercice hautement formateur, riche en implications &mdash;&nbsp;un parfait commencement pour notre application naissante&nbsp;!</p>

<p>Bien que Rails soit destiné à créer des sites web dynamiques avec base de données, il excèle aussi à faire ce genre de pages statiques que nous pouvons créer simplement par des fichiers de code HTML brut. En fait, utiliser Rails même pour des pages statiques produit un avantage certain&nbsp;: nous pouvons ajouter seulement une <em>petite</em> quantité de code dynamique. Nous verrons comment dans ce chapitre. Chemin faisant, nous aurons un avant-goût du <em>testing automatique</em>, qui nous aidera à nous sentir plus confiant en notre code. Plus loin encore, avoir une bonne suite de tests nous permettra de <em>restructurer</em> notre code en toute confiance, en changeant sa forme sans altérer sa fonction.</p>

<p>Comme au <a class="ref" href="a-demo-app#top">chapitre&nbsp;2</a>, avant de commencer nous avons besoin de créer un nouveau projet Rails, cette fois appelé <tt>sample_app</tt> (<em>Application Exemple</em>)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects
<span class="gp">$</span> rails new sample_app -T
<span class="gp">$</span> <span class="nb">cd </span>sample_app
</pre></div>
</div>


<p>Ici, l'option <code>-T</code> ajoutée à la commande <code>rails</code> demande à Rails de ne pas générer le dossier <code>test</code> associé au frameword par défaut <tt>Test::Unit</tt>. Cela ne signifie pas que nous n'exécuterons pas de tests&nbsp;; au contraire, dès la <a class="ref" href="static-pages#sec:first_tests">section&nbsp;3.2</a> nous utiliserons un framework de test alternatif appelé <em>RSpec</em> pour réaliser une suite approfondie de tests.</p>

<p>Comme à la <a class="ref" href="a-demo-app#sec:planning_the_application">section&nbsp;2.1</a>, notre prochaine étape consiste à utiliser un éditeur de texte pour actualiser le fichier <code>Gemfile</code> avec les gems nécessaires à notre application (souvenez-vous que vous pouvez avoir besoin de la version <tt>1.2.5</tt> du gem <tt>sqlite3-ruby</tt>, en fonction de votre système d'exploitation). D'un autre côté, pour l'<em>Application Exemple</em>, nous aurons aussi besoin de deux nouveaux gems&nbsp;: le gem RSpec et le gem de la librairie RSpec spécifique à Rails. Le code pour les inclure est montré dans l'<a class="ref" href="static-pages#code:gemfile_rspec">extrait&nbsp;3.1</a> (<em>note</em>&nbsp;: si vous préférez installer <em>tous</em> les gems nécessaire à l'<em>Application Exemple</em>, vous devriez utiliser le code de l'<a class="ref" href="updating-showing-and-deleting-users#code:final_gemfile">extrait&nbsp;10.42</a> dès à présent).</p>

<div class="label" id="code:gemfile_rspec"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.1.</span> <span class="description">Un <code>Gemfile</code> pour l'<em>Application Exemple</em>.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.7&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3-ruby&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.2&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s1">&#39;sqlite3&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.5.0&#39;</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec&#39;</span><span class="p">,</span> <span class="s1">&#39;2.5.0&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;webrat&#39;</span><span class="p">,</span> <span class="s1">&#39;0.7.1&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Ceci inclut <tt>rspec-rails</tt> en mode développement, de telle sorte que nous avons accès aux génératers spécifiques à RSpec, et il inclut également <tt>rspec</tt> en mode de test dans le but de jouer les tests (nous incluons aussi un gem pour <a href="http://github.com/brynary/webrat">Webrat</a>, un utilitaire de test qui a l'habitude d'être installé automatiquement en tant que dépendance mais a besoin ici d'être inclus explicitement). Pour installer et inclure les gems RSpec, nous utilisons <code>bundle install</code> comme d'habitude&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> [sudo] bundle install
</pre></div>
</div>


<p>Pour demander à Rails d'utiliser RSpec plutôt que <tt>Test::Unit</tt> (qui est utilisé par défaut), nous avons besoin d'installer les fichiers nécessaires à RSpec. Cela peut être accompli avec <code>rails generate</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate rspec:install
</pre></div>
</div>


<p>Ceci fait, il ne nous reste plus qu'à initialiser le repository Git&nbsp;:<sup class="footnote" id="fnref:3.1"><a href="#fn:3.1">1</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git init
<span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Depot Initial&quot;</span>
</pre></div>
</div>


<p>Tout comme la première application, je suggère d'actualier le fichier <code>README</code> (situé dans le dossier racine de l'application) pour être plus utile et descriptif, comme montré dans l'<a class="ref" href="static-pages#code:sample_app_readme">extrait&nbsp;3.2</a>.</p>

<div class="label" id="code:sample_app_readme"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.2.</span> <span class="description">Un fichier <code>README</code> amélioré pour l'<em>Application Exemple</em>.</span>       
</div>
<div class="code"><div class="highlight"><pre># Tutoriel Ruby on Rails&nbsp;: Application Exemple

C'est l'<em>Application Exemple</em> pour le
[*Tutoriel Ruby on Rails&nbsp;: Apprendre Rails par l'exemple*](http://railstutorial.org/)
par [Michael Hartl](http://michaelhartl.com/).
</pre></div>
</div></div>


<p>Changez ce fichier pour utiliser l'extension <code>markdown</code> et déposez les changements&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git mv README README.markdown
<span class="gp">$</span> git commit -a -m <span class="s2">&quot;Amelioration du README&quot;</span>
</pre></div>
</div>




<div class="label" id="fig:create_repository"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/create_repository.png" alt="create_repository" /></span></div><div class="caption"><span class="header">Illustration 3.1: </span><span class="description">Créer le repository de l'<em>Application Exemple</em> sur GitHub.&nbsp;<a href="http://railstutorial.org/images/figures/create_repository-full.png">(taille&nbsp;normale)</a></span></div></div>


<p>Puisque nous utiliserons cette <em>Application Exemple</em> jusqu'à la fin de ce livre, c'est une bonne idée de faire un repository sur GitHub (<a class="ref" href="static-pages#fig:create_repository">illustration&nbsp;3.1</a>) et de la «&nbsp;pusher&nbsp;»&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin git@github.com:&lt;username&gt;/sample_app.git
<span class="gp">$</span> git push origin master
</pre></div>
</div>


<p>(Notez que, comme résultat de cette étape, le repository sur <a href="http://github.com/railstutorial/sample_app">http://github.com/railstutorial/sample_app</a> contient le code source de toute l'<em>Application Exemple</em>. Vous êtes encouragé à le consulter en guise de référence, avec deux mises en garde&nbsp;: (1) vous en apprendrez beaucoup plus si vous écrivez vous-même le code source, plutôt que de vous appuyer sur une version achevée&nbsp;; (2) Il peut exister des différences mineures entre le repository GitHub et le code de ce livre. Cela est dû d'un côté à l'incorporation des exercices du livre et d'un autre côté au repository utilisé dans les <a href="http://railstutorial.org/screencasts">screencasts du tutoriel Rails</a>, qui inclut quelques tests supplémentaires).</p>

<p>Bien entendu, nous pouvons optionnellement déployer l'application vers Heroku même à ce stade peu avancé&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku create
<span class="gp">$</span> git push heroku master
</pre></div>
</div>

<p>(Si cela ne fonctionne pas pour vous, consultez la note au-dessus de l'<a class="ref" href="beginning#code:gemfile_sqlite_heroku">extrait&nbsp;1.8</a> pour des solutions possibles.) À mesure que vous avancez dans le livre, je vous recommande de «&nbsp;pusher&nbsp;» et de déployer l'application régulièrement avec&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push
<span class="gp">$</span> git push heroku
</pre></div>
</div>


<p>Cela posé, nous sommes prêts à développer l'<em>Application Exemple</em>.</p>

<div class="label" id="sec:static_pages"></div>


<h2><a id="sec:3.1" href="static-pages#sec:static_pages" class="heading"><span class="number">3.1</span> Pages statiques</a></h2>


<p>Rails propose deux principales manières de créer des pages web statiques. <em>Primo</em>, Rails peut utiliser des pages <em>vraiment</em> statiques contenant du code HTML brut. <em>Secondo</em>, Rails nous permet de définir des vues (<em>views</em>) contenant du HTML brut, que Rails peut <em>rendre</em> de telle sorte que les serveurs web puisse les envoyer au navigateur.</p>

<p>Afin de prendre nos repères, il est utile de se remémorer la struture du dossier Rails de la <a class="ref" href="beginning#sec:the_first_application">section&nbsp;1.2.3</a> (<a class="ref" href="beginning#fig:directory_structure_rails_3">illustration&nbsp;1.2</a>). Dans cette section, nous travaillerons principalement sur les dossiers <code>app/controllers</code> (contenant les contrôleurs, <rw>controller</rw>s) et <code>app/views</code> (contenant les vues, <rw>view</rw>s) (à la <a class="ref" href="static-pages#sec:first_tests">section&nbsp;3.2</a>, nous ajouterons même un dossier de notre cru).</p>

<div class="label" id="sec:truly_static_pages"></div>


<h3><a id="sec:3.1.1" href="static-pages#sec:truly_static_pages" class="heading"><span class="number">3.1.1</span> Vraies pages statiques</a></h3>


<p>Commençons avec les vraies pages statiques. Rappelez-vous, de la <a class="ref" href="beginning#sec:rails_server">section&nbsp;1.2.5</a>, que  toute application Rails se présente comme une application fonctionnelle minimale générée par le script <code>rails</code>, avec une page d'accueil à l'adresse <a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a> (<a class="ref" href="beginning#fig:riding_rails_3">illustration&nbsp;1.3</a>).</p>

<div class="label" id="fig:public_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/public_index_rails_3.png" alt="public_index_rails_3" /></span></div><div class="caption"><span class="header">Illustration 3.2: </span><span class="description">Le fichier <code>public/index.html</code>.&nbsp;<a href="http://railstutorial.org/images/figures/public_index_rails_3-full.png">(taille&nbsp;normale)</a></span></div></div>


<p>Pour savoir d'où cette page provient, jetez-un coup d'œil au fichier <code>public/index.html</code> (<a class="ref" href="static-pages#fig:public_index_rails_3">illustration&nbsp;3.2</a>). Comme le fichier contient ses propres informations de mise en page, c'est un peu le bazard, mais ça fonctionne&nbsp;: par défaut, Rails renvoie tout fichier du dossier <code>public</code> directement à votre navigateur.<sup class="footnote" id="fnref:3.2"><a href="#fn:3.2">2</a></sup> Dans le cas du fichier spécial <code>index.html</code>, vous n'avez même pas à indiquer le nom du fichier dans l'URL, puisque le nom <code>index.html</code> est le nom de fichier par défaut. Vous pouvez l'inclure si vous voulez, cependant&nbsp;; l'adresse&nbsp;:</p>

<pre class="verbatim">http://localhost:3000/</pre>


<p>… et l'adresse&nbsp;:</p>

<pre class="verbatim">http://localhost:3000/index.html</pre>


<p>… sont équivalentes.</p>

<p>Comme vosu pouvez vous y attendre, si nous le voulons nous pouvons fabriquer nos propres fichiers HTML statiques, et les déposer dans le même dossier <code>public</code> que le fichier <code>index.html</code>. Par exemple, créons un fichier avec un message de salutation amicale (<a class="ref" href="static-pages#code:hello_world">extrait&nbsp;3.3</a>)&nbsp;:<sup class="footnote" id="fnref:3.3"><a href="#fn:3.3">3</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> mate public/hello.html
</pre></div>
</div>


<div class="label" id="code:hello_world"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.3.</span> <span class="description">Un fichier HTML classique, avec une salutation amicale. <br /> <code>public/hello.html</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Salutations<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>Salut le monde&amp;nbsp;!<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Nous pouvons voir dans l'<a class="ref" href="static-pages#code:hello_world">extrait&nbsp;3.3</a> la structure caractéristique d'un document HTML&nbsp;: un type de document (<em>document type</em>), ou <em>doctype</em>, qui est une déclaration aux navigateurs de la version du code HTML que nous employons (dans ce cas, <a href="http://en.wikipedia.org/wiki/HTML5">HTML5</a>)&nbsp;;<sup class="footnote" id="fnref:3.4"><a href="#fn:3.4">4</a></sup> une section  <code>head</code>, dans le cas présent contenant le texte «&nbsp;Greeting&nbsp;» à l'intérieur d'une balise <code>title</code>&nbsp;; et une section <code>body</code> (<em>corps</em>), dans le cas présennt avec le texte «&nbsp;Salut le monde&amp;&nbsp;!&nbsp;» à l'intérieur d'une balise paragraphe <code>p</code> (l'indentation du texte est optionnelle &mdash;&nbsp;HTML n'est pas sensible aux espaces «&nbsp;blanches&nbsp;», et ignore aussi bien les tabulations que les espaces &mdash;&nbsp;mais cela rend la structure du document plus lisible) Comme attendu, en visitant l'adresse <a href="http://localhost:3000/hello.html"><tt>http://localhost:3000/hello.html</tt></a>,  Rails rend aussitôt cette page (<a class="ref" href="static-pages#fig:hello_world">illustration&nbsp;3.3</a>). Notez que le titre affiché au sommet de la fenêtre du navigateur dans l'<a class="ref" href="static-pages#fig:hello_world">illustration&nbsp;3.3</a> correspond au contenu de la balise <code>title</code>, c'est-à-dire «&nbsp;Salutations&nbsp;».</p>

<div class="label" id="fig:hello_world"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/hello_world.png" alt="hello_world" /></span></div><div class="caption"><span class="header">Illustration 3.3: </span><span class="description">Notre vrai fichier HTML statique (<a href="http://localhost:3000/hello.html"><tt>http://localhost:3000/hello.html</tt></a>).&nbsp;<a href="http://railstutorial.org/images/figures/hello_world-full.png">(taille&nbsp;normale)</a></span></div></div>


<p>Puisque ce fichier n'a valeur que de démonstration, nous n'avons pas vraiment envie qu'il fasse partie de notre applicaton, donc il est peut-être mieux de le détruire une fois l'euphorie de cette création passée&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rm public/hello.html
</pre></div>
</div>


<p>Nous laisserons de côté le fichier <code>index.html</code> pour le moment, mais nous pourrions bien sûr l'effacer aussi, éventuellement&nbsp;: nous ne désirons pas que la racine de notre application soit la page par défaut de Rails montrée dans l'<a class="ref" href="beginning#fig:riding_rails_3">illustration&nbsp;1.3</a>. Nous verrons dans la <a class="ref" href="filling-in-the-layout#sec:layout_links">section&nbsp;5.2</a> comment changer l'adresse <a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a> pour qu'elle pointe vers autre chose que le fichier <code>public/index.html</code>.</p>

<div class="label" id="sec:static_pages_with_rails"></div>


<h3><a id="sec:3.1.2" href="static-pages#sec:static_pages_with_rails" class="heading"><span class="number">3.1.2</span> Les pages statiques avec Rails</a></h3>


<p>La capacité de retourner des fichiers HTML statiques est bien, mais cela n'est pas particulièrement utile pour créer des applications web dynamiques. Dans cette section, nous ferons un premier pas vers la création de pages dynamiques en créant un jeu d'<em>actions</em> Rails, qui sont une façon plus puissante de définir des URLs que les fichiers statiques.<sup class="footnote" id="fnref:3.5"><a href="#fn:3.5">5</a></sup> Les actions Rails sont regroupées à l'intérieur de contrôleurs (<em>controllers</em>) (le «&nbsp;C&nbsp;» dans le MVC de la  <a class="ref" href="beginning#sec:mvc">section&nbsp;1.2.6</a>), qui contient des jeux d'actions reliées par un but commun. Nous avons eu un aperçu des contrôleurs au <a class="ref" href="a-demo-app#top">chapitre&nbsp;2</a>, et approfondirons pour en avoir une compréhension plus profonde une fois que nous explorerons mieux l'<a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">architecture REST</a>  (à partir du <a class="ref" href="modeling-and-viewing-users-one#top">chapitre&nbsp;6</a>)&nbsp;; par essence, un <em>contrôleur</em> est le conteneur d'un groupe de pages web (peut-être dynamiques).</p>

<p>Pour commencer, rappelez-vous, <a class="ref" href="beginning#sec:git_commands">section&nbsp;1.3.5</a>, que lorsque nous utilisons Git, c'est une bonne pratique d'exécuter notre travail sur une autre branche que la branche maitresse. Si vous utilisez Git pour le contrôle de versions, vous devriez jouer ces commandes&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout -b static-pages
</pre></div>
</div>


<p>Rails est fourni avec un script pour créer des contrôleurs, appelé  <code>generate</code>&nbsp;; tout ce dont il a besoin pour faire son tour de magie, c'est le nom du contrôleur. Puisque nous créons ce contrôleur pour traiter les pages statiques (courantes), nous l'appellerons simplement le contrôleurs <em>Pages</em>, et planifierons de faire des actions pour la page d'accueil, la page de contact et la page «&nbsp;À Propos&nbsp;». Le script <code>generate</code> prend une liste optionnelle d'actions, donc nous incluerons certaines de ces actions initiales directement en ligne de commande&nbsp;:</p>

<div class="label" id="code:generating_pages"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.4.</span> <span class="description">Générer un contrôleur de Pages.</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate controller Pages home contact
<span class="go">      create  app/controllers/pages_controller.rb</span>
<span class="go">       route  get &quot;pages/contact&quot;</span>
<span class="go">       route  get &quot;pages/home&quot;</span>
<span class="go">      invoke  erb</span>
<span class="go">      create    app/views/pages</span>
<span class="go">      create    app/views/pages/home.html.erb</span>
<span class="go">      create    app/views/pages/contact.html.erb</span>
<span class="go">      invoke  rspec</span>
<span class="go">      create    spec/controllers/pages_controller_spec.rb</span>
<span class="go">      create    spec/views/pages</span>
<span class="go">      create    spec/views/pages/home.html.erb_spec.rb</span>
<span class="go">      create    spec/views/pages/contact.html.erb_spec.rb</span>
<span class="go">      invoke  helper</span>
<span class="go">      create    app/helpers/pages_helper.rb</span>
<span class="go">      invoke    rspec</span>
</pre></div>
</div></div>




<p>(notez que, puisque nous avons installé RSpec avec le code <code>rails generate rspec:install</code>, la génération de contrôleur crée automatiquement des fichiers de test RSpec dans le dossier <code>spec/</code>).</p>
<p>Ici, j'ai intentionnellement «&nbsp;oublié&nbsp;» la page <code>À Propos</code> pour que nous puissions voir comment l'ajouter «&nbsp;à la main&nbsp;» à la <a class="ref" href="static-pages#sec:first_tests">section&nbsp;3.2</a>.</p>

<p>La génération de pages de contrôleurs de l'<a class="ref" href="static-pages#code:generating_pages">extrait&nbsp;3.4</a> actualise automatiquement le fichier de <em>routage</em>, nommé <code>config/routes.rb</code>, que Rails utilise pour trouver la correspondance entre URLs et pages web. C'est notre première rencontre avec le dossier <code>config</code>, donc il peut être utile d'y jeter un coup d'œil (<a class="ref" href="static-pages#fig:config_directory_rails_3">illustration&nbsp;3.4</a>). Le dossier <code>config</code> est l'endroit où Rails rassemble les fichiers nécessaires à la configuration de l'application &mdash;&nbsp;d'où bien sûr son nom.</p>

<div class="label" id="fig:config_directory_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/config_directory_rails_3.png" alt="config_directory_rails_3" /></span></div><div class="caption"><span class="header">Illustration 3.4: </span><span class="description">Contenu du dossier <code>config</code> de l'<em>Application Exemple</em>.&nbsp;<a href="http://railstutorial.org/images/figures/config_directory_rails_3-full.png">(taille&nbsp;normale)</a></span></div></div>


<p>Puis nous avons généré les actions <code>home</code> et <code>contact</code>, le routage de fichier possède déjà des règles pour chacun d'eux, comme on peut le voir dans l'<a class="ref" href="static-pages#code:pages_routes">extrait&nbsp;3.5</a>.</p>

<div class="label" id="code:pages_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.5.</span> <span class="description">Le routage pour l'action <code>home</code> et l'action <code>contact</code> dans le contrôleur Pages. <br /> <code>config/routes.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="no">SampleApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;pages/home&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;pages/contact&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Ici la règle&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s2">&quot;pages/home&quot;</span>
</pre></div>
</div>


<p>… se charge de la requête pour l'URL <tt>/pages/home</tt> pour la page d'accueil (action <code>home</code>) dans le contrôleur Pages. Plus encore, en utilisant <code>get</code> nous nous arrangeons pour que la route réponde à la requête <tt>GET</tt>, qui est un des <em>verbes HTTP</em> fondamentaux supporté par le Hypertext Transfer Protocol (<a class="ref" href="static-pages#sidebar:get_etc">Box&nbsp;3.1</a>). Dans notre cas, cela signifie que lorsque nous générons une action <code>home</code> à l'intérieur du contrôleur Pages nous atteignons automatiquement une page à l'adresse <tt>/pages/home</tt>. Pour voir le résultat, «&nbsp;tuez&nbsp;» le serveur avec Ctrl-C, jouez la commande <code>rails server</code>, et naviguez alors à l'adresse <a href="http://localhost:3000/pages/home"><tt>/pages/home</tt></a> (<a class="ref" href="static-pages#fig:raw_home_view">illustration&nbsp;3.5</a>).</p>

<div class="label" id="fig:raw_home_view"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/raw_home_view.png" alt="raw_home_view" /></span></div><div class="caption"><span class="header">Illustration 3.5: </span><span class="description">La vue de l'accueil brute (<a href="http://localhost:3000/pages/home"><tt>/pages/home</tt></a>) générée par Rails.&nbsp;<a href="http://railstutorial.org/images/figures/raw_home_view-full.png">(taille&nbsp;normale)</a></span></div></div>




<div class="label" id="sidebar:get_etc"></div>


<div class="sidebar"><span class="title"><span class="header">Box 3.1.</span><span class="description"><tt>GET</tt>, et caetera</span></span>
<p>Le Hypertext Transfer Protocol (<a href="http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods">HTTP</a>) définit quatre opérations de base, correspondant aux quatre verbes <tt>GET</tt> (<em>obtenir</em>), <tt>POST</tt> (<em>poster</em>), <tt>PUT</tt> (<em>déposer</em>) et <tt>DELETE</tt> (<em>effacer</em>). Cela fait référence aux opérations entre un ordinateur <em>client</em> (classiquement, un navigateur web comme Firefox ou Safari) et un <em>serveur</em> (typiquement un serveur web tel que Apache ou Nginx) (il est important de comprendre qu'en développant des applications web sur un ordinateur local, le client et le serveur sont la même machine physique, mais en général ils sont différents). L'accent mis sur les verbes HTTP est typique des frameworks (à commencer par Rails) influencés par l'<em>architecture REST</em>, que nous avons abordée brièvement au <a class="ref" href="a-demo-app#top">chapitre&nbsp;2</a> et que nous apprendrons mieux connaitre au <a class="ref" href="sign-up#top">chapitre&nbsp;8</a>.</p>

<p><tt>GET</tt> est l'opération HTTP la plus courante, utilisée pour  <em>lire</em> des données sur le web&nbsp;; elle signifie simplement «&nbsp;atteint une page&nbsp;», et chaque fois que vous visitez une page, telle que google.com ou craigslist.org, votre navigateur soumet une requête <tt>GET</tt>. La requête <tt>POST</tt> est l'opération suivante la plus courante&nbsp;; c'est la requête envoyée par votre navigateur quand vous soumettez un formulaire. Dans les applications Rails, les requêtes <tt>POST</tt> sont utilisées généralement pour <em>créer</em> des choses (bien que le protocope HTTP permet aussi à la requête <tt>POST</tt> de procéder à des actualissations)&nbsp;; par exemple, la requête <tt>POST</tt> envoyée quand vous soumettez un formulaire pour la création d'un nouvel utilisateur sur votre site web. Les deux autres verbes, <tt>PUT</tt> et <tt>DELETE</tt>, sont utilisés pour <em>actualiser</em> et <em>détruire</em> des choses sur le serveur distant. Ces requêtes sont moins courantes que <tt>GET</tt> et <tt>POST</tt> puisque les navigateurs sont incapables de les envoyer nativement, mais certains frameworks web (comme Ruby on Rails) ont des façons intelligentes de <em>simuler</em> ces demandes avec les navigateurs.</p>
</div>


<p>Pour comprendre d'où ces pages proviennent, commençons par jeter un œil au contrôleur Pages dans un éditeur de texte&nbsp;; vous devriez voir quelque chose comme le code de l'<a class="ref" href="static-pages#code:pages_controller">extrait&nbsp;3.6</a> (vous pouvez noter que, contrairement aux contrôleurs Users et Microposts de l'application Démo du <a class="ref" href="a-demo-app#top">chapitre&nbsp;2</a>, le contrôleur Pages ne respecte pas les conventions REST).</p>

<div class="label" id="code:pages_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.6.</span> <span class="description">Le contrôleur Pages contruit par l'<a class="ref" href="static-pages#code:generating_pages">extrait&nbsp;3.4</a>. <br /> <code>app/controllers/pages_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Nous voyons ici que le fichier <code>pages_controller.rb</code> définit une <em>classe</em> appelée <code>PagesController</code>. Les classes sont simplement une façon pratique d'organiser les <em>fonctions</em> (appelées aussi <em>méthodes</em>) comme les actions <code>home</code> et <code>contact</code>, qui sont définies en utilisant le mot-clé <code>def</code>. Le signe «&nbsp;<code>&lt;</code>&nbsp;» indique que <code>PagesController</code> <em>hérite</em> de la classe Rails <code>ApplicationController</code>&nbsp;; comme nous le verrons dans un instant, cela signifie que nos pages possèdent une grande quantité de fonctionnalités spécifiques à Rails. Nous en apprendrons plus sur les classes et l'héritage dans la <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">section&nbsp;4.4</a>).</p>

<p>Dans le cas du contrôleur Pages, ces deux méthodes sont initialement vides&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">home</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">contact</span>
<span class="k">end</span>
</pre></div>
</div>


<p>En pur Ruby, ces méthodes ne feraient tout simplement… rien. En Rails, la situation est différente&nbsp;; <code>PagesController</code> est une classe Ruby, mais parce qu'elle hérite de la classe <code>ApplicationController</code> le comportement de ses méthodes est spécifique à Rails&nbsp;: en visitant l'URL <tt>/pages/home</tt>, Rails consulte le contrôleur Pages et exécute le code de l'action <code>home</code>, et rend alors la <em>vue</em> (le caractère «&nbsp;V&nbsp;» de MVC de la <a class="ref" href="beginning#sec:mvc">section&nbsp;1.2.6</a>) correspondant à l'action. Dans le cas présent, l'action <code>home</code> est vide, donc tous les appels à <tt>/pages/home</tt> rendent simplement la vue. Donc, à quoi ressemble une vue, et où la trouvons-nous&nbsp;?</p>


<p>Si vous jetez un nouveau coup d'œil à la sortie de l'<a class="ref" href="static-pages#code:generating_pages">extrait&nbsp;3.4</a>, vous devriez être en mesure de deviner la correspondance entre les actions et les vues&nbsp;: une action comme <code>home</code> possède une vue correspondante appelée <code>home.html.erb</code>. Nous apprendrons à la <a class="ref" href="static-pages#sec:slightly_dynamic_pages">section&nbsp;3.3</a> ce que la partie <code>.erb</code> signifie&nbsp;; la partie <code>.html</code> ne devrait pas vous surprendre puisqu'elle ressemble à HTML (<a class="ref" href="static-pages#code:raw_home_view">extrait&nbsp;3.7</a>).</p>

<div class="label" id="code:raw_home_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.7.</span> <span class="description">La vue générée pour la page d'accueil (<em>Home</em>). <br /> <code>app/views/pages/home.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Pages#home<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/pages/home.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>Il en va de même de la vue de l'action <code>contact</code> (<a class="ref" href="static-pages#code:raw_contact_view">extrait&nbsp;3.8</a>).</p>

<div class="label" id="code:raw_contact_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.8.</span> <span class="description">La vue générée pour la page Contact. <br /> <code>app/views/pages/contact.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Pages#contact<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/pages/contact.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>Ces deux vues sont juste des <em>espaces réservés</em>&nbsp;: elles possèdent une entête (à l'intérieur de la balise <code>h1</code>) et un paragraphe (la balise <code>p</code>) contenant le chemin d'accès au fichier correspondant. Nous allons ajouter quelque (très léger) contenu dynamique à partir de la <a class="ref" href="static-pages#sec:slightly_dynamic_pages">section&nbsp;3.3</a>, mais telles quelles, ces vues marquent un point important&nbsp;: les vues Rails peuvent ne contenir que du code HTML statique. Du point de vue du navigateur, le code HTML des fichiers de la <a class="ref" href="static-pages#sec:truly_static_pages">section&nbsp;3.1.1</a> et la méthode controller/action des pages délivrées sont indistinctes&nbsp;: tout ce que voit le navigateur est de l'HTML.</p>

<p>Dans la suite de ce chapitre, nous ajouterons d'abord l'action <code>about</code> que nous avons «&nbsp;oubliée&nbsp;» à la <a class="ref" href="static-pages#sec:static_pages_with_rails">section&nbsp;3.1.2</a>, un petit peu de contenu dynamique et nous effecturons les premiers pas vers la stylisation des pages grâce aux CSS. Avant de poursuivre, si vous utilisez Git, c'est une bonne idée d'ajouter dès maintenant les fichiers du contrôleur Pages au repository&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Ajout d'un controleur Pages&quot;</span>
</pre></div>
</div>




<div class="label" id="sec:first_tests"></div>


<h2><a id="sec:3.2" href="static-pages#sec:first_tests" class="heading"><span class="number">3.2</span> Nos premiers tests</a></h2>


<p>Si vous demandez à cinq développeurs Rails comment tester une partie quelconque de code, vous obtiendrez quinze réponses différentes &mdash;&nbsp;mais ils seront tous d'accord sur le fait que vous devrez écrire ces tests. C'est dans cet esprit que nous approcherons le testing de notre <em>Application Exemple</em>, en écrivant de solides tests sans se préoccuper trop pour le moment de leur perfection. Ne prenez pas les tests du <em>Tutoriel Rails</em> pour parole d'évangile&nbsp;; ils s'appuient sur le style que j'ai développé au cours de mes propres travaux ainsi qu'à la lecture du code d'autres développeurs. À mesure que vous étofferez votre expérience en tant que développeur Rails, il n'y a aucun doute que vous développerez vos propres préférences et votre propre style en matière de test.</p>

<p>En complément de l'écriture des tests au cours du développement de l'<em>Application Exemple</em>, nous ferons aussi le choix de plus en plus fréquent d'écrire ces tests <em>avant</em> d'écrire le code de l'application &mdash;&nbsp;une approche connue sous le nom «&nbsp;Développement Dirigée par le Test&nbsp;» (<em>test-driven development</em>, ou TDD).<sup class="footnote" id="fnref:3.6"><a href="#fn:3.6">6</a></sup> Notre exemple spécifique sera d'ajouter une page «&nbsp;À Propos&nbsp;» à notre exemple de site. Heureusement, ajouter cette page supplémentaire n'est pas difficile &mdash;&nbsp;vous devriez même être en mesure de deviner la procédure en vous basant sur les exemples de la section précédente&nbsp;&mdash; ce qui signifie que nous pouvons nous concentrer sur le testing, qui contient pas mal d'idées nouvelles.</p>

<p>Tout d'abord, tester l'existence d'une page peut paraitre superflu, mais l'expérience montre que ça ne l'est pas. Tellement de choses peuvent mal tourner quand on développe un logiciel qu'avoir une bonne batterie de tests est inestimable pour assurer sa qualité. Plus encore, il est courant pour les programmes informatiques &mdash;&nbsp;et spécialement les applications&nbsp;&mdash; d'être étendus, et chaque fois que vous faites un changement vous risquez d'introduire des erreurs. L'écriture de tests ne garantit pas que ces erreurs ne surviendront pas, mais ils les rendent beaucoup plus faciles à localiser et à corriger. Plus encore, en écrivant des tests pour des bogues qui surviennet <em>vraiment</em>, nous pouvons réduire leur probabilité.</p>

<p>(Comme noté à la <a class="ref" href="beginning#sec:comments_for_various_readers">section&nbsp;1.1.1</a>, si vous trouvez que le testing est trop écrasant, poursuivez en les sautant au cours d'une première lecture. Une fois que vous aurez une bonne maitrise de Rails and Ruby, vous pourrez y revenir et apprendre le testing dans un second temps)</p>

<div class="label" id="sec:testing_tools"></div>


<h3><a id="sec:3.2.1" href="static-pages#sec:testing_tools" class="heading"><span class="number">3.2.1</span> Outils de test</a></h3>


<p>Pour écrire des tests pour notre <em>Application Exemple</em>, notre outil principal sera le framework appelé <a href="http://rspec.info/">RSpec</a>, qui est un <a href="http://en.wikipedia.org/wiki/Domain_Specific_Language"><em>langage de domaine spécifique</em></a> pour décrire le comportement du code, doublé d'un programme (appelé <code>rspec</code>) pour vérifier le comportement attendu. Conçu pour tester n'importe quel programme Ruby, RSpec a connu un regain important dans la communauté Rails. Obie Fernandez, auteur de <a href="http://www.amazon.com/gp/product/0321601661?ie=UTF8&amp;tag=httpwwwrailst-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0321601661"><em>The Rails&nbsp;3 Way</em></a>, a qualifié RSpec de «&nbsp;La Manière Rails Way&nbsp;» et je suis d'accord.<sup class="footnote" id="fnref:3.7"><a href="#fn:3.7">7</a></sup></p>

<p>Si vous avez suivi les étapes de l'introduction, RSpec est déjà installé via le Bundler <code>Gemfile</code> (<a class="ref" href="static-pages#code:gemfile_rspec">extrait&nbsp;3.1</a>) et la commande <code>bundle install</code>.</p>

<div class="label" id="sec:autotest"></div>


<h4><a id="sec:3.2.1.1" href="static-pages#sec:autotest" class="heading">Autotest</a></h4>


<p>Autotest est un outil qui joue en permanence votre suite de tests en arrière-plan, en s'appuyant sur les changements de fichiers spécifiques que vous faites. Par exemple, si vous modifiez un fichier contrôleur, Autotest jouera les tests pour ce contrôleur spécifique. Le résultat est un feedback instantané sur l'état de vos tests. Nous en apprendrons davantage sur Autotest quand nous le verrons en actions (<a class="ref" href="static-pages#sec:TDD">section&nbsp;3.2.2</a>).</p>

<p>L'installation de Autotest est optionnelle, et sa configuration peut être un peu délicate, mais si vous parvenez à le faire fonctionner sur votre système, je suis certain que vous le trouverez tout comme moi très utile. Pour installer Autotest, installez les gems <tt>autotest</tt> et <tt>autotest-rails-pure</tt><sup class="footnote" id="fnref:3.8"><a href="#fn:3.8">8</a></sup> comme suit&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install autotest -v 4.4.6
<span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install autotest-rails-pure -v 4.1.2
</pre></div>
</div>


<p>La prochaine étape dépend de votre plateforme. Je passerai par les étapes pour le système OS&nbsp;X, puisque c'est celui que j'utilise, et donnerai ensuite les références vers les posts de blog qui parlent d'Autotest sur Linus et Windows. Sur OS&nbsp;X, vous devrez <a href="http://growl.info/">installer Growl</a> (si vous ne l'avez pas déjà) et installer alors les gems <tt>autotest-fsevent</tt> et <tt>autotest-growl</tt>&nbsp;:<sup class="footnote" id="fnref:3.9"><a href="#fn:3.9">9</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install autotest-fsevent -v 0.2.4
<span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install autotest-growl -v 0.2.9
</pre></div>
</div>


<p>Si FSEvent ne s'installe pas proprement, vérifiez bien que <a href="http://developer.apple.com/technologies/tools/xcode.html">Xcode</a> est installé sur votre système.</p>

<p>Pour utiliser les gems Growl et FSEvent, faites un fichier de configuration Autotest dans votre dossier Rails racine et remplissez-le avec le contenu de  l'<a class="ref" href="static-pages#code:dot_autotest">extrait&nbsp;3.9</a> (ou de l'<a class="ref" href="static-pages#code:dot_autotest_alt">extrait&nbsp;3.10</a> si l'<a class="ref" href="static-pages#code:dot_autotest">extrait&nbsp;3.9</a> renvoie une erreur sur votre système)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> mate .autotest
</pre></div>
</div>


<div class="label" id="code:dot_autotest"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.9.</span> <span class="description">Le fichier de configuration <code>.autotest</code> pour Autotest sur OS&nbsp;X.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;autotest/growl&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;autotest/fsevent&#39;</span>
</pre></div>
</div></div>




<div class="label" id="code:dot_autotest_alt"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.10.</span> <span class="description">Un fichier <code>.autotest</code> alternatif nécessaire sur certains systèmes.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;autotest-growl&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;autotest-fsevent&#39;</span>
</pre></div>
</div></div>


<p>(Note&nbsp;: cela créera une configuration Autotest pour l'<em>Application Exemple</em> seulement&nbsp;; si vous voulez partager cette configuration Autotest avec les autres projets Rails ou Ruby, vous devriez crér un fichier <code>.autotest</code> plutôt dans votre dossier <em>accueil</em> (<em>home</em>)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> mate ~/.autotest
</pre></div>
</div>


<p>où <tt class="verb">~</tt> (tilde) est le symbole Unix pour le «&nbsp;dossier home&nbsp;»).</p>

<p>Si vous tournez sous Linux avec le bureau Gnome, vous devrez essayer les étapes décrites à l'adresse <a href="http://automate-everything.com/2009/08/gnome-and-autospec-notifications/">Automate Everything</a>, qui installe sur Linux un système semblable aux notifications Growl sur OS&nbsp;X. Les utilisateurs Windows devront essayer d'installer <a href="http://www.growlforwindows.com/gfw/">Growl pour Windows</a> et suivre ensuite les instructions de la page <a href="http://github.com/svoop/autotest-growl">GitHub pour <code>autotest-growl</code></a>. Les utilisateurs Linux tout comme les utilisateurs Windows peuvent avoir à jeter un œil à la page <a href="http://github.com/carlosbrando/autotest-notification">autotest-notification</a>&nbsp;; le lecteur du <em>Tutoriel Rails</em> Fred Schoeneman a écrit un compte-rendu intéressant sur son blog&nbsp;: <a href="http://fredschoeneman.posterous.com/pimp-your-autotest-notification">À Propos des notifications Autotest</a>.<sup class="footnote" id="fnref:3.10"><a href="#fn:3.10">10</a></sup></p>

<div class="label" id="sec:TDD"></div>


<h3><a id="sec:3.2.2" href="static-pages#sec:TDD" class="heading"><span class="number">3.2.2</span> TDD&nbsp;: Rouge, Vert, Restructurer</a></h3>


<p>Dans un «&nbsp;Développement Dirigé par les Tests&nbsp;» (TDD), nous écrivons d'abord un test <em>échec</em>&nbsp;: dans notre cas, une pièce de code qui exprime l'idée qu'il devrait y avoir une page «&nbsp;À Propos&nbsp;» (<code>about</code>). Nous lançons alors le test, dans notre cas en ajoutant l'action <code>about</code> et la vue correspondante. La raison typique pour laquelle nous ne faisons pas l'inverse &mdash;&nbsp;l'implémentation d'abord, puis le test&nbsp;&mdash; permet de nous assurer que nous testons vraiment la fonctionnalité que nous ajoutons. Avant d'utiliser le processus TDD, j'étais souvent surpris de découvrir que mes tests, en réalité, testaient la mauvaise chose, quand ils ne testaient pas, tout simplement, rien du tout. En s'assurant que, dans un premier temps, le test <em>échoue</em> et <em>ensuite seulement</em> <em>réussit</em>, nous pouvons être plus confiant sur le fait que nous accomplissons le bon test.</p>

<p>Il est important de comprendre que TDD n'est pas toujours le bon outil pour accomplir le travail. En particulier, quand vous n'êtes pas sûr du tout de comment résoudre un problème de programmation donné, il est souvent utile de laisser tomber les tests un moment pour écrire seulement le code de l'application, juste pour sentir à quoi la solution pourrait ressembler (dans le langage de l''<a href="http://en.wikipedia.org/wiki/Extreme_Programming">Extreme Programming (XP)</a>, cette étape d'exploration est appelée  une <em>spike</em> &mdash;&nbsp;une «&nbsp;pointe&nbsp;», un gros clou). Une fois que vous avez trouvé la forme générale de la solution, vous pouvez alors utiliser TDD pour implémenter une version plus efficiente.</p>

<p>Une façon de procéder au développement dirigé par le test est un cycle connu sous le terme «&nbsp;Rouge, Vert, Restructurer&nbsp;». La première étape, le Rouge, se réfère à l'écriture d'un test conduisant à l'échec, que de nombreux outils de test indiquent avec la couleur rouge. L'étape suivante, Vert, se réfère à un test conduisant à la réussite, indiqué par la couleur (attendue) verte. Une fois que nous avons un test (ou une batterie de tests) qui réussit, nous sommes libres de <em>restructurer</em> notre code, d'en changer la forme (en éliminant les répétitions par exemple) sans en changer la fonction.</p>

<p>Nous n'avons pas encore de couleur, donc commençons par le Rouge. RSpec (et le testing en général) peut être intimidant de prime abord, donc nous allons utiliser les tests générés par les <code>rails generate controller Pages</code> (les <em>Pages de génération de contrôleur de Rails</em>) de l'<a class="ref" href="static-pages#code:generating_pages">extrait&nbsp;3.4</a> pour commencer. Puisque je ne suis pas partisan de séparer les tests pour les Vues de ceux pour les <em>Helpers</em> (les «&nbsp;Assistants&nbsp;». NdT), séparation que j'ai toujours trouvée soit fragile soit redondante, notre première étape va consister à les effacer. Si vous utilisez Git, vous pouvez le faire comme suit&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git rm -r spec/views
<span class="gp">$</span> git rm -r spec/helpers
</pre></div>
</div>


<p>Dans le cas contraire, supprimez-les directement&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rm -rf spec/views
<span class="gp">$</span> rm -rf spec/helpers
</pre></div>
</div>


<p>Nous allons traiter les tests pour les Vues et les <em>Helpers</em> directement dans les tests du contrôleur commençant à la <a class="ref" href="static-pages#sec:slightly_dynamic_pages">section&nbsp;3.3</a>.</p>

<p>Pour commencer avec RSpec, jetez un œil aux spécifications du contrôleurs  Pages<sup class="footnote" id="fnref:3.11"><a href="#fn:3.11">11</a></sup> que nous venons de générer (<a class="ref" href="static-pages#code:default_pages_controller_spec">extrait&nbsp;3.11</a>).</p>

<div class="label" id="code:default_pages_controller_spec"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.11.</span> <span class="description">Les spécifications du contrôleur Pages généré. <br /> <code>spec/controllers/pages_controller_spec.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;contact&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>

<p>(«&nbsp;should be successful&nbsp;» signifie «&nbsp;devrait réussir&nbsp;». NdT)</p>

<p>Ce code est en pur Ruby, mais même si vous avez étudié Ruby précédemment il ne vous semblera pas très familier. C'est parce que RSpec utilise la malléabilité de Ruby pour définir son propre <em>langage de domaine</em> (<em>domain-specific language</em> (DSL)) construit juste pour le testing. Le point important ici est que <em>vous n'avez pas besoin de comprendre la syntaxe RSpec pour pouvoir utiliser RSpec</em>. Ça peut sembler magique dans un premier temps, mais RSpec est conçu pour se lire plus ou moins comme de l'anglais, et si vous suivez les exemples du script généré et les autres exemples de ce tutoriel, vous le maitriserez rapidement.</p>

<p>L''<a class="ref" href="static-pages#code:default_pages_controller_spec">extrait&nbsp;3.11</a> contient deux blocs descriptifs (blocs <code>describe</code>, <em>décrire</em>), chacun avec un <em>exemple</em> (par exemple un bloc commençant avec <code>it "&hellip;" do</code> &mdash;&nbsp;<em>il "…" fait</em>). Concentrons-nous sur le premier pour sentir ce qui se passe&nbsp;:</p>

<div class="code"><div class="highlight"><pre>  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;devrait réussir&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>
</div>


<p>La première ligne indique que nous décrivons (<em>describe</em>) une opération <tt>GET</tt> pour l'action <code>home</code>. C'est juste une description, et ça peut être ce que vous voulez&nbsp;; RSpec s'en fiche, mais vous ou d'autres lecteurs humains probablement pas. Dans ce cas, <code>"GET &rsquo;home&rsquo;"</code> indique que le test correspond à une requête HTTP <tt>GET</tt>, comme discutée dans le <a class="ref" href="static-pages#sidebar:get_etc">Box&nbsp;3.1</a>. Alors la spécification dit que lorsque vous visitez la page d'accueil, cela devrait réussir. Comme avec la première ligne, ce qui vient à l'intérieur des guillemets n'intéresse pas RSpec, ça n'est pertinent qu'aux lecteurs humains. La troisième ligne, <code>get &rsquo;home&rsquo;</code>, est la première ligne qui véritablement accomplit quelque chose. À l'intérieur de RSpec, cette ligne <em>soumet vraiment une requête GET</em>&nbsp;; en d'autres termes, elle agit comme un navigateur et pointe vers la page, dans ce cas <tt>/pages/home</tt> (il sait automatiquement qu'il doit toucher le contrôleur Pages puisque c'est un test de ce contrôleur Pages&nbsp;; il sait qu'il doit atteindre la page d'accueil parce que nous lui disons explicitement). Enfin, la quatrième ligne dit que la <em>réponse</em> (<em>response</em>) de notre application devrait indiquer un succès (elle devrait par exemple retourner un <em>code d'état</em> de <tt>200</tt>&nbsp;; voir <a class="ref" href="static-pages#sidebar:response_codes">Box&nbsp;3.2</a>).</p>

<div class="label" id="sidebar:response_codes"></div>


<div class="sidebar"><span class="title"><span class="header">Box 3.2.</span><span class="description">Codes de réponse HTTP</span></span>
<p>Après qu'un client (tel qu'un navigateur web) envoie une requête correspondant à un des verbes HTTP (<a class="ref" href="static-pages#sidebar:get_etc">Box&nbsp;3.1</a>), le serveur web <em>répond</em> par un code numérique indiquant le <a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes">statut HTTP</a> de la réponse. Par exemple, un code d'état de <tt>200</tt> signifie la réussite et un code d'état de 301 signifie une «&nbsp;redirection permanente&nbsp;». Si vous avez <a href="http://www.google.com/search?q=install+curl">installé <tt>curl</tt></a>, un client en ligne de commande qui peut traiter les requêtes HTTP, vous pouvez voir cela directement avec, par exemple, <tt>www.google.com</tt> (où les drapeaux <tt class="verb">--head</tt> empêchent <code>curl</code> de retourner la page complète)&nbsp;:</p>

<pre class="verbatim">  $ curl --head www.google.fr
  HTTP/1.1 200 OK
  .
  .
  .</pre>


<p>Ici Google indique que la requête a été exécutée avec succès en retournant le code d'état <tt>200&nbsp;OK</tt>. <em>A contrario</em>, <tt>google.com</tt> est redirigé de façon permanente (vers <tt>www.google.com</tt>, naturellement), indiquant un code d'état <tt>301</tt> (une «&nbsp;redirection <tt>301</tt>&nbsp;»)&nbsp;:</p>

<pre class="verbatim">  $ curl --head google.com
  HTTP/1.1 301 Moved Permanently
  Location: http://www.google.com/
  .
  .
  .</pre>


<p>(<em>Note&nbsp;:</em> le résultat retourné ci-dessus peut varier légèrement suivant les pays)</p>

<p>Quand nous écrivons <code>response.should be_success</code> (<em>la_réponse.devrait être_un_succès</em>) dans un test RSpec, RSpec vérifie que la réponse de notre application à la requête est un code d'état de <tt>200</tt>.</p>
</div>


<p>Il est temps maintenant de faire jouer nos tests. Il existe plusierurs façons différentes et équivalentes de le faire.<sup class="footnote" id="fnref:3.12"><a href="#fn:3.12">12</a></sup> Une façon de jouer tous les tests consiste à utiliser le script <code>rspec</code> en ligne de commande comme suit&nbsp;:<sup class="footnote" id="fnref:3.13"><a href="#fn:3.13">13</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
<span class="go">....</span>

<span class="go">Finished in 0.07252 seconds</span>

<span class="go">2 examples, 0 failures</span>
</pre></div>
</div>


<p>Sur certains système (spécialement ceux utilisant l'invite de commande Windows), vous pourriez avoir un message d'erreur à ce stade indiquant des difficultés à trouver le programme <code>rspec</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="go">C:\Sites\sample_app&gt;rspec spec/</span>
<span class="go">&#39;rspec&#39; is not recognized as an internal or external command,</span>
<span class="go">operable program or batch file.</span>
</pre></div>
</div>


<p>Dans ce cas, vous aurez besoin d'exécuter <code>rspec</code> par le Bundler en utilisant la commande <code>bundle exec</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="go">C:\Sites\sample_app&gt;bundle exec rspec spec/</span>
<span class="go">....</span>

<span class="go">Finished in 0.07252 seconds</span>
<span class="go">2 examples, 0 failures</span>
</pre></div>
</div>


<p>Malheureusement, de nombreuses autres choses peuvent mal tourner à ce niveau. Si un test échoue, assurez-vous d'avoir bien migré la base de données avec <code>rake db:migrate</code> comme cela est décrit à la <a class="ref" href="beginning#sec:rails_server">section&nbsp;1.2.5</a>. Si RSpec ne fonctionne pas du tout, essayez de le désinstaller et de le ré-installer&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> gem uninstall rspec rspec-rails
<span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Si ça ne fonctionne toujours pas et que vous utilisez <a href="http://rvm.beginrescueend.com/">RVM</a>, essayez de supprimer le gemset du tutoriel Rails et de ré-installer les gems&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm gemset delete rails3tutorial
<span class="gp">$</span> rvm --create use 1.9.2@rails3tutorial
<span class="gp">$</span> rvm --default 1.9.2@rails3tutorial
<span class="gp">$</span> gem install rails -v 3.0.7
<span class="gp">$</span> bundle install
</pre></div>
</div>


<p>(Si ça continue de ne pas fonctionner… je suis à court d'idées.)</p>

<p>En jouant <code>rspec spec/</code>, <code>rspec</code> est un programme fourni par RSpec, tandis que <code>spec/</code> est le <em>dossier</em> où vous voulez que rspec s'exécute. Vous pouvez également jouer seulement les specs dans un sous-dossier particulier. Par exemple, la commande suivante joue uniquement ls specs des contrôleurs&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/controllers/
<span class="go">....</span>
<span class="go">Finished in 0.07502 seconds</span>

<span class="go">2 examples, 0 failures</span>
</pre></div>
</div>


<p>Vous pouvez aussi jouer seulement un fichier&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/controllers/pages_controller_spec.rb
<span class="go">....</span>
<span class="go">Finished in 0.07253 seconds</span>

<span class="go">2 examples, 0 failures</span>
</pre></div>
</div>


<p>Le résultat de ces trois commandes est le même puisque le spec du contrôleur Pages est actuellement notre seul fichier de test. Au cours de la suite de ce livre, je ne montrerai pas toujours la sortie du testing, mais vous devrez jouer <code>rspec spec/</code> (ou une de ses variantes) régulièrement en poursuivant &mdash;&nbsp;ou, même mieux, utiliser Autotest pour jouer automatiquement la batterie de tests. En parlant de ça&hellip;</p>

<p>Si vous avez intallés Autotest, vous pouvez le faire travailler sur vos tests RSpec en utilisant la command <code>autotest</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> autotest
</pre></div>
</div>


<p>Si cela ne fonctionne pas, essayez&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>autotest
</pre></div>
</div>


<p>Si vous utilisez un Mac avec les notifications Growl activées, vous devriez pouvoir répliquer mes réglages montrés dans l'<a class="ref" href="static-pages#fig:autotest_green">illustration&nbsp;3.6</a>. Avec Autotest jouant en arrière-tâche et les notifications Growl vous disant l'état de vos tests, vous pourriez bien devenir accro du développement TDD.</p>

<div class="label" id="fig:autotest_green"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/autotest_green.png" alt="autotest_green" /></span></div><div class="caption"><span class="header">Illustration 3.6: </span><span class="description">Autotest (via <code>autotest</code>) en action avec les notifications Growl.&nbsp;<a href="http://railstutorial.org/images/figures/autotest_green-full.png">(taille&nbsp;normale)</a></span></div></div>




<div class="label" id="sec:spork"></div>


<h4><a id="sec:3.2.2.1" href="static-pages#sec:spork" class="heading">Spork</a></h4>


<p>Vous avez peut-être noté que les ressources-système liées à la gestion d'une suite de tests peuvent être considérables. Cela s'explique par le fait que chaque fois que RSpec joue les tests, il doit recharger tout l'environnement Rails. Le <a href="http://github.com/timcharper/spork">serveur de test Spork</a><sup class="footnote" id="fnref:3.14"><a href="#fn:3.14">14</a></sup> a pour but de régler ce problème. Spork charge <em>une seule fois</em> l'environnement, et maintient alors un pool de processus pour jouer les prochains tests. Combiné à Autotest, Spork est particulièrement utile.</p>

<p>Configurer et faire fonctionner Spork peut être difficile, et c'est un sujet de niveau plutôt avancé. <strong>Si vous vous sentez dépassé, n'hésitez pas à passer cette section.</strong></p>

<p>La première étape consiste à ajouter la dépendance gem <tt>spork</tt> au <code>Gemfile</code> (<a class="ref" href="static-pages#code:gemfile_spork">extrait&nbsp;3.12</a>).</p>

<div class="label" id="code:gemfile_spork"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.12.</span> <span class="description">Un <code>Gemfile</code> pour l'<em>Application Exemple</em>.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.7&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3-ruby&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.2&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s1">&#39;sqlite3&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.5.0&#39;</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec&#39;</span><span class="p">,</span> <span class="s1">&#39;2.5.0&#39;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">gem</span> <span class="s1">&#39;spork&#39;</span><span class="p">,</span> <span class="s1">&#39;0.9.0.rc5&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Ensuite, installez-le&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Amorcer la configuration Spork&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> spork --bootstrap
</pre></div>
</div>


<p>Maintenant nous devons éditer le fichier de configuration RSpec, <code>spec/spec_helper.rb</code>, pour que l'environnement soit chargé dans le bloc <em>prefork</em>, pour n'avoir à le charger qu'une seule fois (<a class="ref" href="static-pages#code:spork_spec_helper">extrait&nbsp;3.13</a>).</p>

<div class="label" id="code:spork_spec_helper"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.13.</span> <span class="description">Ajout du chargement de l'environnement dans le bloc <code>Spork.prefork</code>. <br /> <code>spec/spec_helper.rb</code></span>
<div><em>Note&nbsp;: utilisez seulement ce code si vous utilisez Spork. Si vous essayez d'utiliser l''<a class="ref" href="static-pages#code:spork_spec_helper">extrait&nbsp;3.13</a> sans Spork, la suite de test de votre application ne fonctionnera pas.</em></div>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spork&#39;</span>

<span class="no">Spork</span><span class="o">.</span><span class="n">prefork</span> <span class="k">do</span>
  <span class="c1"># En charger plus dans ce bloc accélèrera les tests. Cependant, </span>
  <span class="c1"># si vous changez de configuration ou le code des</span>
  <span class="c1"># librairies chargées ici, vous devrez redémarrer spork.</span>
  <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;RAILS_ENV&quot;</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">&#39;test&#39;</span>
  <span class="nb">require</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;../../config/environment&quot;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
  <span class="nb">require</span> <span class="s1">&#39;rspec/rails&#39;</span>

  <span class="c1"># Requires supporting files with custom matchers and macros, etc,</span>
  <span class="c1"># in ./support/ and its subdirectories.</span>
  <span class="no">Dir</span><span class="o">[</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;spec/support/**/*.rb&quot;</span><span class="p">)</span><span class="o">].</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="nb">require</span> <span class="n">f</span><span class="p">}</span>

  <span class="no">Rspec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
    <span class="c1"># == Mock Framework</span>
    <span class="c1">#</span>
    <span class="c1"># If you prefer to use mocha, flexmock or RR, uncomment the appropriate line:</span>
    <span class="c1">#</span>
    <span class="c1"># config.mock_with :mocha</span>
    <span class="c1"># config.mock_with :flexmock</span>
    <span class="c1"># config.mock_with :rr</span>
    <span class="n">config</span><span class="o">.</span><span class="n">mock_with</span> <span class="ss">:rspec</span>

    <span class="n">config</span><span class="o">.</span><span class="n">fixture_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="o">::</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/spec/fixtures&quot;</span>

    <span class="c1"># If you&#39;re not using ActiveRecord, or you&#39;d prefer not to run each of your</span>
    <span class="c1"># examples within a transaction, comment the following line or assign false</span>
    <span class="c1"># instead of true.</span>
    <span class="n">config</span><span class="o">.</span><span class="n">use_transactional_fixtures</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Spork</span><span class="o">.</span><span class="n">each_run</span> <span class="k">do</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Avant de lancer Spork, nous pouvons obtenir une référence du temps que prend notre batterie de tests comme suit&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">time </span>rspec spec/
<span class="go">..</span>


<span class="go">Finished in 0.09606 seconds</span>
<span class="go">2 examples, 0 failures</span>

<span class="go">real    0m7.445s</span>
<span class="go">user    0m5.248s</span>
<span class="go">sys     0m1.475s</span>
</pre></div>
</div>


<p>Ici la suite de tests prend plus de 7 secondes pour être exécutée même si les tests effectifs jouent en moins d'une dizaine de secondes. Pour accélérer cela, nous pouvons ouvrir une fenêtre terminal dédiée aux tests, nous rendre dans le dossier Rails racine et démarrer un serveur Spork&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> spork
<span class="go">Using RSpec</span>
<span class="go">Loading Spork.prefork block...</span>
<span class="go">Spork is ready and listening on 8989!</span>
</pre></div>
</div>


<p>Dans une autre fenêtre Terminal, nous pouvons maintenant lancer notre batterie de tests avec l'option <tt class="verb">--drb</tt> <sup class="footnote" id="fnref:3.15"><a href="#fn:3.15">15</a></sup> et vérifier que le temps de chargement de l'environnement est considérablement réduit&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">time </span>rspec --drb spec/
<span class="go">..</span>


<span class="go">Finished in 0.10519 seconds</span>
<span class="go">2 examples, 0 failures</span>

<span class="go">real    0m0.803s</span>
<span class="go">user    0m0.354s</span>
<span class="go">sys     0m0.171s</span>
</pre></div>
</div>


<p>Comme attendu, les temps ont été considérablement réduits.</p>

<p>Pour lancer RSpec et Spork avec Autotest, nous avons besoin de configurer RSpec pour utiliser l'option <tt class="verb">--drb</tt> par défaut, ce que nous pouvons faire en l'ajoutant au fichier de configuration <code>.rspec</code> dans le dossier racine de Rails (<a class="ref" href="static-pages#code:dot_rspec">extrait&nbsp;3.14</a>).</p>

<div class="label" id="code:dot_rspec"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.14.</span> <span class="description">Ajout de l'option <tt class="verb">--drb</tt> au fichier <code>.rspec</code>.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="o">--</span><span class="n">colour</span>
<span class="o">--</span><span class="n">drb</span>
</pre></div>
</div></div>


<p>Avec ce fichier <code>.rspec</code> actualisé, la suite de tests devrait fonctionner aussi vite que précédemment, même sans l'option explicite <tt class="verb">--drb</tt>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">time </span>rspec spec/
<span class="go">..</span>


<span class="go">Finished in 0.10926 seconds</span>
<span class="go">2 examples, 0 failures</span>

<span class="go">real    0m0.803s</span>
<span class="go">user    0m0.355s</span>
<span class="go">sys     0m0.171s</span>
</pre></div>
</div>


<p>Bien entendu, jouer <code>time</code> ici n'a de sens que pour l'illustration&nbsp;; normalement, vous avez juste à jouer&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
</pre></div>
</div>


<p>… ou&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> autotest
</pre></div>
</div>


<p>… sans la commande <code>time</code>.</p>

<p>Un petit conseil quand vous utilisez Spork&nbsp;: si vos tests échouent quand vous pensez qu'ils devraient réussir, le problème peut venir du chargement du <em>prefork</em> de Spork, qui peut parfois empêcher le chargement de certains fichiers utiles. Dans le doute, quittez alors le serveur Spok (avec <tt>Control-C</tt>) et relancez-le&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> spork
<span class="go">Using RSpec</span>
<span class="go">Loading Spork.prefork block...</span>
<span class="go">Spork is ready and listening on 8989!</span>
<span class="go">^C</span>
<span class="gp">$</span> spork
</pre></div>
</div>


<div class="label" id="sec:red"></div>


<h4><a id="sec:3.2.2.2" href="static-pages#sec:red" class="heading">Rouge</a></h4>


<p>Maintenant voyons la partie Rouge de notre cycle Rouge-Vert en écrivant un test qui va échouer sur la page «&nbsp;À Propos&nbsp;» (page <code>about</code>). En suivant les modèles de l'<a class="ref" href="static-pages#code:default_pages_controller_spec">extrait&nbsp;3.11</a>, vous pouvez probablement deviner le test adéquat (<a class="ref" href="static-pages#code:failing_about_page">extrait&nbsp;3.15</a>).</p>

<div class="label" id="code:failing_about_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.15.</span> <span class="description">Le spec du contrôleur Pages avec un test d'échec pour la page «&nbsp;À Propos&nbsp;». <br /> <code>spec/controllers/pages_controller_spec.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>
  <span class="n">render_views</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;devrait réussir&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;contact&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;devrait réussir&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;about&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;devrait réussir&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Notez que nous avons ajouté une ligne pour dire à RSpec de <em>rendre les vues</em> à l'intérieur des tests du contrôleur. En d'autres termes, par défaut, RSpec teste juste les actions à l'intérieur d'un test d'un contrôleur de test&nbsp;; si vous voulez en plus qu'il rende les vues, nous devons lui demander explictement via la deuxième ligne&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>
  <span class="n">render_views</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
</pre></div>
</div>


<p>Cela assure que si les tests réussissent, la page est vraiment là.</p>

<p>Le nouveau test tente d'atteindre (<code>get</code>) l'action <code>about</code>, et indique que la réponse en résultant doit être un succès. À dessein, cela échoue (avec un message d'erreur rouge), comme le montre l'<a class="ref" href="static-pages#fig:rspec_spec_red">illustration&nbsp;3.7</a> (<code>rspec spec/</code>) et l'<a class="ref" href="static-pages#fig:autotest_red">illustration&nbsp;3.8</a> (<code>autotest</code>) (si vous testez les vues dans les contrôleurs comme le préconise ce tutoriel, cela vaut la peine de noter que changer le fichier de la vue n'invitera pas Autotest à jouer le test de contrôleur correspondant. Il existe probablement une façon de configurer Autotest pour faire cela automatiquement, mais habituellement je bascule juste vers le contrôleur et presse la touche «&nbsp;espace-retour&nbsp;» pour que le fichier soit marqué comme modifié. Sauver le contrôleur conduit Autotest à jouer les tests comme prévu).</p>

<div class="label" id="fig:rspec_spec_red"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/rspec_spec_red.png" alt="rspec_spec_red" /></span></div><div class="caption"><span class="header">Illustration 3.7: </span><span class="description">Specification de l'échec pour la page About («&nbsp;À Propos&nbsp;») en utilisant <code>rspec spec/</code>.&nbsp;<a href="http://railstutorial.org/images/figures/rspec_spec_red-full.png">(taille&nbsp;normale)</a></span></div></div>




<div class="label" id="fig:autotest_red"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/autotest_red.png" alt="autotest_red" /></span></div><div class="caption"><span class="header">Illustration 3.8: </span><span class="description">Spécification de l'échec de la page About en utilisant Autotest.&nbsp;<a href="http://railstutorial.org/images/figures/autotest_red-full.png">(taille&nbsp;normale)</a></span></div></div>


<p>C'est Rouge. Maintenant obtenons le Vert.</p>

<div class="label" id="sec:green"></div>


<h4><a id="sec:3.2.2.3" href="static-pages#sec:green" class="heading">Vert</a></h4>


<p>Rappelez-vous, de la <a class="ref" href="static-pages#sec:static_pages_with_rails">section&nbsp;3.1.2</a>, que nous pouvons générer une page statique avec Rails en créant une action et la vue correspondante avec le nom de la page. Dans notre cas, la page «&nbsp;À Propos&nbsp;» aura d'abord besoin d'une action appelée <code>about</code> dans le contrôleur Pages. Ayant écrit un test d'échec, nous pouvons maintenant être sûr qu'en le faisant réussir, nous avons bien créé une page <code>about</code> qui fonctionne.</p>

<p>En suivant les modèles fournis par <code>home</code> et <code>contact</code> dans l'<a class="ref" href="static-pages#code:pages_controller">extrait&nbsp;3.6</a>, commençons d'abord par ajouter l'action <code>about</code> dans le contrôleur Pages (<a class="ref" href="static-pages#code:adding_the_about_page">extrait&nbsp;3.16</a>).</p>

<div class="label" id="code:adding_the_about_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.16.</span> <span class="description">Le contrôleur Pages avec l'ajout de l'action <code>about</code>. <br /> <code>app/controllers/pages_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">about</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Ensuite, nous allons ajouté l'action <code>about</code> au fichier de routage (<a class="ref" href="static-pages#code:about_route">extrait&nbsp;3.17</a>).</p>

<div class="label" id="code:about_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.17.</span> <span class="description">Ajout de la route <code>about</code>. <br /> <code>config/routes.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="no">SampleApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;pages/home&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;pages/contact&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;pages/about&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Pour finir, nous allons ajouter la Vue <code>about</code>. Éventuellement, nous pourrions la remplir avec quelque chose de plus informatif, mais pour le moment nous copierons seulement le contenu des vues générées (<a class="ref" href="static-pages#code:raw_home_view">extrait&nbsp;3.7</a> et <a class="ref" href="static-pages#code:raw_contact_view">extrait&nbsp;3.8</a>) pour la vue <code>about</code> (<a class="ref" href="static-pages#code:raw_about_view">extrait&nbsp;3.18</a>).</p>

<div class="label" id="code:raw_about_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.18.</span> <span class="description">Une page «&nbsp;À Propos&nbsp;» souche. <br /> <code>app/views/pages/about.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Pages#about<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/pages/about.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>Jouer les specs et regarder les actualisations depuis Autotest (<a class="ref" href="static-pages#fig:autotest_back_to_green">illustration&nbsp;3.9</a>) devrait retourner un message vert&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
</pre></div>
</div>


<div class="label" id="fig:autotest_back_to_green"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/autotest_back_to_green.png" alt="autotest_back_to_green" /></span></div><div class="caption"><span class="header">Illustration 3.9: </span><span class="description">Autotest de retour au Vert&nbsp;: tous les tests réussissent.&nbsp;<a href="http://railstutorial.org/images/figures/autotest_back_to_green-full.png">(taille&nbsp;normale)</a></span></div></div>


<p>Bien sûr, ça n'est jamais une mauvaise idée de jeter un œil à la page dans un navigtaeur pour s'assurer que les tests ne sont pas totalement absurdes (<a class="ref" href="static-pages#fig:raw_about_page">illustration&nbsp;3.10</a>).</p>

<div class="label" id="fig:raw_about_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/raw_about_page.png" alt="raw_about_page" /></span></div><div class="caption"><span class="header">Illustration 3.10: </span><span class="description">La nouvelle page (brute de décoffrage) «&nbsp;À Propos&nbsp;» (<a href="http://localhost:3000/pages/about"><tt>/pages/about</tt></a>).&nbsp;<a href="http://railstutorial.org/images/figures/raw_about_page-full.png">(taille&nbsp;normale)</a></span></div></div>




<div class="label" id="sec:refactor"></div>


<h4><a id="sec:3.2.2.4" href="static-pages#sec:refactor" class="heading">Restructurer</a></h4>


<p>Maintenant que nous sommes au Vert, nous sommes libre de <em>restructurer</em> notre code en changeant sa forme sans changer sa fonction. Souvent, le codage se fait <em>au feeling</em>, ce qui signifie qu'il devient rapidement laid, bouffi et plein de répétitions. L'ordinateur s'en fiche, bien sûr, mais pas les humains, donc il est important de garder le code base le plus propre possible en le restructurant fréquemment. Avoir une bonne batterie de tests (qui réussissent) est un outil inestimable à cet égard, car il réduit considérablement la probabilité d'introduire des bogues en cours de restructuration.</p>

<p>Notre <em>Application Exemple</em> est un peu trop petite pour la restructurer maintenant, mais l'odeur de code sale s'infiltre par chaque fissure, donc nous n'aurons pas à attendre bien longtemps&nbsp;: nous serons contraints de restructurer dès la <a class="ref" href="static-pages#sec:instance_variables_embedded_ruby">section&nbsp;3.3.3</a> de ce chapitre.</p>

<div class="label" id="sec:slightly_dynamic_pages"></div>


<h2><a id="sec:3.3" href="static-pages#sec:slightly_dynamic_pages" class="heading"><span class="number">3.3</span> Pages (un peu) dynamiques</a></h2>


<p>Maintenant que nous avons créé les actions et les vues pour quelques pages statiques, nous allons les rendre <em>très légèrement</em> dynamiques en ajoutant du contenu qui change en fonction des pages&nbsp;: nous devons changer le titre de chaque page pour qu'il reflète son contenu. Que cela représente <em>vraiment</em> un contenu dynamique est discutable, mais en tout cas il présente les fondements nécessaires pour le contenu indiscutablement dynamique du <a class="ref" href="sign-up#top">chapitre&nbsp;8</a>.</p>

<p>(Si vous avez passé ce qui concernait le TDD de la <a class="ref" href="static-pages#sec:first_tests">section&nbsp;3.2</a>, assurez-vous de créer une page «&nbsp;À Propos&nbsp;» ici en utilisant le code de l'<a class="ref" href="static-pages#code:adding_the_about_page">extrait&nbsp;3.16</a>, de l'<a class="ref" href="static-pages#code:about_route">extrait&nbsp;3.17</a> et de l'<a class="ref" href="static-pages#code:raw_about_view">extrait&nbsp;3.18</a>.)</p>

<div class="label" id="sec:testing_a_title_change"></div>


<h3><a id="sec:3.3.1" href="static-pages#sec:testing_a_title_change" class="heading"><span class="number">3.3.1</span> Tester un changement de titre</a></h3>


<p>Notre plan est d'éditer les pages Home (<em>Accueil</em>), Contact et About (<em>À Propos</em>) pour ajouter le type de structure HTML que nous avons vu dans l'<a class="ref" href="static-pages#code:hello_world">extrait&nbsp;3.3</a>, en incluant des titres qui changent pour chacune des pages. C'est un sujet épineux de décider lequel de ces changements tester, et en général, tester le code HTML peut se révéler hasardeux entendu que le contenu tend à changer fréquemment. Nous garderons nos tests le plus simple possible en ne testant que le titre de la page.</p>

<div class="label" id="table:static_pages"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_center"><strong>Page</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Titre de base</strong></th><th class="align_left"><strong>Variable titre</strong></th></tr><tr class="top_bar"><td class="align_center">Accueil</td><td class="align_left"><tt>/pages/home</tt></td><td class="align_left"><code>"Simple App du Tutoriel Ruby on Rails"</code></td><td class="align_left"><code>" | Accueil"</code></td></tr><tr><td class="align_center">Contact</td><td class="align_left"><tt>/pages/contact</tt></td><td class="align_left"><code>"Simple App du Tutoriel Ruby on Rails"</code></td><td class="align_left"><code>" | Contact"</code></td></tr><tr><td class="align_center">À Propos</td><td class="align_left"><tt>/pages/about</tt></td><td class="align_left"><code>"Simple App du tutoriel Ruby on Rails"</code></td><td class="align_left"><code>" | À Propos"</code></td></tr></table></div><div class="caption"><span class="header">Table 3.1: </span><span class="description">Les pages statiques (courantes) pour l'<em>Application Exemple</em>.</span></div></div>


<p>À la fin de cette section, nos trois pages statiques auront des titres de la forme «&nbsp;Simple App du Tutoriel Ruby on Rails | Accueil&nbsp;», où la dernière partie de titre variera en fonction de la page (<a class="ref" href="static-pages#table:static_pages">Table&nbsp;3.1</a>). Nous construirons les tests d'après l'<a class="ref" href="static-pages#code:failing_about_page">extrait&nbsp;3.15</a>, en ajoutant des tests sur le titre suivant le modèle de l'<a class="ref" href="static-pages#code:title_test">extrait&nbsp;3.19</a>.</p>

<div class="label" id="code:title_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.19.</span> <span class="description">Un test de titre.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="n">it</span> <span class="s2">&quot;doit avoir le bon titre&quot;</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
  <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s2">&quot;Simple App du Tutoriel Ruby on Rails | Accueil&quot;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Ce code utilise la méthode <code>have_selector</code> à l'intérieur de RSpec&nbsp;; la documentation sur <code>have_selector</code> est étonnament éparse, mais ce qu'elle fait, c'est de comparer le contenu d'un élément HTML (d'un «&nbsp;selector&nbsp;») avec un contenu donné. En d'autres termes, le code&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                  <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s2">&quot;Simple App du Tutoriel Ruby on Rails | Accueil&quot;</span><span class="p">)</span>
</pre></div>
</div>


<p>… s'assure que le contenu entre les balises <tt class="verb">&lt;title&gt;&lt;/title&gt;</tt> est bien <code>"Simple App du Tutoriel Ruby on Rails | Accueil"</code>.<sup class="footnote" id="fnref:3.16"><a href="#fn:3.16">16</a></sup> Il est utile de mentionner que le contenu n'a pas besoin d'être exact&nbsp;; toute sous-chaine fonctionne aussi, donc le code&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s2">&quot; | Accueil&quot;</span><span class="p">)</span>
</pre></div>
</div>


<p>… fonctionnera tout aussi bien.<sup class="footnote" id="fnref:3.17"><a href="#fn:3.17">17</a></sup></p>

<p>Notez que dans l'<a class="ref" href="static-pages#code:title_test">extrait&nbsp;3.19</a> j'ai coupé le texte à l'intérieur du <code>have_selector</code> en deux lignes&nbsp;; cela nous apprend quelque chose d'important à propos de la syntaxe Ruby&nbsp;: Ruby ne se soucie pas des retours à la ligne.<sup class="footnote" id="fnref:3.18"><a href="#fn:3.18">18</a></sup> La <em>raison</em> pour laquelle j'ai choisi de couper le code en deux est que je préfère garder des lignes de code inférieures à 80 signes pour une question de lisibilité.<sup class="footnote" id="fnref:3.19"><a href="#fn:3.19">19</a></sup> À l'heure actuelle, je trouve le formatage de ce code plutôt laid&nbsp;; la <a class="ref" href="static-pages#sec:static_pages_exercises">section&nbsp;3.5</a> comprend un exercice de restructuration qui lui refera une beauté.<sup class="footnote" id="fnref:3.20"><a href="#fn:3.20">20</a></sup></p>

<p>Ajouter les nouveaux tests pour chacune de nos trois pages statiques en suivant le modèle de l'<a class="ref" href="static-pages#code:title_test">extrait&nbsp;3.19</a> nous fournit notre nouveau spec du contrôleur Pages (<a class="ref" href="static-pages#code:pages_controller_spec_title">extrait&nbsp;3.20</a>).</p>

<div class="label" id="code:pages_controller_spec_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.20.</span> <span class="description">Le spec du contrôleur Pages avec le test des titres. <br /> <code>spec/controllers/pages_controller_spec.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>
  <span class="n">render_views</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;devrait réussir&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;devrait avoir le bon titre&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                        <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s2">&quot;Simple App du Tutoriel Ruby on Rails | Accueil&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;contact&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;devrait réussir&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;devrait avoir le bon titre&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                        <span class="ss">:content</span> <span class="o">=&gt;</span>
                          <span class="s2">&quot;Simple App du Tutoriel Ruby on Rails | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;about&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;devrait réussir&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;devrait avoir le bon titre&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                        <span class="ss">:content</span> <span class="o">=&gt;</span>
                          <span class="s2">&quot;Simple App du Tutoriel Ruby on Rails | À Propos&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Notez que la ligne <code>render_views</code> introduite dans l'<a class="ref" href="static-pages#code:failing_about_page">extrait&nbsp;3.15</a> est nécessaire pour que le test des titres fonctionne.</p>

<p>Avec ces tests en place, nous pouvons jouer&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
</pre></div>
</div>


<p>… ou utiliser Autotest pour vérifier que notre code est maintenant Rouge (échec des tests).</p>

<div class="label" id="sec:passing_title_tests"></div>


<h3><a id="sec:3.3.2" href="static-pages#sec:passing_title_tests" class="heading"><span class="number">3.3.2</span> Réussir les tests de titre</a></h3>


<p>Nous allons maintenant faire en sorte que nos tests de titre réussissent, et en même temps ajouter une structure HTML valide. Commençons avec la page d'accueil (<a class="ref" href="static-pages#code:home_view_full_html">extrait&nbsp;3.21</a>), en utilisant le même squelette HTML basique que la page «&nbsp;hello&nbsp;» de l'<a class="ref" href="static-pages#code:hello_world">extrait&nbsp;3.3</a>.</p>

<p><em>Note&nbsp;:</em> avec Rails&nbsp;3, le générateur de contrôleur crée un fichier de <em>mise en forme</em> (<em>layout</em>), dont nous expliquerons brièvement la fonction, mais que nous devons pour le moment supprimer avant de poursuivre&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rm app/views/layouts/application.html.erb
</pre></div>
</div>


<div class="label" id="code:home_view_full_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.21.</span> <span class="description">La vue pour la page d'accueil avec la structure HTML complète. <br /> <code>app/views/pages/home.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple App du Tutoriel Ruby on Rails | Accueil<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Simple App<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      Ceci est la page d'accueil de l'<em>Application Exemple</em> du
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>L''<a class="ref" href="static-pages#code:home_view_full_html">extrait&nbsp;3.21</a> utilise le titre testé dans l'<a class="ref" href="static-pages#code:pages_controller_spec_title">extrait&nbsp;3.20</a>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;title&gt;</span>Simple App du Tutoriel Ruby on Rails | Accueil<span class="nt">&lt;/title&gt;</span>
</pre></div>
</div>


<p>Les tests pour la page d'accueil devraient maintenant réussir. Nous obenons toujours du Rouge à cause des tests des pages Contact et «&nbsp;À Propos&nbsp;», et nous allons pouvoir obtenir du Vert avc le code de l'<a class="ref" href="static-pages#code:contact_view_full_html">extrait&nbsp;3.22</a> et de l'<a class="ref" href="static-pages#code:about_view_full_html">extrait&nbsp;3.23</a>.</p>

<div class="label" id="code:contact_view_full_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.22.</span> <span class="description">La vue pour la page de Contact avec la structure HTML complète. <br /> <code>app/views/pages/contact.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple App du Tutoriel Ruby on Rails | Contact<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      Contact Ruby on Rails Tutorial à propos de l'<em>Application Exemple</em> à
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/feedback&quot;</span><span class="nt">&gt;</span>feedback page<span class="nt">&lt;/a&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:about_view_full_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.23.</span> <span class="description">La vue pour la page «&nbsp;À Propos&nbsp;» avec la structure HTML complète. <br /> <code>app/views/pages/about.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple App du Tutoriel Ruby on Rails | À Propos<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>À Propos de nous<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Le Tutoriel Ruby on Rails<span class="nt">&lt;/a&gt;</span>
      est un projet de livre et de screencasts pour apprendre le développement web
      avec <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. Ceci
      est l'<em>Application Exemple</em> du tutoriel.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Ces pages exemples introduisent la balise <em>ancre</em> tag&nbsp;<code>a</code>, qui crée des liens vers les URLs données (appelés «&nbsp;href&nbsp;» ou «&nbsp;hypertext reference&nbsp;» dans le contexte d'une balise ancre)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Tutoriel Ruby on Rails<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>


<p>Vous pouvez voir les résultats dans l'<a class="ref" href="static-pages#fig:new_home_page">illustration&nbsp;3.11</a>.</p>

<div class="label" id="fig:new_home_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/new_home_page.png" alt="new_home_page" /></span></div><div class="caption"><span class="header">Illustration 3.11: </span><span class="description">Une page accueil minimale pour l'<em>Application Exemple</em> (<a href="http://localhost:3000/pages/home"><tt>/pages/home</tt></a>).&nbsp;<a href="http://railstutorial.org/images/figures/new_home_page-full.png">(taille&nbsp;normale)</a></span></div></div>



<div class="label" id="sec:instance_variables_embedded_ruby"></div>


<h3><a id="sec:3.3.3" href="static-pages#sec:instance_variables_embedded_ruby" class="heading"><span class="number">3.3.3</span> Variables d'instance et Ruby embarqué</a></h3>


<p>Nous avons déjà fait beaucoup de choses dans cette section, générer trois pages valides en utilisant les contrôleurs et actions Rails, mais ce sont de pures pages statiques HTML et elles ne font donc pas la démonstration de la puissance de Rails. Plus encore, elles souffrent de terribles duplications&nbsp;:</p>

<ul>
<li>Les titres de page sont presque (mais pas tout à fait) exactement semblables&nbsp;;</li>
<li>«&nbsp;Simple App du Tutoriel Ruby on Rails&nbsp;» est commun aux trois titres&nbsp;;</li>
<li>L'entière structure du code HTML est répétée dans chacune des pages.</li>
</ul>


<p>Ce code répété est une violation du principe «&nbsp;Don&rsquo;t Repeat Yourself&nbsp;» (DRY —&nbsp;«&nbsp;Ne vous répétez pas&nbsp;»)&nbsp;; dans cette section et la suivante, nous allons «&nbsp;DRYer&nbsp;» notre code en supprimant les répétitions.</p>

<p>Paradoxalement, nous allons passer la première étape d'élimination des duplications en en ajoutant plus encore&nbsp;: nous allons faire que les titres des pages, qui sont en général les mêmes, correspondre <em>exactement</em>. Cela rendra plus simple la suppression en un coup de toutes les répétions.</p>

<p>La technique implique de créer des <em>instances de variables</em> à l'intérieur de nos actions. Puisque les titres des pages Accueil, Contact et À Propos ont un contenu variable, nous allons renseigner la variable <code>@titre</code> (prononcez «&nbsp;hate titre&nbsp;») avec le titre approprié à chaque action (<a class="ref" href="static-pages#code:pages_controller_with_title">extrait&nbsp;3.24</a>).</p>

<div class="label" id="code:pages_controller_with_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.24.</span> <span class="description">Le contrôleur Pages avec le titre suivant la page. <br /> <code>app/controllers/pages_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
    <span class="vi">@titre</span> <span class="o">=</span> <span class="s2">&quot;Accueil&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">contact</span>
    <span class="vi">@titre</span> <span class="o">=</span> <span class="s2">&quot;Contact&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">about</span>
    <span class="vi">@titre</span> <span class="o">=</span> <span class="s2">&quot;À Propos&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Une déclaration comme&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="vi">@titre</span> <span class="o">=</span> <span class="s2">&quot;Accueil&quot;</span>
</pre></div>
</div>


<p>… est un <em>assignement</em>, qui crée dans ce cas une nouvelle variable <code>@titre</code> de valeur <code>"Accueil"</code>. Le signe arobase, <code>@</code>, dans le nom <code>@titre</code> indique que c'est une variable d'instance. Les variables d'instance ont un sens plus général en Ruby (voir la <a class="ref" href="rails-flavored-ruby#sec:objects_and_message_passing">section&nbsp;4.2.3</a>), mais en Rails leur rôle est principalement de lier les actions et les vues&nbsp;: toute variable d'instance définie dans l'action <code>home</code> est automatiquement accessible dans la vue <code>home.html.erb</code>, et aisni de suite pour toutes les paires action/vue.<sup class="footnote" id="fnref:3.21"><a href="#fn:3.21">21</a></sup></p>

<p>Nous pouvons voir comment cela fonctionne en remplaçant le titre littéral «&nbsp;Accueil&nbsp;» par le contenu de la variable <code>@titre</code> dans la vue <code>home.html.erb</code> (<a class="ref" href="static-pages#code:home_view_erb_title">extrait&nbsp;3.25</a>).</p>

<div class="label" id="code:home_view_erb_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.25.</span> <span class="description">La Vue pour la page d'accueil avec un titre Ruby embarqué. <br /> <code>app/views/pages/home.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple App du Tutoriel Ruby on Rails | <span class="cp">&lt;%=</span> <span class="vi">@titre</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Sample App<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      C'est la page d'accueil de l'<em>Application Exemple</em> du
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Tutoriel Ruby on Rails<span class="nt">&lt;/a&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>L''<a class="ref" href="static-pages#code:home_view_erb_title">extrait&nbsp;3.25</a> est notre premier exemple de <em>Ruby embarqué</em>, également appelé <em>ERb</em> (vous savez maintenant pourquoi les fichiers des vues HTML possèdent l'extension <code>.html.erb</code>). ERb est le principal mécanisme Rails pour inclure du contenu dynamique dans les pages web.<sup class="footnote" id="fnref:3.22"><a href="#fn:3.22">22</a></sup> Le code&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="vi">@titre</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>… indique par l'utilisation de <tt class="verb">&lt;%= ... %&gt;</tt> que Rails devra insérer le contenu de la variable <code>@titre</code>, quel qu'il puisse être. Quand nous visitons la page <tt>/pages/home</tt>, Rails exécute le corps de l'action <code>home</code>, qui procède à la déclaration  <code>@titre = "Accueil"</code>, donc dans le cas présent&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="vi">@titre</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>… sera remplacé par «&nbsp;Accueil&nbsp;». Rails rend alors la vue, en utilisant ERb pour insérer la valeur de <code>@titre</code> dans le gabarit, que le serveur web envoie alors à votre navigateur comme code HTML. Le résultat est exactement le même qu'auparavant, à la différence près que la partie variable du titre est générée dynamiquement par ERb.</p>

<p>Nous pouvons vérifier que tout fonctionne en jouant les tests de la <a class="ref" href="static-pages#sec:testing_a_title_change">section&nbsp;3.3.1</a> et en constatant qu'ils réussissent toujours. Nous pouvons alors faire les remplacements correspondants dans les pages Contact et À Propos (<a class="ref" href="static-pages#code:contact_view_erb_title">extrait&nbsp;3.26</a> et <a class="ref" href="static-pages#code:about_view_erb_title">extrait&nbsp;3.27</a>).</p>

<div class="label" id="code:contact_view_erb_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.26.</span> <span class="description">La vue pour la page Contact avec un titre en Ruby embarqué. <br /> <code>app/views/pages/contact.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple App du Tutoriel Ruby on Rails | <span class="cp">&lt;%=</span> <span class="vi">@titre</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      Contact du Tutoriel Ruby on Rails à propos de l'<em>Application Exemple</em> à la
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/feedback&quot;</span><span class="nt">&gt;</span>page de feedback<span class="nt">&lt;/a&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:about_view_erb_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.27.</span> <span class="description">La vue de la page À Propos avec un titre en Ruby embarqué. <br /> <code>app/views/pages/about.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple App du Tutoriel Ruby on Rails | <span class="cp">&lt;%=</span> <span class="vi">@titre</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>À Propos de nous<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Le Tutoriel Ruby on Rails<span class="nt">&lt;/a&gt;</span>
    est un projet pour faire un livre des screnncasts pour apprendre le
    développement web avec 
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. C'est
      une <em>Application Exemple</em> pour le tutoriel.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Comme précédemment, les tests devraient réussir.</p>

<div class="label" id="sec:layouts"></div>


<h3><a id="sec:3.3.4" href="static-pages#sec:layouts" class="heading"><span class="number">3.3.4</span> Éliminer les duplications avec les <em>layouts</em></a></h3>


<p>Maintenant que nous avons remplacé la partie variable des titres de la page avec une variable d'instance et ERb, chacune de nos pages ressemble à quelque chose comme&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple App du Tutoriel Ruby on Rails | <span class="cp">&lt;%=</span> <span class="vi">@titre</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
      Contenu
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>


<p>En d'autres mots, <em>toutes</em> nos pages sont identiques en structure, incluant même le titre (à cause du code Ruby embarqué), avec pour seule exception le contenu de chaque page.</p>

<p>Ne serait-il pas intéressant de structurer les éléments communs dans une sorte de gabarit global (un <em>layout</em>), et que le contenu du body soit inséré sur cette page de base&nbsp;? Vraiment, ce serait bien, et Rails nous y convie gentiment en utilisant un fichier spécial appelé <code>application.html.erb</code>, qui doit résider dans le dossier <code>layouts</code>. Pour capturer le squelette de la structure, créez le fichier <code>application.html.erb</code> et copiez-y le contenu de l'<a class="ref" href="static-pages#code:application_layout">extrait&nbsp;3.28</a>.</p>

<div class="label" id="code:application_layout"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.28.</span> <span class="description">Le <em>layout</em> du site de l'<em>Application Exemple</em>. <br /> <code>app/views/layouts/application.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple App du Tutoriel Ruby on Rails | <span class="cp">&lt;%=</span> <span class="vi">@titre</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tag</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Remarquez ici la ligne spéciale&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>Ce code est responsable de l'insertion du contenu de chaque page dans le layout. Comme pour <tt class="verb">&lt;%= @titre %&gt;</tt>, la balise <tt class="verb">&lt;% ... %&gt;</tt> indique du Ruby embarqué, et le signe égal dans <tt class="verb">&lt;%= ... %&gt;</tt> assure que les résultats de l'évaluation de l'expression soient insérés à ce point exact du template (ne vous inquiétez pas pour la signification du mot «&nbsp;yield&nbsp;» (&nbsp;)<em>rendement</em>) dans ce contexte&nbsp;;<sup class="footnote" id="fnref:3.23"><a href="#fn:3.23">23</a></sup> ce qui importe c'est d'être certain qu'avec ce layout, la visite de la page <tt>/pages/home</tt> convertira le contenu du fichier <code>home.html.erb</code> en HTML et l'insèrera alors à la place du <tt class="verb">&lt;%= yield %&gt;</tt>.</p>

<p>Maintenant que nous avons un layout pour le site, nous avons aussi saisi l'opportunité d'ajouter une fonctionnalité de sécurité pour chaque page. L'<a class="ref" href="static-pages#code:application_layout">extrait&nbsp;3.28</a> ajoute ce code&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">csrf_meta_tag</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>… qui utilise la méthode Rails <code>csrf_meta_tag</code> qui empêche le <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgery</a> (CSRF), un type d'attaque web malicieuse. Ne vous pré-occupez pas trop du détail (je ne le fais pas)&nbsp;; sachez simplement que Rails travaille dur pour la sécurité de votre application.</p>

<p>Bien sûr, les vues des <a class="ref" href="static-pages#code:home_view_erb_title">extrait&nbsp;3.25</a>, <a class="ref" href="static-pages#code:contact_view_erb_title">extrait&nbsp;3.26</a> et <a class="ref" href="static-pages#code:about_view_erb_title">extrait&nbsp;3.27</a> contiennent toujours toute la structure de code HTML que nous venons tout juste d'introduire dans le layout, donc il nous faut la retirer, en ne laissant que le contenu intérieur. Les vues clarifiées en résultant apparaissent dans les <a class="ref" href="static-pages#code:home_view_interior">extrait&nbsp;3.29</a>, <a class="ref" href="static-pages#code:contact_view_interior">extrait&nbsp;3.30</a> et <a class="ref" href="static-pages#code:about_view_interior">extrait&nbsp;3.31</a>.</p>

<div class="label" id="code:home_view_interior"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.29.</span> <span class="description">La vue Accueil avec la structure HTML supprimée. <br /> <code>app/views/pages/home.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Sample App<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  C'est la page d'accueil de l'<em>Application Exemple</em> du
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Tutoriel Ruby on Rails<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:contact_view_interior"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.30.</span> <span class="description">La vue Contact avec la structure HTML supprimée. <br /> <code>app/views/pages/contact.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Contact du Tutoriel Ruby on Rails à propos de l'<em>Application Exemple</em> à la
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/feedback&quot;</span><span class="nt">&gt;</span>page de feedback<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:about_view_interior"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.31.</span> <span class="description">La vue À Propos avec la structure HTML supprimée. <br /> <code>app/views/pages/about.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>About Us<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
  est un projet de livre et de screencasts pour apprendre le développement web
  avec <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. C'est l'<em>Application Exemple</em> de ce tutoriel.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>Avec ces vues redéfinies, les pages Accueil, Contact et À Propos avec exactement les mêmes que précédemment &mdash;&nbsp;c'est-à-dire que nous les avons restructurées avec succès&nbsp;&mdash; mais elles contiennent beaucoup moins de duplications de code. Et, comme requis, les tests réussissent toujours.</p>

<div class="label" id="sec:static_pages_conclusion"></div>


<h2><a id="sec:3.4" href="static-pages#sec:static_pages_conclusion" class="heading"><span class="number">3.4</span> Conclusion</a></h2>


<p>Vu de l'extérieur, ce chapitre n'a pas accompli grand chose&nbsp;: nous l'avons commencé avec des pages statiques, et nous le finissons avec&hellip; les pages <em>le plus souvent</em> statiques. Mais les apparences sont trompeuses&nbsp;: en développant en termes de <em>Contrôleurs</em> Rails, d'<em>Actions</em> Rails et de <em>Vues</em> Rails, nous sommes maintenant en mesure d'ajouter n'importe quel contenu dynamique à notre site. Voir comment cela joue exactement est la tâche que se propose la suite de ce tutoriel.</p>

<p>Avant de poursuivre, prenez le temps de «&nbsp;commettre&nbsp;» vos changements et les fusionner avec la branche maitresse. Dans la <a class="ref" href="static-pages#sec:static_pages_with_rails">section&nbsp;3.1.2</a>, nous avons créé une branche Git pour le développement des pages statiques. Si vous n'avez pas fait de dépôts à mesure que nous avancions, commencez par en faire un en indiquant que nous avons atteint un point d'arrêt&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Fini avec les pages statiques&quot;</span>
</pre></div>
</div>


<p>Fusionnez alors les changements dans la branche maitresse en utilisant la même technique que dans la <a class="ref" href="beginning#sec:git_commands">section&nbsp;1.3.5</a>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout master
<span class="gp">$</span> git merge static-pages
</pre></div>
</div>

<p>Une fois que vous atteignez un point d'arrêt comme celui-ci, c'est habituellement une bonne idée de «&nbsp;pusher&nbsp;» votre code sur le repository à distance (qui, si vous avez suivi les étapes de la <a class="ref" href="beginning#sec:github">section&nbsp;1.3.4</a> doit se trouver sur GitHub)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
<span class="gp">$</span> git push
</pre></div>
</div>


<p>Si vous le désirez, à ce point vous pouvez même déployer l'application actualisée sur Heroku&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
<span class="gp">$</span> git push heroku
</pre></div>
</div>


<p>Notez que dans les deux cas j'ai joué <code>rspec spec/</code>, juste pour m'assurer que tous les tests réussissaient toujours. Faire jouer les tests avant de «&nbsp;pusher&nbsp;» du code ou de déployer l'application est une habitude à cultiver.</p>

<div class="label" id="sec:static_pages_exercises"></div>


<h2><a id="sec:3.5" href="static-pages#sec:static_pages_exercises" class="heading"><span class="number">3.5</span> Exercises</a></h2>




<ol>

<li>Créez une page d'aide pour l'<em>Application Exemple</em>. Écrivez d'abord un test pour vérifier l'existence d'une page à l'URL <tt>/pages/help</tt>. Écrivez ensuite un second test pour le titre «&nbsp;Simple App du Tutoriel Ruby on Rails | Aide&nbsp;». Faites le nécessaire pour que ces tests réussissent, et remplissez alors la page Aide avec le contenu de l'<a class="ref" href="static-pages#code:help_page">extrait&nbsp;3.32</a>.</li>

<li>Vous avez peut-être noté quelques répétitions dans les specs du contrôleur Pages (<a class="ref" href="static-pages#code:pages_controller_spec_title">extrait&nbsp;3.20</a>). En particulier, la base du titre, «&nbsp;Simple App du Tutoriel Ruby on Rails&nbsp;», est la même pour tous les tests de titre. En utilisant la facilité RSpec <code>before(:each)</code>, qui exécute un code avant chaque cas testé, remplissez l'<a class="ref" href="static-pages#code:pages_controller_spec_exercise">extrait&nbsp;3.33</a> pour définir une instance de variable <code>@base_title</code> qui éliminera cette redondance (ce code utilise deux nouveaux éléments&nbsp;: un <em>symbole</em>, <code>:each</code>, et une opération de concaténation de chaine, <code>+</code>. Nous en apprendrons plus sur ces deux éléments au <a class="ref" href="rails-flavored-ruby#top">chapitre&nbsp;4</a>, et nous reverrons <code>before(:each)</code> à la <a class="ref" href="modeling-and-viewing-users-one#sec:presence_validation">section&nbsp;6.2.1</a>). Notez que, avec la base du titre capturée dans une variable d'instance, nous sommes maintenant en mesure d'aligner <code>:content</code> avec le premier caractère à l'intérieur de chaque parenthèse ouverte. C'est ma convention préférée pour formater du code découpé en plusieurs lignes.</li>

</ol>




<div class="label" id="code:help_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.32.</span> <span class="description">Code pour la page d'aide proposée. <br /> <code>app/views/pages/help.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Aide<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Obtenez de l'aide sur le Tutoriel Ruby on Rails sur la
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/help&quot;</span><span class="nt">&gt;</span>page d'aide du Tutoriel Rails<span class="nt">&lt;/a&gt;</span>.
  Pour obtenir de l'aide sur cette <em>Application Exemple</em>, voyez le 
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/book&quot;</span><span class="nt">&gt;</span>livre du Tutoriel Rails<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:pages_controller_spec_exercise"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.33.</span> <span class="description">Le spec du contrôleur Pages avec une base de titre. <br /> <code>spec/controllers/pages_controller_spec.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>
  <span class="n">render_views</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1">#</span>
    <span class="c1"># Define @base_title here.</span>
    <span class="c1">#</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;devrait réussir&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;devrait avoir le bon titre&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="vi">@base_title</span> <span class="o">+</span> <span class="s2">&quot; | Home&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;contact&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;devrait réussir&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;devrait avoir le bon titre&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="vi">@base_title</span> <span class="o">+</span> <span class="s2">&quot; | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;about&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;devrait réussir&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;devrait avoir le bon titre&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="vi">@base_title</span> <span class="o">+</span> <span class="s2">&quot; | About&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<div class="navigation">  <a class="prev_page" href="a-demo-app#top">
    &laquo;&nbsp;<span class="number">chapitre 2</span> Une application Démo
  </a>
  <a class="next_page" href="rails-flavored-ruby#top">
    <span class="number">chapitre 4</span> Rails au goût Ruby&nbsp;&raquo;
  </a>
</div><div class="footnotes">
<ol>
<li id="fn:3.1">Comme précédemment, vous pouvez trouver le fichier «&nbsp;augmenté&nbsp;» de l'<a class="ref" href="beginning#code:gitignore">extrait&nbsp;1.5</a> plus pratique en fonction de votre système.&nbsp;<a class="arrow" href="#fnref:3.1">&uarr;</a></li>
<li id="fn:3.2">En fait, Rails s'assure que les requêtes pour de tels fichiers   [(never hit the main Rails stack)(n'atteignent jamais la pile principale de Rails)]&nbsp;; ils sont livrés directement du système de fichier (voir <a href="http://www.amazon.com/gp/product/0321601661?ie=UTF8&amp;tag=httpwwwrailst-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0321601661"><em>The Rails&nbsp;3 Way</em></a> pour de plus amples détails).&nbsp;<a class="arrow" href="#fnref:3.2">&uarr;</a></li>
<li id="fn:3.3">Comme d'habitude, remplacez <code>mate</code> avec la commande de votre propre éditeur de texte.&nbsp;<a class="arrow" href="#fnref:3.3">&uarr;</a></li>
<li id="fn:3.4">HTML change avec le temps&nbsp;; en faisant une déclaration de doctype explicite nous nous arrangeons pour que les navigateurs rendent toujours nos pages proprement dans le futur. Le doctype <code>&lt;!DOCTYPE html&gt;</code> extrêmement simple est caractéristique du dernier standard HTML, HTML5.&nbsp;<a class="arrow" href="#fnref:3.4">&uarr;</a></li>
<li id="fn:3.5">Notre méthode pour créer des pages statiques est probablement la plus simple, mais ce n'est pas la seule. La méthode optimale dépend vraiment de vos besoins&nbsp;; si vous comptez sur un <em>grand</em> nombre de pages statiques, utiliser un contrôleur Pages peut être très lourd, mais dans notre <em>Application Exemple</em> nous n'avons besoin que de quelques pages statiques. Lisez ce <a href="http://blog.hasmanythrough.com/2008/4/2/simple-pages">post de blog sur des pages simples avec <tt>has_many :through</tt></a> pour une vue d'ensemble des techniques de création de pages statiques avec Rails. <em>Attention&nbsp;:</em> la discussion est plutôt de niveau avancé, donc vous avez peut-être intérêt à attendre un peu avant d'essayer de la comprendre.&nbsp;<a class="arrow" href="#fnref:3.5">&uarr;</a></li>
<li id="fn:3.6">Dans le contexte de RSpec, TDD est aussi connu sous le nom de Behavior Driven Development, or BDD (Développement Conduit par le Comportement) (franchement, je ne suis pas convaincu qu'il y ait une énorme différence).&nbsp;<a class="arrow" href="#fnref:3.6">&uarr;</a></li>
<li id="fn:3.7">Le frameword de testing <a href="http://github.com/thoughtbot/shoulda">Shoulda</a> est une bonne alternative  (et en fait peut être utilisé avec RSpec). C'est l'autre «&nbsp;manière Rails&nbsp;», pour ainsi dire.&nbsp;<a class="arrow" href="#fnref:3.7">&uarr;</a></li>
<li id="fn:3.8">Cela a été utilisé pour <tt>autotest-rails</tt>, mais ce gem dépend de la suite complète ZenTest, qui occasionne des problèmes sur certains systèmes. Le gem <tt>autotest-rails-pure</tt> évite cette dépendance.&nbsp;<a class="arrow" href="#fnref:3.8">&uarr;</a></li>
<li id="fn:3.9">Le gem Autotest Growl fait que les résultats du test sont automatiquement affichés à l'écran tandis que le FSEvent fait qu'Autotest utilise les évènements du <em>système de fichier</em> d'OS&nbsp;X pour déclencher la suite de tests, plutôt que continuellement sonder le système de fichier. Notez également qu'avec ces deux gems vous pouvez avoir besoin d'utiliser une version actualisée si vous travaillez sous le système OS&nbsp;X Snow Leopard.&nbsp;<a class="arrow" href="#fnref:3.9">&uarr;</a></li>
<li id="fn:3.10">http://fredschoeneman.posterous.com/pimp-your-autotest-notification&nbsp;<a class="arrow" href="#fnref:3.10">&uarr;</a></li>
<li id="fn:3.11">Dans le contexte de RSpec, les tests sont souvent appelés des <em>specs</em>, mais pour la simplicité je m'en tiendrai la plupart du temps au terme «&nbsp;test&nbsp;»&mdash; <em>sauf</em> quand je me réfèrerai à un fichier tel que <code>pages_controller_spec</code>, dans ce cas j'utiliserai «&nbsp;spec du contrôleur Pages&nbsp;».&nbsp;<a class="arrow" href="#fnref:3.11">&uarr;</a></li>
<li id="fn:3.12">La plupart des IDEs ont également une interface de testing, mais comme cela a été noté à la <a class="ref" href="beginning#sec:development_tools">section&nbsp;1.2.1</a> j'ai une expérience limitée de ces outils.&nbsp;<a class="arrow" href="#fnref:3.12">&uarr;</a></li>
<li id="fn:3.13">Vous pouvez aussi jouer <code>rake spec</code>, qui est par essence équivalent (fâcheusement, si vous voulez jouer <code>rake spec</code> ici vous devrez d'abord jouer <code>rake db:migrate</code>, quand bien même les tests de ce chapitre ne requièrent par de base de données).&nbsp;<a class="arrow" href="#fnref:3.13">&uarr;</a></li>
<li id="fn:3.14">Un <em>spork</em> est la combinaison «&nbsp;spoon-fork&nbsp;» (<em>cuillière-fourchette</em>). Mon sentiment est que le nom du projet est un jeu de mot sur l'utilisation de Spork des <a href="http://en.wikipedia.org/wiki/Fork_(software_development)">fourchettes</a><a href="http://en.wikipedia.org/wiki/POSIX">POSIX</a>.&nbsp;<a class="arrow" href="#fnref:3.14">&uarr;</a></li>
<li id="fn:3.15">DRb signifie «&nbsp;Distributed Ruby&nbsp;».&nbsp;<a class="arrow" href="#fnref:3.15">&uarr;</a></li>
<li id="fn:3.16">Nous apprendrons à la <a class="ref" href="rails-flavored-ruby#sec:hashes_and_symbols">section&nbsp;4.3.3</a> que la syntaxe <code>:content =&gt; "&hellip;"</code> est un <em>tableau hash</em> utilisant un <em>symbole</em> comme clé.&nbsp;<a class="arrow" href="#fnref:3.16">&uarr;</a></li>
<li id="fn:3.17">Je considère que c'est un recul par rapport à la version RSpec&nbsp;1.3, qui utilisait <code>have_tag</code> dans ce context, qui pourrait être utilisé pour requérir une correspondance plus exacte. Malheureusement, cette écriture <code>have_tag</code> n'est plus utilisable avec RSpec&nbsp;2.&nbsp;<a class="arrow" href="#fnref:3.17">&uarr;</a></li>
<li id="fn:3.18">Une nouvelle ligne est ce qui arrive à la fin de la ligne, commençant avec, hé bien, une nouvelle ligne. Dans le code, c'est représenté par le signe <tt class="verb">\n</tt>.&nbsp;<a class="arrow" href="#fnref:3.18">&uarr;</a></li>
<li id="fn:3.19">En vérité, le <em>comptage</em> des colonnes peut vous rendre fou, ce qui explique que de nombreux éditeurs de texte possèdend une aide visuelle pour vous aider. Considérons TextMate, par exemple&nbsp;; si vous revenez à l'<a class="ref" href="beginning#fig:editor_shell">illustration&nbsp;1.1</a>, vous verrez une petite ligne verticale sur la droite pour aider à garder le code sous les 80 signes (il est en fait à 78 colonnes, ce qui vous laisse une marge d'erreur). Si vous utilisez TextMate, vous pouvez trouver cette fonctionnalité dans le menu <tt>View &gt; Wrap Column &gt; 78</tt>.&nbsp;<a class="arrow" href="#fnref:3.19">&uarr;</a></li>
<li id="fn:3.20">Rails 2.3/RSpec 1.3, utilisait le code <code>have_tag</code> plus court au lieu de <code>have_selector</code>, l'argument <code>:content</code> n'était pas nécessaire non plus. Nouveau ne signifie pas toujours meilleur&hellip;&nbsp;<a class="arrow" href="#fnref:3.20">&uarr;</a></li>
<li id="fn:3.21">En fait, la variable d'instance est vraiment lisible dans  <em>n'importe quelle</em> vue, un fait dont nous nous servirons à la <a class="ref" href="sign-up#sec:a_working_form">section&nbsp;8.2.2</a>.&nbsp;<a class="arrow" href="#fnref:3.21">&uarr;</a></li>
<li id="fn:3.22">Il existe un second système de template populaire appelé <a href="http://haml-lang.com/">Haml</a>, que j'aime personnellement, mais il n'est pas encore <em>assez</em> standard pour l'utiliser dans l'introduction d'un tutoriel. Si cela se révèle suffisamment intéressant, je pourrais produire une série de screencasts pour le Tutoriel Rails utilisant Haml pour les vues. Cela permettrait aussi une introduction à <a href="http://sass-lang.com/">Sass</a>, le technologie sœur de Haml, si quelque chose peut être plus impressionnant que Haml.&nbsp;<a class="arrow" href="#fnref:3.22">&uarr;</a></li>
<li id="fn:3.23">Si vous avez étudié Ruby auparavant, vous pouvez vous douter que Rails <em>soumet</em> le contenu à un block, et votre supposition sera exacte. Mais, aussi loin qu'on développe des applications web avec Rails, ça n'est pas très important, et je n'ai honnêtement jamais accordé plus de réflexion au sens du mot <tt class="verb">&lt;%= yield %&gt;</tt>.&nbsp;<a class="arrow" href="#fnref:3.23">&uarr;</a></li>
</ol>
</div>




