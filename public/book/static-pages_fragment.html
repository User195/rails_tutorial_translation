

<h1 class="title">Tutoriel Ruby on Rails </h1>


<h1 class="subtitle"> Apprendre Rails par l'exemple</h1>


<h2 class="author">Michael Hartl</h2>



<h1 class="contents">Contenu</h1>


<div id="table_of_contents"><ol>
<li class="chapter"><a href="beginning#top"><span class="number">Chapitre 1</span> De zéro au déploiement</a></li>
<li><ol>
<li class="section"><a href="beginning#sec:introduction"><span class="number">1.1</span> Introduction</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:comments_for_various_readers"><span class="number">1.1.1</span> Commentaires pour les lecteurs différents</a></li>
<li class="subsection"><a href="beginning#sec:1.1.2"><span class="number">1.1.2</span> &ldquo;Dimensionner&rdquo; Rails</a></li>
<li class="subsection"><a href="beginning#sec:conventions"><span class="number">1.1.3</span> Conventions utilisées dans ce livre</a></li></ol></li>
<li class="section"><a href="beginning#sec:up_and_running"><span class="number">1.2</span> [(Up and running)(En route pour le démarrage)]</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:development_tools"><span class="number">1.2.1</span> Environnements de développement</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:1.2.1.1">IDEs</a></li>
<li class="subsubsection"><a href="beginning#sec:1.2.1.2">Éditeurs de texte et lignes de commande</a></li>
<li class="subsubsection"><a href="beginning#sec:1.2.1.3">Navigateurs</a></li>
<li class="subsubsection"><a href="beginning#sec:1.2.1.4">Note à propos des outils</a></li></ol></li>
<li class="subsection"><a href="beginning#sec:rubygems"><span class="number">1.2.2</span> Ruby, RubyGems, Rails, et Git</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:rails_installer_windows">Installation de Rails (Windows)</a></li>
<li class="subsubsection"><a href="beginning#sec:install_git">Installer Git</a></li>
<li class="subsubsection"><a href="beginning#sec:install_ruby">Installer Ruby</a></li>
<li class="subsubsection"><a href="beginning#sec:install_rubygems">Installer RubyGems</a></li>
<li class="subsubsection"><a href="beginning#sec:install_rails">Installer Rails</a></li></ol></li>
<li class="subsection"><a href="beginning#sec:the_first_application"><span class="number">1.2.3</span> La première application</a></li>
<li class="subsection"><a href="beginning#sec:bundler"><span class="number">1.2.4</span> Bundler</a></li>
<li class="subsection"><a href="beginning#sec:rails_server"><span class="number">1.2.5</span> <code>Le serveur rails (rails server)</code></a></li>
<li class="subsection"><a href="beginning#sec:mvc"><span class="number">1.2.6</span> Modèles-Vue-Contrôleur (MVC)</a></li></ol></li>
<li class="section"><a href="beginning#sec:version_control"><span class="number">1.3</span> Contrôle de versions avec Git</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:git_setup"><span class="number">1.3.1</span> Installation et réglages</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:1.3.1.1">Initialisation des réglages système</a></li>
<li class="subsubsection"><a href="beginning#sec:1.3.1.2">Initialisation des réglages du dépôt (repository)</a></li></ol></li>
<li class="subsection"><a href="beginning#sec:adding_and_committing"><span class="number">1.3.2</span> Ajout et mandat de dépôt</a></li>
<li class="subsection"><a href="beginning#sec:1.3.3"><span class="number">1.3.3</span> Qu'est-ce que Git peut faire de bien pour vous&nbsp;?</a></li>
<li class="subsection"><a href="beginning#sec:github"><span class="number">1.3.4</span> GitHub</a></li>
<li class="subsection"><a href="beginning#sec:git_commands"><span class="number">1.3.5</span> Branch, edit, commit, merge</a></li>
<li><ol>
<li class="subsubsection"><a href="beginning#sec:git_branch">Branch</a></li>
<li class="subsubsection"><a href="beginning#sec:git_edit">Edit</a></li>
<li class="subsubsection"><a href="beginning#sec:git_commit">Commit</a></li>
<li class="subsubsection"><a href="beginning#sec:git_merge">Merge</a></li>
<li class="subsubsection"><a href="beginning#sec:git_push">Push</a></li></ol></li></ol></li>
<li class="section"><a href="beginning#sec:deploying"><span class="number">1.4</span> Déploiement</a></li>
<li><ol>
<li class="subsection"><a href="beginning#sec:1.4.1"><span class="number">1.4.1</span> Réglages Heroku</a></li>
<li class="subsection"><a href="beginning#sec:heroku_step_one"><span class="number">1.4.2</span> déploiement Heroku, première étape</a></li>
<li class="subsection"><a href="beginning#sec:1.4.3"><span class="number">1.4.3</span> Déploiement Heroku deployment, seconde étape</a></li>
<li class="subsection"><a href="beginning#sec:heroku_commands"><span class="number">1.4.4</span> Commandes Heroku</a></li></ol></li>
<li class="section"><a href="beginning#sec:beginning_conclusion"><span class="number">1.5</span> Conclusion</a></li></ol></li>
<li class="chapter"><a href="a-demo-app#top"><span class="number">Chapitre 2</span> Une application démo</a></li>
<li><ol>
<li class="section"><a href="a-demo-app#sec:planning_the_application"><span class="number">2.1</span> Planifier l'application</a></li>
<li><ol>
<li class="subsection"><a href="a-demo-app#sec:modeling_users"><span class="number">2.1.1</span> Modéliser les utilisateurs</a></li>
<li class="subsection"><a href="a-demo-app#sec:modeling_microposts"><span class="number">2.1.2</span> Modéliser les micro-messages</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec:demo_users_resource"><span class="number">2.2</span> La ressource Utilisateurs (Users)</a></li>
<li><ol>
<li class="subsection"><a href="a-demo-app#sec:a_user_tour"><span class="number">2.2.1</span> Un tour de l'utilisateur</a></li>
<li class="subsection"><a href="a-demo-app#sec:mvc_in_action"><span class="number">2.2.2</span> MVC en action</a></li>
<li class="subsection"><a href="a-demo-app#sec:weaknesses_of_this_users_resource"><span class="number">2.2.3</span> Faiblesses de la ressource Utilisateurs (Users)</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec:microposts_resource"><span class="number">2.3</span> La ressource Micro-messages (Microposts)</a></li>
<li><ol>
<li class="subsection"><a href="a-demo-app#sec:a_micropost_microtour"><span class="number">2.3.1</span> Un petit tour du micro-message</a></li>
<li class="subsection"><a href="a-demo-app#sec:putting_the_micro_in_microposts"><span class="number">2.3.2</span> Appliquer le <em>micro</em> aux micro-messages</a></li>
<li class="subsection"><a href="a-demo-app#sec:demo_user_has_many_microposts"><span class="number">2.3.3</span> Un utilisateur <code>has_many</code> (<code>possède plusieurs</code>) micro-messages</a></li>
<li class="subsection"><a href="a-demo-app#sec:inheritance_hierarchies"><span class="number">2.3.4</span> Hiérarchie des héritages</a></li>
<li class="subsection"><a href="a-demo-app#sec:deploying_the_demo_app"><span class="number">2.3.5</span> Déployer l'application Démo</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec:2.4"><span class="number">2.4</span> Conclusion</a></li></ol></li>
<li class="chapter"><a href="static-pages#top"><span class="number">Chapitre 3</span> Pages statiques courantes</a></li>
<li><ol>
<li class="section"><a href="static-pages#sec:static_pages"><span class="number">3.1</span> Pages statiques</a></li>
<li><ol>
<li class="subsection"><a href="static-pages#sec:truly_static_pages"><span class="number">3.1.1</span> Pages HTML statiques</a></li>
<li class="subsection"><a href="static-pages#sec:static_pages_with_rails"><span class="number">3.1.2</span> Les pages statiques avec Rails</a></li></ol></li>
<li class="section"><a href="static-pages#sec:first_tests"><span class="number">3.2</span> Premiers tests</a></li>
<li><ol>
<li class="subsection"><a href="static-pages#sec:testing_tools"><span class="number">3.2.1</span> Outils de test</a></li>
<li><ol>
<li class="subsubsection"><a href="static-pages#sec:autotest">Auto-test</a></li></ol></li>
<li class="subsection"><a href="static-pages#sec:TDD"><span class="number">3.2.2</span> TDD : Rouge, Vert, Refactor</a></li>
<li><ol>
<li class="subsubsection"><a href="static-pages#sec:spork">Spork</a></li>
<li class="subsubsection"><a href="static-pages#sec:red">Rouge</a></li>
<li class="subsubsection"><a href="static-pages#sec:green">Vert</a></li>
<li class="subsubsection"><a href="static-pages#sec:refactor">Refactor</a></li></ol></li></ol></li>
<li class="section"><a href="static-pages#sec:slightly_dynamic_pages"><span class="number">3.3</span> Pages (un peu) dynamiques</a></li>
<li><ol>
<li class="subsection"><a href="static-pages#sec:testing_a_title_change"><span class="number">3.3.1</span> Test d'un changement de titre</a></li>
<li class="subsection"><a href="static-pages#sec:passing_title_tests"><span class="number">3.3.2</span> Réussir les tests de titre</a></li>
<li class="subsection"><a href="static-pages#sec:instance_variables_embedded_ruby"><span class="number">3.3.3</span> Variables d'instance et Ruby embarqué</a></li>
<li class="subsection"><a href="static-pages#sec:layouts"><span class="number">3.3.4</span> Supprimer les répétitions avec les [(layouts)]</a></li></ol></li>
<li class="section"><a href="static-pages#sec:static_pages_conclusion"><span class="number">3.4</span> Conclusion</a></li>
<li class="section"><a href="static-pages#sec:static_pages_Exercices"><span class="number">3.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="rails-flavored-ruby#top"><span class="number">Chapitre 4</span> [(Rails-flavored Ruby)(Rails au goût Ruby)]</a></li>
<li><ol>
<li class="section"><a href="rails-flavored-ruby#sec:motivation"><span class="number">4.1</span> Motivation</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:title_helper"><span class="number">4.1.1</span> Un « helper » (« aideur ») pour le titre (<code>title</code>)</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:cascading_style_sheets"><span class="number">4.1.2</span> Feuilles de styles (CSS — Cascading Style Sheets)</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:strings_and_methods"><span class="number">4.2</span> Chaines de caractères et méthodes</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:comments"><span class="number">4.2.1</span> Commentaires</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:strings"><span class="number">4.2.2</span> Chaines de caractères</a></li>
<li><ol>
<li class="subsubsection"><a href="rails-flavored-ruby#sec:printing">Impression</a></li>
<li class="subsubsection"><a href="rails-flavored-ruby#sec:single_quoted_strings">Chaines de caractères « single-quoté »</a></li></ol></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:objects_and_message_passing"><span class="number">4.2.3</span> Objets et passage de message</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:method_definitions"><span class="number">4.2.4</span> Définition de méthode</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:back_to_the_title_helper"><span class="number">4.2.5</span> Retour à l'« helper » de titre</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:other_data_structures"><span class="number">4.3</span> Autres structures de données</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:arrays_and_ranges"><span class="number">4.3.1</span> Tableaux et rangs</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:blocks"><span class="number">4.3.2</span> Blocs</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:hashes_and_symbols"><span class="number">4.3.3</span> Tables de hachage et symboles</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:css_revisited"><span class="number">4.3.4</span> CSS revisitées</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:ruby_classes"><span class="number">4.4</span> Classes Ruby</a></li>
<li><ol>
<li class="subsection"><a href="rails-flavored-ruby#sec:constructors"><span class="number">4.4.1</span> Constructeurs</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:a_class_of_our_own"><span class="number">4.4.2</span> Héritages de classes</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:modifying_built_in_classes"><span class="number">4.4.3</span> Modifier les classes d'origine</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:a_controller_class"><span class="number">4.4.4</span> Classe de contrôleur</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec:a_user_class"><span class="number">4.4.5</span> Classe utiliateur</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec:Exercices"><span class="number">4.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="filling-in-the-layout#top"><span class="number">Chapitre 5</span> Achever la mise en page</a></li>
<li><ol>
<li class="section"><a href="filling-in-the-layout#sec:structure"><span class="number">5.1</span> Ajout de structure</a></li>
<li><ol>
<li class="subsection"><a href="filling-in-the-layout#sec:adding_to_the_layout"><span class="number">5.1.1</span> Navigation du site</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:custom_css"><span class="number">5.1.2</span> Personnalisation CSS</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:partials"><span class="number">5.1.3</span> Partiels (Partials)</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec:layout_links"><span class="number">5.2</span> Liens pour la mise en page</a></li>
<li><ol>
<li class="subsection"><a href="filling-in-the-layout#sec:integration_tests"><span class="number">5.2.1</span> Test d'intégration</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:rails_routes"><span class="number">5.2.2</span> Routes Rails</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:named_routes"><span class="number">5.2.3</span> Nommer les routes</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec:user_signup"><span class="number">5.3</span> Inscription de l'utilisateur : une première étape</a></li>
<li><ol>
<li class="subsection"><a href="filling-in-the-layout#sec:users_controller"><span class="number">5.3.1</span> Contrôleur Utilisateur (Users controller)</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec:signup_url"><span class="number">5.3.2</span> URL d'inscription</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec:layout_conclusion"><span class="number">5.4</span> Conclusion</a></li>
<li class="section"><a href="filling-in-the-layout#sec:layout_Exercices"><span class="number">5.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="modeling-and-viewing-users-one#top"><span class="number">Chapitre 6</span> Modéliser et afficher les utilisateurs, partie I</a></li>
<li><ol>
<li class="section"><a href="modeling-and-viewing-users-one#sec:user_model"><span class="number">6.1</span> Modèle utilisateur (User model)</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:database_migrations"><span class="number">6.1.1</span> Migrations de la base de données</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:the_model_file"><span class="number">6.1.2</span> Le fichier modèle</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:model_annotation">[(Model annotation)]</a></li>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:accessible_attributes">Attributs accessibles</a></li></ol></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:creating_user_objects"><span class="number">6.1.3</span> Créer des objets Utilisateur</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:finding_user_objects"><span class="number">6.1.4</span> Recherche dans les objets Utilisateurs (Users)</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:updating_user_objects"><span class="number">6.1.5</span> Actualisation des objets Utilisateurs (Users)</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:user_validations"><span class="number">6.2</span> Validations utilisateur</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:presence_validation"><span class="number">6.2.1</span> Valider l'existence</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:length_validation"><span class="number">6.2.2</span> Valider la longueur</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:format_validation"><span class="number">6.2.3</span> Valider le format</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:uniqueness_validation"><span class="number">6.2.4</span> Valider l'unicité</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:the_caveat">L'avertissement d'unicité</a></li></ol></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:viewing_users"><span class="number">6.3</span> Afficher les utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:rails_environments"><span class="number">6.3.1</span> Débuggage et environnements Rails</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:users_show"><span class="number">6.3.2</span> Modèle, Vue et Contrôleur Utilisateur</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-one#sec:a_users_resource"><span class="number">6.3.3</span> Ressource Utilisateurs</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:params_in_debug">[(<code>params</code> in <code>debug</code>)]</a></li></ol></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:6.4"><span class="number">6.4</span> Conclusion</a></li>
<li class="section"><a href="modeling-and-viewing-users-one#sec:6.5"><span class="number">6.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="modeling-and-viewing-users-two#top"><span class="number">Chapitre 7</span> Modéliser et afficher les utilisateurs, partie II</a></li>
<li><ol>
<li class="section"><a href="modeling-and-viewing-users-two#sec:insecure_passwords"><span class="number">7.1</span> Mots de passe non sûrs</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_validations"><span class="number">7.1.1</span> Valider le mot de passe</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_migration"><span class="number">7.1.2</span> Migrer un mot de passe</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_active_record_callback"><span class="number">7.1.3</span> Un <em>callback</em> de l'Active Record</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:secure_passwords"><span class="number">7.2</span> Sécuriser les mots de passe</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_secure_password_test"><span class="number">7.2.1</span> Test de mot de passe sûr</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:secure_password_theory"><span class="number">7.2.2</span> Un peu de théorie sur les mots de passe sécurisés</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:implementing_has_password"><span class="number">7.2.3</span> Implémenter la méthode <code>has_password?</code></a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_authenticate_method"><span class="number">7.2.4</span> Méthode d'authentification</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:better_user_views"><span class="number">7.3</span> Meilleures vues d'utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:tests_with_factories"><span class="number">7.3.1</span> Tester la page de l'utilisateur (avec factories)</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_name_and_a_gravatar"><span class="number">7.3.2</span> Un nom et un Gravatar</a></li>
<li><ol>
<li class="subsubsection"><a href="modeling-and-viewing-users-two#sec:a_gravatar_helper">Un « helper » de Gravatar</a></li></ol></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_user_sidebar"><span class="number">7.3.3</span> Une barre utilisateur latérale</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:7.4"><span class="number">7.4</span> Conclusion</a></li>
<li><ol>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:7.4.1"><span class="number">7.4.1</span> Commit Git</a></li>
<li class="subsection"><a href="modeling-and-viewing-users-two#sec:heroku_deploy"><span class="number">7.4.2</span> Déploiement Heroku</a></li></ol></li>
<li class="section"><a href="modeling-and-viewing-users-two#sec:more_modeling_users_Exercices"><span class="number">7.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="sign-up#top"><span class="number">Chapitre 8</span> Inscription</a></li>
<li><ol>
<li class="section"><a href="sign-up#sec:signup_form"><span class="number">8.1</span> Formulaire d'inscription</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:using_form_for"><span class="number">8.1.1</span> Utiliser  <code>form_for</code></a></li>
<li class="subsection"><a href="sign-up#sec:the_form_html"><span class="number">8.1.2</span> Le formulaire HTML</a></li></ol></li>
<li class="section"><a href="sign-up#sec:signup_failure"><span class="number">8.2</span> Échec de l'inscription</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:testing_failure"><span class="number">8.2.1</span> Test de l'échec</a></li>
<li class="subsection"><a href="sign-up#sec:a_working_form"><span class="number">8.2.2</span> Un formulaire fonctionnel</a></li>
<li class="subsection"><a href="sign-up#sec:signup_error_messages"><span class="number">8.2.3</span> Inscription&nbsp;: messages d'erreur</a></li>
<li class="subsection"><a href="sign-up#sec:filtering_parameter_logging"><span class="number">8.2.4</span> Filtrage des paramètres d'identification</a></li></ol></li>
<li class="section"><a href="sign-up#sec:signup_success"><span class="number">8.3</span> Succès de l'inscription</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:testing_success"><span class="number">8.3.1</span> Tester le succès de l'inscription</a></li>
<li class="subsection"><a href="sign-up#sec:the_finished_signup_form"><span class="number">8.3.2</span> Le formulaire d'inscription finalisé</a></li>
<li class="subsection"><a href="sign-up#sec:the_flash"><span class="number">8.3.3</span> Le message «&nbsp;flash&nbsp;»</a</a></li>
<li class="subsection"><a href="sign-up#sec:the_first_signup"><span class="number">8.3.4</span> La première inscription</a></li></ol></li>
<li class="section"><a href="sign-up#sec:rspec_integration_tests"><span class="number">8.4</span> Test d'intégration RSpec</a></li>
<li><ol>
<li class="subsection"><a href="sign-up#sec:integration_tests_with_style"><span class="number">8.4.1</span> Tests d'intégration avec les styles</a></li>
<li class="subsection"><a href="sign-up#sec:failed_signup"><span class="number">8.4.2</span> Un échec d'inscription ne devrait pas créer un nouvel utilisateur</a></li>
<li class="subsection"><a href="sign-up#sec:successful_signup"><span class="number">8.4.3</span> Le succès d'une inscription devrait créer un nouvel utilisateur</a></li></ol></li>
<li class="section"><a href="sign-up#sec:8.5"><span class="number">8.5</span> Conclusion</a></li>
<li class="section"><a href="sign-up#sec:signup_Exercices"><span class="number">8.6</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="sign-in-sign-out#top"><span class="number">Chapitre 9</span> Connexion, déconnexion</a></li>
<li><ol>
<li class="section"><a href="sign-in-sign-out#sec:sessions"><span class="number">9.1</span> Les sessions</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:sessions_controller"><span class="number">9.1.1</span> Le contrôleur de session</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:signin_form"><span class="number">9.1.2</span> Formulaire d'identification</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:signin_failure"><span class="number">9.2</span> Échec de l'identification</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:reviewing_form_submission"><span class="number">9.2.1</span> Examen de la soumission du formulaire</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:failed_signin"><span class="number">9.2.2</span> Échec de l'identification (test et code)</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:signin_success"><span class="number">9.3</span> Succès de l'identification</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:the_completed_create_action"><span class="number">9.3.1</span> L'action <code>create</code> («&nbsp;créer&nbsp;») finalisée</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:remember_me"><span class="number">9.3.2</span> Se souvenir de moi</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:current_user"><span class="number">9.3.3</span> Utilisateur courant</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:signing_out"><span class="number">9.4</span> Déconnexion</a></li>
<li><ol>
<li class="subsection"><a href="sign-in-sign-out#sec:destroying_sessions"><span class="number">9.4.1</span> Détruire la session</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:signin_upon_signup"><span class="number">9.4.2</span> Connection à l'inscription</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:changing_the_layout_links"><span class="number">9.4.3</span> Changement des liens de la mise en plage</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec:signin_out_integration_tests"><span class="number">9.4.4</span> Test d'intégration de l'identification/déconnexion</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec:9.5"><span class="number">9.5</span> Conclusion</a></li>
<li class="section"><a href="sign-in-sign-out#sec:sign_in_out_Exercices"><span class="number">9.6</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="updating-showing-and-deleting-users#top"><span class="number">Chapitre 10</span> Actualiser, afficher et supprimer de l'utilisateur</a></li>
<li><ol>
<li class="section"><a href="updating-showing-and-deleting-users#sec:updating_users"><span class="number">10.1</span> Actualiser l'utilisateur</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:edit_form"><span class="number">10.1.1</span> Formulaire de modification</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:enabling_edits"><span class="number">10.1.2</span> Permettre les modifications</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:protecting_pages"><span class="number">10.2</span> Protéger les pages</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_signed_in_users"><span class="number">10.2.1</span> Utilisateurs identifiés requis</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_the_right_user"><span class="number">10.2.2</span> Nécessité du bon utilisateur</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:friendly_forwarding"><span class="number">10.2.3</span> Redirection conviviale</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:showing_users"><span class="number">10.3</span> Afficher les utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:user_index"><span class="number">10.3.1</span> Liste des utilisateurs</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:sample_users"><span class="number">10.3.2</span> Exemples d'utilisateurs</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:pagination"><span class="number">10.3.3</span> Pagination</a></li>
<li><ol>
<li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:testing_pagination">Test de la pagination</a></li></ol></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:partial_refactoring"><span class="number">10.3.4</span> Restructuration des partielles</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:destroying_users"><span class="number">10.4</span> Supprimer des utilisateurs</a></li>
<li><ol>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:administrative_users"><span class="number">10.4.1</span> Utilisateurs administrateurs</a></li>
<li><ol>
<li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:revisiting_attr_accessible">Révision de <code>attr_accessible</code></a></li></ol></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec:the_destroy_action"><span class="number">10.4.2</span> L'action <code>destroy</code> («&nbsp;supprimer&nbsp;»)</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:10.5"><span class="number">10.5</span> Conclusion</a></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec:updating_deleting_Exercices"><span class="number">10.6</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="user-microposts#top"><span class="number">Chapitre 11</span> Micro-messages d'utilisateur</a></li>
<li><ol>
<li class="section"><a href="user-microposts#sec:a_micropost_model"><span class="number">11.1</span> Le modèle Micropost («&nbsp;Micro-message&nbsp;»)</a></li>
<li><ol>
<li class="subsection"><a href="user-microposts#sec:the_basic_model"><span class="number">11.1.1</span> Le modèle initial</a></li>
<li><ol>
<li class="subsubsection"><a href="user-microposts#sec:accessible_attribute">Attributs accessibles</a></li></ol></li>
<li class="subsection"><a href="user-microposts#sec:user_micropost_associations"><span class="number">11.1.2</span> Associations Utilisateur/micro-messages</a></li>
<li class="subsection"><a href="user-microposts#sec:ordering_and_dependency"><span class="number">11.1.3</span> Affinements du micro-message</a></li>
<li><ol>
<li class="subsubsection"><a href="user-microposts#sec:default_scope">Portée par défaut</a></li>
<li class="subsubsection"><a href="user-microposts#sec:dependent_destroy">Dependent: destroy (dépendances de la suppression)</a></li></ol></li>
<li class="subsection"><a href="user-microposts#sec:micropost_validations"><span class="number">11.1.4</span> Validations du micro-message</a></li></ol></li>
<li class="section"><a href="user-microposts#sec:showing_microposts"><span class="number">11.2</span> Afficher les micro-messages</a></li>
<li><ol>
<li class="subsection"><a href="user-microposts#sec:augmenting_the_user_show_page"><span class="number">11.2.1</span> Etoffement de la page de l'utilisateur</a></li>
<li class="subsection"><a href="user-microposts#sec:sample_microposts"><span class="number">11.2.2</span> Exemples de micro-messages</a></li></ol></li>
<li class="section"><a href="user-microposts#sec:manipulating_microposts"><span class="number">11.3</span> Manipuler les micro-messages</a></li>
<li><ol>
<li class="subsection"><a href="user-microposts#sec:access_control"><span class="number">11.3.1</span> Contrôle de l'accès</a></li>
<li class="subsection"><a href="user-microposts#sec:creating_microposts"><span class="number">11.3.2</span> Créer des micro-messages</a></li>
<li class="subsection"><a href="user-microposts#sec:a_proto_feed"><span class="number">11.3.3</span> Une proto-alimentation</a></li>
<li class="subsection"><a href="user-microposts#sec:destroying_microposts"><span class="number">11.3.4</span> Supprimer des micro-messages</a></li>
<li class="subsection"><a href="user-microposts#sec:testing_the_new_home_page"><span class="number">11.3.5</span> Test de la nouvelle page d'accueil</a></li></ol></li>
<li class="section"><a href="user-microposts#sec:11.4"><span class="number">11.4</span> Conclusion</a></li>
<li class="section"><a href="user-microposts#sec:micropost_Exercices"><span class="number">11.5</span> Exercices</a></li></ol></li>
<li class="chapter"><a href="following-users#top"><span class="number">Chapitre 12</span> Suivi des utilisateurs</a></li>
<li><ol>
<li class="section"><a href="following-users#sec:the_relationship_model"><span class="number">12.1</span> Le modèle Relation (Relationship model)</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:a_problem_with_the_data_model"><span class="number">12.1.1</span> Un problème du modèle de données (et sa solution)</a></li>
<li class="subsection"><a href="following-users#sec:relationship_user_associations"><span class="number">12.1.2</span> Associations Utilisateur/Relations</a></li>
<li class="subsection"><a href="following-users#sec:relationship_validations"><span class="number">12.1.3</span> Validations</a></li>
<li class="subsection"><a href="following-users#sec:following"><span class="number">12.1.4</span> Auteurs suivis</a></li>
<li class="subsection"><a href="following-users#sec:followers"><span class="number">12.1.5</span> Lecteurs</a></li></ol></li>
<li class="section"><a href="following-users#sec:a_web_interface_for_following_and_followers"><span class="number">12.2</span> Une interface web pour les auteurs suivis et les lecteurs</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:sample_following_data"><span class="number">12.2.1</span> Exemple de donnée de suivi</a></li>
<li class="subsection"><a href="following-users#sec:stats_and_a_follow_form"><span class="number">12.2.2</span> Statistiques et formulaire de suivi</a></li>
<li class="subsection"><a href="following-users#sec:following_and_followers_pages"><span class="number">12.2.3</span> Pages d'auteurs suivis et de lecteurs</a></li>
<li class="subsection"><a href="following-users#sec:a_working_follow_button_the_standard_way"><span class="number">12.2.4</span> Un bouton de suivi fonctionnant de façon standard</a></li>
<li class="subsection"><a href="following-users#sec:a_working_follow_button_with_ajax"><span class="number">12.2.5</span> Un bouton fonctionnant avec Ajax</a></li></ol></li>
<li class="section"><a href="following-users#sec:the_status_feed"><span class="number">12.3</span> L'état de l'alimention</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:motivation_and_strategy"><span class="number">12.3.1</span> Motivation et stratégie</a></li>
<li class="subsection"><a href="following-users#sec:a_first_feed_implementation"><span class="number">12.3.2</span> Une première implémentation de peuplement</a></li>
<li class="subsection"><a href="following-users#sec:scopes_subselects_and_a_lambda"><span class="number">12.3.3</span> Portées, sous-requêtes et fonction <em>lambda</em></a></li>
<li class="subsection"><a href="following-users#sec:the_new_status_feed"><span class="number">12.3.4</span> Nouvel état de l'alimentation</a></li></ol></li>
<li class="section"><a href="following-users#sec:following_conclusion"><span class="number">12.4</span> Conclusion</a></li>
<li><ol>
<li class="subsection"><a href="following-users#sec:extensions_to_the_sample_application"><span class="number">12.4.1</span> Extensions de l'application exemple</a></li>
<li><ol>
<li class="subsubsection"><a href="following-users#sec:replies">Réponses</a></li>
<li class="subsubsection"><a href="following-users#sec:messaging">Notification</a></li>
<li class="subsubsection"><a href="following-users#sec:follower_notifications">Notifications aux lecteurs</a></li>
<li class="subsubsection"><a href="following-users#sec:password_reminders">Rappel du mot de passe</a></li>
<li class="subsubsection"><a href="following-users#sec:signup_confirmation">Confirmation d'inscription</a></li>
<li class="subsubsection"><a href="following-users#sec:rss_feed">Alimentation RSS</a></li>
<li class="subsubsection"><a href="following-users#sec:rest_api">REST API</a></li>
<li class="subsubsection"><a href="following-users#sec:search">Recherche</a></li></ol></li>
<li class="subsection"><a href="following-users#sec:guide_to_further_resources"><span class="number">12.4.2</span> Guide vers d'autres ressources</a></li></ol></li>
<li class="section"><a href="following-users#sec:following_Exercices"><span class="number">12.5</span> Exercices</a></li></ol></li></ol></div>


<div id="main_content"></div>

<p> <span class="preamble">
 <span id="foreword">
<strong> Avant-propos</strong> <br />
 </span>
 </span></p>

<p>Ma précédente compagnie (CD Baby) fut une des premières à basculer complètement vers Ruby on Rails, et à rebasculer aussi complètement vers PHP (googlez-moi pour prendre la mesure du drama). Ce livre de Michael Hartl m'est arrivé avec tant de recommandation que je ne pouvais faire autrement que de le lire. C'est ainsi que <em>Ruby on Rails Tutorial</em> m'a fait retourner à Rails à nouveau </p>
<p>Bien qu'ayant parcouru de nombreux livre sur Rails, c'est celui qui m'a fait vraiment &ldquo;posséder&rdquo; Rails. Tout est fait “à la manière de Rails” —&nbsp;une manière qui ne me semblait pas naturelle avant avant d'avoir terminer ce livre. C'est aussi le seul livre sur Rails qui opère un Développement conduit par le test (“test-driven development”) d'un bout à l'autre, une approche hautement recommandée par les experts mais qui n'a jamais été aussi démontrée avant. Enfin, en incluant Git, GitHub et Heroku dans les exemples en démonstration, l'auteur vous donne vraiment le goût de ce que c'est que faire un projet dans la vraie vie. Les exemples de code du tutoriel ne sont pas de reste.</p> 
	
<p>La narration linéaire est vraiment un bon format. Personnellement, j'ai étudié <em>Le Tutoriel Rails</em> en trois longues journées, en faisant tous les exemples et les exercices proposés à la fin de chaque chapitre. Lisez du début à la fin, en ne sautant aucune partie, et vous en tirerez tout le bénéfice.</p>

<p>Régalez-vous&nbsp;!</p>

<p><a href="http://sivers.org/">Derek Sivers</a> (<a href="http://sivers.org/">sivers.org</a>) <br />
<em>Précédemment&nbsp;: Fondateur de </em> <a href="http://www.cdbaby.com/"><em>CD Baby</em></a> <br />
<em>Actuellement&nbsp;: Fondateur de </em> <a href="http://thoughts.pro/"><em>Thoughts Ltd.</em></a> <br /></p>

<p> <span class="preamble">
<strong> Remerciements</strong> <br />
 </span></p>

<p>Ce <em>Tutoriel Ruby on Rails</em> doit beaucoup à mon livre précédent sur Rails, <em>RailsSpace</em>, et donc à mon co-auteur <a href="http://aure.com/">Aurelius Prochazka</a>. J'aimerais remercier Aure à la fois pour le travail qu'il a accompli sur ce précédent livre et pour son soutien pour le présent ouvrage. J'aimerais aussi remercier Debra Williams Cauley, mon éditeur pour les deux ouvrages&nbsp;; aussi longtemps qu'[elle me prendra au baseball][she keeps taking me to baseball games], je continuerai d'écrire des livres pour elle.</p>

<p>J'aimerais remerciement une longue liste de Rubyistes qui m'ont parlé et inspiré au cours des années&nbsp;; David Heinemeier Hansson, Yehuda Katz, Carl Lerche, Jeremy Kemper, Xavier Noria, Ryan Bates, Geoffrey Grosenbach, Peter Cooper, Matt Aimonetti, Gregg Pollack, Wayne&nbsp;E. Seguin, Amy Hoy, Dave Chelimsky, Pat Maddox, Tom Preston-Werner, Chris Wanstrath, Chad Fowler, Josh Susser, Obie Fernandez, Ian McFarland, Steven Bristol, Giles Bowkett, Evan Dorn, Long Nguyen, James Lindenbaum, Adam Wiggins, Tikhon Bernstam, Ron Evans, Wyatt Greene, Miles Forrest, les gens bien de Pivotal Labs, le gang Heroku, les mecs de thoughtbot, et l'équipe de GitHub. Enfin, tellement, tellement, tellement de lecteurs —&nbsp;beaucoup trop pour les citer tous&nbsp;— qui ont contribuer par leur rapport de bogues et leurs suggestions durant l'écriture de ce livre, et je tiens à saluer leur aide pour rendre ce livre aussi bon qu'il pouvait être. <br /></p>

<p> <span class="preamble">
 <span id="author">
<strong> À propos de l'auteur</strong> <br />
 </span>
 </span></p>

<p><a href="http://michaelhartl.com/">Michael Hartl</a> est programmeur, éducateur et entrepreneur. Il est le co-auteur de <em>RailsSpace</em>, un tutoriel Rails [qui s'est bien vendu] publié en 2007, et a été co-fondateur et développeur en chef de <a href="http://insoshi.com/">Insoshi</a>, une plateforme de réseau social <a href="http://github.com/popular/forked">populaire</a> en Ruby on Rails. Précédement, il a enseigné la théorie et [l'application informatique][computational physics] en physique au <a href="http://www.caltech.edu/">California Institute of Technology</a> (Caltech), où il a reçu le Lifetime Achievement Award for Excellence en enseignement. Michael est diplômé du <a href="http://college.harvard.edu/">Harvard College</a>, a un <a href="http://resolver.caltech.edu/CaltechETD:etd-05222003-161626">Ph.D. en physique</a> (NdT. Un doctorat) de <a href="http://www.caltech.edu/">Caltech</a>, et est ancien élève du programme   des entrepreneurs <a href="http://ycombinator.com/">Y&nbsp;Combinator</a>. <br /></p>

<p> <span id="license" class="preamble">
<strong> Copyright et license</strong> <br />
 </span></p>

<p><em>Le Tutoriel Ruby on Rails&nbsp;: apprendre Rails par l'exemple</em>. Copyright &copy; 2010 par Michael Hartl. Tout le code source du <em>Tutoriel Ruby on Rails</em> est disponible sour la license <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> et la licence <a href="http://en.wikipedia.org/wiki/Beerware">Beerware License</a>.</p>

<pre class="verbatim">   Copyright (c) 2010 Michael Hartl

   [La permission est accordée ici, à titre gratuit, à toute
   personne obtenant une copie de ce logiciel et sa documentation
   associés (le “Software”), 
   Permission is hereby granted, free of charge, to any person
   obtaining a copy of this software and associated documentation
   files (the &quot;Software&quot;), de traiter dans le Software
   sans restriction, d'inclure sans limitation de droits à utiliser,
   copier, modifier, ajouter, publier, distribuer, sous-licensier,
   et/ou vendre des copies de ce Software, et de permettre au gens
   à qui ce Software est fourni d'en faire de même, assujetti aux
   conditions suivantes&nbsp;:

   La note de copyright ci-dessous et cette notice de permission
   doivent être inclues à toute copie ou portion substantielle
   du logiciel.

   LE LOGICIEL EST FOURNI “TEL QUEL”, SANS AUCUNE GARANTIE D'AUCUNE
   ESPÈCE, ESPRESSE OU IMPLICITE, INCLUANT MAIS NE LIMITANT PAS LES
   GARANTIES MARCHANDES, À PROPOS D'UN BUT PARTICULIER ET ABSENCE
   DE CONTREFAÇON. EN AUCUN CAS LES AUTEURS OU LES DÉTENTEURS DU 
   COPYRIGHT NE POURRONT ÊTRE TENUS RESPONSABLE DE DOMMAGE OU AUTRE
   RESPONSABILITÉ, SI EN UNE ACTION DE CONTRAT, TORT OU AUTREMENT,
   DÉCOULANT DIRECTEMENT OU INDIRECTEMENT DE L'UTILISATION OU DE LA
   MODIFICATION DE CE LOGICIEL.]</pre>




<pre class="verbatim">/*
 * ------------------------------------------------------------
 * &quot;THE BEERWARE LICENSE&quot; (Revision 42):
 * Michael Hartl a écrit ce code. Aussi longtemps que vous
 * conservez cette note, vous pouvez faire ce que vous voulez
 * de ce travail. Si nous nous rencontrons un jour, et que vous
 * pensez que ce travail en vaut la peine, vous pourrez me
 * payer une bière en retour.
 * ------------------------------------------------------------
 */</pre>




<div id="top"></div>


<h1 class="chapter"><a id="sec:3" href="static-pages#top" class="heading"><span class="number">Chapitre 3</span> Pages statiques courantes</a></h1>


<p>Dans ce chapitre, nous commencerons à développer l'application exemple qui nous servira de base tout au long de ce tutoriel. Bien que l'application exemple aient éventuellement des utilisateurs, des micro-messages et un patch d'authentification complet, nous commencerons par un sujet apparemment limité&nbsp;: la création de pages statiques. Malgré son apparente simplicité, la création de pages statiques est une exercice hautement formateur, riche en implications $mdash;&nbsp;un parfait commencement pour notre application naissante.</p>

<p>Bien que Rails soit destiné à créer des sites web dynamique avec base de données, Rails excèle aussi à faire ce genre de pages statiques que nous pouvons faire avec des fichiers de code HTML brut. En fait, utiliser Rails même pour des pages statiques produit un avantage certain&nbsp;: nous pouvons ajouter seulement une <em>petite</em> quantité de code dynamique. Nous verrons comment dans ce chapitre. Chemin faisant, nous aurons un avant-goût du <em>testing automatique</em>, qui nous aidera à nous sentir plus confiant envers notre code. Plus encore, avoir une bonne batterie de tests nous permet de <em>restructurer</em> notre code en toute confiance, en changeant sa forme sans changer sa fonction.</p>

<p>Comme au <a class="ref" href="a-demo-app#top">chapitre&nbsp;2</a>, avant de commencer nous avons besoin de créer un nouveau projet Rails, cette fois appelé <tt>sample_app</tt> (<em>application exemple</em>)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects
<span class="gp">$</span> rails new sample_app -T
<span class="gp">$</span> <span class="nb">cd </span>sample_app
</pre></div>
</div>


<p>Ici, l'option <code>-T</code> ajoutée à la commande <code>rails</code> demande à Rails de ne pas générer le dossier <code>test</code> associé au frameword par défaut <tt>Test::Unit</tt>. Cela ne signifie pas que nous n'exécuterons pas de tests&nbsp;; au contraire, dès la <a class="ref" href="static-pages#sec:first_tests">section&nbsp;3.2</a> nous utiliserons un framework de test alternatif appelé <em>RSpec</em> pour écrire une suite de test approfondie.</p>

<p>Comme à la <a class="ref" href="a-demo-app#sec:planning_the_application">section&nbsp;2.1</a>, notre prochaine étape consiste à utiliser un éditeur de texte pour actualiser le fichier <code>Gemfile</code> avec les gems nécessaires à notre application (souvenez-vous que vous pouvez avoir besoin de la version <tt>1.2.5</tt> du gem <tt>sqlite3-ruby</tt>, en fonction de votre système d'exploitation). D'un autre côté, pour l'application exemple, nous aurons aussi besoin de deux nouveaux gems&nbsp;: le gem RSpec et le gem de la librairie RSpec spécifique à Rails. Le code pour les inclure est montré dans l'<a class="ref" href="static-pages#code:gemfile_rspec">extrait&nbsp;3.1</a> (<em>note</em>&nbsp;: si vous préférez installer <em>tous</em> les gems nécessaire à l'application exemple, vous devriez utiliser le code de l'<a class="ref" href="updating-showing-and-deleting-users#code:final_gemfile">extrait&nbsp;10.42</a> dès à présent).</p>

<div class="label" id="code:gemfile_rspec"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.1.</span> <span class="description">Un <code>Gemfile</code> pour l'application exemple.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.7&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3-ruby&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.2&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s1">&#39;sqlite3&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.5.0&#39;</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec&#39;</span><span class="p">,</span> <span class="s1">&#39;2.5.0&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;webrat&#39;</span><span class="p">,</span> <span class="s1">&#39;0.7.1&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Ceci inclut <tt>rspec-rails</tt> en mode développement, de telle sorte que nous avons accès aux génératers spécifiques à RSpec, et il inclut également <tt>rspec</tt> en mode de test dans le but de jouer les tests (nous incluons aussi un gem pour <a href="http://github.com/brynary/webrat">Webrat</a>, un utilitaire de test qui a l'habitude d'être installé automatiquement comme dépendance mais a besoin ici d'être inclus explicitement). Pour installer et inclure les gems RSpec, nous utilisons <code>bundle install</code> comme d'habitude&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Dans le but de demander à Rails d'utiliser RSpec au lieu de <tt>Test::Unit</tt>, nous avons besoin d'installer les fichiers nécessités par RSpec. Cela peut être accompli avec <code>rails generate</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate rspec:install
</pre></div>
</div>


<p>Avec ça, tout ce qu'il nous reste à faire est d'initialiser le repository Git&nbsp;:<sup class="footnote" id="fnref:3.1"><a href="#fn:3.1">1</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git init
<span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Initial commit&quot;</span>
</pre></div>
</div>


<p>Tout comme la première application, je suggère d'actualier le fichier <code>README</code> (situé dans le dossier racine de l'application) pour être plus utile et descriptif, comme montré dans l'<a class="ref" href="static-pages#code:sample_app_readme">extrait&nbsp;3.2</a>.</p>

<div class="label" id="code:sample_app_readme"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.2.</span> <span class="description">Un fichier <code>README</code> amélioré pour l'application exemple.</span>       
</div>
<div class="code"><div class="highlight"><pre># Tutoriel Ruby on Rails&nbsp;: sample application (application exemple)

C'est l'application exemple pour 
[*Tutoriel Ruby on Rails&nbsp;: Apprendre Rails par l'exemple*](http://railstutorial.org/)
par [Michael Hartl](http://michaelhartl.com/).
</pre></div>
</div></div>


<p>Changez alors cela pour utiliser l'extension <code>markdown</code> et déposer les changements&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git mv README README.markdown
<span class="gp">$</span> git commit -a -m <span class="s2">&quot;Amelioration du README&quot;</span>
</pre></div>
</div>




<div class="label" id="fig:create_repository"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/create_repository.png" alt="create_repository" /></span></div><div class="caption"><span class="header">Illustration 3.1: </span><span class="description">Créer le repository de l'application exemple sur GitHub.&nbsp;<a href="http://railstutorial.org/images/figures/create_repository-full.png">(taille normale)</a></span></div></div>


<p>Puisque nous utiliserons cette application exemple jusqu'à la fin de ce livre, c'est une bonne idée de faire un repository sur GitHub (<a class="ref" href="static-pages#fig:create_repository">illustration&nbsp;3.1</a>) et de la «&nbsp;pusher&nbsp;»&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin git@github.com:&lt;username&gt;/sample_app.git
<span class="gp">$</span> git push origin master
</pre></div>
</div>


<p>(Notez que, comme résultat de cette étape, le repository sur <a href="http://github.com/railstutorial/sample_app">http://github.com/railstutorial/sample_app</a> contient le code source de toute l'application exemple. Vous êtes encouragé à le consulter en guise de référence, avec deux mises en garde&nbsp;: (1) vous en apprendrez beaucoup plus sir vous écrivez dans le code source vous-même,  plutôt que de vous appuyer sur une version achevée&nbsp;; (2) Il peut exister des différences mineures entre le repository GitHub et le code de ce livre. Cela est dû d'un côté à l'incorporation des exercices du livre et d'un autre côté au repository utilisé dans les <a href="http://railstutorial.org/screencasts">screencasts du tutoriel Rails</a>, qui inclut quelques tests supplémentaires).</p>

<p>Bien entendu, nous pouvons optionnellement déployer l'application vers Heroku même à ce stade peu avancé&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku create
<span class="gp">$</span> git push heroku master
</pre></div>
</div>

<p>(Si cela ne fonctionne pas pour vous, consultez la note au-dessus de l'<a class="ref" href="beginning#code:gemfile_sqlite_heroku">extrait&nbsp;1.8</a> pour des solutions possibles.) À mesure que vous avancez dans le livre, je vous recommande de «&nbsp;pusher&nbsp;» et de déployer l'application régulièrement avec&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push
<span class="gp">$</span> git push heroku
</pre></div>
</div>


<p>Cela posé, nous sommes prêts à développer l'application exemple.</p>

<div class="label" id="sec:static_pages"></div>


<h2><a id="sec:3.1" href="static-pages#sec:static_pages" class="heading"><span class="number">3.1</span> Pages statiques</a></h2>


<p>Rails propose deux manières principales de créer des pages web statiques. <em>Primo</em>, Rails peut utiliser des pages <em>vraiment</em> statiques contenant du code HTML brut. <em>Secondo</em>, Rails nous permet de définir des vues (<em>views</em>) contenant du HTML brut, que Rails peut <em>rendre</em> de telle sorte que le serveurs web puisse les envoyer au navigateur.</p>

<p>Afin de prendre nos repères, il est utile de se remémorer la struture d'un dossier Rails de la <a class="ref" href="beginning#sec:the_first_application">section&nbsp;1.2.3</a> (<a class="ref" href="beginning#fig:directory_structure_rails_3">illustration&nbsp;1.2</a>). Dans cette section, nous travaillerons principalement sur les dossiers <code>app/controllers</code> (contenant les contrôleurs) et <code>app/views</code> (contenant les vues) (à la <a class="ref" href="static-pages#sec:first_tests">section&nbsp;3.2</a>, nous ajouterons même un dossier de notre cru).</p>

<div class="label" id="sec:truly_static_pages"></div>


<h3><a id="sec:3.1.1" href="static-pages#sec:truly_static_pages" class="heading"><span class="number">3.1.1</span> Vraies pages statiques</a></h3>


<p>Commençons avec les vraies pages statiques. Rappelez-vous, de la <a class="ref" href="beginning#sec:rails_server">section&nbsp;1.2.5</a>, que  toute application Rails se présente comme une application fonctionnelle minimale générée par le script <code>rails</code>, avec une page d'accueil à l'adresse <a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a> (<a class="ref" href="beginning#fig:riding_rails_3">illustration&nbsp;1.3</a>).</p>

<div class="label" id="fig:public_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/public_index_rails_3.png" alt="public_index_rails_3" /></span></div><div class="caption"><span class="header">Illustration 3.2: </span><span class="description">Le fichier <code>public/index.html</code>.&nbsp;<a href="http://railstutorial.org/images/figures/public_index_rails_3-full.png">(taille normale)</a></span></div></div>


<p>Pour savoir d'où cette page vient, jetez-un coup d'œil au fichier <code>public/index.html</code> (<a class="ref" href="static-pages#fig:public_index_rails_3">illustration&nbsp;3.2</a>). Comme le fichier contient ses propres informations de mise en page, c'est un peu le bazard, mais ça fonctionne&nbsp;: par défaut, Rails renvoie tout fichier du dossier <code>public</code> directement à votre navigateur.<sup class="footnote" id="fnref:3.2"><a href="#fn:3.2">2</a></sup> Dans le cas du fichier spécial <code>index.html</code>, vous n'avez même pas à indiquer le nom du fichier dans l'URL, puisque le nom <code>index.html</code> est le nom de fichier par défaut. Vous pouvez l'inclure si vous voulez, cependant&nbsp;; l'adresse…</p>

<pre class="verbatim">http://localhost:3000/</pre>


<p>et</p>

<pre class="verbatim">http://localhost:3000/index.html</pre>


<p>… sont équivalentes.</p>

<p>Comme vosu pouvez vous y attendre, si nous le voulons nous pouvons fabriquer nos propres fichier HTML statiques, et les déposer dans le même dossier <code>public</code> que le fichier <code>index.html</code>. Par exemple, créons un fichier avec un message de salutation amicale (<a class="ref" href="static-pages#code:hello_world">extrait&nbsp;3.3</a>)&nbsp;:<sup class="footnote" id="fnref:3.3"><a href="#fn:3.3">3</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> mate public/hello.html
</pre></div>
</div>


<div class="label" id="code:hello_world"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.3.</span> <span class="description">Un fichier HTML typique, avec une salutation amicale. <br /> <code>public/hello.html</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Greeting<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>Salut le monde&amp;nbsp;!<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Nous pouvons voir dans l'<a class="ref" href="static-pages#code:hello_world">extrait&nbsp;3.3</a> la structure caractéristique d'un document HTML&nbsp;: un type de document (<em>document type</em>), ou <em>doctype</em>, qui est une déclaration aux navigateurs de la version du code HTML que nous utilisons (dans ce cas, <a href="http://en.wikipedia.org/wiki/HTML5">HTML5</a>)&nbsp;;<sup class="footnote" id="fnref:3.4"><a href="#fn:3.4">4</a></sup> une section  <code>head</code>, dans le cas présent avec le texte &ldquo;&nbsp;Greeting&nbsp;&rdquo; à l'intérieur d'une balise <code>title</code>&nbsp;; et une section <code>body</code> (<em>corps</em>), dans le cas présennt avec le texte &ldquo;&nbsp;Salut le monde&amp;nbsp;!&nbsp;!&rdquo; à l'intérieur d'une balise de paragraphe <code>p</code> (l'indentation du texte est optionnelle &mdash;&nbsp;HTML n'est pas sensible aux espaces «&nbsp;blanches&nbsp;», et ignore aussi bien les tabulations que les espaces &mdash;&nbsp;mais cela rend la structure du document plus lisible) Comme promis, quand on visite l'adresse <a href="http://localhost:3000/hello.html"><tt>http://localhost:3000/hello.html</tt></a>,  Rails rend aussitôt cette page (<a class="ref" href="static-pages#fig:hello_world">illustration&nbsp;3.3</a>). Notez que le titre affiché au sommet de la fenêtre du navigateur dans l'<a class="ref" href="static-pages#fig:hello_world">illustration&nbsp;3.3</a> correspond au contenu de la balise <code>title</code>, c'est-à-dire &ldquo;&nbsp;Greeting&nbsp;&rdquo;.</p>

<div class="label" id="fig:hello_world"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/hello_world.png" alt="hello_world" /></span></div><div class="caption"><span class="header">Illustration 3.3: </span><span class="description">Notre vrai fichier HTML statique (<a href="http://localhost:3000/hello.html"><tt>http://localhost:3000/hello.html</tt></a>).&nbsp;<a href="http://railstutorial.org/images/figures/hello_world-full.png">(taille normale)</a></span></div></div>


<p>Puisque ce fichier n'a valeur que de démonstration, nous n'avons pas vraiment envie qu'il fasse partie de notre applicaton, donc il est peut-être mieux de le détruire une fois l'euphorie de cette création passée&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rm public/hello.html
</pre></div>
</div>


<p>Nous laisserons de côté le fichier <code>index.html</code> pour le moment, mais nous pourrions bien sûr l'effacer aussi, éventuellement&nbsp;: nous ne désirons pas que la racine de notre application soit la page par défaut de Rails comme montrée dans l'<a class="ref" href="beginning#fig:riding_rails_3">illustration&nbsp;1.3</a>. Nous verrons dans la <a class="ref" href="filling-in-the-layout#sec:layout_links">section&nbsp;5.2</a> comment changer l'adresse <a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a> pour qu'elle pointe vers autre chose que le fichier <code>public/index.html</code>.</p>

<div class="label" id="sec:static_pages_with_rails"></div>


<h3><a id="sec:3.1.2" href="static-pages#sec:static_pages_with_rails" class="heading"><span class="number">3.1.2</span> Les pages statiques avec Rails</a></h3>


<p>La capacité de retourner des fichiers de code HTML statique est bien, mais cela n'est pas particulièrement utile pour créer des applications web dynamiques. Dans cette section, nous ferons un premier pas vers la création de pages dynamiques en créant un jeu d'<em>actions</em> Rails, qui sont une façon plus puissante de définir des URLs que les fichiers statiques.<sup class="footnote" id="fnref:3.5"><a href="#fn:3.5">5</a></sup> Les actions Rails sont regroupées à l'intérieur de contrôleurs (<em>controllers</em>) (le «&nbsp;C&nbsp;» dans le MVC de la  <a class="ref" href="beginning#sec:mvc">section&nbsp;1.2.6</a>), qui contient des jeux d'actions reliées par un but commun. Nous avons eu un aperçu des contrôleurs au <a class="ref" href="a-demo-app#top">chapitre&nbsp;2</a>, et approfondiront pour en avoir une compréhension plus profonde une fois que nous explorerons mieux l'<a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">architecture REST</a>  (à partir du <a class="ref" href="modeling-and-viewing-users-one#top">chapitre&nbsp;6</a>)&nbsp;; par essence, un <em>contrôleur</em> est le conteneur d'un groupe de pages web (peut-être dynamiques).</p>

<p>Pour commencer, rappelez-vous, dans la <a class="ref" href="beginning#sec:git_commands">section&nbsp;1.3.5</a>, que lorsque nous utilisons Git, c'est une bonne pratique d'exécuter notre travail sur une autre branche que la branche maitresse. Si vous utilisez Git pour le contrôle de versions, vous devriez jouer ces commandes&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout -b static-pages
</pre></div>
</div>


<p>Rails est fourni avec un script pour créer des contrôleurs, appelé  <code>generate</code>&nbsp;; tout ce dont il a besoin pour faire son tour de magie, c'est le nom du contrôleur. Puisque nous créons ce contrôleur pour empoigner les pages statiques (courantes), nous l'appellerons simplement le contrôleurs Pages, et planifierons de faire des actions pour la page d'accueil, la page de contact et la page «&nbsp;À propos&nbsp;». Le script <code>generate</code> prend une liste optionnelle d'actions, donc nous incluerons certaines de ces actions initiales directement en ligne de commande&nbsp;:</p>

<div class="label" id="code:generating_pages"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.4.</span> <span class="description">Générer un contrôleur de Pages.</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate controller Pages home contact
<span class="go">      create  app/controllers/pages_controller.rb</span>
<span class="go">       route  get &quot;pages/contact&quot;</span>
<span class="go">       route  get &quot;pages/home&quot;</span>
<span class="go">      invoke  erb</span>
<span class="go">      create    app/views/pages</span>
<span class="go">      create    app/views/pages/home.html.erb</span>
<span class="go">      create    app/views/pages/contact.html.erb</span>
<span class="go">      invoke  rspec</span>
<span class="go">      create    spec/controllers/pages_controller_spec.rb</span>
<span class="go">      create    spec/views/pages</span>
<span class="go">      create    spec/views/pages/home.html.erb_spec.rb</span>
<span class="go">      create    spec/views/pages/contact.html.erb_spec.rb</span>
<span class="go">      invoke  helper</span>
<span class="go">      create    app/helpers/pages_helper.rb</span>
<span class="go">      invoke    rspec</span>
</pre></div>
</div></div>




<p>(notez que, puisque nous avons installé RSpec avec le code <code>rails generate rspec:install</code>, la génération de contrôleur crée automatiquement des fichiers de test RSpec dans le dossier <code>spec/</code>). Ici, j'ai intentionnellement &ldquo;&nbsp;oublié&nbsp;&rdquo; la page <code>à propos</code> pour que nous puissions voir comment l'ajouter à la main (<a class="ref" href="static-pages#sec:first_tests">section&nbsp;3.2</a>).</p>

<p>La génération de pages de contrôleurs de l'<a class="ref" href="static-pages#code:generating_pages">extrait&nbsp;3.4</a> actualise automatiquement le fichier de <em>routage</em>, nommé <code>config/routes.rb</code>, que Rails utilise pour trouver la correspondance entre URLs et pages web. C'est notre première rencontre avec le dossier <code>config</code>, donc il peut être utile d'y jeter un coup d'œil (<a class="ref" href="static-pages#fig:config_directory_rails_3">illustration&nbsp;3.4</a>). Le dossier <code>config</code> est l'endroit où Rails collecte les fichiers nécessaires à la configuration de l'application &mdash;&nbsp;d'où le nom.</p>

<div class="label" id="fig:config_directory_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/config_directory_rails_3.png" alt="config_directory_rails_3" /></span></div><div class="caption"><span class="header">Illustration 3.4: </span><span class="description">Contenu du dossier <code>config</code> de l'application exemple.&nbsp;<a href="http://railstutorial.org/images/figures/config_directory_rails_3-full.png">(taille normale)</a></span></div></div>


<p>Puis nous avons généré les actions <code>home</code> et <code>contact</code>, le routage de fichier possède déjà des règles pour chacun d'eux, comme on peut le voir dans l'<a class="ref" href="static-pages#code:pages_routes">extrait&nbsp;3.5</a>.</p>

<div class="label" id="code:pages_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.5.</span> <span class="description">Le routage pour l'action <code>home</code> et l'action <code>contact</code> dans le contrôleur Pages. <br /> <code>config/routes.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="no">SampleApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;pages/home&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;pages/contact&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Ici la règle…</p>

<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s2">&quot;pages/home&quot;</span>
</pre></div>
</div>


<p>… se charge de la requête pour l'URL <tt>/pages/home</tt> pour la page d'accueil (action <code>home</code>) dans le contrôleur Pages. Plus encore, en utilisant <code>get</code> nous nous arrangeons pour que la route réponde à la requête <tt>GET</tt>, qui est un des <em>verbes HTTP</em> fondamentaux supporté par le Hypertext Transfer Protocol (<a class="ref" href="static-pages#sidebar:get_etc">Box&nbsp;3.1</a>). Dans notre cas, cela signifie que lorsque nous générons une action <code>home</code> à l'intérieur du contrôleur Pages nous atteignons automatiquement une page à l'adresse <tt>/pages/home</tt>. Pour voir le résultat, «&nbsp;tuez&nbsp;» le serveur avec Ctrl-C, jouez la commande <code>rails server</code>, et naviguez alors à l'adresse <a href="http://localhost:3000/pages/home"><tt>/pages/home</tt></a> (<a class="ref" href="static-pages#fig:raw_home_view">illustration&nbsp;3.5</a>).</p>

<div class="label" id="fig:raw_home_view"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/raw_home_view.png" alt="raw_home_view" /></span></div><div class="caption"><span class="header">Illustration 3.5: </span><span class="description">La vue de l'accueil brute (<a href="http://localhost:3000/pages/home"><tt>/pages/home</tt></a>) générée par Rails.&nbsp;<a href="http://railstutorial.org/images/figures/raw_home_view-full.png">(taille normale)</a></span></div></div>




<div class="label" id="sidebar:get_etc"></div>


<div class="sidebar"><span class="title"><span class="header">Box 3.1.</span><span class="description"><tt>GET</tt>, et caetera</span></span>
<p>Le Hypertext Transfer Protocol (<a href="http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods">HTTP</a>) définit quatre opérations de base, correspondant aux quatre verbes <em>get</em> (<em>obtenir</em>), <em>post</em> (<em>poster</em>), <em>put</em> (<em>déposer</em>) et <em>delete</em> (<em>effacer</em>). Cela fait référence aux opérations entre un ordinateur <em>client</em> (typiquement jouant un navigateur web comme Firefox ou Safari) et un <em>serveur</em> (typiquement un serveur web tel que Apache ou Nginx) (il est important de comprendre qu'en développant des applications web sur un ordinateur local, le client et le serveur sont la même machine physique, mais en général ils sont différents). L'accent mis sur les verbes HTTP est typique des frameworks (à commencer par Rails) influencés par l'<em>architecture REST</em>, que nous avons abordée brièvement au <a class="ref" href="a-demo-app#top">chapitre&nbsp;2</a> et que nous apprendrons mieux au <a class="ref" href="sign-up#top">chapitre&nbsp;8</a>.</p>

<p><tt>GET</tt> est l'opération HTTP la plus courante, utilisée pour  <em>lire</em> des données sur le web&nbsp;; elle signifie simplement &ldquo;atteint une page&rdquo;, et chaque fois que vous visitez une page, telle que google.com ou craigslist.org, votre navigateur soumet une requête <tt>GET</tt>. La requête <tt>POST</tt> est l'opération suivante la plus courante&nbsp;; c'est la requête envoyée par votre navigateur quand vous soumettez un formulaire. Dans les applications Rails, les requêtes <tt>POST</tt> sont utilisées typiquement pour <em>créer</em> des choses (bien que le protocope HTTP permet aussi à la requête <tt>POST</tt> de procéder à des actualissations)&nbsp;; par exemple, la requête <tt>POST</tt> envoyée quand vous soumettez un formulaire pour la création d'un nouvel utilisateur sur votre site web. Les deux autres verbes, <tt>PUT</tt> et <tt>DELETE</tt>, sont utilisés pour <em>actualiser</em> et <em>détruire</em> des choses sur le serveur distant. Ces requêtes sont moins courantes que <tt>GET</tt> et <tt>POST</tt> puisque les navigateurs sont incapables de les envoyer nativement, mais certains frameworks web (comme Ruby on Rails) ont des façons intelligentes de <em>simuler</em> ces demandes par les navigateurs.</p>
</div>


<p>Pour comprendre d'où ces pages proviennent, commençons par jeter un œil au contrôleur Pages dans un éditeur de texte&nbsp;; vous devriez voir quelque chose comme le code de l'<a class="ref" href="static-pages#code:pages_controller">extrait&nbsp;3.6</a> (vous pouvez noter que, contrairement aux contrôleurs Users et Microposts de l'application Démo du <a class="ref" href="a-demo-app#top">chapitre&nbsp;2</a>, le contrôleur Pages ne respecte pas les conventions REST).</p>

<div class="label" id="code:pages_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.6.</span> <span class="description">Le contrôleur Pages contruit par l'<a class="ref" href="static-pages#code:generating_pages">extrait&nbsp;3.4</a>. <br /> <code>app/controllers/pages_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Nous voyons ici que la page <code>pages_controller.rb</code> définit une <em>classe</em> appelée <code>PagesController</code>. Les classes sont simplement une façon pratique d'organiser les <em>fonctions</em> (appelées aussi <em>méthodes</em>) comme les actions <code>home</code> et <code>contact</code>, qui sont définies en utilisant le mot-clé <code>def</code>. Le signe <code>&lt;</code> indique que <code>PagesController</code> <em>hérite</em> de la classe Rails <code>ApplicationController</code>&nbsp;; comme nous le verrons dans un instant, cela signifie que nos pages possèdent une grande quantité de fonctionnalités spécifiques à Rails. Nous en apprendrons plus sur les classes et l'héritage dans la <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">section&nbsp;4.4</a>).</p>

<p>Dans le cas du contrôleur Pages, ces deux méthodes sont initialement vides&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">home</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">contact</span>
<span class="k">end</span>
</pre></div>
</div>


<p>En pur Ruby, ces méthodes ne feraient rien, tout simple. En Rails, la situation est différente&nbsp;; <code>PagesController</code> est une classe Ruby, mais parce qu'elle hérite de la classe <code>ApplicationController</code> le comportement de ses méthodes est spécifique à Rails&nbsp;: en visitant l'URL <tt>/pages/home</tt>, Rails consulte le contrôleur Pages et exécute le code de l'action <code>home</code>, et rend alors la <em>vue</em> (le caractère «&nbsp;V&nbsp;» de MVC de la <a class="ref" href="beginning#sec:mvc">section&nbsp;1.2.6</a>) correspondant à l'action. Dans le cas présent, l'action <code>home</code> est vide, donc tous les appels à <tt>/pages/home</tt> rendent simplement la vue. Donc, à quoi ressemble une vue, et comment la trouvons-nous nous&nbsp;?</p>


<p>Si vous jetez un nouveau coup d'œil à la sortie de l'<a class="ref" href="static-pages#code:generating_pages">extrait&nbsp;3.4</a>, vous devriez être en mesure de deviner la correspondance entre les actions et les vues&nbsp;: une action comme <code>home</code> possède une vue correspondante appelée <code>home.html.erb</code>. Nous apprendrons à la <a class="ref" href="static-pages#sec:slightly_dynamic_pages">section&nbsp;3.3</a> ce que la partie <code>.erb</code> signifie&nbsp;; la partie <code>.html</code> ne devrait pas vous surprendre puisqu'elle ressemble à HTML (<a class="ref" href="static-pages#code:raw_home_view">extrait&nbsp;3.7</a>).</p>

<div class="label" id="code:raw_home_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.7.</span> <span class="description">La vue générée pour la page d'accueil (<em>Home</em>). <br /> <code>app/views/pages/home.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Pages#home<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/pages/home.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>La vue pour l'action <code>contact</code> est analogue (<a class="ref" href="static-pages#code:raw_contact_view">extrait&nbsp;3.8</a>).</p>

<div class="label" id="code:raw_contact_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.8.</span> <span class="description">La vue générée pour la page Contact. <br /> <code>app/views/pages/contact.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Pages#contact<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/pages/contact.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>Ces deux vues sont juste des <em>espaces réservés</em>&nbsp;: elles possèdent une entête (à l'intérieur de la balise <code>h1</code>) et un paragraphe (la balise <code>p</code>) contenant le chemin d'accès au fichier correspondant. Nous allons ajouter quelque (très léger) contenu dynamique à partir de la <a class="ref" href="static-pages#sec:slightly_dynamic_pages">section&nbsp;3.3</a>, mais telles quelles, ces vues soulignent un point important&nbsp;: les vues Rails peuvent contenir simplement du code HTML statique. Aussi loin que le navigateur est concerné, le code HTML des fichiers de la <a class="ref" href="static-pages#sec:truly_static_pages">section&nbsp;3.1.1</a> et la méthode controller/action des pages délivrées sont indistinctes&nbsp;: tout ce que voit le navigateur est de l'HTML.</p>

<p>Dans le reste de ce chapitre, nous ajouterons d'abord l'action <code>about</code> que nous avons &ldquo;&nbsp;oubliée&nbsp;&rdquo; à la <a class="ref" href="static-pages#sec:static_pages_with_rails">section&nbsp;3.1.2</a>, le petit montant de contenu dynamique, et effecturons les premiers pas vers la stylisation des pages en CSS. Avant de poursuivre, si vous utilisez Git, c'est une bonne idée d'ajouter dès maintenant les fichiers du contrôleur Pages au repository&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Ajout d'un controleur Pages&quot;</span>
</pre></div>
</div>




<div class="label" id="sec:first_tests"></div>


<h2><a id="sec:3.2" href="static-pages#sec:first_tests" class="heading"><span class="number">3.2</span> Nos premiers tests</a></h2>


<p>Si vous demandez à cinq développeurs Rails comment tester une pièce quelconque de code, vous obtiendrez quinze réponses différentes &mdash;&nbsp;mais ils seront tous d'accord sur le fait que vous devrez écrire ces tests. C'est dans cet esprit que nous approcherons le testing de notre application exemple, en écrivant de solides tests sans s'inquiéter trop de les rendre parfaits. Ne prenez pas les tests du <em>Tutoriel Rails</em> pour parole d'évangile&nbsp;; ils s'appuient sur le style que j'ai développé au cours de mes propres travaus et à la lecture du code d'autres développeurs. À mesure que vous développerez votre expérience en tant que développeur Rails, il n'y a aucun doute que vous développerez vos propres préférences et votre propre style en matière de test.</p>

<p>En complément de l'écriture des tests au cours du développement de l'application exemple, nous ferons aussi le choix de plus en plus fréquent d'écrire ces tests <em>avant</em> d'écrire le code de l'application &mdash;&nbsp;une approche connue sous le nom «&nbsp;Développement conduit par le test&nbsp;» (<em>test-driven development</em>, ou TDD).<sup class="footnote" id="fnref:3.6"><a href="#fn:3.6">6</a></sup> Notre exemple spécifique sera d'ajouter une page «&nbsp;À propos&nbsp;» à notre exemple de site. Heureusement, ajouter cette page supplémentaire n'est pas difficile &mdash;&nbsp;vous devriez même être en mesure de deviner la procédure en vous basant sur les exemples de la section précédente&nbsp;&mdash; ce qui signifie que nous pouvons nous concentrer sur le testing, qui contient pas mal d'idées nouvelles.</p>

<p>Tout d'abord, tester l'existence d'une page peut paraitre excessif, mais l'expérience montre que ça ne l'est pas. Tellement de choses peuvent mal tourner quand on développe un logiciel qu'avoir une bonne batterie de tests est inestimable pour assurer sa qualité. Plus encore, il est courant pour les programmes informatiques &mdash;&nbsp;et spécialement les applications applications&nbsp;&mdash; d'être étendu, et chaque fois que vous faites un changement vous risquez d'introduire des erreurs. L'écriture de tests ne garantit pas que ces erreurs ne surviendront pas, mais ils les rendent beaucoup plus faciles à localiser et à corriger. Plus encore, en écrivant des tests pour des bugs qui arrivent <em>vraiment</em>, nous pouvons réduire la probabilité qu'ils surviennent.</p>

<p>(Comme noté à la <a class="ref" href="beginning#sec:comments_for_various_readers">section&nbsp;1.1.1</a>, si vous trouvez que le testing est trop écrasant, poursuivez en les sautant au cours d'une première lecture. Une fois que vous aurez une bonne saisie de Rails and Ruby, vous pourrez y revenir et apprendre le testing dans un second temps)</p>

<div class="label" id="sec:testing_tools"></div>


<h3><a id="sec:3.2.1" href="static-pages#sec:testing_tools" class="heading"><span class="number">3.2.1</span> Outils de test</a></h3>


<p>Pour écrire des tests pour notre application exemple, notre outil principal sera le framework appelé <a href="http://rspec.info/">RSpec</a>, qui est un <a href="http://en.wikipedia.org/wiki/Domain_Specific_Language"><em>langage de domaine spécifique</em></a> pour décrire le comportement du code, doublé d'un programme (appelé <code>rspec</code>) pour vérifier le comportement attendu. Conçu pour tester n'importe quel programme Ruby, RSpec a connu un regain important dans la communauté Rails. Obie Fernandez, auteur de <a href="http://www.amazon.com/gp/product/0321601661?ie=UTF8&amp;tag=httpwwwrailst-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0321601661"><em>The Rails&nbsp;3 Way</em></a>, a appelé RSpec &ldquo;&nbsp;the Rails Way&nbsp;&rdquo; («&nbsp;La manière Rails&nbsp;»), et je suis d'accord.<sup class="footnote" id="fnref:3.7"><a href="#fn:3.7">7</a></sup></p>

<p>Si vous avez suivi les étapes de l'introduction, RSpec est déjà installé via le Bundler <code>Gemfile</code> (<a class="ref" href="static-pages#code:gemfile_rspec">extrait&nbsp;3.1</a>) et la commande <code>bundle install</code>.</p>

<div class="label" id="sec:autotest"></div>


<h4><a id="sec:3.2.1.1" href="static-pages#sec:autotest" class="heading">Autotest</a></h4>


<p>Autotest est un outil qui joue en permanence votre batterie de tests en arrière-plan, basé sur sur les changements de fichiers spécifiques que vous faites. Par exemple, si vous modifiez un fichier contrôleur, Autotest jouera les tests pour ce contrôleur spécifique. Le résultat est un feedback instantané sur l'état de vos tests. Nous en apprendrons davantage sur Autotest quand nous le verrons en actions (<a class="ref" href="static-pages#sec:TDD">section&nbsp;3.2.2</a>).</p>

<p>L'installation de Autotest est optionnelle, et sa configuration peut être un peu délicate, mais si vous parvenez à le faire fonctionner sur votre système, je suis certain que vous le trouverez tout comme moi très utile. Pour installer Autotest, installez les gems <tt>autotest</tt> et <tt>autotest-rails-pure</tt><sup class="footnote" id="fnref:3.8"><a href="#fn:3.8">8</a></sup> comme suit&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install autotest -v 4.4.6
<span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install autotest-rails-pure -v 4.1.2
</pre></div>
</div>


<p>La prochaine étape dépend de votre plateforme. Je passerai par les étapes pour le système OS&nbsp;X, puisque c'est celui que j'utilise, et donnerai ensuite les références vers les posts de blog qui parlent d'Autotest sur Linus et Windows. Sur OS&nbsp;X, vous devrez <a href="http://growl.info/">installer Growl</a> (si vous ne l'avez pas déjà) et installer alors les gems <tt>autotest-fsevent</tt> et <tt>autotest-growl</tt>&nbsp;:<sup class="footnote" id="fnref:3.9"><a href="#fn:3.9">9</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install autotest-fsevent -v 0.2.4
<span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install autotest-growl -v 0.2.9
</pre></div>
</div>


<p>Si FSEvent ne s'installe pas proprement, vérifiez bien que <a href="http://developer.apple.com/technologies/tools/xcode.html">Xcode</a> est installé sur votre système.</p>

<p>Pour utilise les gems Growl et FSEvent, faite un fichier de configuration Autotest dans votre dossier Rails racine et remplissez-le avec le contenu de  <a class="ref" href="static-pages#code:dot_autotest">extrait&nbsp;3.9</a> (ou de l'<a class="ref" href="static-pages#code:dot_autotest_alt">extrait&nbsp;3.10</a> si l'<a class="ref" href="static-pages#code:dot_autotest">extrait&nbsp;3.9</a> renvoie une erreur sur votre système)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> mate .autotest
</pre></div>
</div>


<div class="label" id="code:dot_autotest"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.9.</span> <span class="description">Le fichier de configuration <code>.autotest</code> pour Autotest sur OS&nbsp;X.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;autotest/growl&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;autotest/fsevent&#39;</span>
</pre></div>
</div></div>




<div class="label" id="code:dot_autotest_alt"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.10.</span> <span class="description">Un fichier <code>.autotest</code> alternatif nécessaire sur certains systèmes.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;autotest-growl&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;autotest-fsevent&#39;</span>
</pre></div>
</div></div>


<p>(Note&nbsp;: cela créera une configuration Autotest pour l'application exemple seulement&nbsp;; si vous voulez partager cette configuration Autotest avec les autres projets Rails ou Ruby, vous devrez crér une fichier <code>.autotest</code> plutôt dans votre dossier <em>accueil</em> (<em>home</em>)&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> mate ~/.autotest
</pre></div>
</div>


<p>où <tt class="verb">~</tt> (tilde) est le symbole Unix pour le &ldquo;&nbsp;dossier home&nbsp;&rdquo;).</p>

<p>Si vous tournez sous Linux avec le bureau Gnome, vous devrez essayer les étapes décrites à l'adresse <a href="http://automate-everything.com/2009/08/gnome-and-autospec-notifications/">Automate Everything</a>, qui installe sur Linux un système semblable aux notifications Growl sur OS&nbsp;X. Les utilisateurs Windows devront essayer d'installer <a href="http://www.growlforwindows.com/gfw/">Growl pour Windows</a> et suivre ensuite les instructions de la page <a href="http://github.com/svoop/autotest-growl">GitHub pour <code>autotest-growl</code></a>. Les utilisateurs Linux tout comme les utilisateurs Windows peuvent avoir à jeter un œil à la page <a href="http://github.com/carlosbrando/autotest-notification">autotest-notification</a>&nbsp;; le lecteur du <em>Tutoriel Rails</em> Fred Schoeneman a écrit un compte-rendu intéressant sur son blog&nbsp;: <a href="http://fredschoeneman.posterous.com/pimp-your-autotest-notification">À propos des notifications Autotest</a>.<sup class="footnote" id="fnref:3.10"><a href="#fn:3.10">10</a></sup></p>

<div class="label" id="sec:TDD"></div>


<h3><a id="sec:3.2.2" href="static-pages#sec:TDD" class="heading"><span class="number">3.2.2</span> TDD&nbsp;: Rouge, Vert, Restructurer</a></h3>


<p>Dans un «&nbsp;développement conduit par le test&nbsp;» (TDD), nous écrivons d'abord un test <em>échec</em>&nbsp;: dans notre cas, une pièce de code qui exprime l'idée qu'il devrait y avoir une page «&nbsp;à propos&nbsp;» (<code>about</code>). Nous lançons alors le test, dans notre cas en ajoutant l'action <code>about</code> et la vue correspondante. La raison typique pour laquelle nous ne faisons pas l'inverse &mdash;&nbsp;l'implémentation d'abord, puis le test&nbsp;&mdash; permet de nous assurer que nous testons vraiment la fonctionnalité que nous ajoutons. Avant d'utiliser le processus TDD j'étais souvent surpris de découvrir que mes tests testaient en réalité la mauvaise chose, quand ils ne testaient tout simplement rien du tout. En s'assurant que, dans un premier temps, le test conduit à un échec et <em>ensuite</em> réussit, nous pouvons être plus confiant sur le fait que nous accomplissons le bon test.</p>

<p>Il est important de comprendre que TDD n'est pas toujours le bon outil pour accomplir le travail. En particulier, quand vous n'êtes pas sûr du tout de comment résoudre un problème de programmation donné, il est souvent utile de laisser tomber les tests et d'écrire seulement le code de l'application, juste pour sentir à quoi la solution pourrait ressembler (dans le langage de l''<a href="http://en.wikipedia.org/wiki/Extreme_Programming">Extreme Programming (XP)</a>, cette étape d'exploration est appelée  une <em>spike</em> &mdash;&nbsp;une «&nbsp;pointe&nbsp;», un gros clou). Une fois que vous avez trouvé la forme générale de la solution, vous pouvez alors utiliser TDD pour implémenter une version plus efficiente.</p>

<p>Une façon de procéder au développement conduit par le test est un cycle connu sous le terme &ldquo;&nbsp;Rouge, Vert, Restructurer&nbsp;&rdquo;. La première étape, le Rouge, se réfère à l'écriture d'un test conduisant à l'échec, que de nombreux outils de test indiquent avec la couleur rouge. L'étape suivante, Vert, se réfère à un test conduit à la réussite, indiqué par la couleur (attendue) verte. Une fois que nous avons un test qui réussit (ou une batterie de tests), nous sommes libre de <em>restructurer</em> notre code, d'en changer la forme (en éliminant les répétitions par exemple) sans changer la fonction.</p>

<p>Nous n'avons pas encore de couleur, donc commençons par le Rouge. RSpec (et le testing en général) peut être intimidant dans un premier temps, donc nous allons utiliser les tests générés par les <code>rails generate controller Pages</code> (les <em>Pages de génération de contrôleur de Rails</em>) de l'<a class="ref" href="static-pages#code:generating_pages">extrait&nbsp;3.4</a> pour commencer. Puisque je ne suis pas partisan de séparer les tests pour les Vues de ceux pour les Helpers, ce que j'ai trouvé soit fragile soit redondant, notre première étape va consister à les effacer. Si vous utilisez Git, vous pouvez le faire comme suit&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git rm -r spec/views
<span class="gp">$</span> git rm -r spec/helpers
</pre></div>
</div>


<p>Dans le cas contraire, supprimez-les directement&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rm -rf spec/views
<span class="gp">$</span> rm -rf spec/helpers
</pre></div>
</div>


<p>Nous allons traiter les tests pour les Vues et les Helpers directement dans les tests du contrôleur commençant à la <a class="ref" href="static-pages#sec:slightly_dynamic_pages">section&nbsp;3.3</a>.</p>

<p>Pour commencer avec RSpec, jetez un œil aux spécifications du contrôleurs  Pages<sup class="footnote" id="fnref:3.11"><a href="#fn:3.11">11</a></sup> que nous venons de générer (<a class="ref" href="static-pages#code:default_pages_controller_spec">extrait&nbsp;3.11</a>).</p>

<div class="label" id="code:default_pages_controller_spec"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.11.</span> <span class="description">Les spécifications du contrôleur Pages généré. <br /> <code>spec/controllers/pages_controller_spec.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;contact&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Ce code est en pur Ruby, mais même si vous avez étudié Ruby précédemment il ne vous semblera pas très familier. C'est parce que RSpec utilise la malléabilité de Ruby pour définir son propre <em>langage de dommaine</em> (<em>domain-specific language</em> (DSL)) construit juste pour le testing. Le point important ici est que <em>vous n'avez pas besoin de comprendre la syntaxe RSpec pour pouvoir utiliser RSpec</em>. Ça peut sembler magique dans un premier temps, mais RSpec est conçu pour se lire plus ou moins comme de l'anglais, et si vous suivez les exemples du script généré et les autres exemples de ce tutoriel, [(you&rsquo;ll pick it up fairly quickly)(vous le percevrez rapidement bien)].</p>

<p>L''<a class="ref" href="static-pages#code:default_pages_controller_spec">extrait&nbsp;3.11</a> contient deux blocs descriptifs (<code>describe</code> blocks), chacun avec un <em>exemple</em> (par exemple un bloc commençant avec <code>it "&hellip;" do</code> &mdash;&nbsp;<code>il "…" fait</code>). Concentrons-nous sur le premier pour sentir ce qu'il fait&nbsp;:</p>

<div class="code"><div class="highlight"><pre>  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;devrait réussir&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>
</div>


<p>La première ligne indique que nous décrivons (<em>describe</em>) un opération <tt>GET</tt> pour l'action <code>home</code>. C'est juste une description, et ça peut être ce que vous voulez&nbsp;; RSpec s'en fiche, mais vous ou d'autres lecteurs humains probablement pas. Dans ce cas, <code>"GET &rsquo;home&rsquo;"</code> indique que le test correspond à une requête HTTP <tt>GET</tt>, comme discutée dans le <a class="ref" href="static-pages#sidebar:get_etc">Box&nbsp;3.1</a>. Alors la spécification dit que lorsque vous visitez la page d'accueil, cela devrait réussir. Comme avec la première ligne, ce qui vient à l'intérieur des guillemets n'intéresse pas de RSpec, n'est pertinent qu'aux lecteurs humains. La troisième ligne, <code>get &rsquo;home&rsquo;</code>, est la première ligne qui véritablement accomplit quelque chose. À l'intérieur de RSpec, cette ligne <em>soumet vraiment une requête GET</em>&nbsp;; en d'autres termes, elle agit comme un navigateur et pointe vers la page, dans ce cas <tt>/pages/home</tt> (il sait automatiquement qu'il doit toucher le contrôleur Pages puisque c'est un test de ce contrôleur Pages&nbsp;; il sait qu'il doit atteindre la page d'accueil parce que nous lui disons explicitement). Enfin, la quatrième ligne dit que la <em>réponse</em> (<em>response</em>) de notre application devrait indiquer un succès (elle devrait par exemple retourner un <em>code d'état</em> de <tt>200</tt>&nbsp;; voir <a class="ref" href="static-pages#sidebar:response_codes">Box&nbsp;3.2</a>).</p>

<div class="label" id="sidebar:response_codes"></div>


<div class="sidebar"><span class="title"><span class="header">Box 3.2.</span><span class="description">Codes de réponse HTTP</span></span>
<p>Après qu'un client (tel qu'un navigateur web) envoie une requête correspondant à un des verbes HTTP (<a class="ref" href="static-pages#sidebar:get_etc">Box&nbsp;3.1</a>), le serveur web <em>répond</em> par un code numérique indiquant le <a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes">statut HTTP</a> de la réponse. Par exemple, un code d'état de <tt>200</tt> signifie la réussite et un code d'état de 301 signifie une &ldquo;&nbsp;redirection permanente&nbsp;&rdquo;. Si vous avez <a href="http://www.google.com/search?q=install+curl">installé <tt>curl</tt></a>, un client en ligne de commande qui peut traiter les requêtes HTTP, vous pouvez voir cela directement à, par exemple, <tt>www.google.com</tt> (où les drapeaux <tt class="verb">--head</tt> empêchent <code>curl</code> de retourner la page complète)&nbsp;:</p>

<pre class="verbatim">  $ curl --head www.google.fr
  HTTP/1.1 200 OK
  .
  .
  .</pre>


<p>Ici Google indique que la requête a été exécutée avec succès en retournant le code d'état <tt>200&nbsp;OK</tt>. <em>A contrario</em>, <tt>google.com</tt> est redirigé de façon permanente (vers <tt>www.google.com</tt>, naturellement), indiquant un code d'état <tt>301</tt> (une &ldquo;&nbsp;redirection <tt>301</tt> redirect&nbsp;&rdquo;)&nbsp;:</p>

<pre class="verbatim">  $ curl --head google.com
  HTTP/1.1 301 Moved Permanently
  Location: http://www.google.com/
  .
  .
  .</pre>


<p>(<em>Note&nbsp;:</em> le résultat retourné ci-dessus peut varier légèrement suivant les pays)</p>

<p>Quand nous écrivons <code>response.should be_success</code> (<em>la_réponse.devrait_être_un_succès</em>) dans un test RSpec, RSpec vérifie que la réponse de notre application à la requête est un code d'état de <tt>200</tt>.</p>
</div>


<p>Il est temps maintenant de faire jouer nos tests. Il existe plusierurs façons différentes et équivalentes de le faire.<sup class="footnote" id="fnref:3.12"><a href="#fn:3.12">12</a></sup> Une façon de jouer tous les tests consiste à utiliser le script <code>rspec</code> en ligne de commande comme suit&nbsp;:<sup class="footnote" id="fnref:3.13"><a href="#fn:3.13">13</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
<span class="go">....</span>

<span class="go">Finished in 0.07252 seconds</span>

<span class="go">2 examples, 0 failures</span>
</pre></div>
</div>


<p>Sur certains système (spécialement ceux utilisant l'invite de commande Windows), vous pourriez avoir un message d'erreur à ce stade indiquant des difficultés à trouver le programme <code>rspec</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="go">C:\Sites\sample_app&gt;rspec spec/</span>
<span class="go">&#39;rspec&#39; is not recognized as an internal or external command,</span>
<span class="go">operable program or batch file.</span>
</pre></div>
</div>


<p>Dans ce cas, vous aurez besoin d'exécuter <code>rspec</code> par le Bundler en utilisant la commande <code>bundle exec</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="go">C:\Sites\sample_app&gt;bundle exec rspec spec/</span>
<span class="go">....</span>

<span class="go">Finished in 0.07252 seconds</span>
<span class="go">2 examples, 0 failures</span>
</pre></div>
</div>


<p>Malheureusement, de nombreuses autres choses peuvent mal tourner à ce niveau. Si un test échoue, assurez-vous d'avoir bien migré la base de données avec <code>rake db:migrate</code> comme cela est décrit à la <a class="ref" href="beginning#sec:rails_server">section&nbsp;1.2.5</a>. Si RSpec ne fonctionne pas du tout, essayez de le désinstaller et de le ré-installer&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> gem uninstall rspec rspec-rails
<span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Si ça ne fonctionne toujours pas et que vous utilisez <a href="http://rvm.beginrescueend.com/">RVM</a>, essayez de supprimer le gemset du tutoriel Rails et de ré-installer les gems&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm gemset delete rails3tutorial
<span class="gp">$</span> rvm --create use 1.9.2@rails3tutorial
<span class="gp">$</span> rvm --default 1.9.2@rails3tutorial
<span class="gp">$</span> gem install rails -v 3.0.7
<span class="gp">$</span> bundle install
</pre></div>
</div>


<p>(Si ça continue de ne pas fonctionner… je suis à court d'idées.)</p>

<p>En jouant <code>rspec spec/</code>, <code>rspec</code> est un programme fourni par RSpec, tandis que <code>spec/</code> est le <em>dossier</em> où vous voulez que specs s'exécute. Vous pouvez également jouer seulement les specs dans un sous-dossier particulier. Par exemple, la commande suivante joue uniquement ls specs des contrôleurs&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/controllers/
<span class="go">....</span>
<span class="go">Finished in 0.07502 seconds</span>

<span class="go">2 examples, 0 failures</span>
</pre></div>
</div>


<p>Vous pouvez aussi jouer seulement un fichier&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/controllers/pages_controller_spec.rb
<span class="go">....</span>
<span class="go">Finished in 0.07253 seconds</span>

<span class="go">2 examples, 0 failures</span>
</pre></div>
</div>


<p>Le résultat de ces trois commandes est le même puisque le spec du contrôleur Pages est actuellement notre seul fichier de test. Au cours de la suite de ce livre, je ne montrerai pas toujours la sortie du testing, mais vous devrez jouer <code>rspec spec/</code> (ou une de ses variantes) régulièrement en poursuivant &mdash;&nbsp;ou, même mieux, utiliser Autotest pour jouer automatiquement la batterie de tests. En parlant de ça&hellip;</p>

<p>Si vous avez intallés Autotest, vous pouvez le faire travailler sur vos tests RSpec en utilisant la command <code>autotest</code>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> autotest
</pre></div>
</div>


<p>Si cela ne fonctionne pas, essayez&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>autotest
</pre></div>
</div>


<p>Si vous utilisez un Mac avec les notifications Growl activées, vous devirez pouvoir répliquer mes réglages montrés dans l'<a class="ref" href="static-pages#fig:autotest_green">illustration&nbsp;3.6</a>. Avec Autotest jouant en arrière-tâche et les notifications Growl vous disant l'état de vos tests, vous pourriez bien devenir accro du développement TDD.</p>

<div class="label" id="fig:autotest_green"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/autotest_green.png" alt="autotest_green" /></span></div><div class="caption"><span class="header">Illustration 3.6: </span><span class="description">Autotest (via <code>autotest</code>) en action avec les notifications Growl.&nbsp;<a href="http://railstutorial.org/images/figures/autotest_green-full.png">(taille normale)</a></span></div></div>




<div class="label" id="sec:spork"></div>


<h4><a id="sec:3.2.2.1" href="static-pages#sec:spork" class="heading">Spork</a></h4>


<p>Vous avez peut-être noté que les [(ressources)(overhead)] liées à la gestion d'une batterie de test peuvent être considérables. Cela s'explique du fait que chaque fois que RSpec joue les tests il doit recharger tout l'environnement Rails. Le <a href="http://github.com/timcharper/spork">serveur de test Spork</a><sup class="footnote" id="fnref:3.14"><a href="#fn:3.14">14</a></sup> a pour but de régler ce problème. Spork charge <em>une seule fois</em> l'environnement, et maintient alors un pool de processus pour jouer les prochains tests. Spork est particulièrement utile quand il est combiné à Autotest.</p>

<p>Configurer et faire fonctionner Spork peut être difficile, et c'est un sujet de niveau plutôt avancé. <strong>Si vous vous sentez dépassé, n'hésitez pas à passer cette section.</strong></p>

<p>La première étape consiste à ajouter la dépendance gem <tt>spork</tt> au <code>Gemfile</code> (<a class="ref" href="static-pages#code:gemfile_spork">extrait&nbsp;3.12</a>).</p>

<div class="label" id="code:gemfile_spork"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.12.</span> <span class="description">Un <code>Gemfile</code> pour l'application exemple.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.7&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3-ruby&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.2&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s1">&#39;sqlite3&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.5.0&#39;</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec&#39;</span><span class="p">,</span> <span class="s1">&#39;2.5.0&#39;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">gem</span> <span class="s1">&#39;spork&#39;</span><span class="p">,</span> <span class="s1">&#39;0.9.0.rc5&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Ensuite, installez-le&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Ensuite, amorcer la configuration Spork&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> spork --bootstrap
</pre></div>
</div>


<p>Maintenant nous devons éditer le fichier de configuration RSpec, <code>spec/spec_helper.rb</code>, pour que l'environnement soit chargé dans le bloc <em>prefork</em>, pour n'avoir à le charger qu'une seule fois (<a class="ref" href="static-pages#code:spork_spec_helper">extrait&nbsp;3.13</a>). <em>Note&nbsp;:</em> utilisez seulement ce code si vous utilisez Spork. Si vous essayez d'utiliser l''<a class="ref" href="static-pages#code:spork_spec_helper">extrait&nbsp;3.13</a> sans Spork, la suite de test de votre application ne fonctionnera pas.</p>

<div class="label" id="code:spork_spec_helper"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.13.</span> <span class="description">Ajout du chargement de l'environnement dans le bloc <code>Spork.prefork</code>. <br /> <code>spec/spec_helper.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spork&#39;</span>

<span class="no">Spork</span><span class="o">.</span><span class="n">prefork</span> <span class="k">do</span>
  <span class="c1"># En charger plus dans ce bloc accélèrera les test. Cependant, </span>
  <span class="c1"># si vous changez de configuration ou le code des librairies chargées ici, vous</span>
  <span class="c1"># devrez redémarrer spork.</span>
  <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;RAILS_ENV&quot;</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">&#39;test&#39;</span>
  <span class="nb">require</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;../../config/environment&quot;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
  <span class="nb">require</span> <span class="s1">&#39;rspec/rails&#39;</span>

  <span class="c1"># Requires supporting files with custom matchers and macros, etc,</span>
  <span class="c1"># in ./support/ and its subdirectories.</span>
  <span class="no">Dir</span><span class="o">[</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;spec/support/**/*.rb&quot;</span><span class="p">)</span><span class="o">].</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="nb">require</span> <span class="n">f</span><span class="p">}</span>

  <span class="no">Rspec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
    <span class="c1"># == Mock Framework</span>
    <span class="c1">#</span>
    <span class="c1"># If you prefer to use mocha, flexmock or RR, uncomment the appropriate line:</span>
    <span class="c1">#</span>
    <span class="c1"># config.mock_with :mocha</span>
    <span class="c1"># config.mock_with :flexmock</span>
    <span class="c1"># config.mock_with :rr</span>
    <span class="n">config</span><span class="o">.</span><span class="n">mock_with</span> <span class="ss">:rspec</span>

    <span class="n">config</span><span class="o">.</span><span class="n">fixture_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="o">::</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/spec/fixtures&quot;</span>

    <span class="c1"># If you&#39;re not using ActiveRecord, or you&#39;d prefer not to run each of your</span>
    <span class="c1"># examples within a transaction, comment the following line or assign false</span>
    <span class="c1"># instead of true.</span>
    <span class="n">config</span><span class="o">.</span><span class="n">use_transactional_fixtures</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Spork</span><span class="o">.</span><span class="n">each_run</span> <span class="k">do</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Avant de lancer Spork, nous pouvons obtenir une référence du temps que prend notre batterie de tests comme suit&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">time </span>rspec spec/
<span class="go">..</span>


<span class="go">Finished in 0.09606 seconds</span>
<span class="go">2 examples, 0 failures</span>

<span class="go">real    0m7.445s</span>
<span class="go">user    0m5.248s</span>
<span class="go">sys     0m1.475s</span>
</pre></div>
</div>


<p>Ici la suite de test prend plus de sept secondes pour être exécuté même si les tests effectifs jouent en moins d'une dizaine de secondes. Pour accélérer cela, nous pouvons ouvrir une fenêtre terminal dédiée aux tests, naviguer vers le dossier Rails racine, et démarrer un serveur Spork&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> spork
<span class="go">Using RSpec</span>
<span class="go">Loading Spork.prefork block...</span>
<span class="go">Spork is ready and listening on 8989!</span>
</pre></div>
</div>


<p>Dans une autre fenêtre Terminal, nous pouvons maintenant lancer notre batterie de tests avec l'option <tt class="verb">--drb</tt> <sup class="footnote" id="fnref:3.15"><a href="#fn:3.15">15</a></sup> et vérifier que le temps de chargement de l'environnement est considérablement réduit&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">time </span>rspec --drb spec/
<span class="go">..</span>


<span class="go">Finished in 0.10519 seconds</span>
<span class="go">2 examples, 0 failures</span>

<span class="go">real    0m0.803s</span>
<span class="go">user    0m0.354s</span>
<span class="go">sys     0m0.171s</span>
</pre></div>
</div>


<p>Comme attendu, les temps ont été considérablement réduits.</p>

<p>Pour lancer RSpec et Spork avec Autotest, nous avons besoin de configurer RSpec pour utiliser l'option <tt class="verb">--drb</tt> par défaut, ce que nous pouvons faire en l'ajoutant au fichier de configuration <code>.rspec</code> dans le dossier racine de Rails (<a class="ref" href="static-pages#code:dot_rspec">extrait&nbsp;3.14</a>).</p>

<div class="label" id="code:dot_rspec"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.14.</span> <span class="description">Ajout de l'option <tt class="verb">--drb</tt> au fichier <code>.rspec</code>.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="o">--</span><span class="n">colour</span>
<span class="o">--</span><span class="n">drb</span>
</pre></div>
</div></div>


<p>Avec ce fichier <code>.rspec</code> actualisé, la suite de tests devrait fonctionner aussi vite que précédemment, même sans l'option explicite <tt class="verb">--drb</tt>&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">time </span>rspec spec/
<span class="go">..</span>


<span class="go">Finished in 0.10926 seconds</span>
<span class="go">2 examples, 0 failures</span>

<span class="go">real    0m0.803s</span>
<span class="go">user    0m0.355s</span>
<span class="go">sys     0m0.171s</span>
</pre></div>
</div>


<p>Bien entendu, jouer <code>time</code> ici n'a de sens que pour l'illustration&nbsp;; normalement, vous avez juste à jouer&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
</pre></div>
</div>


<p>ou</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> autotest
</pre></div>
</div>


<p>sans la commande <code>time</code>.</p>

<p>Un petit conseil quand vous utilisez Spork&nbsp;: si vos tests échouent quand vous pensez qu'ils devraient réussir, le problème peut venir du chargement du <em>prefork</em> de Spork, qui peut parfois empêcher le chargement de certains fichiers utiles. Dans le doute, quittez alors le serveur Spok (avec <tt>Control-C</tt>) et relancez-le&nbsp;:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> spork
<span class="go">Using RSpec</span>
<span class="go">Loading Spork.prefork block...</span>
<span class="go">Spork is ready and listening on 8989!</span>
<span class="go">^C</span>
<span class="gp">$</span> spork
</pre></div>
</div>


<!-- FIN FRENCH -->

<div class="label" id="sec:red"></div>


<h4><a id="sec:3.2.2.2" href="static-pages#sec:red" class="heading">Red</a></h4>


<p>Now let&rsquo;s get to Red part of the Red-Green cycle by writing a failing test for the <code>about</code> page. Following the models from <a class="ref" href="static-pages#code:default_pages_controller_spec">extrait&nbsp;3.11</a>, you can probably guess the right test (<a class="ref" href="static-pages#code:failing_about_page">extrait&nbsp;3.15</a>).</p>

<div class="label" id="code:failing_about_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.15.</span> <span class="description">The Pages controller spec with a failing test for the About page. <br /> <code>spec/controllers/pages_controller_spec.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>
  <span class="n">render_views</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;contact&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;about&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Note that we&rsquo;ve added a line to tell RSpec to <em>render the views</em> inside the controller tests. In other words, by default RSpec just tests actions inside a controller test; if we want it also to render the views, we have to tell it explicitly via the second line:</p>

<div class="code"><div class="highlight"><pre><span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>
  <span class="n">render_views</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
</pre></div>
</div>


<p>This ensures that if the test passes, the page is really there.</p>

<p>The new test attempts to <code>get</code> the <code>about</code> action, and indicates that the resulting response should be a success. By design, it fails (with a red error message), as seen in <a class="ref" href="static-pages#fig:rspec_spec_red">illustration&nbsp;3.7</a> (<code>rspec spec/</code>) and <a class="ref" href="static-pages#fig:autotest_red">illustration&nbsp;3.8</a> (<code>autotest</code>). (If you test the views in the controllers as recommended in this tutorial, it&rsquo;s worth noting that changing the view file won&rsquo;t prompt Autotest to run the corresponding controller test. There&rsquo;s probably a way to configure Autotest to do this automatically, but usually I just switch to the controller and press &ldquo;space-backspace&rdquo; so that the file gets marked as modified. Saving the controller then causes Autotest to run the tests as desired.)</p>

<div class="label" id="fig:rspec_spec_red"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/rspec_spec_red.png" alt="rspec_spec_red" /></span></div><div class="caption"><span class="header">Illustration 3.7: </span><span class="description">Failing spec for the About page using <code>rspec spec/</code>.&nbsp;<a href="http://railstutorial.org/images/figures/rspec_spec_red-full.png">(taille normale)</a></span></div></div>




<div class="label" id="fig:autotest_red"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/autotest_red.png" alt="autotest_red" /></span></div><div class="caption"><span class="header">Illustration 3.8: </span><span class="description">Failing spec for the About page using Autotest.&nbsp;<a href="http://railstutorial.org/images/figures/autotest_red-full.png">(taille normale)</a></span></div></div>


<p>This is Red. Now let&rsquo;s get to Green.</p>

<div class="label" id="sec:green"></div>


<h4><a id="sec:3.2.2.3" href="static-pages#sec:green" class="heading">Green</a></h4>


<p>Recall from <a class="ref" href="static-pages#sec:static_pages_with_rails">section&nbsp;3.1.2</a> that we can generate a static page in Rails by creating an action and corresponding view with the page&rsquo;s name. In our case, the About page will first need an action called <code>about</code> in the Pages controller. Having written a failing test, we can now be confident that, in getting it to pass, we will actually have created a working <code>about</code> page.</p>

<p>Following the models provided by <code>home</code> and <code>contact</code> from <a class="ref" href="static-pages#code:pages_controller">extrait&nbsp;3.6</a>, let&rsquo;s first add an <code>about</code> action in the Pages controller (<a class="ref" href="static-pages#code:adding_the_about_page">extrait&nbsp;3.16</a>).</p>

<div class="label" id="code:adding_the_about_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.16.</span> <span class="description">The Pages controller with added <code>about</code> action. <br /> <code>app/controllers/pages_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">about</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Next, we&rsquo;ll add the <code>about</code> action to the routes file (<a class="ref" href="static-pages#code:about_route">extrait&nbsp;3.17</a>).</p>

<div class="label" id="code:about_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.17.</span> <span class="description">Adding the <code>about</code> route. <br /> <code>config/routes.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="no">SampleApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;pages/home&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;pages/contact&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;pages/about&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Finally, we&rsquo;ll add the <code>about</code> view. Eventually we&rsquo;ll fill it with something more informative, but for now we&rsquo;ll just mimic the content from the generated views (<a class="ref" href="static-pages#code:raw_home_view">extrait&nbsp;3.7</a> and <a class="ref" href="static-pages#code:raw_contact_view">extrait&nbsp;3.8</a>) for the <code>about</code> view (<a class="ref" href="static-pages#code:raw_about_view">extrait&nbsp;3.18</a>).</p>

<div class="label" id="code:raw_about_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.18.</span> <span class="description">A stub About page. <br /> <code>app/views/pages/about.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Pages#about<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/pages/about.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>Running the specs or watching the update from Autotest (<a class="ref" href="static-pages#fig:autotest_back_to_green">illustration&nbsp;3.9</a>) should get us back to Green:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
</pre></div>
</div>


<div class="label" id="fig:autotest_back_to_green"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/autotest_back_to_green.png" alt="autotest_back_to_green" /></span></div><div class="caption"><span class="header">Illustration 3.9: </span><span class="description">Autotest back to Green: All tests passing.&nbsp;<a href="http://railstutorial.org/images/figures/autotest_back_to_green-full.png">(taille normale)</a></span></div></div>


<p>Of course, it&rsquo;s never a bad idea to take a look at the page in a browser to make sure our tests aren&rsquo;t completely crazy (<a class="ref" href="static-pages#fig:raw_about_page">illustration&nbsp;3.10</a>).</p>

<div class="label" id="fig:raw_about_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/raw_about_page.png" alt="raw_about_page" /></span></div><div class="caption"><span class="header">Illustration 3.10: </span><span class="description">The new (and rather raw) About page (<a href="http://localhost:3000/pages/about"><tt>/pages/about</tt></a>).&nbsp;<a href="http://railstutorial.org/images/figures/raw_about_page-full.png">(taille normale)</a></span></div></div>




<div class="label" id="sec:refactor"></div>


<h4><a id="sec:3.2.2.4" href="static-pages#sec:refactor" class="heading">Refactor</a></h4>


<p>Now that we&rsquo;re at Green, we are free to <em>refactor</em> our code by changing its form without changing its function. Oftentimes code will start to &ldquo;smell&rdquo;, meaning that it gets ugly, bloated, or filled with repetition.  The computer doesn&rsquo;t care, of course, but humans do, so it is important to keep the code base clean by refactoring frequently. Having a good (passing!) test suite is an invaluable tool in this regard, as it dramatically lowers the probability of introducing bugs while refactoring.</p>

<p>Our sample app is a little too small to refactor right now, but code smell seeps in at every crack, so we won&rsquo;t have to wait long: we&rsquo;ll already get busy refactoring in <a class="ref" href="static-pages#sec:instance_variables_embedded_ruby">section&nbsp;3.3.3</a> of this chapter.</p>

<div class="label" id="sec:slightly_dynamic_pages"></div>


<h2><a id="sec:3.3" href="static-pages#sec:slightly_dynamic_pages" class="heading"><span class="number">3.3</span> Slightly dynamic pages</a></h2>


<p>Now that we&rsquo;ve created the actions and views for some static pages, we&rsquo;ll make them <em>very slightly</em> dynamic by adding some content that changes on a per-page basis: we&rsquo;ll have the title of each page change to reflect its content. Whether this represents <em>truly</em> dynamic content is debatable, but in any case it lays the necessary foundation for unambiguously dynamic content in <a class="ref" href="sign-up#top">chapitre&nbsp;8</a>.</p>

<p>(If you skipped the TDD material in <a class="ref" href="static-pages#sec:first_tests">section&nbsp;3.2</a>, be sure to create an About page at this point using the code from <a class="ref" href="static-pages#code:adding_the_about_page">extrait&nbsp;3.16</a>, <a class="ref" href="static-pages#code:about_route">extrait&nbsp;3.17</a>, and <a class="ref" href="static-pages#code:raw_about_view">extrait&nbsp;3.18</a>.)</p>

<div class="label" id="sec:testing_a_title_change"></div>


<h3><a id="sec:3.3.1" href="static-pages#sec:testing_a_title_change" class="heading"><span class="number">3.3.1</span> Testing a title change</a></h3>


<p>Our plan is to edit the Home, Contact, and About pages to add the kind of HTML structure we saw in <a class="ref" href="static-pages#code:hello_world">extrait&nbsp;3.3</a>, including titles that change on each page. It&rsquo;s a delicate matter to decide just which of these changes to test, and in general testing HTML can be quite fragile since content tends to change frequently. We&rsquo;ll keep our tests simple by just testing for the page titles.</p>

<div class="label" id="table:static_pages"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_center"><strong>Page</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Base title</strong></th><th class="align_left"><strong>Variable title</strong></th></tr><tr class="top_bar"><td class="align_center">Home</td><td class="align_left"><tt>/pages/home</tt></td><td class="align_left"><code>"Ruby on Rails Tutorial Sample App"</code></td><td class="align_left"><code>" | Home"</code></td></tr><tr><td class="align_center">Contact</td><td class="align_left"><tt>/pages/contact</tt></td><td class="align_left"><code>"Ruby on Rails Tutorial Sample App"</code></td><td class="align_left"><code>" | Contact"</code></td></tr><tr><td class="align_center">About</td><td class="align_left"><tt>/pages/about</tt></td><td class="align_left"><code>"Ruby on Rails Tutorial Sample App"</code></td><td class="align_left"><code>" | About"</code></td></tr></table></div><div class="caption"><span class="header">Table 3.1: </span><span class="description">The (mostly) static pages for the sample app.</span></div></div>


<p>By the end of this section, all three of our static pages will have titles of the form &ldquo;Ruby on Rails Tutorial Sample App | Home&rdquo;, where the last part of the title will vary depending on the page (<a class="ref" href="static-pages#table:static_pages">Table&nbsp;3.1</a>). We&rsquo;ll build on the tests in <a class="ref" href="static-pages#code:failing_about_page">extrait&nbsp;3.15</a>, adding title tests following the model in <a class="ref" href="static-pages#code:title_test">extrait&nbsp;3.19</a>.</p>

<div class="label" id="code:title_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.19.</span> <span class="description">A title test.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
  <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Home&quot;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>This uses the <code>have_selector</code> method inside RSpec; the documentation for <code>have_selector</code> is surprisingly sparse, but what it does is to check for an HTML element (the &ldquo;selector&rdquo;) with the given content. In other words, the code</p>

<div class="code"><div class="highlight"><pre><span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                  <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Home&quot;</span><span class="p">)</span>
</pre></div>
</div>


<p>checks to see that the content inside the <tt class="verb">&lt;title&gt;&lt;/title&gt;</tt> tags is <code>"Ruby on Rails Tutorial Sample App | Home"</code>.<sup class="footnote" id="fnref:3.16"><a href="#fn:3.16">16</a></sup> It&rsquo;s worth mentioning that the content need not be an exact match; any substring works as well, so that</p>

<div class="code"><div class="highlight"><pre><span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s2">&quot; | Home&quot;</span><span class="p">)</span>
</pre></div>
</div>


<p>will also match the full title.<sup class="footnote" id="fnref:3.17"><a href="#fn:3.17">17</a></sup></p>

<p>Note that in <a class="ref" href="static-pages#code:title_test">extrait&nbsp;3.19</a> I&rsquo;ve broken the material inside <code>have_selector</code> into two lines; this tells you something important about Ruby syntax: Ruby doesn&rsquo;t care about newlines.<sup class="footnote" id="fnref:3.18"><a href="#fn:3.18">18</a></sup> The <em>reason</em> I chose to break the code into pieces is that I prefer to keep lines of source code under 80 characters for legibility.<sup class="footnote" id="fnref:3.19"><a href="#fn:3.19">19</a></sup> As it stands, I still find this code formatting rather ugly; <a class="ref" href="static-pages#sec:static_pages_exercises">section&nbsp;3.5</a> has a refactoring exercise that makes them much prettier.<sup class="footnote" id="fnref:3.20"><a href="#fn:3.20">20</a></sup></p>

<p>Adding new tests for each of our three static pages following the model of <a class="ref" href="static-pages#code:title_test">extrait&nbsp;3.19</a> gives us our new Pages controller spec (<a class="ref" href="static-pages#code:pages_controller_spec_title">extrait&nbsp;3.20</a>).</p>

<div class="label" id="code:pages_controller_spec_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.20.</span> <span class="description">The Pages controller spec with title tests. <br /> <code>spec/controllers/pages_controller_spec.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>
  <span class="n">render_views</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                        <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Home&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;contact&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                        <span class="ss">:content</span> <span class="o">=&gt;</span>
                          <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;about&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                        <span class="ss">:content</span> <span class="o">=&gt;</span>
                          <span class="s2">&quot;Ruby on Rails Tutorial Sample App | About&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Note that the <code>render_views</code> line introduced in <a class="ref" href="static-pages#code:failing_about_page">extrait&nbsp;3.15</a> is necessary for the title tests to work.</p>

<p>With these tests in place, you should run</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
</pre></div>
</div>


<p>or use Autotest to verify that our code is now Red (failing tests).</p>

<div class="label" id="sec:passing_title_tests"></div>


<h3><a id="sec:3.3.2" href="static-pages#sec:passing_title_tests" class="heading"><span class="number">3.3.2</span> Passing title tests</a></h3>


<p>Now we&rsquo;ll get our title tests to pass, and at the same time add the full HTML structure needed to make valid web pages. Let&rsquo;s start with the Home page (<a class="ref" href="static-pages#code:home_view_full_html">extrait&nbsp;3.21</a>), using the same basic HTML skeleton as in the &ldquo;hello&rdquo; page from <a class="ref" href="static-pages#code:hello_world">extrait&nbsp;3.3</a>.</p>

<p><em>Note:</em> In Rails&nbsp;3, the controller generator creates a <em>layout</em> file, whose purpose we will explain shortly, but which for now you should remove before proceeding:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rm app/views/layouts/application.html.erb
</pre></div>
</div>


<div class="label" id="code:home_view_full_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.21.</span> <span class="description">The view for the Home page with full HTML structure. <br /> <code>app/views/pages/home.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | Home<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Sample App<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      This is the home page for the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
      sample application.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p><a class="ref" href="static-pages#code:home_view_full_html">extrait&nbsp;3.21</a> uses the title tested for in <a class="ref" href="static-pages#code:pages_controller_spec_title">extrait&nbsp;3.20</a>:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | Home<span class="nt">&lt;/title&gt;</span>
</pre></div>
</div>


<p>As a result, the tests for the Home page should now pass. We&rsquo;re still Red because of the failing Contact and About tests, and we can get to Green with the code in <a class="ref" href="static-pages#code:contact_view_full_html">extrait&nbsp;3.22</a> and <a class="ref" href="static-pages#code:about_view_full_html">extrait&nbsp;3.23</a>.</p>

<div class="label" id="code:contact_view_full_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.22.</span> <span class="description">The view for the Contact page with full HTML structure. <br /> <code>app/views/pages/contact.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | Contact<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      Contact Ruby on Rails Tutorial about the sample app at the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/feedback&quot;</span><span class="nt">&gt;</span>feedback page<span class="nt">&lt;/a&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:about_view_full_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.23.</span> <span class="description">The view for the About page with full HTML structure. <br /> <code>app/views/pages/about.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | About<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>About Us<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
      is a project to make a book and screencasts to teach web development
      with <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. This
      is the sample application for the tutorial.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>These example pages introduce the <em>anchor</em> tag&nbsp;<code>a</code>, which creates links to the given URL (called an &ldquo;href&rdquo;, or &ldquo;hypertext reference&rdquo;, in the context of an anchor tag):</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>


<p>You can see the results in <a class="ref" href="static-pages#fig:new_home_page">illustration&nbsp;3.11</a>.</p>

<div class="label" id="fig:new_home_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/new_home_page.png" alt="new_home_page" /></span></div><div class="caption"><span class="header">Illustration 3.11: </span><span class="description">A minimal Home page for the sample app (<a href="http://localhost:3000/pages/home"><tt>/pages/home</tt></a>).&nbsp;<a href="http://railstutorial.org/images/figures/new_home_page-full.png">(taille normale)</a></span></div></div>




<div class="label" id="sec:instance_variables_embedded_ruby"></div>


<h3><a id="sec:3.3.3" href="static-pages#sec:instance_variables_embedded_ruby" class="heading"><span class="number">3.3.3</span> Instance variables and Embedded Ruby</a></h3>


<p>We&rsquo;ve achieved a lot already in this section, generating three valid pages using Rails controllers and actions, but they are purely static HTML and hence don&rsquo;t show off the power of Rails. Moreover, they suffer from terrible duplication:</p>

<ul>
<li>The page titles are almost (but not quite) exactly the same.</li>
<li>&ldquo;Ruby on Rails Tutorial Sample App&rdquo; is common to all three titles.</li>
<li>The entire HTML skeleton structure is repeated on each page.</li>
</ul>


<p>This repeated code is a violation of the important &ldquo;Don&rsquo;t Repeat Yourself&rdquo; (DRY) principle; in this section and the next we&rsquo;ll &ldquo;DRY out our code&rdquo; by removing the repetition.</p>

<p>Paradoxically, we&rsquo;ll take the first step toward eliminating duplication by first adding some more: we&rsquo;ll make the titles of the pages, which are currently quite similar, match <em>exactly</em>. This will make it much simpler to remove all the repetition at a stroke.</p>

<p>The technique involves creating <em>instance variables</em> inside our actions. Since the Home, Contact, and About page titles have a variable component, we&rsquo;ll set the variable <code>@title</code> (pronounced &ldquo;at title&rdquo;) to the appropriate title for each action (<a class="ref" href="static-pages#code:pages_controller_with_title">extrait&nbsp;3.24</a>).</p>

<div class="label" id="code:pages_controller_with_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.24.</span> <span class="description">The Pages controller with per-page titles. <br /> <code>app/controllers/pages_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="s2">&quot;Home&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">contact</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="s2">&quot;Contact&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">about</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="s2">&quot;About&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>A statement such as</p>

<div class="code"><div class="highlight"><pre><span class="vi">@title</span> <span class="o">=</span> <span class="s2">&quot;Home&quot;</span>
</pre></div>
</div>


<p>is an <em>assignment</em>, in this case creating a new variable <code>@title</code> with value <code>"Home"</code>. The at sign&nbsp;<code>@</code> in <code>@title</code> indicates that it is an instance variable. Instance variables have a more general meaning in Ruby (see <a class="ref" href="rails-flavored-ruby#sec:objects_and_message_passing">section&nbsp;4.2.3</a>), but in Rails their role is primarily to link actions and views: any instance variable defined in the <code>home</code> action is automatically available in the <code>home.html.erb</code> view, and so on for other action/view pairs.<sup class="footnote" id="fnref:3.21"><a href="#fn:3.21">21</a></sup></p>

<p>We can see how this works by replacing the literal title &ldquo;Home&rdquo; with the contents of the <code>@title</code> variable in the <code>home.html.erb</code> view (<a class="ref" href="static-pages#code:home_view_erb_title">extrait&nbsp;3.25</a>).</p>

<div class="label" id="code:home_view_erb_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.25.</span> <span class="description">The view for the Home page with an Embedded Ruby title. <br /> <code>app/views/pages/home.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Sample App<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      This is the home page for the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
      sample application.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p><a class="ref" href="static-pages#code:home_view_erb_title">extrait&nbsp;3.25</a> is our first example of <em>Embedded Ruby</em>, also called <em>ERb</em>. (Now you know why HTML views have the file extension <code>.html.erb</code>.) ERb is the primary mechanism in Rails for including dynamic content in web pages.<sup class="footnote" id="fnref:3.22"><a href="#fn:3.22">22</a></sup> The code</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>indicates using <tt class="verb">&lt;%= ... %&gt;</tt> that Rails should insert the contents of the <code>@title</code> variable, whatever it may be. When we visit <tt>/pages/home</tt>, Rails executes the body of the <code>home</code> action, which makes the assignment <code>@title = "Home"</code>, so in the present case</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>gets replaced with &ldquo;Home&rdquo;. Rails then renders the view, using ERb to insert the value of <code>@title</code> into the template, which the web server then sends to your browser as HTML. The result is exactly the same as before, only now the variable part of the title is generated dynamically by ERb.</p>

<p>We can verify that all this works by running the tests from <a class="ref" href="static-pages#sec:testing_a_title_change">section&nbsp;3.3.1</a> and see that they still pass. Then we can make the corresponding replacements for the Contact and About pages (<a class="ref" href="static-pages#code:contact_view_erb_title">extrait&nbsp;3.26</a> and <a class="ref" href="static-pages#code:about_view_erb_title">extrait&nbsp;3.27</a>).</p>

<div class="label" id="code:contact_view_erb_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.26.</span> <span class="description">The view for the Contact page with an Embedded Ruby title. <br /> <code>app/views/pages/contact.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      Contact Ruby on Rails Tutorial about the sample app at the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/feedback&quot;</span><span class="nt">&gt;</span>feedback page<span class="nt">&lt;/a&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:about_view_erb_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.27.</span> <span class="description">The view for the About page with an Embedded Ruby title. <br /> <code>app/views/pages/about.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>About Us<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
      is a project to make a book and screencasts to teach web development
      with <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. This
      is the sample application for the tutorial.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>As before, the tests still pass.</p>

<div class="label" id="sec:layouts"></div>


<h3><a id="sec:3.3.4" href="static-pages#sec:layouts" class="heading"><span class="number">3.3.4</span> Eliminating duplication with layouts</a></h3>


<p>Now that we&rsquo;ve replaced the variable part of the page titles with instance variables and ERb, each of our pages looks something like this:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
      Contents
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>


<p>In other words, <em>all</em> our pages are identical in structure, including even the title (because of Embedded Ruby), with the sole exception of the contents of each page.</p>

<p>Wouldn&rsquo;t it be nice if there were a way to factor out the common elements into some sort of global layout, with the body contents inserted on a per-page basis? Indeed, it would be nice, and Rails happily obliges using a special file called <code>application.html.erb</code>, which lives in the <code>layouts</code> directory. To capture the structural skeleton, create the file <code>application.html.erb</code> and fill it with the contents of <a class="ref" href="static-pages#code:application_layout">extrait&nbsp;3.28</a>.</p>

<div class="label" id="code:application_layout"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.28.</span> <span class="description">The sample application site layout. <br /> <code>app/views/layouts/application.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tag</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Note here the special line</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>This code is responsible for inserting the contents of each page into the layout. As with <tt class="verb">&lt;%= @title %&gt;</tt>, the <tt class="verb">&lt;% ... %&gt;</tt> tags indicate Embedded Ruby, and the equals sign in <tt class="verb">&lt;%= ... %&gt;</tt> ensures that the results of evaluating the expression are inserted at that exact point in the template. (Don&rsquo;t worry about the meaning of the word &ldquo;yield&rdquo; in this context;<sup class="footnote" id="fnref:3.23"><a href="#fn:3.23">23</a></sup> what matters is that using this layout ensures that visiting the page <tt>/pages/home</tt> converts the contents of <code>home.html.erb</code> to HTML and then inserts it in place of <tt class="verb">&lt;%= yield %&gt;</tt>.</p>

<p>Now that we have a site-wide layout, we&rsquo;ve also taken this opportunity to add a security feature to each page. <a class="ref" href="static-pages#code:application_layout">extrait&nbsp;3.28</a> adds the code</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">csrf_meta_tag</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>which uses the Rails method <code>csrf_meta_tag</code> to prevent <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgery</a> (CSRF), a type of malicious web attack. Don&rsquo;t worry about the details (I don&rsquo;t); just know that Rails is working hard to keep your application secure.</p>

<p>Of course, the views in <a class="ref" href="static-pages#code:home_view_erb_title">extrait&nbsp;3.25</a>, <a class="ref" href="static-pages#code:contact_view_erb_title">extrait&nbsp;3.26</a>, and <a class="ref" href="static-pages#code:about_view_erb_title">extrait&nbsp;3.27</a> are still filled with all the HTML structure we just hoisted into the layout, so we have to rip it out, leaving only the interior contents. The resulting cleaned-up views appear in <a class="ref" href="static-pages#code:home_view_interior">extrait&nbsp;3.29</a>, <a class="ref" href="static-pages#code:contact_view_interior">extrait&nbsp;3.30</a>, and <a class="ref" href="static-pages#code:about_view_interior">extrait&nbsp;3.31</a>.</p>

<div class="label" id="code:home_view_interior"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.29.</span> <span class="description">The Home view with HTML structure removed. <br /> <code>app/views/pages/home.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Sample App<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  This is the home page for the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
  sample application.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:contact_view_interior"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.30.</span> <span class="description">The Contact view with HTML structure removed. <br /> <code>app/views/pages/contact.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Contact Ruby on Rails Tutorial about the sample app at the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/feedback&quot;</span><span class="nt">&gt;</span>feedback page<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:about_view_interior"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.31.</span> <span class="description">The About view with HTML structure removed. <br /> <code>app/views/pages/about.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>About Us<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
  is a project to make a book and screencasts to teach web development
  with <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. This
  is the sample application for the tutorial.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>With these views defined, the Home, Contact, and About pages are exactly the same as before&mdash;i.e., we have successfully refactored them&mdash;but they have much less duplication. And, as required, the tests still pass.</p>

<div class="label" id="sec:static_pages_conclusion"></div>


<h2><a id="sec:3.4" href="static-pages#sec:static_pages_conclusion" class="heading"><span class="number">3.4</span> Conclusion</a></h2>


<p>Seen from the outside, this chapter hardly accomplished anything: we started with static pages, and ended with&hellip; <em>mostly</em> static pages. But appearances are deceiving: by developing in terms of Rails controllers, actions, and views, we are now in a position to add arbitrary amounts of dynamic content to our site. Seeing exactly how this plays out is the task for the rest of this tutorial.</p>

<p>Before moving on, let&rsquo;s take a minute to commit our changes and merge them into the master branch. Back in <a class="ref" href="static-pages#sec:static_pages_with_rails">section&nbsp;3.1.2</a> we created a Git branch for the development of static pages. If you haven&rsquo;t been making commits as we&rsquo;ve been moving along, first make a commit indicating that we&rsquo;ve reached a stopping point:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Done with static pages&quot;</span>
</pre></div>
</div>


<p>Then merge the changes back into the master branch using the same technique as in <a class="ref" href="beginning#sec:git_commands">section&nbsp;1.3.5</a>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout master
<span class="gp">$</span> git merge static-pages
</pre></div>
</div>


<p>Once you reach a stopping point like this, it&rsquo;s usually a good idea to push your code up to a remote repository (which, if you followed the steps in <a class="ref" href="beginning#sec:github">section&nbsp;1.3.4</a>, will be GitHub):</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
<span class="gp">$</span> git push
</pre></div>
</div>


<p>If you like, at this point you can even deploy the updated application to Heroku:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
<span class="gp">$</span> git push heroku
</pre></div>
</div>


<p>Note that in both cases I&rsquo;ve run <code>rspec spec/</code>, just to be sure that all the tests still pass. Running your tests before pushing or deploying is a good habit to cultivate.</p>

<div class="label" id="sec:static_pages_exercises"></div>


<h2><a id="sec:3.5" href="static-pages#sec:static_pages_exercises" class="heading"><span class="number">3.5</span> Exercises</a></h2>




<ol>

<li>Make a Help page for the sample app. First write a test for the existence of a page at the URL <tt>/pages/help</tt>. Then write a second test for the title &ldquo;Ruby on Rails Tutorial Sample App | Help&rdquo;. Get your tests to pass, and then fill in the Help page with the content from <a class="ref" href="static-pages#code:help_page">extrait&nbsp;3.32</a>.</li>

<li>You may have noticed some repetition in the Pages controller spec (<a class="ref" href="static-pages#code:pages_controller_spec_title">extrait&nbsp;3.20</a>). In particular, the base title, &ldquo;Ruby on Rails Tutorial Sample App&rdquo;, is the same for every title test. Using the RSpec <code>before(:each)</code> facility, which executes a block of code before each test case, fill in <a class="ref" href="static-pages#code:pages_controller_spec_exercise">extrait&nbsp;3.33</a> to define a <code>@base_title</code> instance variable that eliminates this duplication. (This code uses two new elements: a <em>symbol</em>, <code>:each</code>, and the string concatenation operator <code>+</code>. We&rsquo;ll learn more about both in <a class="ref" href="rails-flavored-ruby#top">chapitre&nbsp;4</a>, and we&rsquo;ll see <code>before(:each)</code> again in <a class="ref" href="modeling-and-viewing-users-one#sec:presence_validation">section&nbsp;6.2.1</a>.) Note that, with the base title captured in an instance variable, we are now able to align <code>:content</code> with the first character inside each left parenthesis&nbsp;<code>(</code>. This is my preferred convention for formatting code broken into multiple lines.</li>

</ol>




<div class="label" id="code:help_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.32.</span> <span class="description">Code for a proposed Help page. <br /> <code>app/views/pages/help.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Help<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Get help on Ruby on Rails Tutorial at the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/help&quot;</span><span class="nt">&gt;</span>Rails Tutorial help page<span class="nt">&lt;/a&gt;</span>.
  To get help on this sample app, see the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/book&quot;</span><span class="nt">&gt;</span>Rails Tutorial book<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:pages_controller_spec_exercise"></div>


<div class="codelisting">
<div class="listing"><span class="header">Extrait 3.33.</span> <span class="description">The Pages controller spec with a base title. <br /> <code>spec/controllers/pages_controller_spec.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>
  <span class="n">render_views</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1">#</span>
    <span class="c1"># Define @base_title here.</span>
    <span class="c1">#</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="vi">@base_title</span> <span class="o">+</span> <span class="s2">&quot; | Home&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;contact&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="vi">@base_title</span> <span class="o">+</span> <span class="s2">&quot; | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;about&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="vi">@base_title</span> <span class="o">+</span> <span class="s2">&quot; | About&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<div class="navigation">  <a class="prev_page" href="a-demo-app#top">
    &laquo;&nbsp;<span class="number">chapitre 2</span> A demo app
  </a>
  <a class="next_page" href="rails-flavored-ruby#top">
    <span class="number">chapitre 4</span> Rails-flavored Ruby&nbsp;&raquo;
  </a>
</div><div class="footnotes">
<ol>
<li id="fn:3.1">As before, you may find the augmented file from <a class="ref" href="beginning#code:gitignore">extrait&nbsp;1.5</a> to be more convenient depending on your system.&nbsp;<a class="arrow" href="#fnref:3.1">&uarr;</a></li>
<li id="fn:3.2">In fact, Rails ensures that requests for such files never hit the main Rails stack; they are delivered directly from the filesystem. (See <a href="http://www.amazon.com/gp/product/0321601661?ie=UTF8&amp;tag=httpwwwrailst-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0321601661"><em>The Rails&nbsp;3 Way</em></a> for more details.)&nbsp;<a class="arrow" href="#fnref:3.2">&uarr;</a></li>
<li id="fn:3.3">As usual, replace <code>mate</code> with the command for your text editor.&nbsp;<a class="arrow" href="#fnref:3.3">&uarr;</a></li>
<li id="fn:3.4">HTML changes with time; by explicitly making a doctype declaration we make it likelier that browsers will render our pages properly in the future. The extremely simple doctype <code>&lt;!DOCTYPE html&gt;</code> is characteristic of the latest HTML standard, HTML5.&nbsp;<a class="arrow" href="#fnref:3.4">&uarr;</a></li>
<li id="fn:3.5">Our method for making static pages is probably the simplest, but it&rsquo;s not the only way. The optimal method really depends on your needs; if you expect a <em>large</em> number of static pages, using a Pages controller can get quite cumbersome, but in our sample app we&rsquo;ll only need a few. See this <a href="http://blog.hasmanythrough.com/2008/4/2/simple-pages">blog post on simple pages at <tt>has_many :through</tt></a> for a survey of techniques for making static pages with Rails. <em>Warning:</em> the discussion is fairly advanced, so you might want to wait a while before trying to understand it.&nbsp;<a class="arrow" href="#fnref:3.5">&uarr;</a></li>
<li id="fn:3.6">In the context of RSpec, TDD is also known as Behavior Driven Development, or BDD. (Frankly, I&rsquo;m not convinced there&rsquo;s much of a difference.)&nbsp;<a class="arrow" href="#fnref:3.6">&uarr;</a></li>
<li id="fn:3.7">The <a href="http://github.com/thoughtbot/shoulda">Shoulda</a> testing framework is a good alternate choice (and in fact can be used with RSpec). It&rsquo;s the Other Rails Way, so to speak.&nbsp;<a class="arrow" href="#fnref:3.7">&uarr;</a></li>
<li id="fn:3.8">This used to be just <tt>autotest-rails</tt>, but that gem depends on the full ZenTest suite, which caused problems on some systems. The <tt>autotest-rails-pure</tt> gem avoids this dependency.&nbsp;<a class="arrow" href="#fnref:3.8">&uarr;</a></li>
<li id="fn:3.9">The Autotest Growl gem causes the test results to be automatically displayed to the monitor, whereas the FSEvent gem causes Autotest to use OS&nbsp;X filesystem events to trigger the test suite, rather than continuously polling the filesystem. Also note that with both gems you might need to use an updated version if you&rsquo;re running OS&nbsp;X Snow Leopard.&nbsp;<a class="arrow" href="#fnref:3.9">&uarr;</a></li>
<li id="fn:3.10">http://fredschoeneman.posterous.com/pimp-your-autotest-notification&nbsp;<a class="arrow" href="#fnref:3.10">&uarr;</a></li>
<li id="fn:3.11">In the context of RSpec, tests are often called <em>specs</em>, but for simplicity I&rsquo;ll usually stick to the term &ldquo;test&rdquo;&mdash;<em>except</em> when referring to a file such as <code>pages_controller_spec</code>, in which case I&rsquo;ll write &ldquo;Pages controller spec&rdquo;.&nbsp;<a class="arrow" href="#fnref:3.11">&uarr;</a></li>
<li id="fn:3.12">Most IDEs also have an interface to testing, but as noted in <a class="ref" href="beginning#sec:development_tools">section&nbsp;1.2.1</a> I have limited experience with those tools.&nbsp;<a class="arrow" href="#fnref:3.12">&uarr;</a></li>
<li id="fn:3.13">You can also run <code>rake spec</code>, which is basically equivalent. (Annoyingly, if you want to run <code>rake spec</code> here you have to run <code>rake db:migrate</code> first, even though the tests in this chapter don&rsquo;t require a database.)&nbsp;<a class="arrow" href="#fnref:3.13">&uarr;</a></li>
<li id="fn:3.14">A <em>spork</em> is a combination spoon-fork. My guess is that the project&rsquo;s name is a pun on Spork&rsquo;s use of <a href="http://en.wikipedia.org/wiki/POSIX">POSIX</a> <a href="http://en.wikipedia.org/wiki/Fork_(software_development)">forks</a>.&nbsp;<a class="arrow" href="#fnref:3.14">&uarr;</a></li>
<li id="fn:3.15">DRb stands for &ldquo;Distributed Ruby&rdquo;.&nbsp;<a class="arrow" href="#fnref:3.15">&uarr;</a></li>
<li id="fn:3.16">We&rsquo;ll learn in <a class="ref" href="rails-flavored-ruby#sec:hashes_and_symbols">section&nbsp;4.3.3</a> that the <code>:content =&gt; "&hellip;"</code> syntax is a <em>hash</em> using a <em>symbol</em> as the key.&nbsp;<a class="arrow" href="#fnref:3.16">&uarr;</a></li>
<li id="fn:3.17">I consider this a step back from RSpec&nbsp;1.3, which used <code>have_tag</code> in this context, which could be used to require an exact match. Unfortunately, as of this writing <code>have_tag</code> is not available in RSpec&nbsp;2.&nbsp;<a class="arrow" href="#fnref:3.17">&uarr;</a></li>
<li id="fn:3.18">A newline is what comes at the end of a line, starting a, well, new line. In code, it is represented by the character <tt class="verb">\n</tt>.&nbsp;<a class="arrow" href="#fnref:3.18">&uarr;</a></li>
<li id="fn:3.19">Actually <em>counting</em> columns could drive you crazy, which is why many text editors have a visual aid to help you. Consider TextMate, for example; if you take a look back at <a class="ref" href="beginning#fig:editor_shell">illustration&nbsp;1.1</a>, you&rsquo;ll see a small vertical line on the right to help keep code under 80 characters. (It&rsquo;s actually at 78 columns, which gives you a little margin for error.) If you use TextMate, you can find this feature under <tt>View &gt; Wrap Column &gt; 78</tt>.&nbsp;<a class="arrow" href="#fnref:3.19">&uarr;</a></li>
<li id="fn:3.20">Rails 2.3/RSpec 1.3, used the shorter <code>have_tag</code> instead of <code>have_selector</code>, and the <code>:content</code> argument wasn&rsquo;t necessary either. Newer isn&rsquo;t always better&hellip;&nbsp;<a class="arrow" href="#fnref:3.20">&uarr;</a></li>
<li id="fn:3.21">In fact, the instance variable is actually visible in <em>any</em> view, a fact we&rsquo;ll make use of in <a class="ref" href="sign-up#sec:a_working_form">section&nbsp;8.2.2</a>.&nbsp;<a class="arrow" href="#fnref:3.21">&uarr;</a></li>
<li id="fn:3.22">There is a second popular template system called <a href="http://haml-lang.com/">Haml</a>, which I personally love, but it&rsquo;s not <em>quite</em> standard enough yet for use in an introductory tutorial. If there is sufficient interest, I might produce a Rails Tutorial screencast series using Haml for the views. This would also allow for an introduction to <a href="http://sass-lang.com/">Sass</a>, Haml&rsquo;s sister technology, which if anything is even more awesome than Haml.&nbsp;<a class="arrow" href="#fnref:3.22">&uarr;</a></li>
<li id="fn:3.23">If you&rsquo;ve studied Ruby before, you might suspect that Rails is <em>yielding</em> the contents to a block, and your suspicion would be correct. But, as far as developing web applications with Rails, it doesn&rsquo;t matter, and I&rsquo;ve honestly never given the meaning of <tt class="verb">&lt;%= yield %&gt;</tt> a second thought&mdash;or even a first one.&nbsp;<a class="arrow" href="#fnref:3.23">&uarr;</a></li>
</ol>
</div>




